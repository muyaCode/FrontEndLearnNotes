# 项目系统架构

## 怎么成为一名前端架构师？

- 真实的架构设计过程
- 真实的商业级项目
- 大型复杂业务
- 完善的工程体系
- 完善的运维体系
- 研发流程+项目管理
- 前沿+全面的前端技术栈

### 架构师思维分析需求

你作为前端负责人，来开发一个 h5 页，某个抽奖功能的运营活动。假定 PM(产品经理) 和后端 RD 都是实习生，技术和业务都不熟练，你要从 0 开发这个页面，你会要求 server 端给你哪些接口和能力?

#### 多数人的答案

所有人都能想到，需要一个抽奖接口。否则，他就不是一个合格的程序员了。

很少部分人能想到，需要一个用户信息接口，否则都不知道奖品给谁，总得登录以下。或者直接输入手机号抽奖也行，但需求没有说这里有手机号。

还有，加入刚刚抽了奖，再重新进入界面，是否要禁用抽奖？是否要限制每个人抽奖一次？这些需求没说，但这些很重要，这些可都需要后端支持。

### 项目浅层需求

解读需求、去深入理解业务。请大家记住：需求指导设计，设计指导开发。

表面的需求其实很简单:

- 登录
- 创建一个作品，编辑，发布
- 访问作品 h5

细心的同学估计会继续补充和分组

用户信息

- 登录(短信验证码登录)
- 注册
- 获取用户信息

作品

- 创建
- 保存
- 发布
- 获取作品信息
- 获取作品列表

模板

- 模板列表
- 使用模板创建

### 深度需求分析

不容易一眼看到，但却很重要的需求

PS：如果真如“浅层需求“那么简单，那我们也没必要建那么多代码仓库，可能一两个就搞定了。

#### 作品的管理

- 删除和恢复
- 转赠(例如，员工离职交接工作)
- 复制

#### 作品统计

我们一再强调需求闭环，统计就能很好的体现这一点——有输入有输出，创建发布了作品，当然要看一看统计结果。

- 统计
- 分渠道统计，渠道对于运营人员非常重要

#### 作品发布

- url 不能变
- 支持多渠道

#### H5

- 分享-对业务增长负责，这里就能体现

#### 后台管理

全局把控，让一切尽在掌握之中

- 数据统计
- 作品管理，能快速下线作品，防止有违规内容
- 用户管理，能快速冻结用户，防止有违规用户
- 模板管理，能控制哪些模块展示、哪些不展示

#### 小结

- 作品管理
- 统计
- 发布
- h5
- 后台管理

#### 主要内容

- 如何以架构师思维分析需求
- 项目的浅层需求
- 项目的深度需求
- 需求总揽

#### 主要产出

- 熟悉产品需求
- 学会以架构师的思维分析需求
- 全局思维、整体思维、闭环思维

#### 附:和 PM 的关系

- 程序员和 PM(产品经理) 的关系：水火不容，势不两立
- 架构师和 PM(产品经理) 的关系：统一战线，对业务负责

所以，建议各位程序员，在遇到需求时，都要学着以架构师的思维去理解，和 PM 做朋友

## 架构设计

> 任何看似复杂的设计，都是让整个系统变的更简单

熟悉了需求之后，就要考虑如何把他做出来

其实架构师的职责，就是在深入理解业务需求之后，能用软件把业务给模拟出来。并且保证稳定执行，和后续增长。只要能满足这个条件即可，不一定非得用上什么看似高大上的技术和框架。技术永远都是为业务服务的。

"很多程序员学了大量的算法和计算机基础，然而在工作中却派不上用场。这是非常正常的，因为这些内容是为了在科学领域做研究准备的。而在业务领域，大多是如何把现有业务在软件中模拟出来的问题，并没有太高深的数学问题。并且现在的计算机硬件，比如 CPU、内存、存储都很便宜，也不需要斤斤计较的去抠空间和时间复杂度。这些都导致所学不能致用。反而如何能够高效的把业务用软件表达出来，并能够随着业务的增长，让软件也快速长大，则变成了一个更重要的问题。这一点可能是当前计算机软件教育需要思考的问题。"——《聊聊架构》

### 主要产出

- 《整体技术方案设计》文档
- 学会如何写技术方案设计(很多同学可能一次都没写过技术方案，上来就写代码，这其实很不好)

### 主要内容

- 需要哪些项目，各项目之间的关系
- 独立的业务组件库
- 为何要自研”自定义事件统计”服务?
- 作品的数据结构设计
- 写《技术方案设计》文档

### 注意事项

- 不要关注细节，要看整体，看范围
- 考虑扩展性 (这就需要深入理解业务，否则你也不知道未来将如何扩展)
- 考虑可行性，不确定的就调研一下
- 考虑实现成本，不要为了设计而设计，技术要永远服务于业务——永远都要选择最简单的实现方案

### 分析需求，确定需要创建的项目

- 先不看细节，看整体，这一步就是确定项目的范围。确定范围是做任何事情的第一步
- 范围确定好了，剩下的事情，即便有问题，也属于"人民内部矛盾"。该购买第三方服务，还是该自研，或者该放弃，就看实际情况了

### 需要哪些项目

从需求来看，比较重要的几个方面: B 端和编辑器，H5，管理后台

B 端和编辑器，做前后端分离

- biz-editor-fe
- biz-editor-server

H5 适合做 SSR，因为要考虑性能

- H5-server

管理后台，做前端分析

- admin-fe
- admin-server

[注意] 大家都到处嚷嚷 SSR，方案，不要为了设计而设计。使用还是得分场景。
一般来讲，toB 的不适合用，toC 的适合用。 所以，架构设计要考虑成本，要用最简单

### 独立的业务组件库

画布使用的组件和渲染逻辑，和 H5 页面是完全一样的。所以，两边不应该有几余，应该复用。所以，就把业务组件库给抽离出来 H5 使用

### 为何自研统计服务

#### 熟悉需求很重要

回顾一下作品的渠道，以及分渠道统计，这个需求。

而且，我们非常明确，这个需求是我们业务环节中非常重要的一部分，没有它，我们业务就无法闭环，就跑不通。随意，这肯定是不能的

#### 为何自研

要实现这个功能，我们就需要自定义事件统计。普通的 pv 统计，是无法满足要求的。

- 支持自定义事件统计
- 支持 Open API--重要

一开始我们以为会有一些第三方的统计服务：如友盟、百度统计、arms，可以支持。但后来调研发现，他们要么不支持，要么收费很贵统计一年好几万)

所以，需求又不能砍掉，我们综合对比，只能选择自研一个。包括

- 日志收集
- 日志分析
- penAPI

#### 注意事项

这块又可能听着比较懵.但没关系，只要真正了解了这块需求，不会影响你接下来的需求

### 各项目之间的关系图

...

### 项目之间的数据结构设计思路

总之，基本思路就是：

- 每个组件尽量符合 vnode 规范
- 用数组来组织数据，有序
- 尽量使用引用关系，不要冗余

#### 数据流转

核心：B 端、C 端、管理后台，共用一个数据库

- 创建作品：初始化一个 JSON 数据
- 保存作品：修改 JSON 数据
- 发布作品：修改一个标记，仅此而已
- C 端浏览作品:获取 JSON 数据，SSR 染页面
- 屏蔽作品：修改一个标记，C 端来判断

当然，其中 C 端还有缓存，防止频繁访问数据库。

#### 注意事项

大家千万不要扣细节，以及拿现在的代码实例和接下来前端开发的代码进行对比!!!否则你就是自讨苦吃。

我们做技术方案设计，为的就是寻找一个方向，论证：可行性、扩展性、复杂度高低。我们没法在现在就确定细节，更没法保证未来的细节，就一定和现在一模一样

但我们能保证：设计的方向和思路，是一样的，就行了

### 写技术方案设计文档

#### 关于技术方案设计文档

为何难写?

- 没有规范可依 e
- 不常写

如何写，技巧:

- 随性一些，解释一下你要如何做，即可.
- 可以先尝试写一部分代码，捋一捋思路，再来写文档-[注意]这里写代码纯是为了捋思路、为了写文档，搞清楚目的

写设计文档是浪费时间吗?

- 如果你真的想明白了，最多浪费你 1-2h 时间，不会导致项目延期 0
- 如果你写不出来，说明你没想明白，正好暴露了问题

### 技术方案文档目录（整体架构设计 V1.0）

#### 需求

需求地址或者需求的说明

#### 范围

整体设计，架构设计，没有细节

#### 模块设计

模块的拆分和关系图，结果模块的关键功能，职责等

特殊的模块重点说明

- 组件库，独立第三方，同时用于编辑器和 H5
- 自研统计服务，为何自研

#### 核心数据结构

vuex store 的结构，解释数据流转关系图

#### 扩展型保证

扩展组件，数据结构层面扩展编辑器的功能，例如: 组件隐藏、锁定扩展页面的配置(讨论，集思广益)

#### 开发提效

脚手架

组件平台

#### 运维保障

线上服务和运维服务

安全

监控和报警

服务扩展性：流量大

## 知识点

![架构图例](.\img\架构图例.jpg)

### 脚手架-创建项目

- 包管理：lerma
- 环境变量：dotenv
- 海令行：commander
- log 定制：npmlog
- 版本检宜：semver
- npm api
- npm 台安装：npm install
- 通用 Package 类封装
- 命令行交互：inquirer
- 命令行 loading：spinner
- ejs 模板渲染
- 文件匹配器：glob
- egg.js

### 脚手架-发布项目

- 云构建 CloudBuild 封装
- Github & Gitee API 接入
- git 操作：simple-git
- git flow 自动化
- npm 自动化
- WebSocket
- egg-socket.io
- egg-redis
- base64 加密&解密
- 命令行 link：terminalLink

### 前端-toB

TypeScript

Vue3

Vuex4

Vue Router4

Ant Design Vue

Ant Design Vue 二次开发

截图：html/2canvas

图片裁剪：cropperjs

快捷键：hotkeys-js

二维码：qrcodejs2

拖动排序：vue-draggable-next

组件拖动

组件缩放

组件移动

右键菜单

复制粘贴

撤销重做

动态表单

### 前端-toC

Wue3 SSR

移动响应式

微信分享

事件处理

埋点统计

### 业务组件库

rollup 打包

rollup vue 插件

rollup typescript 插件

rollup oommonjs 插件

rollup css-only 摄插件

sourcemap

vue-test-utils

npm 发布和配置

### 组件平台

egg.js rustfut API

egg-mysql

egg-mock

umi

Ant Design 4

Ract

hooks

### 服务端

Koa2

登录验证 JWT

跨域配置 CORS

模板引擎 pug

ORM 框架 Sequelize

mongoose

缓存

GraphGL

文件上传

定时任务

日志分析

输入验证 Validator

JSON Schama

加密 Crypto

静态资源处理

#### 第二种

Typescript
Egg.js
MongoDB
Mongoose
加密 Bcrypt
Redis
Oauth2
登录验证 JWT
跨域配置 CORS
模板引擎 nunjucks
RBAC 权限系统
权限实现: Casl
本地文件上传
OSS 云文件上传
Sharp 本地文件处理
SSR

### 第三方服务

阿里云 OSS

阿里云 ARMS

微信 jsjdk

腾讯云短信服务 SMS

百度云敏感内容审查

自研统计服务 EAS

### 性能优化

webpack-bundle-analyzer

webpack 构建优化

webpack 分包

webpack gzip 压缩

webpack extra css

H5 图片懒加载

HTTP 缓存

HTTP 压缩 （gzip+Brotli）

HTTP/2

静态资源发布 CDN

### 打包构建

webpack

webpack 插件开发

rollup

githooks：husky

lint 检查

prettier 格式化

jest 单元测试

mocha 单元测试

### 持续集成 CI/CD

CentOS

ssh 信任

shell 脚本

github actions 持续集成

travis 持续集成

docker

docker-compose

敏感信息处理

自动化接口测试 SuperTest

自动发布测试机

release-it

### 线上云服务

域名备案和解析

CNAME 域名转发

HTTP 证书

云服务器 ECS

云 MySQL

云 MongoDB

云 Redis

阿里云 OSS

阿里云 CDN

阿里云 WAF

反向代理 Nginx

进程守护 pm2

### 运维&监控

服务器监控

ali-node

心跳检测

异常处理

报警

定时任务 crontab

日志拆分 pm2-logrotate

安全预防

防御 CC 攻击

防刷防爬

### 研发流程

- 架构设计
- 技术选型
- 技术方案设计
- 接口设计
- 数据库设计
- 制定计划
- 监控执行
- 多人协作
- code review
- bug 修复流程
- 产品迭代流程

### 团队建设

- 绩效考核
- 面试技巧
- 工作汇报
- 晋升答辩
- 沟通技巧
- 团队分享
