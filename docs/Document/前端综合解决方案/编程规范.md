# ç¼–ç è§„èŒƒï¼šä»£ç æ£€æµ‹å·¥å…·+ä»£ç æ ¼å¼åŒ–+Git æäº¤è§„èŒƒ

## Vue3 é¡¹ç›®åˆ›å»ºçš„é…ç½®ï¼šeslintï¼šä»£ç æ£€æµ‹å·¥å…· + prettierï¼šä»£ç æ ¼å¼åŒ–å·¥å…·

vue3 å®˜æ–¹åˆ›å»º vue é¡¹ç›®å‘½ä»¤

```bash
pnpm create vue@latest
```

æ ¹æ®äº¤äº’å¼é€‰æ‹©æ„å»ºé¡¹ç›®

![image-20240221161309074](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240221161309074.png)

è‡³æ­¤ï¼Œé›†æˆäº† eslint+prettier çš„ vue3 é¡¹ç›®æ¨¡ç‰ˆåˆ›å»ºå®Œæˆã€‚

### eslintï¼šä»£ç æ£€æµ‹å·¥å…·

- eslint å®˜ç½‘ï¼š[Find and fix problems in your JavaScript code - ESLint - Pluggable JavaScript Linter](https://eslint.org/)
- npmï¼š[eslint - npm (npmjs.com)](https://www.npmjs.com/package/eslint)

`ESLint` æ˜¯ `2013å¹´6æœˆ` åˆ›å»ºçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒçš„ç›®æ ‡éå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯ **æä¾›ä¸€ä¸ªæ’ä»¶åŒ–çš„ `javascript` ä»£ç æ£€æµ‹å·¥å…·** ï¼Œè¯´ç™½äº†å°±æ˜¯åš **ä»£ç æ ¼å¼æ£€æµ‹ä½¿ç”¨çš„**

æ‰“å¼€é¡¹ç›®ï¼Œåœ¨å½“å‰çš„é¡¹ç›®ä¸­ï¼ŒåŒ…å«ä¸€ä¸ª `.eslintrc.cjs` æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ `eslint` çš„é…ç½®æ–‡ä»¶ã€‚

![image-20240221161840415](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240221161840415.png)

æ¥ä¸‹æ¥æˆ‘ä»¬å°±åœ¨è¯¥è§„åˆ™ä¹‹ä¸‹ï¼Œçœ‹ä¸€çœ‹ `ESLint` å®ƒçš„ä¸€äº›é…ç½®éƒ½æœ‰ä»€ä¹ˆï¼Ÿ

æ‰“å¼€é¡¹ç›®ä¸­çš„ `.eslintrc.cjs` æ–‡ä»¶

```js
/* eslint-env node */
require("@rushstack/eslint-patch/modern-module-resolution");
// æ–‡æ¡£ï¼šhttps://eslint.bootcss.com/docs/user-guide/configuring
module.exports = {
	// è¡¨ç¤ºå½“å‰ç›®å½•å³ä¸ºæ ¹ç›®å½•ï¼ŒESLint è§„åˆ™å°†è¢«é™åˆ¶åˆ°è¯¥ç›®å½•ä¸‹
	root: true,
	extends: [
		"plugin:vue/vue3-essential",
		"eslint:recommended",
		"@vue/eslint-config-typescript",
		"@vue/eslint-config-prettier/skip-formatting",
	],
	// è§£æå™¨
	parserOptions: {
		ecmaVersion: "latest",
		parser: "@babel/eslint-parser",
	},
	// éœ€è¦ä¿®æ”¹çš„å¯ç”¨è§„åˆ™åŠå…¶å„è‡ªçš„é”™è¯¯çº§åˆ«
	/**
	 * é”™è¯¯çº§åˆ«åˆ†ä¸ºä¸‰ç§ï¼š
	 * "off" æˆ– 0 - å…³é—­è§„åˆ™
	 * "warn" æˆ– 1 - å¼€å¯è§„åˆ™ï¼Œä½¿ç”¨è­¦å‘Šçº§åˆ«çš„é”™è¯¯ï¼šwarn (ä¸ä¼šå¯¼è‡´ç¨‹åºé€€å‡º)
	 * "error" æˆ– 2 - å¼€å¯è§„åˆ™ï¼Œä½¿ç”¨é”™è¯¯çº§åˆ«çš„é”™è¯¯ï¼šerror (å½“è¢«è§¦å‘çš„æ—¶å€™ï¼Œç¨‹åºä¼šé€€å‡º)
	 */
	rules: {
		"no-console": process.env.NODE_ENV === "production" ? "warn" : "off",
		"no-debugger": process.env.NODE_ENV === "production" ? "warn" : "off",
	},
};
```

é‚£ä¹ˆåˆ°è¿™é‡Œå’±ä»¬å·²ç»å¤§è‡´çš„äº†è§£äº†`.eslintrc.cjs` æ–‡ä»¶ï¼ŒåŸºäº `ESLint` å¦‚æœæˆ‘ä»¬å‡ºç°ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç æ ¼å¼æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šå¾—åˆ°ä¸€ä¸ªå¯¹åº”çš„é”™è¯¯ã€‚

æ¯”å¦‚ï¼š

> æˆ‘ä»¬å¯ä»¥æŠŠ `Home.vue` ä¸­çš„ `name` å±æ€§å€¼ï¼Œç”±å•å¼•å·æ”¹ä¸ºåŒå¼•å·

æ­¤æ—¶ï¼Œåªè¦æˆ‘ä»¬ä¸€ä¿å­˜ä»£ç ï¼Œé‚£ä¹ˆå°±ä¼šå¾—åˆ°ä¸€ä¸ªå¯¹åº”çš„é”™è¯¯

![image-20210904185336318](./ç¼–ç¨‹è§„èŒƒ.assets/image-20210904185336318-1708445224395-7.png)

è¿™ä¸ªé”™è¯¯è¡¨ç¤ºï¼š

1. æ­¤æ—¶æˆ‘ä»¬è§¦å‘äº†ä¸€ä¸ª ã€Šé”™è¯¯çº§åˆ«çš„é”™è¯¯ã€‹
2. è§¦å‘è¯¥é”™è¯¯çš„ä½ç½®æ˜¯ åœ¨ `Home.vue` çš„ç¬¬ 13 è¡Œ ç¬¬ä¹åˆ— ä¸­
3. é”™è¯¯æè¿°ä¸ºï¼šå­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨å•å¼•å·
4. é”™è¯¯è§„åˆ™ä¸ºï¼š`quotes`

é‚£ä¹ˆæƒ³è¦è§£å†³è¿™ä¸ªé”™è¯¯ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼ï¼š

1. æŒ‰ç…§ `ESLint` çš„è¦æ±‚ä¿®æ”¹ä»£ç 
2. ä¿®æ”¹ `ESLint` çš„éªŒè¯è§„åˆ™

**æŒ‰ç…§ `ESLint` çš„è¦æ±‚ä¿®æ”¹ä»£ç ï¼š**

> åœ¨ `Home.vue` çš„ç¬¬ 13 è¡Œä¸­æŠŠåŒå¼•å·æ”¹ä¸ºå•å¼•å·

**ä¿®æ”¹ `ESLint` çš„éªŒè¯è§„åˆ™ï¼š**

1. åœ¨ `.eslintrc.cjs` æ–‡ä»¶ä¸­ï¼Œæ–°å¢ä¸€æ¡éªŒè¯è§„åˆ™

   ```json
   "quotes": "error" // é»˜è®¤
   "quotes": "warn" // ä¿®æ”¹ä¸ºè­¦å‘Š
   "quotes": "off" // ä¿®æ”¹ä¸æ ¡éªŒ
   ```

ä¸€ä¸ªå›¢é˜Ÿä¸­ï¼Œäººå‘˜çš„æ°´å¹³é«˜ä½ä¸é½ï¼Œå¤§é‡çš„ `ESLint` è§„åˆ™æ ¡éªŒï¼Œä¼šè®©å¾ˆå¤šçš„å¼€å‘è€…å¤´ç–¼ä¸å·²ï¼Œä»è€Œå¤§å¤§å½±å“äº†é¡¹ç›®çš„å¼€å‘è¿›åº¦ã€‚

è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨ä½ å»å®Œæˆé¡¹ç›®ä»£ç çš„åŒæ—¶ï¼Œè¿˜éœ€è¦æ—¶æ—¶åˆ»åˆ»æ³¨æ„ä»£ç çš„æ ¼å¼é—®é¢˜ï¼Œè¿™å°†æ˜¯ä¸€ä»¶å¤šä¹ˆç—›è‹¦çš„äº‹æƒ…ï¼

é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•ï¼Œæ—¢å¯ä»¥ä¿è¯ `ESLint` è§„åˆ™æ ¡éªŒï¼Œåˆå¯ä»¥è§£å†³ä¸¥è‹›çš„æ ¼å¼è§„åˆ™å¯¼è‡´çš„å½±å“é¡¹ç›®è¿›åº¦çš„é—®é¢˜å‘¢ï¼Ÿ

æ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œè¯·çœ‹ä¸‹ä¸€èŠ‚ã€Š`Prettier` ï¼Œï¼šä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œè®©ä½ çš„ä»£ç å˜å¾—æ›´æ¼‚äº®ï¼ã€‹

### prettierï¼šä»£ç æ ¼å¼åŒ–å·¥å…·

- prettier å®˜ç½‘ï¼š[Install Â· Prettier](https://prettier.io/docs/en/install.html)
- Prettier ä¸­æ–‡ç½‘ï¼š[Prettier ä¸­æ–‡ç½‘ Â· Prettier æ˜¯ä¸€ä¸ªâ€œæœ‰æ€åº¦â€çš„ä»£ç æ ¼å¼åŒ–å·¥å…·](https://www.prettier.cn/)

**`prettier` æ˜¯ä»€ä¹ˆï¼Ÿ**

1. ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·
2. å¼€ç®±å³ç”¨
3. å¯ä»¥ç›´æ¥é›†æˆåˆ° `VSCode` ä¹‹ä¸­
4. åœ¨ä¿å­˜æ—¶ï¼Œè®©ä»£ç ç›´æ¥ç¬¦åˆ `ESLint` æ ‡å‡†ï¼ˆéœ€è¦é€šè¿‡ä¸€äº›ç®€å•é…ç½®ï¼‰

é‚£ä¹ˆè¿™äº›ç®€å•é…ç½®å…·ä½“æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

### ESLint ä¸ Prettier é…åˆè§£å†³ä»£ç æ ¼å¼é—®é¢˜

1. åœ¨ `VSCode` ä¸­å®‰è£… `prettier` æ’ä»¶ï¼ˆæœç´¢ `prettier`ï¼‰ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨é…ç½® `prettier` çš„æ—¶å€™è·å¾—æç¤º

   ![image-20210904195026475](./ç¼–ç¨‹è§„èŒƒ.assets/image-20210904195026475.png)

2. åœ¨é¡¹ç›®ä¸­ `.prettierrc.json` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸º `perttier` é»˜è®¤é…ç½®æ–‡ä»¶

3. åœ¨è¯¥æ–‡ä»¶ä¸­å¦‚ä¸‹é…ç½®ï¼š

   ```json
   {
   	"$schema": "https://json.schemastore.org/prettierrc",
   	"semi": false, // ä¸å°¾éšåˆ†å·
   	"tabWidth": 2,
   	"singleQuote": true, // ä½¿ç”¨å•å¼•å·
   	"printWidth": 100,
   	"trailingComma": "none" // å¤šè¡Œé€—å·åˆ†å‰²çš„è¯­æ³•ä¸­ï¼Œæœ€åä¸€è¡Œä¸åŠ é€—å·
   }
   ```

4. æ‰“å¼€ `VSCode` ã€Šè®¾ç½®é¢æ¿ã€‹

   ![image-20210904200638072](./ç¼–ç¨‹è§„èŒƒ.assets/image-20210904200638072.png)

5. åœ¨è®¾ç½®ä¸­ï¼Œæœç´¢ `save` ï¼Œå‹¾é€‰ `Format On Save`

   ![image-20210904200738067](./ç¼–ç¨‹è§„èŒƒ.assets/image-20210904200738067-1708445149848-3.png)

è‡³æ­¤ï¼Œä½ å³å¯åœ¨ **`VSCode` ä¿å­˜æ—¶ï¼Œè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼**

**ä½†æ˜¯ï¼** ä½ åªåšåˆ°è¿™æ ·è¿˜ä¸å¤Ÿï¼

> 1. VSCode è€Œè¨€ï¼Œé»˜è®¤ä¸€ä¸ª tab ç­‰äº 4 ä¸ªç©ºæ ¼ï¼Œè€Œ ESLint å¸Œæœ›ä¸€ä¸ª tab ä¸ºä¸¤ä¸ªç©ºæ ¼
>
>    1. VSCode è®¾ç½®é‡Œé¢ï¼ŒTab Size æ”¹æˆ 2ï¼Œè¿™æ ·å°±èƒ½ä¸ ESLint åŒæ­¥
>       ![image-20240221200247506](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240221200247506.png)
>
> 2. ESLint å’Œ prettier ä¹‹é—´çš„å†²çªé—®é¢˜
>
> ä»£ç ä¸­ï¼Œå³é”® `ä½¿ç”¨...æ ¼å¼åŒ–æ–‡æ¡£` é…ç½®é»˜è®¤æ ¼å¼åŒ–æ–‡æ¡£ç¨‹åºï¼Œé€‰æ‹© prettier
>
> ![image-20240221200501367](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240221200501367.png)
>
> ![image-20240221200559796](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240221200559796.png)

æˆ‘ä»¬å°è¯•åœ¨ `Home.vue` ä¸­å†™å…¥ä¸€ä¸ª `created` æ–¹æ³•ï¼Œå†™å…¥å®Œæˆä¹‹åï¼Œæ‰“å¼€æˆ‘ä»¬çš„æ§åˆ¶å°æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ­¤æ—¶ä»£ç æŠ›å‡ºäº†ä¸€ä¸ª `ESLint` çš„é”™è¯¯

![image-20210904201057594](./ç¼–ç¨‹è§„èŒƒ.assets/image-20210904201057594-1708445036771-1.png)

è¿™ä¸ªé”™è¯¯çš„æ„æ€æ˜¯è¯´ï¼š**`created` è¿™ä¸ªæ–¹æ³•åå’Œåé¢çš„å°æ‹¬å·ä¹‹é—´ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªç©ºæ ¼ï¼**

ä½†æ˜¯å½“æˆ‘ä»¬åŠ å…¥äº†è¿™ä¸ªç©ºæ ¼ä¹‹åï¼Œåªè¦ä¸€ä¿å­˜ä»£ç ï¼Œå°±ä¼šå‘ç° `prettier` ä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬å»é™¤æ‰è¿™ä¸ªç©ºæ ¼ã€‚

é‚£ä¹ˆæ­¤æ—¶çš„è¿™ä¸ªé—®é¢˜å°±æ˜¯ `prettier` å’Œ `ESLint` çš„å†²çªé—®é¢˜ã€‚

é’ˆå¯¹äºè¿™ä¸ªé—®é¢˜æˆ‘ä»¬æƒ³è¦è§£å†³ä¹Ÿéå¸¸ç®€å•ï¼š

1. æ‰“å¼€ `.eslintrc.cjs` é…ç½®æ–‡ä»¶

2. åœ¨ `rules` è§„åˆ™ä¸‹ï¼Œæ–°å¢ä¸€æ¡è§„åˆ™

   ```json
   'space-before-function-paren': 'off'
   ```

3. è¯¥è§„åˆ™è¡¨ç¤ºå…³é—­ã€Šæ–¹æ³•ååå¢åŠ ç©ºæ ¼ã€‹çš„è§„åˆ™

4. é‡å¯é¡¹ç›®

è‡³æ­¤æˆ‘ä»¬æ•´ä¸ªçš„ `perttier` å’Œ `ESLint` çš„é…åˆä½¿ç”¨å°±ç®—æ˜¯å…¨éƒ¨å®Œæˆäº†ã€‚

åœ¨ä¹‹åæˆ‘ä»¬å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦ä¿å­˜ä»£ç ï¼Œé‚£ä¹ˆ `perttier` å°±ä¼šå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä½¿å…¶ç¬¦åˆ `ESLint` çš„æ ¡éªŒè§„åˆ™ã€‚è€Œæ— éœ€æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œæ›´æ”¹äº†ã€‚

## Git çº¦å®šå¼æäº¤è§„èŒƒ

åœ¨ç°åœ¨çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ `git` æ¥ç®¡ç†é¡¹ç›®ã€‚åªè¦é€šè¿‡ `git` æ¥ç®¡ç†é¡¹ç›®ï¼Œé‚£ä¹ˆå°±å¿…ç„¶ä¼šé‡åˆ°ä½¿ç”¨ `git` æäº¤ä»£ç çš„åœºæ™¯

å½“æˆ‘ä»¬æ‰§è¡Œ `git commit -m "æè¿°ä¿¡æ¯"` çš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“æ­¤æ—¶å¿…é¡»æ·»åŠ ä¸€ä¸ªæè¿°ä¿¡æ¯ã€‚ä½†æ˜¯ä¸­åæ–‡åŒ–åšå¤§ç²¾æ·±ï¼Œä¸åŒçš„äººå»å¡«å†™æè¿°ä¿¡æ¯çš„æ—¶å€™ï¼Œéƒ½ä¼šæ ¹æ®è‡ªå·±çš„ç†è§£æ¥è¿›è¡Œæè¿°ã€‚

è€Œå¾ˆå¤šäººçš„æè¿° â€œå¤©é©¬è¡Œç©ºâ€ ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åˆ«äººåœ¨çœ‹ä½ çš„æäº¤è®°å½•æ—¶ï¼Œçœ‹ä¸æ‡‚ä½ è¯´çš„ä»€ä¹ˆæ„æ€ï¼Ÿä¸çŸ¥é“ä½ å½“å‰çš„è¿™æ¬¡æäº¤åˆ°åº•åšäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿä¼šä¸ä¼šå­˜åœ¨æ½œåœ¨çš„é£é™©ï¼Ÿ

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ¥çœ‹è¿™å‡ æ¡æäº¤è®°å½•ï¼š

![image-20210904203051754](./ç¼–ç¨‹è§„èŒƒ.assets/image-20210904203051754-1708445446790-10.png)

ä½ èƒ½å¤Ÿæƒ³è±¡å¾—åˆ°å®ƒä»¬ç»å†äº†ä»€ä¹ˆå—ï¼Ÿ

æ‰€ä»¥ **`git` æäº¤è§„èŒƒ** åŠ¿åœ¨å¿…è¡Œã€‚

å¯¹äº **`git` æäº¤è§„èŒƒ** æ¥è¯´ï¼Œä¸åŒçš„å›¢é˜Ÿå¯èƒ½ä¼šæœ‰ä¸åŒçš„æ ‡å‡†ï¼Œé‚£ä¹ˆå’±ä»¬ä»Šå¤©å°±ä»¥ç›®å‰ä½¿ç”¨è¾ƒå¤šçš„ [Angular å›¢é˜Ÿè§„èŒƒ](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines) å»¶ä¼¸å‡ºçš„ [Conventional Commits specificationï¼ˆçº¦å®šå¼æäº¤ï¼‰](https://www.conventionalcommits.org/zh-hans/v1.0.0/) ä¸ºä¾‹ï¼Œæ¥ä¸ºå¤§å®¶è¯¦è§£ **`git` æäº¤è§„èŒƒ**

çº¦å®šå¼æäº¤è§„èŒƒè¦æ±‚å¦‚ä¸‹ï¼š

```js
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]

--------  ç¿»è¯‘ -------------

<ç±»å‹>[å¯é€‰ èŒƒå›´]: <æè¿°>

[å¯é€‰ æ­£æ–‡]

[å¯é€‰ è„šæ³¨]
```

å…¶ä¸­ `<type>` ç±»å‹ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªå¯é€‰çš„å€¼ï¼Œæ¯”å¦‚ï¼š

1. æ–°åŠŸèƒ½ï¼š`feat`
2. ä¿®å¤ï¼š`fix`
3. æ–‡æ¡£å˜æ›´ï¼š`docs`
4. ....

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¦æŒ‰ç…§ **çº¦å®šå¼æäº¤è§„èŒƒ** æ¥å»åšçš„åŒ–ï¼Œé‚£ä¹ˆä½ çš„ä¸€æ¬¡æäº¤æè¿°åº”è¯¥å¼è¿™ä¸ªæ ·å­çš„ï¼š

![image-20210904205519762](./ç¼–ç¨‹è§„èŒƒ.assets/image-20210904205519762-1708445464346-12.png)

### Git Hooks

ç±»ä¼¼äºå‰ç«¯æ¡†æ¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œgit åœ¨æŸäº›ç‰¹å®šäº‹ä»¶å‘ç”Ÿå‰æˆ–åä¹Ÿä¼šæœ‰æŸäº›æ‰§è¡Œç‰¹å®šåŠŸèƒ½çš„é’©å­ï¼Œgithooks å°±æ˜¯åœ¨ git æ‰§è¡Œç‰¹å®šäº‹ä»¶ï¼ˆå¦‚ commitã€pushã€receive ç­‰ï¼‰æ—¶è§¦å‘è¿è¡Œçš„è„šæœ¬ï¼ˆgit é’©å­ || git å›è°ƒæ–¹æ³•ï¼‰ã€‚

ä¹Ÿå°±æ˜¯ï¼š**`git` åœ¨æ‰§è¡ŒæŸä¸ªäº‹ä»¶ä¹‹å‰æˆ–ä¹‹åè¿›è¡Œä¸€äº›å…¶ä»–é¢å¤–çš„æ“ä½œ**

è€Œæˆ‘ä»¬æ‰€æœŸæœ›çš„ **é˜»æ­¢ä¸åˆè§„çš„æäº¤æ¶ˆæ¯**ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åˆ° `hooks` çš„é’©å­å‡½æ•°ã€‚

githooks ä¿å­˜åœ¨ .git æ–‡ä»¶å¤¹ä¸­

å…·ä½“é’©å­å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| git hook              | æ‰§è¡Œè°ƒç”¨æ—¶æœº                                                                                                                                         | è¯´æ˜                                                                                   |
| --------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |
| applypatch-msg        | git am æ‰§è¡Œå‰                                                                                                                                        | é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ commit-msg å¯ç”¨çš„è¯ï¼Œapplpatch-msg é’©å­åœ¨å¯ç”¨æ—¶ä¼šè¿è¡Œ commit-msg é’©å­ |
| pre-applypatc         | git am æ‰§è¡Œå‰                                                                                                                                        | é»˜è®¤çš„ pre-applypatch é’©å­åœ¨å¯ç”¨æ—¶è¿è¡Œ pre-commit é’©å­ï¼ˆå¦‚æœåè€…å·²å¯ç”¨ï¼‰               |
| post-applypatch       | git am æ‰§è¡Œå                                                                                                                                        | è¿™ä¸ªé’©å­ä¸»è¦ç”¨äºé€šçŸ¥ï¼Œä¸èƒ½å½±å“ git-am çš„ç»“æœ                                           |
| **pre-commit**        | git commit æ‰§è¡Œå‰                                                                                                                                    | å¯ä»¥ä½¿ç”¨ git commit --no verify å‘½ä»¤ç»•è¿‡è¯¥é’©å­                                         |
| pre-merge-commit      | git merge æ‰§è¡Œå‰                                                                                                                                     | å¯ä»¥ä½¿ç”¨ git merge --no verify å‘½ä»¤ç»•è¿‡è¯¥é’©å­                                          |
| prepare-commit-msg    | git commit æ‰§è¡Œä¹‹åï¼Œç¼–è¾‘å™¨æ‰“å¼€ä¹‹å‰                                                                                                                  |                                                                                        |
| **commit-msg**        | git commit æ‰§è¡Œå‰                                                                                                                                    | å¯ä»¥ä½¿ç”¨ git commit --no verify å‘½ä»¤ç»•è¿‡è¯¥é’©å­                                         |
| post-commit           | git commit æ‰§è¡Œå                                                                                                                                    | ä¸å½±å“ git commit çš„ç»“æœ                                                               |
| pre-rebase            | git rebase æ‰§è¡Œå‰                                                                                                                                    |                                                                                        |
| post-checkout         | git checkout æˆ– git switch æ‰§è¡Œå                                                                                                                    | å¦‚æœä¸ä½¿ç”¨ --no-checkout å‚æ•°ï¼Œåˆ™åœ¨ git clone ä¹‹åä¹Ÿä¼šæ‰§è¡Œ                             |
| post-merge            | git merge æ‰§è¡Œå                                                                                                                                     | åœ¨æ‰§è¡Œ git pull æ—¶ä¹Ÿä¼šè¢«è°ƒç”¨                                                           |
| pre-push              | git push æ‰§è¡Œå‰                                                                                                                                      |                                                                                        |
| pre-receive           | git receive pack æ‰§è¡Œå‰                                                                                                                              |                                                                                        |
| update                |                                                                                                                                                      |                                                                                        |
| proc-receive          | `git-receive-pack`æ‰§è¡Œå                                                                                                                             | ä¸å½±å“`git-receive-pack`çš„ç»“æœ                                                         |
| post-receive          | git receive pack æ‰§è¡Œå‰                                                                                                                              | ä¸å½±å“ git receive pack çš„æ‰§è¡Œç»“æœ                                                     |
| post-update           | å½“ `git-receive-pack`å¯¹ `git push` ä½œå‡ºååº”å¹¶æ›´æ–°ä»“åº“ä¸­çš„å¼•ç”¨æ—¶                                                                                      |                                                                                        |
| reference-transaction |                                                                                                                                                      |                                                                                        |
| push-to-checkout      | å½“ git receive pack å¯¹ git push ä½œå‡ºååº”å¹¶æ›´æ–°ä»“åº“ä¸­çš„å¼•ç”¨æ—¶ï¼Œä»¥åŠå½“æ¨é€è¯•å›¾æ›´æ–°å½“å‰è¢«ç­¾å‡ºçš„åˆ†æ”¯ä¸” receive.denyCurrentBranch é…ç½®è¢« updateInstead æ—¶ |                                                                                        |
| pre-auto-gc           | git gc --auto æ‰§è¡Œå‰                                                                                                                                 |                                                                                        |
| post-rewrite          | æ‰§è¡Œ git commit --amend æˆ– git rebase æ—¶                                                                                                             |                                                                                        |
| sendemail-validate    | git send-email æ‰§è¡Œå‰                                                                                                                                |                                                                                        |
| fsmonitor-watchman    | é…ç½® core.fsmonitor è¢«è®¾ç½®ä¸º.git/hooks/fsmonitor-watchman æˆ–.git/hooks/fsmonitor-watchmanv2 æ—¶                                                       |                                                                                        |
| p4-changelist         | git-p4 submit æ‰§è¡Œå¹¶ç¼–è¾‘å®Œ changelist message ä¹‹å                                                                                                   | å¯ä»¥ä½¿ç”¨ git-p4 submit --no-verify ç»•è¿‡è¯¥é’©å­                                          |
| p4-prepare-changelist | git-p4 submit æ‰§è¡Œåï¼Œç¼–è¾‘å™¨å¯åŠ¨å‰                                                                                                                   | å¯ä»¥ä½¿ç”¨ git-p4 submit --no-verify ç»•è¿‡è¯¥é’©å­                                          |
| p4-post-changelist    | git-p4 submit æ‰§è¡Œå                                                                                                                                 |                                                                                        |
| p4-pre-submit         | git-p4 submit æ‰§è¡Œå‰                                                                                                                                 | å¯ä»¥ä½¿ç”¨ git-p4 submit --no-verify ç»•è¿‡è¯¥é’©å­                                          |
| post-index-change     | ç´¢å¼•è¢«å†™å…¥ read-cache.c do_write_locked_index å                                                                                                     |                                                                                        |

PSï¼šè¯¦ç»†çš„ `HOOKSä»‹ç»` å¯ç‚¹å‡» [è¿™é‡Œ](https://git-scm.com/docs/githooks) æŸ¥çœ‹

æ•´ä½“çš„ `hooks` éå¸¸å¤šï¼Œå½“æ—¶æˆ‘ä»¬å…¶ä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„å…¶å®åªæœ‰ä¸¤ä¸ªï¼š

| Git Hook       | è°ƒç”¨æ—¶æœº                                                                                                                                           | è¯´æ˜                               |
| :------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------- |
| **pre-commit** | `git commit`æ‰§è¡Œå‰<br />å®ƒä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œå¹¶ä¸”åœ¨è·å–æäº¤æ—¥å¿—æ¶ˆæ¯å¹¶è¿›è¡Œæäº¤ä¹‹å‰è¢«è°ƒç”¨ã€‚è„šæœ¬`git commit`ä»¥éé›¶çŠ¶æ€é€€å‡ºä¼šå¯¼è‡´å‘½ä»¤åœ¨åˆ›å»ºæäº¤ä¹‹å‰ä¸­æ­¢ã€‚ | å¯ä»¥ç”¨`git commit --no-verify`ç»•è¿‡ |
| **commit-msg** | `git commit`æ‰§è¡Œå‰<br />å¯ç”¨äºå°†æ¶ˆæ¯è§„èŒƒåŒ–ä¸ºæŸç§é¡¹ç›®æ ‡å‡†æ ¼å¼ã€‚<br />è¿˜å¯ç”¨äºåœ¨æ£€æŸ¥æ¶ˆæ¯æ–‡ä»¶åæ‹’ç»æäº¤ã€‚                                             | å¯ä»¥ç”¨`git commit --no-verify`ç»•è¿‡ |
| pre-push       | git push æ‰§è¡Œå‰                                                                                                                                    |                                    |

ç®€å•æ¥è¯´è¿™ä¸¤ä¸ªé’©å­ï¼š

1. `commit-msg`ï¼šå¯ä»¥ç”¨æ¥è§„èŒƒåŒ–æ ‡å‡†æ ¼å¼ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰éœ€æŒ‡å®šæ˜¯å¦è¦æ‹’ç»æœ¬æ¬¡æäº¤
2. `pre-commit`ï¼šä¼šåœ¨æäº¤å‰è¢«è°ƒç”¨ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰éœ€æŒ‡å®šæ˜¯å¦è¦æ‹’ç»æœ¬æ¬¡æäº¤

è€Œæˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„å…³é”®ï¼Œå°±åœ¨è¿™ä¸¤ä¸ªé’©å­ä¸Šé¢ã€‚

## husky åº“ä»‹ç»

husky æ˜¯ä¸€ä¸ªç”¨æ¥ç®¡ç† git é’©å­çš„æ’ä»¶ï¼Œå®ƒå¯ä»¥è®©æ‚¨åœ¨æäº¤æˆ–æ¨é€ä»£ç æ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œï¼Œä¾‹å¦‚æ£€æŸ¥ä»£ç é£æ ¼ã€è¿è¡Œæµ‹è¯•ç­‰ã€‚

ä½¿ç”¨ git çš„`commit`æˆ–è€…`push`çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å¯¹`commit`ã€`run`ã€`test`ã€`lint code`ç­‰è¿›è¡Œ lint å¤„ç†ã€‚`Husky` æ”¯æŒæ‰€æœ‰çš„ Git hooksã€‚

- husky çš„ npmï¼š[husky - npm (npmjs.com)](https://www.npmjs.com/package/husky)
- husky çš„ github å¼€æºåœ°å€ï¼š[typicode/husky: Git hooks made easy ğŸ¶ woof! (github.com)](https://github.com/typicode/husky)
- **husky å®˜ç½‘æ–‡æ¡£**ï¼š[Husky (typicode.github.io)](https://typicode.github.io/husky/)

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

## husky ç‰ˆæœ¬åŠŸèƒ½æ›´æ–°è¯´æ˜

[husky å·²ç»æ›´æ–°åˆ°äº† 9.0 ç‰ˆæœ¬ï¼Œå®ƒäº 2021 å¹´ 7 æœˆ 1 æ—¥å‘å¸ƒäº† 7.0.0 ç‰ˆæœ¬](https://www.npmjs.com/package/husky)ã€‚è¿™ä¸ªç‰ˆæœ¬ä¸»è¦æ˜¯ä¿®å¤äº†ä¸€äº› bug å’Œç»†èŠ‚ï¼Œæ²¡æœ‰å¤ªå¤§çš„å˜åŒ–ã€‚

å¯ä»¥åœ¨ [husky çš„å‘å¸ƒé¡µé¢](https://github.com/typicode/husky/releases) ä¸­æŸ¥çœ‹ husky å„ä¸ªç‰ˆæœ¬çš„æ›´æ–°å†…å®¹å’Œè¯´æ˜ã€‚

æˆªæ­¢ 2024-02-20ï¼Œhusky ç›®å‰çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ v9.0.11ï¼Œå®ƒä¸ä¹‹å‰çš„ç‰ˆæœ¬æœ‰ä¸€äº›ä¸åŒå’Œæ”¹è¿›ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

- husky v9 æ”¹å˜äº†è®¸å¯è¯ï¼Œå®ƒä½¿ç”¨äº† MIT è®¸å¯è¯ï¼Œè¿™æ„å‘³ç€ husky å¯ä»¥å…è´¹ç”¨äºå•†ä¸šæˆ–éå•†ä¸šçš„é¡¹ç›®ã€‚
- husky v9 ä¼˜åŒ–äº† husky init å‘½ä»¤ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æ£€æµ‹æ‚¨çš„é¡¹ç›®ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„å‘½ä»¤æ¥å®‰è£… huskyã€‚
- husky v9 ä¿®å¤äº†ä¸€äº› bug å’Œç»†èŠ‚ï¼Œä¾‹å¦‚æ”¯æŒäº† Windows ä¸Šçš„ PowerShell 7ï¼Œä»¥åŠåœ¨ husky install å‘½ä»¤ä¸­æ·»åŠ äº† --skip-validate é€‰é¡¹ã€‚

husky v8 ä¹‹å‰çš„ç‰ˆæœ¬ä¹Ÿæœ‰ä¸€äº›é‡è¦çš„æ›´æ–°ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

- husky v8 ç®€åŒ–äº†å®‰è£…å’Œé…ç½®çš„è¿‡ç¨‹ï¼Œæ‚¨åªéœ€è¦è¿è¡Œ `npm install husky --save-dev` å’Œ `npx husky-init` å‘½ä»¤ï¼Œå°±å¯ä»¥åœ¨æ‚¨çš„é¡¹ç›®ä¸­åˆå§‹åŒ– huskyï¼Œå¹¶ç”Ÿæˆä¸€äº›ç¤ºä¾‹çš„é’©å­ã€‚

husky v7 ç‰ˆæœ¬æ–°ç‰¹æ€§ï¼š

- husky v7 ä½¿ç”¨äº†æ–°çš„è®¸å¯è¯ï¼Œå³ ISC è®¸å¯è¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ›´ç®€æ´çš„ MIT è®¸å¯è¯ã€‚
- husky v7 æ”¯æŒäº† Yarn 2 å’Œ pnpmï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æ£€æµ‹æ‚¨çš„é¡¹ç›®ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„å‘½ä»¤æ¥è¿è¡Œé’©å­ã€‚
- husky v7 ç®€åŒ–äº†å®‰è£…å’Œé…ç½®çš„è¿‡ç¨‹ï¼Œæ‚¨åªéœ€è¦è¿è¡Œ `npm install husky --save-dev` å’Œ `npx husky-init` å‘½ä»¤ï¼Œå°±å¯ä»¥åœ¨æ‚¨çš„é¡¹ç›®ä¸­åˆå§‹åŒ– huskyï¼Œå¹¶ç”Ÿæˆä¸€äº›ç¤ºä¾‹çš„é’©å­ã€‚
- husky v7 å‡å°‘äº†ä¾èµ–çš„æ•°é‡å’ŒåŒ…çš„å¤§å°ï¼Œå®ƒåªä¾èµ–äº†ä¸€ä¸ªåä¸º run-node çš„åŒ…ï¼Œç”¨æ¥åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿è¡Œ nodeã€‚
- husky v7 æ”¹å˜äº†é’©å­çš„å­˜æ”¾ä½ç½®å’Œæ ¼å¼ï¼Œå®ƒå°†é’©å­æ–‡ä»¶æ”¾åœ¨äº† `.husky` ç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯ `.git/hooks` ç›®å½•ä¸‹ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›æƒé™é—®é¢˜ã€‚å®ƒä¹Ÿå°†é’©å­æ–‡ä»¶æ”¹ä¸ºäº† shell è„šæœ¬ï¼Œè€Œä¸æ˜¯ JSON æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥æä¾›æ›´å¤šçš„çµæ´»æ€§ã€‚

husky v7 ä¹‹å‰çš„ç‰ˆæœ¬ä¹Ÿæœ‰ä¸€äº›é‡è¦çš„æ›´æ–°ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

- husky v6 å¼•å…¥äº†è‡ªåŠ¨å®‰è£…çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥åœ¨æ‚¨çš„ `package.json` æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª `prepare` è„šæœ¬ï¼Œç”¨æ¥åœ¨å®‰è£…ä¾èµ–æˆ–å‘å¸ƒåŒ…æ—¶è‡ªåŠ¨å®‰è£… huskyã€‚
- husky v5 é‡æ–°è®¾è®¡äº† husky çš„æ ¸å¿ƒï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªåä¸º `husky.sh` çš„è„šæœ¬æ¥ç®¡ç†æ‰€æœ‰çš„é’©å­ï¼Œè¿™æ ·å¯ä»¥æé«˜æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚
  - åœ¨ 2021 å¹´ 1 æœˆ 27 æ—¥ï¼Œhusky è¿æ¥äº† v5 çš„å¤§ç‰ˆæœ¬å‡çº§ï¼Œé…ç½®æ–¹å¼è¾ƒä¸Šä¸€ç‰ˆæœ¬æœ‰äº†æ¯”è¾ƒå¤§çš„å˜åŒ–ã€‚å¦‚æœåœ¨ 27 æ—¥ä¹‹åï¼Œå†æŒ‰ç…§åŸæ¥çš„å¥—è·¯é…ç½® husky å’Œ lint-stagedï¼Œç»“æœå°†æ˜¯é’©å­æ ¡éªŒæ— æ³•ç”Ÿæ•ˆã€‚
- husky v4 å¢åŠ äº†å¯¹ Yarn å’Œ pnpm çš„æ”¯æŒï¼Œå®ƒå¯ä»¥åœ¨ä½ çš„ `package.json` æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª `husky` å­—æ®µï¼Œç”¨æ¥é…ç½®ä¸åŒçš„é’©å­ã€‚
  - ä»¥å‰çš„è€ç‰ˆæœ¬çš„é¡¹ç›®ä¸»è¦ç”¨çš„ç‰ˆæœ¬ 4ï¼Œä¹‹åç‰ˆæœ¬ 5 æœ‰äº†æ¯”è¾ƒå¤§çš„æ›´æ–°
- husky v3 ä¿®å¤äº†ä¸€äº› bugï¼Œå¹¶ä¼˜åŒ–äº†ä¸€äº›ç»†èŠ‚ï¼Œä¾‹å¦‚æ”¯æŒäº† `HUSKY_DEBUG` ç¯å¢ƒå˜é‡ï¼Œç”¨æ¥æ‰“å°ä¸€äº›è°ƒè¯•ä¿¡æ¯ã€‚
- husky v2 å¢åŠ äº†å¯¹ Git å·¥ä½œæ ‘çš„æ”¯æŒï¼Œå®ƒå¯ä»¥åœ¨æ‚¨çš„é¡¹ç›®çš„å­ç›®å½•ä¸­ä½¿ç”¨ huskyã€‚
- husky v1 å¢åŠ äº†å¯¹ Git é’©å­çš„éªŒè¯ï¼Œå®ƒå¯ä»¥æ£€æŸ¥æ‚¨çš„é’©å­æ˜¯å¦è¢« husky ç®¡ç†ï¼Œä»¥åŠæ˜¯å¦æœ‰å†²çªçš„é’©å­ã€‚
- husky v0.14 å¼•å…¥äº† `.huskyrc` æ–‡ä»¶ï¼Œç”¨æ¥å­˜æ”¾ husky çš„é…ç½®ï¼Œè¿™æ ·å¯ä»¥é¿å…æ±¡æŸ“ `package.json` æ–‡ä»¶ã€‚

### husky ç‰ˆæœ¬ä½¿ç”¨æ›´æ–°

ä»ç‰ˆæœ¬ 4 å¼€å§‹ï¼Œhusky çš„ä½¿ç”¨æ–¹æ³•æœ‰äº†ä¸€äº›å˜åŒ–ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

ä¸»è¦æ˜¯ä½¿ç”¨äº† core.hooksPath åŠŸèƒ½æ¥æŒ‡å®š git hooks çš„ç›®å½•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ package.json ä¸­çš„ husky å­—æ®µã€‚è¿™æ ·å¯ä»¥è®©ç”¨æˆ·åªæ·»åŠ éœ€è¦çš„ git hooksï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„ git hooksã€‚å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

1. å®‰è£… husky ä½œä¸ºå¼€å‘ä¾èµ–ï¼š`npm install husky --save-dev` æˆ– `yarn add husky -D`
2. åœ¨ package.json ä¸­æ·»åŠ  prepare è„šæœ¬ï¼Œç”¨äºåœ¨å®‰è£…åè‡ªåŠ¨å¯ç”¨é’©å­ï¼š`"prepare": "husky install"`
3. ä½¿ç”¨ husky add å‘½ä»¤åˆ›å»ºä½ éœ€è¦çš„ git hooksï¼Œæ¯”å¦‚ pre-commitã€commit-msg ç­‰ã€‚ä¾‹å¦‚ï¼š`npx husky add .husky/pre-commit "npm test"` æˆ– `yarn husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'`
4. å°†åˆ›å»ºçš„ git hooks æ·»åŠ åˆ° git ä¸­ï¼š`git add .husky`

- husky 5ï¼šéœ€è¦æ‰‹åŠ¨è¿è¡Œ `npx husky install` æ¥åˆ›å»º .husky ç›®å½•å’Œè®¾ç½® core.hooksPathï¼Œç„¶åä½¿ç”¨ `npx husky add .husky/ ""` æ¥æ·»åŠ  git hooksï¼Œæ¯”å¦‚ `npx husky add .husky/pre-commit "npm test"`ã€‚husky 5 æ˜¯å…è´¹çš„ï¼Œä½†æ˜¯éœ€è¦éµå®ˆ MIT åè®®ã€‚

- husky 6ï¼šåœ¨ husky 5 çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº† `npm set-script prepare "husky install"` å‘½ä»¤ï¼Œå¯ä»¥åœ¨ package.json ä¸­æ·»åŠ  prepare è„šæœ¬ï¼Œç”¨äºåœ¨å®‰è£…åè‡ªåŠ¨å¯ç”¨é’©å­ã€‚husky 6 ä¹Ÿæ˜¯å…è´¹çš„ï¼Œä½†æ˜¯éœ€è¦éµå®ˆ MIT åè®®ã€‚

  - `v6`ç‰ˆæœ¬å‘å¸ƒåï¼Œä½¿ç”¨æ–¹å¼ä¸Šæœ‰äº†å¾ˆå¤§çš„æ”¹å˜ï¼›å¯ä»¥è¯´æ˜¯å®ƒçš„è®¾è®¡å‘ç”Ÿäº†å˜åŒ–ï¼›

  - `v6`ç‰ˆæœ¬å·²ä¸åœ¨ä½¿ç”¨`.huskyrc.js`æ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿä¸æ”¯æŒåœ¨`package.json`æ–‡ä»¶ä¸­é…ç½®ï¼Œè€Œæ˜¯ä½¿ç”¨äº†`.husky/`ç›®å½•ä¸­é…ç½®çš„å•ä¸ª git é’©å­ï¼›

  - #### husky ä¸ºä»€ä¹ˆæ”¾å¼ƒäº†ä¼ ç»Ÿæ–¹å¼çš„é…ç½®å‘¢

  - åœ¨`v4`ç‰ˆæœ¬ä¹‹å‰`husky`ä¸ºäº†èƒ½å¤Ÿè¿è¡Œç”¨æˆ·åœ¨`.huskyrc.json`ä¸­åˆ›å»ºçš„ä»»ä½•é’©å­ï¼Œå®ƒä¸å¾—ä¸å°†æ‰€æœ‰çš„é’©å­éƒ½å®‰è£…åœ¨`.git/hooks`ç›®å½•ä¸­ã€‚å½“è§¦å‘åˆ°é’©å­è„šæœ¬çš„æ—¶å€™ï¼Œæ¯ä¸ªè„šæœ¬éƒ½ä¼šå…ˆæ£€æŸ¥`.huskyrc.json`æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ç›¸åº”çš„é’©å­å®šä¹‰ï¼›è¿™æ ·çš„å¥½å¤„å°±æ˜¯ç”¨æˆ·å¯ä»¥éšæ„çš„æ·»åŠ ã€æ›´æ–°å’Œåˆ é™¤é’©å­ï¼Œæ‰€åšçš„æ›´æ”¹ä¼šè‡ªåŠ¨çš„ç”Ÿæ•ˆï¼›ç¼ºç‚¹å°±æ˜¯ï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•ä¸œè¥¿è¦è¿è¡Œï¼Œè¯¥é’©å­èŠ‚ç‚¹ä¹Ÿä¼šè¢«å¯åŠ¨ï¼›

    åœ¨å½“æ—¶`husky`æœ‰è¿‡è¿™æ ·çš„è®¾æƒ³ï¼Œå°±æ˜¯åªå¯åŠ¨åœ¨`.huskyrc.json`æ–‡ä»¶ä¸­é…ç½®çš„é’©å­ï¼Œä½†éšåçš„é—®é¢˜å°±åˆå‡ºç°äº†ï¼Œå¦‚æœæ”¹åŠ¨äº†`.huskyrc.json`æ–‡ä»¶ä¸­çš„é’©å­å®šä¹‰ï¼Œ`husky`å°†ä¸ä¼šè‡ªåŠ¨å·¥ä½œï¼Œå› ä¸ºåœ¨`.git/hooks`ç›®å½•é‡Œè¿˜æ²¡æœ‰å¯åŠ¨ç›¸åº”çš„é’©å­è„šæœ¬ï¼Œæ‰€ä»¥ä¿è¯ä¸¤ä¸ªåœ°æ–¹çš„é…ç½®åŒæ­¥æˆäº†ä¸€ä¸ªéš¾é¢˜ï¼›

    ç›´åˆ° 2016 å¹´ï¼Œ`Git 2.9`å¼•è¿›äº†`core.hooksPath`ï¼Œå¯ä»¥è®¾ç½®`Git hooks`è„šæœ¬çš„ç›®å½•ï¼Œè¿™ä¸ªå¼•è¿›ä¹Ÿå°±æ˜¯æ–°ç‰ˆ`husky`æ”¹è¿›çš„åŸºç¡€ï¼›

    - `husky install`å‘½ä»¤å‘Šè¯‰`Git`ä½¿ç”¨`.hooks`ç›®å½•ä½œä¸ºé’©å­è„šæœ¬ç›®å½•ï¼Œå®é™…ä¸Šå°±æ˜¯ä¿®æ”¹äº†`core.hooksPath`çš„å€¼ï¼›
    - `husky add`åˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„`shell`è„šæœ¬

    è¿™æ ·ä¹Ÿå°±è§£å†³äº†å¯åŠ¨å•ä¸€çš„é’©å­è„šæœ¬å’Œæ‰€æœ‰çš„é…ç½®éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ç›®å½•ä¸‹ï¼›ä½†æ˜¯è¿™æ ·ä¹Ÿå°±åœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª`.hooks`ç›®å½•ï¼Œçœ‹èµ·æ¥ä¸çˆ½çš„è¯ï¼Œ ä½ ä¹Ÿå¯ä»¥æŒ‡å®šè®©`.hooks`æ”¾åˆ°`config`ç›®å½•ä¸‹ï¼›

    husky 7ï¼šåœ¨ husky 6 çš„åŸºç¡€ä¸Šï¼Œç®€åŒ–äº† husky çš„å®‰è£…å’Œä½¿ç”¨ï¼Œä¸å†éœ€è¦ prepare è„šæœ¬ï¼Œåªéœ€è¦è¿è¡Œ `npm install husky -D` å’Œ `npx husky-init`ï¼Œç„¶åç¼–è¾‘ .husky ç›®å½•ä¸‹çš„é’©å­è„šæœ¬å³å¯ã€‚husky 7 æ˜¯å…è´¹çš„ï¼Œä½†æ˜¯éœ€è¦éµå®ˆ ISC åè®®ã€‚

- husky 8ï¼šåœ¨ husky 7 çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº† husky çš„é…ç½®æ–‡ä»¶ .huskyrcï¼Œå¯ä»¥åœ¨å…¶ä¸­è®¾ç½®ä¸€äº›å…¨å±€çš„é€‰é¡¹ï¼Œæ¯”å¦‚ concurrentã€shellã€quiet ç­‰ã€‚husky 8 æ˜¯å…è´¹çš„ï¼Œä½†æ˜¯éœ€è¦éµå®ˆ ISC åè®®ã€‚

- husky 9ï¼šåœ¨ husky 8 çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº† husky çš„å‘½ä»¤è¡Œå·¥å…· husky-cliï¼Œå¯ä»¥ç”¨æ¥æ›´æ–¹ä¾¿åœ°ç®¡ç† husky çš„å®‰è£…ã€å¸è½½ã€æ›´æ–°ã€æ·»åŠ ã€åˆ é™¤ã€åˆ—å‡ºã€è¿è¡Œç­‰æ“ä½œã€‚husky 9 æ˜¯æ”¶è´¹çš„ï¼Œéœ€è¦è´­ä¹°è®¸å¯è¯æ‰èƒ½ä½¿ç”¨ã€‚

## åº”è¯¥ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ husky?

è¿™ä¸ªé—®é¢˜æ²¡æœ‰ä¸€ä¸ªç¡®å®šçš„ç­”æ¡ˆï¼Œä¸åŒçš„ç‰ˆæœ¬çš„ husky æœ‰ä¸åŒçš„ç‰¹ç‚¹å’Œä¼˜ç¼ºç‚¹ï¼Œä½ åº”è¯¥æ ¹æ®ä½ çš„é¡¹ç›®éœ€æ±‚å’Œä¸ªäººå–œå¥½æ¥é€‰æ‹©ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½ å¯ä»¥è€ƒè™‘ä»¥ä¸‹çš„å› ç´ ï¼š

- å…¼å®¹æ€§ï¼šå¦‚æœä½ çš„é¡¹ç›®éœ€è¦æ”¯æŒè¾ƒæ—§çš„ git ç‰ˆæœ¬ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ husky 4 æˆ–ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œå› ä¸º husky 5 åŠä»¥ä¸Šçš„ç‰ˆæœ¬éœ€è¦ git 2.13.0 æˆ–æ›´é«˜çš„ç‰ˆæœ¬ã€‚
- åè®®ï¼šå¦‚æœä½ çš„é¡¹ç›®éœ€è¦éµå®ˆæŸäº›ç‰¹å®šçš„å¼€æºåè®®ï¼Œä½ å¯èƒ½éœ€è¦æ³¨æ„ husky çš„åè®®å˜åŒ–ã€‚husky 4 ä½¿ç”¨äº† MIT åè®®ï¼Œhusky 5 å’Œ 6 ä¹Ÿä½¿ç”¨äº† MIT åè®®ï¼Œä½†æ˜¯å¢åŠ äº†ä¸€äº›é™åˆ¶ï¼Œhusky 7 å’Œ 8 ä½¿ç”¨äº† ISC åè®®ï¼Œhusky 9 éœ€è¦è´­ä¹°è®¸å¯è¯æ‰èƒ½ä½¿ç”¨ã€‚
- åŠŸèƒ½ï¼šå¦‚æœä½ çš„é¡¹ç›®éœ€è¦ä¸€äº›é«˜çº§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¹¶å‘æ‰§è¡Œã€è‡ªå®šä¹‰ shellã€é™é»˜æ¨¡å¼ç­‰ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ husky 8 æˆ–ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº† husky çš„é…ç½®æ–‡ä»¶ .huskyrcï¼Œå¯ä»¥åœ¨å…¶ä¸­è®¾ç½®ä¸€äº›å…¨å±€çš„é€‰é¡¹ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ husky-cli æ¥ç®¡ç† husky çš„æ“ä½œï¼Œä½ éœ€è¦ä½¿ç”¨ husky 9 çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯ä½ ä¹Ÿéœ€è¦ä»˜è´¹ã€‚
- ç®€æ´æ€§ï¼šå¦‚æœä½ çš„é¡¹ç›®éœ€è¦ç®€åŒ– husky çš„å®‰è£…å’Œä½¿ç”¨ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ husky 7 æˆ–ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå› ä¸ºå®ƒä»¬ä¸å†éœ€è¦ prepare è„šæœ¬ï¼Œåªéœ€è¦è¿è¡Œ `npm install husky -D` å’Œ `npx husky-init`ï¼Œç„¶åç¼–è¾‘ .husky ç›®å½•ä¸‹çš„é’©å­è„šæœ¬å³å¯ã€‚

æ€»ä¹‹ï¼Œä½ åº”è¯¥æ ¹æ®ä½ çš„é¡¹ç›®å’Œä¸ªäººçš„æƒ…å†µï¼Œæƒè¡¡ husky çš„å„ä¸ªç‰ˆæœ¬çš„ä¼˜ç¼ºç‚¹ï¼Œé€‰æ‹©ä¸€ä¸ªé€‚åˆä½ çš„ç‰ˆæœ¬ã€‚ä½ ä¹Ÿå¯ä»¥å‚è€ƒ husky çš„å®˜æ–¹æ–‡æ¡£å’Œå…¶ä»–ç”¨æˆ·çš„ç»éªŒï¼Œæ¥å¸®åŠ©ä½ åšå‡ºå†³å®šã€‚

### ç‰ˆæœ¬ 6 çš„å…·ä½“ä½¿ç”¨æ–¹æ³•

#### è‡ªå®šé…ç½®ï¼ˆæ¨èï¼‰

`husky-init`æ˜¯ä¸€ä¸ªä¸€æ¬¡æ€§å‘½ä»¤ï¼Œå¯ä»¥åœ¨é¡¹ç›®ä¸­å¿«é€Ÿæ·»åŠ `husky`é…ç½®ï¼›

```javascript
npx husky-init && npm isntall
```

ä¸Šè¾¹å‘½ä»¤ä¼šè®¾ç½®`husky`ï¼Œä¿®æ”¹`package.json`å¹¶ä¸”åˆ›å»ºäº†ä¸€ä¸ªå¯æ‰§è¡Œçš„`pre-commit`è„šæœ¬æ ·ä¾‹ï¼Œå½“ä½ `git commit`å‘½ä»¤å¼ï¼Œé»˜è®¤ä¼šæ‰§è¡Œ`npm test`

`hooks add`æ·»åŠ å…¶ä»– hooks

```javascript
npx hooks add .hooks/commit-msg 'npx --no-install commitlint --edit "$1"'
```

#### æ‰‹åŠ¨é…ç½®

1ã€ å®‰è£… husky

```bash
npm install husky --save-dev
```

2ã€ä¿®æ”¹ git hooks é»˜è®¤ç›®å½•

```bash
npx husky install
```

3ã€å¦‚æœæƒ³å®‰è£…åè‡ªåŠ¨å¯ç”¨ hooksï¼Œè¯·ç¼–è¾‘`package.json`

```json
{
	"scripts": {
		"prepare": "husky install"
	}
}
```

> yarn2 ä¸æ”¯æŒ`prepare`ï¼Œå¯ä»¥ä¿®æ”¹ä¸º`postinstall`

4ã€åˆ›å»º hooksï¼Œè¯­æ³•ï¼š`husky add <file> [cmd]`

```javascript
npx husky add .husky/pre-commit "npm test"
```

æ‰§è¡Œ`git commit -m "test"` å‘½ä»¤ï¼Œå¦‚æœ`npm test`å¤±è´¥ï¼Œå°†ç»ˆæ­¢æäº¤

5ã€å¸è½½ husky

```lua
npm uninstall husky && git config --unset core.hooksPath
```

#### å…¶ä»–ç”¨æ³•

1ã€æ¨èåœ¨`package.json`ä¸­æ·»åŠ  huskyï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`lerna` å’Œ`filter`ç­‰å·¥å…·æ¥åªè¿è¡Œå·²æ›´æ”¹åŒ…ä¸­çš„è„šæœ¬

(1) æ·»åŠ  hooks

```dockerfile
npx husky add .husky/pre-commit "npm run pre-commit"
```

(2) åœ¨`package.json`æ–‡ä»¶ä¸­æ·»åŠ `pre-commit`

```json
{
	"script": {
		"pre-commit": "npm run test && eslint"
	}
}
```

2ã€è‡ªå®šä¹‰`.husky`ç›®å½•

```bash
npx husky install .config/husky
```

3ã€ç»•è¿‡é’©å­

```bash
git commit -m "test" --no-verify
```

### æ¨èä½¿ç”¨ 7 ä»¥åçš„ç‰ˆæœ¬

å¦‚æœæ‚¨æƒ³ä½¿ç”¨ husky 7.0 ä¹‹åçš„ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…æˆ–æ›´æ–° huskyï¼š

- 1.åœ¨ husky 7 ä¹‹å‰ï¼Œéœ€è¦æ‰‹åŠ¨è¿è¡Œ npx husky install æ¥è®¾ç½® huskyã€‚
- 2.åœ¨ husky 7 ä¹‹åï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ npx husky-initï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ husky-cli çš„ husky init å‘½ä»¤
  - husky-cli æ˜¯ husky 9 ç‰ˆæœ¬æ–°å¢çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥æ›´æ–¹ä¾¿åœ°ç®¡ç† husky çš„å®‰è£…ã€å¸è½½ã€æ›´æ–°ã€æ·»åŠ ã€åˆ é™¤ã€åˆ—å‡ºã€è¿è¡Œç­‰æ“ä½œã€‚ä½ å¯ä»¥ä½¿ç”¨ `npx husky-cli` æˆ– `yarn husky-cli` æ¥è¿è¡Œå®ƒï¼Œæˆ–è€…å°†å®ƒå®‰è£…åˆ°å…¨å±€æˆ–æœ¬åœ°ã€‚husky-cli çš„ä½¿ç”¨æ–¹æ³•å’Œå‚æ•°å¯ä»¥å‚è€ƒ [husky - NPM (npmjs.com)](https://www.npmjs.com/package/husky)ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œhusky-cli æ˜¯æ”¶è´¹çš„ï¼Œéœ€è¦è´­ä¹°è®¸å¯è¯æ‰èƒ½ä½¿ç”¨ã€‚

```bash
# æ¨èä½¿ç”¨pnpmå®‰è£…huskyï¼ˆyarnæœ‰ä¸¤ä¸ªç‰ˆæœ¬å®‰è£…æ–¹æ³•ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œä¸æ¨èï¼‰
pnpm install --save-dev husky
```

**ä»¥ä¸‹æ˜¯ husky ç‰ˆæœ¬ 7.0 ä¹‹åçš„åˆå§‹åŒ–å‘½ä»¤**ï¼šå¯¹åº” npmã€yarnã€pnpm å®‰è£…çš„ husky åº“çš„åˆå§‹åŒ–å‘½ä»¤

```bash
npx husky-init && npm install       # npm
npx husky-init && yarn              # Yarn 1
yarn dlx husky-init --yarn2 && yarn # Yarn 2+ï¼šYarn 2+å®‰è£…æ‰‹å†Œï¼šhttps://blog.csdn.net/HHoao/article/details/127833268
pnpm dlx husky-init && pnpm install # pnpm
```

å®ƒå°†è®¾ç½® huskyï¼Œä¿®æ”¹ package.json å¹¶åˆ›å»ºä¸€ä¸ªå¯ä»¥ç¼–è¾‘çš„ç¤ºä¾‹ pre-commit é’©å­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œcommit æ—¶å®ƒå°†è¿è¡Œ npm æµ‹è¯•ã€‚

#### åœ¨ husky çš„ v7.x ç‰ˆæœ¬ä¹‹å‰

- åœ¨ husky çš„ 4.x ç‰ˆæœ¬ä¸­å¼•å…¥çš„ `npx husky add` æ˜¯ä¸€ä¸ªç”¨äºæ·»åŠ  git é’©å­çš„å‘½ä»¤ã€‚

  - ```bash
    npx husky add .husky/commit-msg 'npx --no -- commitlint --edit "$1"'
    ```

- åœ¨ husky çš„ 5.x ç‰ˆæœ¬ä¸­ï¼Œ`npx husky add`è¿™ä¸ªå‘½ä»¤è¢«åºŸå¼ƒäº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ `husky install` å’Œ `husky add` ä¸¤ä¸ªå‘½ä»¤ï¼Œå®ƒä»¬å¯ä»¥è®©æ‚¨æŒ‡å®š git é’©å­æ‰€åœ¨çš„ç›®å½•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„ .git/hooks/

  - åœ¨ husky çš„ 5.x ç‰ˆæœ¬ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `husky install` å‘½ä»¤æ¥æŒ‡å®š git é’©å­çš„ç›®å½•ï¼Œç„¶åä½¿ç”¨ `husky add` å‘½ä»¤æ¥æ·»åŠ æ‚¨éœ€è¦çš„é’©å­è„šæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³æ·»åŠ ä¸€ä¸ª pre-commit é’©å­ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

    ```bash
    npx husky install
    npx husky add .husky/pre-commit "npm test"
    ```

#### åœ¨ husky çš„ v7.x ç‰ˆæœ¬ä¸­

å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‘½ä»¤æ¥æ·»åŠ é’©å­ï¼Œä½†æ˜¯ä¸éœ€è¦å†è¿è¡Œ `husky install` å‘½ä»¤äº†ï¼Œå› ä¸º husky ä¼šè‡ªåŠ¨å®‰è£…é’©å­ã€‚æ‚¨åªéœ€è¦åœ¨ package.json ä¸­æ·»åŠ ä¸€ä¸ª `prepare` è„šæœ¬ï¼Œå¦‚ä¸‹ï¼š

```bash
{
  "scripts": {
    "prepare": "husky install"
  }
}
```

æˆ–è€…æ‰§è¡Œå‘½ä»¤å¯ç”¨é’©å­ï¼š

```bash
# ç‰ˆæœ¬7+8éƒ½å¯ä»¥æ‰§è¡Œ
npm set-script prepare "husky install"
pnpm set-script prepare "husky install"
```

è¿™æ ·ï¼Œå½“å®‰è£…ä¾èµ–æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä»è€Œ husky ä¼šè‡ªåŠ¨åˆ›å»º `.husky` ç›®å½•ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º git é’©å­çš„ç›®å½•ã€‚

è¿™æ ·ï¼Œå°±ä¸éœ€è¦å†æ‰‹åŠ¨è¿è¡Œ `husky install` å‘½ä»¤äº†ï¼Œåªéœ€è¦ä½¿ç”¨ `husky add` å‘½ä»¤æ¥æ·»åŠ é’©å­è„šæœ¬ã€‚

å¯ä»¥åƒä¹‹å‰ä¸€æ ·ä½¿ç”¨ `husky add` å‘½ä»¤æ¥æ·»åŠ é’©å­è„šæœ¬

```bash
# æ·»åŠ ä¸€ä¸ª pre-commit é’©å­
npx husky add .husky/pre-commit "npm test"
# æ·»åŠ ä¸€ä¸ª pre-push é’©å­
npx husky add .husky/pre-push "npm run lint"
# åˆ›å»ºä¸€ä¸ªcommit-msgé’©å­ï¼š
npx husky add .husky/commit-msg 'yarn commitlint --edit "$1"'
```

è¿™æ ·ï¼Œå½“å®‰è£…ä¾èµ–æ—¶ï¼Œhusky ä¼šè‡ªåŠ¨åˆ›å»º `.husky` ç›®å½•ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º git é’©å­çš„ç›®å½•ã€‚ç„¶åï¼Œå¯ä»¥åœ¨ .husky ç›®å½•ä¸‹æŸ¥çœ‹æˆ–ä¿®æ”¹é’©å­è„šæœ¬ã€‚

- æ­¤å¤–è¿˜æœ‰ `husky-init`å‘½ä»¤ï¼Œ æ‰§è¡Œä¹‹åå¯ä»¥åœ¨é¡¹ç›®ä¸­å¿«é€Ÿçš„åˆå§‹åŒ–ä¸€ä¸ª huskyã€‚

- husky 7.x ç‰ˆæœ¬åŠä»¥å‰çš„ç‰ˆæœ¬éœ€è¦åœ¨ package.json ä¸­æ·»åŠ  husky é…ç½®ï¼Œè€Œæ˜¯ä½¿ç”¨ .husky ç›®å½•æ¥å­˜æ”¾é’©å­è„šæœ¬ã€‚

  - ```json
    // ç‰ˆæœ¬7.xä»¥å‰éœ€è¦é…ç½®
    "husky": {
        "hooks": {
          "pre-commit": "lint-staged",
          "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
        }
    },
    ```

- husky 7.x ç‰ˆæœ¬åŠä»¥å‰çš„ç‰ˆæœ¬éœ€è¦åœ¨ package.json ä¸­æ·»åŠ  prepare è„šæœ¬ï¼Œè€Œæ˜¯è‡ªåŠ¨å®‰è£…é’©å­ã€‚

  - ```json
    // ç‰ˆæœ¬8.xä»¥å‰éœ€è¦é…ç½®
    "scripts": {
    	"prepare": "husky && husky install"
    },
    ```

- husky 7.x ç‰ˆæœ¬åŠä»¥å‰çš„ç‰ˆæœ¬éœ€è¦åœ¨ package.json ä¸­æ·»åŠ  configã€‚

  - ```json
    // ç‰ˆæœ¬8.xä»¥å‰éœ€è¦é…ç½®
    "config": {
        "commitizen": {
          "path": "node_modules/cz-customizable"
        },
        "cz-customizable": {
          "config": ".cz-config.cjs"
        }
    },
    ```

- husky 7.x ç‰ˆæœ¬åŠä»¥å‰çš„ç‰ˆæœ¬éœ€è¦åœ¨ package.json ä¸­æ·»åŠ  lint-staged é…ç½®ã€‚

  - ```json
    // ç‰ˆæœ¬8.xä»¥å‰éœ€è¦é…ç½®
    "lint-staged": {
        "src/**/*.{js,jsx,ts,tsx,json,vue}": [
          "eslint --fix",
          "prettier --write",
          "git add"
        ],
        "*.scss": [
          "stylelint --fix"
        ]
    }
    ```

#### åœ¨ husky çš„ v8.x ç‰ˆæœ¬ä¸­

husky çš„ 8.x ç‰ˆæœ¬æ·»åŠ æ–°é’©å­çš„æ–¹æ³•å’Œ 7.x ç‰ˆæœ¬æ˜¯ä¸€æ ·çš„ï¼Œæ‚¨åªéœ€è¦ä½¿ç”¨ `husky add` å‘½ä»¤æ¥æ·»åŠ é’©å­è„šæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³æ·»åŠ ä¸€ä¸ª pre-push é’©å­ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
npx husky add .husky/pre-push "npm run lint"
```

è¿™æ ·ï¼Œå½“å®‰è£…ä¾èµ–æ—¶ï¼Œhusky ä¼šè‡ªåŠ¨åˆ›å»º `.husky` ç›®å½•ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º git é’©å­çš„ç›®å½•ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨ .husky ç›®å½•ä¸‹æŸ¥çœ‹æˆ–ä¿®æ”¹é’©å­è„šæœ¬

#### åœ¨ husky çš„ v9.x ç‰ˆæœ¬ä¸­(å•†ä¸šæ”¶è´¹ï¼Œä¸æ¨èä½¿ç”¨)

husky çš„ä½œè€…åœ¨ 9.x ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„è®¸å¯è¯ï¼Œå«åš Parity Public Licenseã€‚è¿™ä¸ªè®¸å¯è¯çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ”¯æŒå¼€æºè½¯ä»¶çš„å¼€å‘è€…ï¼Œè®©ä»–ä»¬èƒ½å¤Ÿä»è‡ªå·±çš„åŠ³åŠ¨ä¸­è·å¾—æ”¶å…¥ã€‚

å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªè®¸å¯è¯çš„å«ä¹‰æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ husky çš„ 9.x ç‰ˆæœ¬ï¼Œæ‚¨å¿…é¡»éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š

- å¦‚æœæ‚¨åªæ˜¯åœ¨ä¸ªäººé¡¹ç›®ä¸­ä½¿ç”¨ huskyï¼Œæˆ–è€…æ‚¨çš„é¡¹ç›®æ˜¯å¼€æºçš„ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å’Œ husky ç›¸åŒçš„è®¸å¯è¯ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å…è´¹ä½¿ç”¨ huskyã€‚
- å¦‚æœæ‚¨åœ¨å•†ä¸šé¡¹ç›®ä¸­ä½¿ç”¨ huskyï¼Œæˆ–è€…æ‚¨çš„é¡¹ç›®æ˜¯é—­æºçš„ï¼Œæˆ–è€…æ‚¨çš„é¡¹ç›®ä½¿ç”¨äº†å’Œ husky ä¸åŒçš„è®¸å¯è¯ï¼Œé‚£ä¹ˆæ‚¨å¿…é¡»å‘ husky çš„ä½œè€…æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ï¼Œæˆ–è€…è·å¾—ä»–çš„æˆæƒã€‚

**åœ¨ husky çš„ v9.x ç‰ˆæœ¬ä¸­**ï¼Œè¿è¡Œ `husky install` åï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°ä»¥ä¸‹è­¦å‘Šï¼š

```bash
install command is deprecated

# husky9.0ç‰ˆæœ¬ä¸­ï¼šhusky installå‘½ä»¤è¢«åºŸé™¤
```

è§£å†³æ–¹æ³•æ˜¯å°† package.json ä¸­çš„ script è„šæœ¬ï¼š`postinstall` å‘½ä»¤ æ”¹æˆ `prepare`å‘½ä»¤

```json
-    "postinstall": "husky install",
+    "prepare": "husky",
```

**åœ¨ husky çš„ v9.x ç‰ˆæœ¬ä¸­**ï¼Œ`npx husky add` å‘½ä»¤å·²ç»è¢«åºŸå¼ƒäº†ï¼Œä¸å†æ”¯æŒæ·»åŠ  git hooks çš„åŠŸèƒ½ï¼Œ**è¦æ·»åŠ å¦ä¸€ä¸ªé’©å­**ï¼Œè€Œæ˜¯ä½¿ç”¨ echo å‘½ä»¤æ¥åˆ›å»ºé’©å­è„šæœ¬ï¼Œå¹¶å°†å…¶é‡å®šå‘åˆ° .husky ç›®å½•ä¸‹çš„ç›¸åº”æ–‡ä»¶ä¸­ã€‚

1.**å–è€Œä»£ä¹‹çš„æ˜¯ä½¿ç”¨ echo å‘½ä»¤æ¥åˆ›å»ºé’©å­è„šæœ¬**ï¼Œå¹¶å°†å…¶é‡å®šå‘åˆ° .husky ç›®å½•ä¸‹çš„ç›¸åº”æ–‡ä»¶ä¸­ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³æ·»åŠ ä¸€ä¸ª pre-commit é’©å­ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤

```bash
echo "npm test" > .husky/pre-commit
```

è¿™æ ·ï¼Œå½“æ‚¨å®‰è£…ä¾èµ–æ—¶ï¼Œhusky ä¼šè‡ªåŠ¨åˆ›å»º `.husky` ç›®å½•ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º git é’©å­çš„ç›®å½•ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨ .husky ç›®å½•ä¸‹æŸ¥çœ‹æˆ–ä¿®æ”¹é’©å­è„šæœ¬ã€‚

2.**ä¹Ÿå¯ä»¥ä½¿ç”¨ husky-cli æ¥ç®¡ç† git hooks**ï¼Œæˆ–è€…ç›´æ¥åœ¨ .husky ç›®å½•ä¸‹åˆ›å»ºæˆ–ç¼–è¾‘é’©å­è„šæœ¬ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³æ·»åŠ  commit-msg é’©å­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤ï¼š

```
npx husky-cli add commit-msg 'npx --no-install commitlint --edit "$1"'
```

3.**æˆ–è€…ç›´æ¥åœ¨ .husky ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `commit-msg` çš„æ–‡ä»¶**ï¼Œå†…å®¹ä¸ºï¼š

```bash
#!/bin/sh
. â€œ$(dirname â€œ$0â€)/_/husky.shâ€

npx --no-install commitlint --edit â€œ$1â€
```

## ä½¿ç”¨ husky æ¥è§„èŒƒ Git æäº¤çš„æ ¼å¼

### 0.Git ä»£ç æäº¤è§„èŒƒâ€”â€”æ•´åˆå®‰è£…çš„åº“

husky æå®š Git ä»£ç æäº¤è§„èŒƒ

```bash
pnpm add -D husky lint-staged cz-customizable @commitlint/cli @commitlint/config-conventional

# commitizenåº“éœ€è¦å…¨å±€å®‰è£…
pnpm add -g commitizen

npm install -g commitizen
```

æ·»åŠ  pre-commit hook é’©å­éœ€è¦å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š

- husky
- lint-staged

æ·»åŠ  commit-msg hook é’©å­éœ€è¦ä»¥ä¸‹ä¾èµ–ï¼š

- commitizenï¼šäº¤äº’å¼ git commit é…ç½®åº“ã€‚
- cz-customizableï¼šå¯è‡ªå®šä¹‰çš„ commitizen æ’ä»¶ï¼Œå®ƒå¯ä»¥è®©ä½ æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é…ç½®æäº¤ä¿¡æ¯çš„æ ¼å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼ã€‚
- @commitlint/cli
- @commitlint/config-conventional

### 1.éœ€è¦å…ˆåˆå§‹åŒ–`.husky`æ–‡ä»¶å¤¹ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤

```bash
# huskyç‰ˆæœ¬7åŠä¹‹å‰ç‰ˆæœ¬
npx husky install
pnpm dlx husky install

# huskyç‰ˆæœ¬8
npx husky-init
pnpm dlx husky-init

# huskyç‰ˆæœ¬9
npx husky init
pnpm exec husky init
```

### 2.è‡ªåŠ¨å¯ç”¨ husky å‘½ä»¤

é¡¹ç›®ä¸­è¿è¡Œå‘½ä»¤

```bash
# huskyç‰ˆæœ¬7å’Œ8éƒ½å¯ä»¥æ‰§è¡Œ
npm set-script prepare "husky install"  && npm run prepare

pnpm pkg set scripts.prepare="husky install" && pnpm run prepare
```

ä¼šåœ¨ package.json ä¸­æ·»åŠ å‘½ä»¤ï¼ˆæ‰‹åŠ¨åœ¨ package.json ä¸­æ·»åŠ è¿™æ¡å‘½ä»¤ä¹Ÿå¯ä»¥ï¼‰

```json
"scripts": {
  "prepare": "husky install"
},
```

æ‰§è¡Œ `prepare` æŒ‡ä»¤

æ‰§è¡ŒæˆåŠŸï¼Œæç¤ºï¼š`husky - Git hooks installed`

ä¹‹åå°±å¯ä»¥è¿›è¡Œä¸‹é¢çš„æ“ä½œ

### 3.lint-staged è‡ªåŠ¨ä¿®å¤æ ¼å¼é”™è¯¯

- npm æ–‡æ¡£ï¼š[lint-staged - npm (npmjs.com)](https://www.npmjs.com/package/lint-staged)
- å¼€æºåœ°å€ï¼š[lint-staged/lint-staged: ğŸš«ğŸ’© â€” Run linters on git staged files (github.com)](https://github.com/lint-staged/lint-staged)

**lint-staged æ˜¯ä¸€ä¸ªåœ¨ git æš‚å­˜åŒºä¸Šè¿è¡Œ linters çš„å·¥å…·ã€‚**

å®ƒå°†æ ¹æ® package.json ä¾èµ–é¡¹ä¸­çš„ä»£ç è´¨é‡å·¥å…·æ¥å®‰è£…å’Œé…ç½® husky å’Œ lint-staged ï¼Œå› æ­¤è¯·ç¡®ä¿åœ¨æ­¤ä¹‹å‰å®‰è£…ï¼ˆnpm install --save-devï¼‰å¹¶é…ç½®æ‰€æœ‰ä»£ç è´¨é‡å·¥å…·ï¼Œæ¯”å¦‚ Prettier å’Œ ESlintã€‚

é€šè¿‡ `pre-commit` å¤„ç†äº† **æ£€æµ‹ä»£ç çš„æäº¤è§„èŒƒé—®é¢˜ï¼Œå½“æˆ‘ä»¬è¿›è¡Œä»£ç æäº¤æ—¶ï¼Œä¼šæ£€æµ‹æ‰€æœ‰çš„ä»£ç æ ¼å¼è§„èŒƒ** ã€‚

ä½†æ˜¯è¿™æ ·ä¼šå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š

1. æˆ‘ä»¬åªä¿®æ”¹äº†ä¸ªåˆ«çš„æ–‡ä»¶ï¼Œæ²¡æœ‰å¿…è¦æ£€æµ‹æ‰€æœ‰çš„æ–‡ä»¶ä»£ç æ ¼å¼
2. å®ƒåªèƒ½ç»™æˆ‘ä»¬æç¤ºå‡ºå¯¹åº”çš„é”™è¯¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰‹åŠ¨çš„è¿›è¡Œä»£ç ä¿®æ”¹

é‚£ä¹ˆæƒ³è¦å¤„ç†è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ’ä»¶ [lint-staged](https://github.com/okonet/lint-staged) ï¼

[lint-staged](https://github.com/okonet/lint-staged) å¯ä»¥è®©ä½ å½“å‰çš„ä»£ç æ£€æŸ¥ **åªæ£€æŸ¥æœ¬æ¬¡ä¿®æ”¹æ›´æ–°çš„ä»£ç ï¼Œå¹¶åœ¨å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œè‡ªåŠ¨ä¿®å¤å¹¶ä¸”æ¨é€**

å®‰è£… lint-staged

```bash
yarn add lint-staged -D
pnpm add lint-staged -D
```

```js
æ‰§è¡Œ npx lint-staged --help å‘½ä»¤å¯ä»¥çœ‹åˆ°ç›¸å…³çš„æ‰€æœ‰å‚æ•°å¦‚ä¸‹ï¼š
ç”¨æ³•: lint-staged [options]

Options:
  -V, --version                      è¾“å‡ºç‰ˆæœ¬å·
  --allow-empty                      å½“ä»»åŠ¡æ’¤æ¶ˆæ‰€æœ‰åˆ†é˜¶æ®µçš„æ›´æ”¹æ—¶å…è®¸ç©ºæäº¤ï¼ˆé»˜è®¤å€¼ï¼šfalseï¼‰
  -c, --config [path]                é…ç½®æ–‡ä»¶çš„è·¯å¾„
  -d, --debug                        æ‰“å°å…¶ä»–è°ƒè¯•ä¿¡æ¯ï¼ˆé»˜è®¤å€¼ï¼šfalseï¼‰
  -p, --concurrent <parallel tasks>  è¦åŒæ—¶è¿è¡Œçš„ä»»åŠ¡æ•°ï¼Œæˆ–è€…ä¸ºfalseåˆ™è¦è¿ç»­è¿è¡Œä»»åŠ¡ï¼ˆé»˜è®¤å€¼ï¼štrueï¼‰
  -q, --quiet                        è‡ªå·±çš„æ§åˆ¶å°è¾“å‡ºï¼ˆé»˜è®¤å€¼ï¼šfalseï¼‰
  -r, --relative                     å°†ç›¸å¯¹æ–‡ä»¶è·¯å¾„ä¼ é€’ç»™ä»»åŠ¡ï¼ˆé»˜è®¤å€¼ï¼šfalseï¼‰
  -x, --shell                        è·³è¿‡ä»»åŠ¡è§£æä»¥æ›´å¥½åœ°æ”¯æŒshellï¼ˆé»˜è®¤å€¼ï¼šfalseï¼‰
  -h, --help                         è¾“å‡ºç”¨æ³•ä¿¡æ¯
```

- **--allow-empty**ï¼šä½¿ç”¨æ­¤å‚æ•°å…è®¸åˆ›å»ºç©ºçš„ git æäº¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ LITER ä»»åŠ¡æ’¤æ¶ˆæ‰€æœ‰é˜¶æ®µæ€§çš„æ›´æ”¹æ—¶ï¼ŒLITET é˜¶æ®µå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä¸­æ­¢æäº¤ã€‚

#### husky åˆ›å»ºé’©å­é…ç½®

```bash
npx husky add .husky/pre-commit
```

#### ç”Ÿæˆçš„æ–‡ä»¶ä¸­å†™å…¥

```bash
npx lint-staged
```

#### æŠŠ package.json æ–‡ä»¶çš„ lint-staged ä¿®æ”¹ä¸º

```json
"lint-staged": {
   "src/**/*.{js,vue}": [      //srcç›®å½•ä¸‹æ‰€æœ‰çš„jså’Œvueæ–‡ä»¶
     "eslint --fix",           // è‡ªåŠ¨ä¿®å¤
     "git add"                 // è‡ªåŠ¨æäº¤æ—¶ä¿®å¤
   ]
 }
```

### 4.@commitlint/config-conventional å’Œ@commitlint/cliâ€”â€”æ ¡éªŒ git æäº¤çš„æè¿°è§„èŒƒåº“

npm å¯ä»¥è¿™æ ·å­é€‰æ‹©ä¸¤ä¸ªåŒ…å®‰è£…ï¼š`npm i @commitlint/{cli,config-conventional} -D`

**è§„èŒƒ git æäº¤è®°å½•**ï¼šcommitlint ç›¸å…³ä¾èµ–ï¼ˆç”¨æ¥å¸®åŠ©æˆ‘ä»¬åœ¨å¤šäººå¼€å‘æ—¶ï¼Œéµå®ˆ git æäº¤çº¦å®šï¼‰

- ä»¥ä¸‹å‚è€ƒ**å®˜ç½‘æ–‡æ¡£**å¾—å‡ºï¼š[commitlint - Lint commit messages](https://commitlint.js.org/#/)


1.**æ‰§è¡Œå‘½ä»¤è‡ªåŠ¨åˆ›å»º `commitlint.config.js` æ–‡ä»¶**ï¼š

```bash
echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.js
```

2.**æˆ–åœ¨æ ¹ç›®å½•æ‰‹åŠ¨åˆ›å»º `commitlint.config.js` æ–‡ä»¶å…¶å†…å®¹å¦‚ä¸‹æ‰€ç¤º**ï¼š

```js
// è§„èŒƒcommitæ—¥å¿—å®˜ç½‘é…ç½®ï¼šhttps://commitlint.js.org
module.exports = {
	// ç»§æ‰¿çš„è§„åˆ™
	extends: ["@commitlint/config-conventional"],
	// å®šä¹‰è§„åˆ™ç±»å‹ï¼šhttps://github.com/conventional-changelog/commitlint/blob/master/docs/reference-rules.md
	rules: {
		// è§„å®šæäº¤ç±»å‹çš„å¤§å°å†™çš„ã€‚å®ƒçš„å«ä¹‰æ˜¯ï¼š2ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé”™è¯¯çº§åˆ«çš„è§„åˆ™ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œæäº¤ä¼šè¢«æ‹’ç»ã€‚alwaysï¼šè¡¨ç¤ºè¿™ä¸ªè§„åˆ™æ€»æ˜¯ç”Ÿæ•ˆï¼Œæ— è®ºæäº¤ç±»å‹æ˜¯ä»€ä¹ˆã€‚[â€˜lower-caseâ€™, â€˜upper-caseâ€™]ï¼šè¡¨ç¤ºæäº¤ç±»å‹å¿…é¡»æ˜¯å…¨å°å†™æˆ–å…¨å¤§å†™ï¼Œä¸èƒ½æ··åˆä½¿ç”¨ã€‚
		// 'type-case': [2, 'always', ['lower-case', 'upper-case']],
		// type ç±»å‹å®šä¹‰ï¼šä¸ºå¿…å¡«é¡¹ï¼Œç”¨äºæŒ‡å®š commit çš„ç±»å‹ï¼Œè¡¨ç¤º git æäº¤çš„ type å¿…é¡»åœ¨ä»¥ä¸‹ç±»å‹èŒƒå›´å†…ã€‚
		"type-enum": [
			2,
			"always",
			[
				"feat", // æ–°åŠŸèƒ½ featureï¼šå¢åŠ ä¸€ä¸ªæ–°ç‰¹æ€§
				"fix", // ä¿®å¤ bug
				"docs", // æ–‡æ¡£æ³¨é‡Šï¼šä»…ä»…ä¿®æ”¹æ–‡æ¡£è¯´æ˜
				"style", // ä»£ç æ ¼å¼(ä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨)ï¼šä¸å½±å“ä»£ç å«ä¹‰çš„æ”¹åŠ¨ï¼Œä¾‹å¦‚å»æ‰ç©ºæ ¼ã€æ”¹å˜ç¼©è¿›ã€å¢åˆ åˆ†å·
				"refactor", // é‡æ„(æ—¢ä¸å¢åŠ æ–°åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bug)
				"perf", // æ€§èƒ½ä¼˜åŒ–ï¼šæ›´æ”¹ä»£ç ä»¥æé«˜æ€§èƒ½
				"test", // å¢åŠ æµ‹è¯•
				"chore", // æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
				"revert", // å›é€€
				"wip", // æ­£åœ¨è¿›è¡Œçš„å·¥ä½œ
				"build", // æ‰“åŒ…ï¼šæ›´æ”¹æ„å»ºç³»ç»Ÿå’Œå¤–éƒ¨ä¾èµ–é¡¹ï¼ˆå¦‚å°† gulp æ”¹ä¸º webpackï¼Œæ›´æ–°æŸä¸ª npm åŒ…ï¼‰
				"ci", // å¯¹ CI é…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„æ›´æ”¹
				"test", // å¢åŠ æ–°çš„æµ‹è¯•åŠŸèƒ½æˆ–æ›´æ”¹åŸæœ‰çš„æµ‹è¯•æ¨¡å—
			],
		],
		// subject å¤§å°å†™ä¸åšæ ¡éªŒ
		"subject-case": [0],
		// 'subject-case': [2, 'never', ['upper-case']], // æäº¤ä¿¡æ¯çš„ä¸»é¢˜ä¸èƒ½æ˜¯å¤§å†™
		"header-max-length": [2, "always", 999], // æäº¤ä¿¡æ¯çš„é•¿åº¦ä¸èƒ½è¶…è¿‡999ä¸ªå­—ç¬¦
	},
};
```

**æ³¨æ„ï¼šç¡®ä¿ä¿å­˜ä¸º `UTF-8` çš„ç¼–ç æ ¼å¼**ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š

![image-20210710121456416](./ç¼–ç¨‹è§„èŒƒ.assets/image-20210710121456416.png)

#### æ‰§è¡Œ commitlint é’©å­å‘½ä»¤ï¼š

```bash
pnpm husky add .husky/commit-msg 'pnpm commitlint --edit "$1"'
```

ä¹‹åï¼Œä¼šçœ‹åˆ°åœ¨æ ¹ç›®å½•çš„`.husky`æ–‡ä»¶å¤¹ä¸‹å¤šäº†ä¸€ä¸ª `commit-msg` æ–‡ä»¶

![image-20240221010133051](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240221010133051.png)

å…¶å†…å®¹å¦‚ä¸‹ï¼š

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

pnpm commitlint --edit "$1"
```

å°†æ·»åŠ çš„ `.husky/commit-msg` é’©å­æ·»åŠ åˆ° git ä¸­å»ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š

```bash
git add .husky/commit-msg
```

#### å†æ‰§è¡Œ lint-staged åº“æ·»åŠ çš„.husky/pre-commit é’©å­å‘½ä»¤ï¼š

```bash
pnpm husky add .husky/pre-commit 'pnpm lint-staged --allow-empty "$1"'
```

ä¹‹åï¼Œä¼šçœ‹åˆ°åœ¨æ ¹ç›®å½•çš„`.husky`æ–‡ä»¶å¤¹ä¸‹å¤šäº†ä¸€ä¸ª `pre-commit` æ–‡ä»¶

![image-20240221010203924](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240221010203924.png)

å…¶å†…å®¹å¦‚ä¸‹ï¼š

```js
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

yarn lint-staged --allow-empty "$1"
```

åŒæ ·çš„ï¼Œå°†æ·»åŠ çš„ `.husky/pre-commit` é’©å­æ·»åŠ åˆ° git ä¸­å»ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š

```bash
git add .husky/pre-commit
```

#### æ£€éªŒç°æœ‰çš„é…ç½®

git æäº¤æ ¼å¼ï¼š

```
<type>(<scope>): <subject>

1. type ä¸ºå¿…å¡«é¡¹ï¼Œç”¨äºæŒ‡å®š commit çš„ç±»å‹

build : æ›´æ”¹æ„å»ºç³»ç»Ÿå’Œå¤–éƒ¨ä¾èµ–é¡¹ï¼ˆå¦‚å°† gulp æ”¹ä¸º webpackï¼Œæ›´æ–°æŸä¸ª npm åŒ…ï¼‰
ci : å¯¹ CI é…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„æ›´æ”¹
docs : ä»…ä»…ä¿®æ”¹æ–‡æ¡£è¯´æ˜
feat : å¢åŠ ä¸€ä¸ªæ–°ç‰¹æ€§
fix : ä¿®å¤ä¸€ä¸ª bug
perf : æ›´æ”¹ä»£ç ä»¥æé«˜æ€§èƒ½
refactor : ä»£ç é‡æ„æ—¶ä½¿ç”¨
style : ä¸å½±å“ä»£ç å«ä¹‰çš„æ”¹åŠ¨ï¼Œä¾‹å¦‚å»æ‰ç©ºæ ¼ã€æ”¹å˜ç¼©è¿›ã€å¢åˆ åˆ†å·
test : å¢åŠ æ–°çš„æµ‹è¯•åŠŸèƒ½æˆ–æ›´æ”¹åŸæœ‰çš„æµ‹è¯•æ¨¡å—
è¿˜æ”¯æŒå…¶ä»–è‡ªå®šä¹‰ç±»å‹ï¼šåœ¨é…ç½®æ–‡ä»¶æ–°å¢å³å¯

2. scope ä¸ºéå¿…å¡«é¡¹ï¼Œç”¨äºæè¿°æ”¹åŠ¨çš„å½±å“èŒƒå›´
scopeå¯ä»¥æ˜¯æ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯æ¨¡å—åï¼Œç”±è‡ªå·±å®š

3. subject æ˜¯å¿…å¡«é¡¹ï¼Œä»£è¡¨æ­¤æ¬¡æäº¤çš„æ—¥å¿—ä¿¡æ¯
```

æ¥ä¸‹æ¥ï¼Œå°±æ˜¯æ£€éªŒé…ç½®çš„æ—¶å€™äº†ï¼šå½“æˆ‘ä»¬æŒ‰ç…§ git commit è§„èŒƒæ­£ç¡®æäº¤æ—¶ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°å¦‚ä¸‹è¾“å‡º

è§„èŒƒåŒ–æäº¤ä»£ç ï¼Œä¼šæäº¤æˆåŠŸ

```bash
# è§„èŒƒåŒ–æäº¤ä»£ç ï¼Œä¼šæäº¤æˆåŠŸ
git ci -m 'feat: æ–°å¢åŠŸèƒ½'
```

ä¸è§„èŒƒæäº¤ä»£ç ï¼Œé˜»æ­¢ä½ çš„ä»£ç æäº¤ï¼Œå¹¶æäº¤å¤±è´¥

```bash
# ä¸è§„èŒƒæäº¤ä»£ç ï¼Œé˜»æ­¢ä½ çš„ä»£ç æäº¤ï¼Œå¹¶æäº¤å¤±è´¥
git ci -m 'å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ'

âœ–   subject may not be empty [subject-empty]
âœ–   type may not be empty [type-empty]

âœ–   found 2 problems, 0 warnings
â“˜   Get help: https://github.com/conventional-changelog/commitlint/#what-is-commitlint

husky - commit-msg hook exited with code 1 (error)
```

é‚£ä¹ˆè‡³æ­¤ï¼Œæˆ‘ä»¬å°±å·²ç»å¯ä»¥å¤„ç†å¥½äº† **å¼ºåˆ¶è§„èŒƒåŒ–çš„æäº¤è¦æ±‚**ï¼Œåˆ°ç°åœ¨ **ä¸ç¬¦åˆè§„èŒƒçš„æäº¤ä¿¡æ¯ï¼Œå°†ä¸å¯åœ¨è¢«æäº¤ï¼**

### 5.commitizen+cz-customizable åº“â€”â€”æ·»åŠ äº¤äº’å¼ git commit äº¤äº’å¼æè¿°çš„é…ç½®

**commitizen åŠ©ä½ è§„èŒƒåŒ–äº¤äº’æäº¤ä»£ç **

`commitizen` ä»“åº“åä¸º [cz-cli](https://github.com/commitizen/cz-cli) ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª `git cz` çš„æŒ‡ä»¤ç”¨äºä»£æ›¿ `git commit`ï¼Œç®€å•ä¸€å¥è¯ä»‹ç»å®ƒï¼š

> å½“ä½ ä½¿ç”¨ `commitizen` è¿›è¡Œä»£ç æäº¤ï¼ˆgit commitï¼‰æ—¶ï¼Œ`commitizen` ä¼šæäº¤ä½ åœ¨æäº¤æ—¶å¡«å†™æ‰€æœ‰å¿…éœ€çš„æäº¤å­—æ®µï¼

- **commitizen**ï¼šè¿™æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå¯ä»¥è®©æ‚¨é€šè¿‡äº¤äº’å¼çš„æ–¹å¼æ¥è¾“å…¥æäº¤ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ git commit å‘½ä»¤ã€‚
- **cz-conventional-changelog**ï¼šè¿™æ˜¯ commitizen çš„å®˜æ–¹é€‚é…å™¨ï¼Œå®ƒå¯ä»¥è®©æ‚¨æŒ‰ç…§ Angular å›¢é˜Ÿçš„æäº¤ä¿¡æ¯æ ¼å¼æ¥ç”Ÿæˆæäº¤ä¿¡æ¯ã€‚
- **cz-customizable**ï¼šè¿™æ˜¯ä¸€ä¸ªå¯è‡ªå®šä¹‰çš„ commitizen æ’ä»¶ï¼Œå®ƒå¯ä»¥è®©æ‚¨æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é…ç½®æäº¤ä¿¡æ¯çš„æ ¼å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼

æˆ‘ä»¬ä»¥ä¸‹ç”¨çš„æ˜¯ commitizen å’Œ cz-customizable è¿™ä¸¤ä¸ªåº“ï¼Œcz-customizable ç”¨æ¥è‡ªå®šä¹‰é…ç½®å±äºæˆ‘ä»¬çš„æäº¤ä¿¡æ¯çš„æ ¼å¼

#### åœ¨ package.json ä¸­è¿½åŠ ä»¥ä¸‹é…ç½®ï¼š

```json
"config": {
    "commitizen": {
      "path": "node_modules/cz-customizable"
    },
    "cz-customizable": {
      "config": ".cz-config.cjs"
    }
},
```

#### æ–°å»º `.cz-config.cjs` æ–‡ä»¶ï¼Œå¹¶å†™å…¥ï¼š

```js
// å‚è€ƒæ–‡æ¡£ï¼šhttps://www.npmjs.com/package/cz-customizable
module.exports = {
  // æŒ‡å®šè¦ä½¿ç”¨çš„é€‚é…å™¨
  adapter: 'cz-customizable',
  // æŒ‡å®šè¦ä½¿ç”¨çš„é¢„è®¾
  preset: 'vue',
  // æŒ‡å®šè¦ä½¿ç”¨çš„è¯­è¨€
  locale: 'zh-CN',
  // æŒ‡å®šè¦ä½¿ç”¨çš„ä¸»é¢˜
  theme: 'default',
  // æŒ‡å®šè¦ä½¿ç”¨çš„è¡¨æƒ…ç¬¦å·
  useEmoji: true,
  // æŒ‡å®šè¦ä½¿ç”¨çš„æäº¤ç±»å‹
  types: [
    { value: 'feat', name: 'feat:âœ¨  æ–°åŠŸèƒ½' },
    { value: 'fix', name: 'fix:ğŸ  ä¿®å¤bug' },
    { value: 'docs', name: 'docs:ğŸ“  æ–‡æ¡£å˜æ›´' },
    { value: 'style', name: 'style:ğŸ’…  ä¿®æ”¹æ ·å¼(ä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨)' },
    { value: 'refactor', name: 'refactor:ğŸ”¨  ä»£ç é‡æ„(æ—¢ä¸æ˜¯å¢åŠ featureï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bug)' },
    { value: 'perf', name: 'perf:ğŸš€  æ€§èƒ½|ä½“éªŒä¼˜åŒ–' },
    { value: 'test', name: 'test:ğŸ§ª  å¢åŠ æµ‹è¯•' },
    { value: 'chore', name: 'chore:ğŸ—¯  æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨' },
    { value: 'revert', name: 'revert:âª  å›é€€' },
    { value: 'WIP', name: 'WIP:ğŸš§  æ­£åœ¨è¿›è¡Œä¸­çš„å·¥ä½œ' },
    { value: 'merge', name: 'merge:âŒ›  åˆå¹¶ä»£ç ' },
    { value: 'build', name: 'build:ğŸ“¦  æ‰“åŒ…' },
    { value: 'ci', name: 'ci:ğŸ”§  æŒç»­é›†æˆ' },
  ],
  
  // æŒ‡å®šè¦ä½¿ç”¨çš„æäº¤èŒƒå›´
  scopes: [
    { name: 'UI' },
    { name: 'API' },
    { name: 'Data' },
    { name: 'Auth' },
    { name: 'Other' },
  ],
  scopeOverrides: {
    fix: [
      { name: 'Bug' },
      { name: 'Hotfix' },
    ],
  },
  
  // æ¶ˆæ¯æ­¥éª¤
  messages: {
    type: 'è¯·é€‰æ‹©æäº¤ç±»å‹:',
    scope: 'è¯·é€‰æ‹©æäº¤èŒƒå›´ (å¯é€‰):',
    customScope: 'è¯·è¾“å…¥è‡ªå®šä¹‰ä¿®æ”¹æäº¤çš„èŒƒå›´(å¯é€‰):',
    subject: 'è¯·ç®€è¦æè¿°æäº¤â€”â€”çŸ­è¯´æ˜(å¿…å¡«):',
    body: 'è¯·è¾“å…¥æäº¤çš„è¯¦ç»†æè¿°â€”â€”é•¿è¯´æ˜ã€‚ä½¿ç”¨"|"æ¢è¡Œ(å¯é€‰):',
    breaking: 'è¯·åˆ—å‡ºéå…¼å®¹æ€§å˜æ›´ (å¯é€‰):',
    footer: 'è¯·è¾“å…¥è¦å…³é—­çš„issueç›¸å…³çš„é—®é¢˜æˆ–åˆå¹¶è¯·æ±‚ï¼Œä¾‹å¦‚ï¼š#31, #34((å¯é€‰):',
    confirmCommit: 'ç¡®è®¤ä½¿ç”¨ä»¥ä¸Šä¿¡æ¯æäº¤å—ï¼Ÿ'
  },
  allowCustomScopes: true,
  allowBreakingChanges: ['feat', 'fix'],
  // è·³è¿‡é—®é¢˜
  skipQuestions: ['body', 'footer'],
  // æŒ‡å®šè¦ä½¿ç”¨çš„æäº¤ä¸»é¢˜çš„æœ€å¤§é•¿åº¦ï¼š72
  subjectLimit: 72
}
```

#### js æ¨¡å—åŒ–æ‰©å±•çŸ¥è¯†ï¼ˆå…³äºæˆ‘è¿™é‡Œä¸ºä»€ä¹ˆæŠŠ.js å†™æˆ.cjs åç¼€ï¼‰

##### package.json ä¸­çš„ `{"type": "module"}` é…ç½®ï¼š

æƒ³è¦å¯¼å…¥ CommonJS çš„è¯­æ³•æ¥ç¼–å†™å’Œå¯¼å…¥æ¨¡å— `.cjs`ï¼š

```js
// a.cjs
// å¯¼å‡ºä¸€ä¸ªå‡½æ•°
function add(x, y) {
	return x + y;
}
module.exports = { add };

// b.cjs
// å¯¼å…¥ a.cjs æ¨¡å—
const { add } = require("./a.cjs");
console.log(add(1, 2));
```

##### package.json ä¸­çš„ `{"type": "commonjs"}` é…ç½®ï¼š

æƒ³è¦å¯¼å…¥ä½¿ç”¨ ES æ¨¡å—çš„è¯­æ³•æ¥ç¼–å†™å’Œå¯¼å…¥åœ¨ .mjs åç¼€æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š

```js
// a.mjs
// å¯¼å‡ºä¸€ä¸ªå‡½æ•°
export function add(x, y) {
	return x + y;
}

// b.mjs
// å¯¼å…¥ a.mjs æ¨¡å—
import { add } from "./a.mjs";
console.log(add(1, 2));
```

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

#### å†æ¬¡æ ¡éªŒ git æäº¤çš„é…ç½®ï¼š

```bash
git add .
# git czå‘½ä»¤ æ›¿ä»£äº†git commitå‘½ä»¤
git cz
```

ä¼šè¾“å‡ºä»¥ä¸‹ï¼Œæ ¹æ®æ­¥éª¤äº¤äº’é€‰æ‹©å’Œè¾“å…¥æè¿°ï¼Œä¼šè‡ªåŠ¨ä¸€æ­¥æ­¥æ ¡éªŒï¼š

![image-20240220225609127](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240220225609127.png)

å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œä¾¿ä¼šæˆåŠŸæäº¤ï¼š

![image-20240220235218703](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240220235218703.png)

å¦‚æœæœ‰é”™è¯¯ï¼Œåˆ™ä¼šæœ‰æ‰€æç¤ºï¼Œæ‰¾å‡ºæ¥ä¿®å¤å³å¯ï¼š

![image-20240220230232250](./ç¼–ç¨‹è§„èŒƒ.assets/image-20240220230232250.png)

é‚£ä¹ˆåˆ°è¿™é‡Œæˆ‘ä»¬å°±å·²ç»å¯ä»¥ä½¿ç”¨`git cz` æ¥ä»£æ›¿äº† `git commit` å®ç°äº†è§„èŒƒåŒ–çš„æäº¤è¯‰æ±‚äº†ã€‚
