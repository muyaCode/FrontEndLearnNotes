import{_ as e,c as o,o as r,ah as p,j as n,a as t,t as l}from"./chunks/framework.DqD713j2.js";const d=JSON.parse('{"title":"Tauri应用更新Updater","description":"","frontmatter":{},"headers":[],"relativePath":"Document/跨平台桌面端开发/Tauri框架/Tauri应用更新Updater.md","filePath":"Document/跨平台桌面端开发/Tauri框架/Tauri应用更新Updater.md","lastUpdated":1750954157000}'),c={name:"Document/跨平台桌面端开发/Tauri框架/Tauri应用更新Updater.md"};function i(a,s,B,y,u,b){return r(),o("div",null,[s[2]||(s[2]=p(`<h1 id="tauri应用更新updater" tabindex="-1">Tauri应用更新Updater <a class="header-anchor" href="#tauri应用更新updater" aria-label="Permalink to &quot;Tauri应用更新Updater&quot;">​</a></h1><p>文档：<a href="https://tauri.app/zh-cn/v1/guides/distribution/updater/" target="_blank" rel="noreferrer">Updater | Tauri Apps</a></p><p>API：<a href="https://tauri.app/zh-cn/v1/api/js/updater" target="_blank" rel="noreferrer">updater | Tauri Apps</a></p><p>正常的应用程序更新需要手动下载并安装，而借助 <a href="https://tauri.app/zh-cn/v1/guides/distribution/updater/" target="_blank" rel="noreferrer">Tauri 内置的 Updater 程序</a> ，我们可以实现应用程序的自动更新推送</p><p>下面将介绍如何在 tauri 项目中实现自动更新推送的过程（仅windows环境）。为了避免给后端增加工作量，我选择静态json文件来配置更新信息，json与安装包同时保存在 minioOSS 中</p><p><a href="https://juejin.cn/post/7326738921471016969" target="_blank" rel="noreferrer">打造完美桌面应用体验：Tauri自动升级技术揭秘 - 掘金 (juejin.cn)</a></p><h2 id="实现步骤" tabindex="-1">实现步骤 <a class="header-anchor" href="#实现步骤" aria-label="Permalink to &quot;实现步骤&quot;">​</a></h2><h3 id="_1-生成签名" tabindex="-1">1. 生成签名 <a class="header-anchor" href="#_1-生成签名" aria-label="Permalink to &quot;1. 生成签名&quot;">​</a></h3><p>使用签名可以确保文件的完整性和来源可信性，在项目根目录执行命令 <code>npm run tauri signer generate -- -w ./app.key </code></p><p>后生成 app.key 和 app.key.pub（公钥） 文件</p><h3 id="_2-配置-updater" tabindex="-1">2. 配置 Updater <a class="header-anchor" href="#_2-配置-updater" aria-label="Permalink to &quot;2. 配置 Updater&quot;">​</a></h3><p>文档: <a href="https://tauri.app/zh-cn/v1/api/config/#updaterconfig" target="_blank" rel="noreferrer">Configuration | Tauri Apps</a></p><p>确保 Tauri 项目配置文件（<code>tauri.conf.json</code>）已经正确配置 Updater：</p><div class="language-json5 line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json5</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#98C379;">  &quot;updater&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">    &quot;active&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // 更新程序是否激活</span></span>
<span class="line"><span style="color:#98C379;">    &quot;dialog&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // 显示内置对话框，太丑了我不用</span></span>
<span class="line"><span style="color:#98C379;">    &quot;pubkey&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;xxx&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // app.key.pub签名公钥</span></span>
<span class="line"><span style="color:#98C379;">    &quot;endpoints&quot;</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#98C379;">      &quot;https://xxx/updater.json&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">      // 更新元数据的静态json文件地址</span></span>
<span class="line"><span style="color:#ABB2BF;">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div>`,14)),n("ul",null,[n("li",null,[s[0]||(s[0]=n("code",null,"endpoints",-1)),t("：数组，通过地址列表来确定服务器端是否有可用更新，字符串 "+l(a.target)+" 和 "+l(a.current_version)+" 会在 URL 中自动替换。如果指定了多个地址，服务器在预期时间内未响应，更新程序将依次尝试。 endpoints 支持两种格式： ",1),s[1]||(s[1]=n("ul",null,[n("li",null,"动态接口 - 服务器根据客户端的更新请求确定是否需要更新。 如果需要更新，服务器应以状态代码 200 OK 进行响应，并在正文中包含更新 JSON。 如果不需要更新，服务器必须响应状态代码 204 No Content。"),n("li",null,"静态文件 - 备用更新技术使用纯 JSON 文件，将更新元数据存储在 gist，github-pages 或其他静态文件存储中。（我选择的）")],-1))])]),s[3]||(s[3]=p(`<p>配置完成后执行构建客户端的命令得到安装包，别忘了开启 updater 后的构建需要环境变量 <code>TAURI_PRIVATE_KEY、TAURI_KEY_PASSWORD</code></p><h3 id="_3-编辑静态json文件-保存更新元数据" tabindex="-1">3. 编辑静态json文件（保存更新元数据） <a class="header-anchor" href="#_3-编辑静态json文件-保存更新元数据" aria-label="Permalink to &quot;3. 编辑静态json文件（保存更新元数据）&quot;">​</a></h3><p>文档: <a href="https://tauri.app/zh-cn/v1/guides/distribution/updater/#static-json-file" target="_blank" rel="noreferrer">Updater | Tauri Apps</a></p><p>由于关闭了内置更新对话框，需要在程序内手动检查更新，并执行后续的交互逻辑：</p><div class="language-json5 line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json5</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// updater.json</span></span>
<span class="line"><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#98C379;">  &quot;version&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;v1.0.0&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // 版本号，版本格式：主版本号.次版本号.修订号</span></span>
<span class="line"><span style="color:#98C379;">  &quot;notes&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;new Version&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // 更新说明</span></span>
<span class="line"><span style="color:#98C379;">  &quot;pub_date&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;2024-01-26T01:57:18.253Z&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // RFC 3339</span></span>
<span class="line"><span style="color:#98C379;">  &quot;platforms&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">    &quot;windows-x86_64&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">      &quot;signature&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;xxx&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">      // 私钥，app.key内容</span></span>
<span class="line"><span style="color:#98C379;">      &quot;url&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;https://xxx/xxx.nsis.zip&quot;</span></span>
<span class="line"><span style="color:#FFFFFF;">      //</span><span style="color:#FFFFFF;"> 安装包地址</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_4-程序内手动检查更新" tabindex="-1">4. 程序内手动检查更新 <a class="header-anchor" href="#_4-程序内手动检查更新" aria-label="Permalink to &quot;4. 程序内手动检查更新&quot;">​</a></h3><p>自定义弹窗：<a href="https://tauri.app/zh-cn/v1/guides/distribution/updater/#custom-dialog" target="_blank" rel="noreferrer">Updater | Tauri Apps</a></p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">checkUpdate</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#ABB2BF;"> {</span><span style="color:#E5C07B;">shouldUpdate</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">manifest</span><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> res</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">  if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">shouldUpdate</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">    Modal</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">confirm</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">      title</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\`发现新版本：</span><span style="color:#C678DD;">\${</span><span style="color:#E5C07B;">manifest</span><span style="color:#ABB2BF;">?.</span><span style="color:#E06C75;">version</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      content</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\`是否升级？\`</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      okText</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;升级&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      cancelText</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;取消&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#61AFEF;">      onOk</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">        try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">          notification</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">info</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">            message</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;正在下载更新...&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">            duration</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3000</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">          });</span></span>
<span class="line"><span style="color:#C678DD;">          await</span><span style="color:#61AFEF;"> installUpdate</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">          await</span><span style="color:#61AFEF;"> relaunch</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">        } </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">e</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">          notification</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">            message</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;下载更新失败&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">            description</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">e</span><span style="color:#ABB2BF;">?.</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">||</span><span style="color:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">          });</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">      },</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_5-手动上传文件到-miniooss" tabindex="-1">5. 手动上传文件到 minioOSS <a class="header-anchor" href="#_5-手动上传文件到-miniooss" aria-label="Permalink to &quot;5. 手动上传文件到 minioOSS&quot;">​</a></h3><p>将 updater.json 和 安装包.zip 文件上传到 minioOSS 中，然后将地址替换。在每次发版时手动修改 updater.json 中的信息，再重新构建并上传安装包。</p><p>一切顺利时客户端将收到更新</p><h3 id="_6-懒人模式-脚本" tabindex="-1">6. 懒人模式（脚本） <a class="header-anchor" href="#_6-懒人模式-脚本" aria-label="Permalink to &quot;6. 懒人模式（脚本）&quot;">​</a></h3><p>在 node 环境内执行构建命令，并继承环境变量</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">execSync</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;npm run tauri build&#39;</span><span style="color:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#E06C75;">  stdio</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;inherit&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  env</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#ABB2BF;">    ...</span><span style="color:#E5C07B;">process</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">env</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    TAURI_PRIVATE_KEY</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    TAURI_KEY_PASSWORD</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  },</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>登录 minio 并获取cookie</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> function</span><span style="color:#61AFEF;"> login</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">  try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // 拿到header内的cookie</span></span>
<span class="line"><span style="color:#C678DD;">    const</span><span style="color:#E5C07B;"> res</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> await</span><span style="color:#E5C07B;"> axios</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;https://xxx/xxx/login&#39;</span><span style="color:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#E06C75;">      accessKey</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;xxx&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      secretKey</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;xxx&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    });</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#E5C07B;"> res</span><span style="color:#ABB2BF;">?.</span><span style="color:#E06C75;">headers</span><span style="color:#ABB2BF;">?.[</span><span style="color:#98C379;">&#39;set-cookie&#39;</span><span style="color:#ABB2BF;">]?.</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  } </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">err</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">    console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;登录minio失败&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">    console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">err</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>上传文件到 minio</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">async</span><span style="color:#C678DD;"> function</span><span style="color:#61AFEF;"> uploadFile</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">cookie</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">  try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    await</span><span style="color:#E5C07B;"> request</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">      \`https://xxx/buckets/xxx/objects/upload\`</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      data</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">      {</span></span>
<span class="line"><span style="color:#E06C75;">        headers</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">          Cookie</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">cookie</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#98C379;">          &#39;Content-Type&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;multipart/form-data&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">        },</span></span>
<span class="line"><span style="color:#ABB2BF;">      },</span></span>
<span class="line"><span style="color:#ABB2BF;">    );</span></span>
<span class="line"><span style="color:#ABB2BF;">  } </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">err</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">    console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;上传文件失败&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">    console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">err</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>读取本地安装包并上传</p><div class="language-typescript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> FormData</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;form-data&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> fs</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;fs&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 读取本地的 updater.json 文件</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> buffer_updater</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> fs</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">readFileSync</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./xxx/updater.json&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 模拟 formData 格式上传</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> formData_updater</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> FormData</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E5C07B;">formData_updater</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">buffer_updater</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">length</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">(), </span><span style="color:#E06C75;">buffer_updater</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#C678DD;">await</span><span style="color:#61AFEF;"> uploadFile</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">formData_updater</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">cookie</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// 上传安装包同理</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h1 id="tauri-2-0-updater自动更新指南" tabindex="-1">Tauri 2.0 Updater自动更新指南 <a class="header-anchor" href="#tauri-2-0-updater自动更新指南" aria-label="Permalink to &quot;Tauri 2.0 Updater自动更新指南&quot;">​</a></h1><p><a href="https://juejin.cn/post/7358446362575568906" target="_blank" rel="noreferrer">Tauri 2.0 Updater自动更新指南 - 掘金 (juejin.cn)</a></p>`,22))])}const A=e(c,[["render",i]]);export{d as __pageData,A as default};
