import{_ as n,c as a,o as l,ah as p}from"./chunks/framework.DqD713j2.js";const e="/FrontEndLearnNotes/assets/image-20240219170312990.CO-Yv08c.png",o="/FrontEndLearnNotes/assets/image-20240219170402172.CrZrNg8S.png",r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALcAAAA/CAYAAACijVkqAAAH0UlEQVR4nO2dMW/iXBaGnztabbMabbPNTo1TRPkFpkkL0UhUSFOls0sjzaSjpItGskvcpaWiif0LoJrpUIrY7Uyz22W/du8WtsFgY0zWfBk855FchOt7uYTX5x4bv8dKa635jXl5ecG2ba6vr/n27Rtfv37l/fv3bz2tX46fP3/y4cOHt57GUbx76wm8JZmwP336hGVZfPnyhc+fP/Py8vLWUxMa4LcVd17YHz9+BODi4kIE3iLU75qWvLy88P37d66vrwttz8/PQCJ2IeEc05LfVtzCcZyjuA+kJSG26uLFNUaKPbpKoZRNCIS2wg6bmKIgvBK9l0BboNmzmW6ktdY6cs30NUsHWdfI1Wb+b+Hs+fHjR0VrpF1zWx9W7ssPrI1eyvblRFopjdyx10WpPgQarXe2yMU0XR6cDgAdZ4HWEa657o13O2KJT18pVG7r1loChPPExI02Gln1q1d8K6+tAPqq+ZW+IO7Y62LMhkRaM5jvTDC0UbfwsHBIpB3jdRVKGYyWmZgNRkuLYOegCCy4uug0O3vh16TjMLaWzB5rBrPeND0gkpS2KQri7jgLdCre3nTMk5EcUaGtUPPBui3dG2eh0TrAIhN0gOve0SM5ULpeDLHHZOVy12tw5kK76NwwNH3mDar7L9XNPe5cE6OvkhRlnzjDOT4+vlrhRgscZ6e947BYNDFd4SyIPSa+yTB625V679WS0E7yZGO0BMDv78ufY7w5WKZFoMc83XrEoY1aJ1ARXleunLSfJSMj1YcxYxgtcI7Wtsml0dyMCuLORD1ZmZhuVDyh1BodWOv9Y++W2eWASwB6TBcX3PchmGZh3sBZBHDgBEM4d3InlPoVwg7vGTHkpsFgXxB3b5pM8GFYb4Do6Yqxkx1uMV63D8GU7QymxzS4YnTrIfoWCoQ2qr/Cfcifz/3/VObcy5GBGpW3me4dAL3pFIhJfrBOTjBL6U335+zCb4ffV/jZH6ZLpKeNChsOiNt0IxZl60to032u6BjaqH4ydSuQy3/tp4NTccWgN9W5lTwJgLvXHE6B3Fsi1KKF95YIwvki4hZai4hbaC0ibqG1iLiF1iLiFlqLiFuoxV///s+3nsLRiLiF1iLiFlrL+ud35avKHbUlP2QK54VEbqG1vIPDUbvuPkcTe3Trlo4QhCMpRG5t6a1NEOoTYpdWOUheV7m6NhlJpYWcy6vUslUy7rpOTrKVdXuXj8hlYs6/1nj07jgsXuPaEH4xsioIc7DK2uYM1lUQfPo5JUZPy23H17R403/sTTb3fgMQYhsjroKNM8wvcc7XyrklkgvVZFUQpgxK2zbOrN7AgtXzliOrsuRH7HE7G+IWDhqLwWZQLFY87ywYa3HvRuiqbZu05Jpn7ym+k1+S0v26qd0s9uiul6n94yRL1+bIDO3q5eu4/uV9hNMQzn3M4c267s3zKm8+342+SYGnq7HDdknSHnfuikn2XYVzfGtcyAAKkft1qceS0dNgXW2I0W16khhib1WueoCZf/Q4HWdBYPnJhwlt+iuXqLB8hdhqwuXapBoxnBnYYVX//X2EBsnlx/OBzrm7soifbJG7ot/d+GxD22A2jCjJVIDUBqkUqu9jltrmp+hsy8i/trsVCbSFqdel4HSkXTP9O7A0pqujrd1zr23VFKwYZ92OZmufnXErahqW9j/YR8j413/+W2u/7bqA5e0FTWxaNxrY0c7WuJGrTYrasHYKDpZ6KHdz65NcBjwFpku0ONJB/Zo+wqvpTQMsNeExdiouJMR4Ex+WYGw51A3UzCUYzlhaYxbr/j0GFkyeY+htBn136GrIoasp1Z9kgLUccb9e5tNJv4LQ7rNyI5JsJZ+zp9fJC+8FoZ3Ps0v6H+gjNEDs0c3lebE3wTez+iQxce4UJ7T7adt2uqLTWpOmG6EXDr2bIaY/yf0+EjL3iyemhcjdbJTuMY1cuoYiGdXEdS2YHTdKaKs0T+7Q4QF3ZmDYF+i7qvdKKolOq/pP9/cRGqLj8HCZVg0GwCLQm5Xy8VaRFjWrv4p2HBbBE8pQZHHdCnQhN1+73/+0e0tCGzW5lFTgzPj3H5p//O1M0tOUE99bEuN188t8iN3PXwoShNNx+rolsUfXGLFZefYU+hF+ac4xcktRHqEW5yhuueVVaC0ibqG1iLiF1iLiFlqLiFtoLWIQFlqLRG6htYhBWGgtYhAWGmSfQbi8vWAOLjP7hnaureyOzf3vKQZhoQGqDMK5vXaMvh1nsf0IyMjFzHsjs5vs1vvsPiWvzDy8QQzCQgNUGYRT9hp9N4T3I67Wj3mM8SYHHt93YEwxCItB+E9gn9E3R+ptvctCc/zIjCHc7/tuDo8pBmExCJ+cQ0bfzKFljXNROnpiuRzxNNAluqozZk7cmagPpR7l7SZudsh1bhia2aea45u5o5EOzrhiXdo3Don37mpk7H/SbDjHzz9/XBmMlrBKi1mU9j/QR2iANJg8VJ1YxY/MlrlcOyOvnY7D2Foye4zrjcmeh6yKQVhohmqjb/Z/D+9H4EbbJ4vGJSZlRLXGBDEIi0H4pFQbfRMRhsx9k+HNTnjp3DBkxG2Wh8QeE99keNOrMWaCGITFIPy2xM+suGJQWDo7OIuAJ2WQBWgr0EddNhaDsFALceIUEIOw8HaIQVioxTlGbjEIC7U4R3H/D+buGKQt7OuzAAAAAElFTkSuQmCC",c="/FrontEndLearnNotes/assets/640-1692286487810-1.CYL9p3Us.png",t="/FrontEndLearnNotes/assets/640-1692286487811-3.DGWciETc.png",i="/FrontEndLearnNotes/assets/640-1692286487811-4.BZjuODJb.png",F="/FrontEndLearnNotes/assets/640-1692286487811-6.D7JcLWX_.png",b="/FrontEndLearnNotes/assets/640-1692286487811-7.BP00AvAS.png",y="/FrontEndLearnNotes/assets/640-1692286487811-8.3ALoRCpO.png",d="/FrontEndLearnNotes/assets/640-1692286487811-9.C40ypdL_.png",u="/FrontEndLearnNotes/assets/640-1692286487811-10.CbQz5gmF.png",m="/FrontEndLearnNotes/assets/640-1692286487812-11.2GaHfuid.png",B="/FrontEndLearnNotes/assets/640-1692286487812-12._aayN0Nh.png",h="/FrontEndLearnNotes/assets/640-1692286487812-13.SEkpUYR3.png",g="/FrontEndLearnNotes/assets/640-1692286487812-14.Cb92_kQN.png",x="/FrontEndLearnNotes/assets/640-1692286487812-15.BjOpPtil.png",A="/FrontEndLearnNotes/assets/image-20240219171948782.DbaMzap5.png",C="/FrontEndLearnNotes/assets/image-20240219172054687.DfegfIA3.png",v="/FrontEndLearnNotes/assets/image-20240219172403144.qNghDVHv.png",f="/FrontEndLearnNotes/assets/image-20240219172420050.-YfytURo.png",E="/FrontEndLearnNotes/assets/image-20240219172434289.CATlGVj9.png",z=JSON.parse('{"title":"Nginx 配置","description":"","frontmatter":{},"headers":[],"relativePath":"Document/服务器相关配置和运维/Nginx配置.md","filePath":"Document/服务器相关配置和运维/Nginx配置.md","lastUpdated":1750954157000}'),_={name:"Document/服务器相关配置和运维/Nginx配置.md"};function k(q,s,N,D,w,P){return l(),a("div",null,s[0]||(s[0]=[p('<h1 id="nginx-配置" tabindex="-1">Nginx 配置 <a class="header-anchor" href="#nginx-配置" aria-label="Permalink to &quot;Nginx 配置&quot;">​</a></h1><p>Nginx 官网：<a href="https://nginx.org/" target="_blank" rel="noreferrer">nginx news</a></p><p>中文网：<a href="https://nginx.p2hp.com/" target="_blank" rel="noreferrer">nginx 中文网 官网 (p2hp.com)</a></p><p>Nginx 中文文档：<a href="https://blog.redis.com.cn/doc/" target="_blank" rel="noreferrer">Nginx 中文文档 (redis.com.cn)</a></p><p>菜鸟教程：<a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html" target="_blank" rel="noreferrer">Nginx 配置详解 | 菜鸟教程 (runoob.com)</a></p><p>Nginx 安装包下载：<a href="https://nginx.org/en/download.html" target="_blank" rel="noreferrer">nginx：下载</a></p><h2 id="nginx-简介" tabindex="-1">Nginx 简介 <a class="header-anchor" href="#nginx-简介" aria-label="Permalink to &quot;Nginx 简介&quot;">​</a></h2><p>服务器 nginx 是一种高性能的 Web 服务器和反向代理软件，它可以处理静态和动态的内容，支持负载均衡、缓存、安全等功能。</p><p>Nginx (engine x) 是一个高性能的 HTTP 和反向代理 web 服务器，同时也提供了 IMAP/POP3/SMTP 服务。Nginx 是由伊戈尔·赛索耶夫为俄罗斯访问量第二的 Rambler.ru 站点（俄文：Рамблер）开发的，第一个公开版本 0.1.0 发布于 2004 年 10 月 4 日。2011 年 6 月 1 日，nginx 1.0.4 发布。</p><p>高并发，大流量：需要面对高并发用户，大流量访问。举个例子，去往迪拜的飞机有 200 张票，但是有 100w 人都挤进系统买票，如何让这 100w 人能够看到票务的实时更新，以及顺利的买到一张票，都是一个网站架构师应该考虑的问题。这也许对于淘宝的“双十一”1000w 的一分钟独立访问用户量来说，是个微不足道的数字，但是对于用户的体验以及网站的口碑来说，都是一项不小的挑战</p><p>Nginx 是一个安装非常的简单、配置文件非常简洁（还能够支持 perl 语法）、Bug 非常少的服务。Nginx 启动特别容易，并且几乎可以做到 7*24 不间断运行，即使运行数个月也不需要重新启动。你还能够不间断服务的情况下进行软件版本的升级。</p><p>Nginx 代码完全用 C 语言从头写成。官方数据测试表明能够支持高达 50,000 个并发连接数的响应。</p><h3 id="_1-正向代理-反向代理" tabindex="-1">1.正向代理 反向代理 <a class="header-anchor" href="#_1-正向代理-反向代理" aria-label="Permalink to &quot;1.正向代理 反向代理&quot;">​</a></h3><p><strong>正向代理</strong>来进行上网等功能。如果把局域网外的 Internet 想象成一个巨大的资源库，则局域网中的客户端要访问 Internet，则需要通过代理服务器来访问，这种代理服务就称为正向代理（也就是大家常说的，通过正向代理进行上网功能）</p><p><img src="'+e+'" alt="image-20240219170312990"></p><p><strong>反向代理</strong>实际运行方式是代理服务器接受网络上的连接请求。它将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给网络上请求连接的客户端，此时代理服务器对外就表现为一个服务器。</p><p><img src="'+o+`" alt="image-20240219170402172"></p><h3 id="_2-负载均衡-upstream" tabindex="-1">2.负载均衡（upstream） <a class="header-anchor" href="#_2-负载均衡-upstream" aria-label="Permalink to &quot;2.负载均衡（upstream）&quot;">​</a></h3><h4 id="轮询" tabindex="-1">轮询 <a class="header-anchor" href="#轮询" aria-label="Permalink to &quot;轮询&quot;">​</a></h4><p>轮询方式是 Nginx 负载默认的方式，顾名思义，所有请求都按照时间顺序分配到不同的服务上，如果服务 Down 掉，可以自动剔除</p><h4 id="权重" tabindex="-1">权重 <a class="header-anchor" href="#权重" aria-label="Permalink to &quot;权重&quot;">​</a></h4><p>指定每个服务的权重比例，weight 和访问比率成正比，通常用于后端服务机器性能不统一，将性能好的分配权重高来发挥服务器最大性能</p><h3 id="_3-动静分离" tabindex="-1">3.动静分离 <a class="header-anchor" href="#_3-动静分离" aria-label="Permalink to &quot;3.动静分离&quot;">​</a></h3><p>在 Web 开发中，通常来说，动态资源其实就是指那些后台资源，而静态资源就是指 HTML，JavaScript，CSS，img 等文件。</p><p>一般来说，都需要将动态资源和静态资源分开，将静态资源部署在 Nginx 上，当一个请求来的时候，如果是静态资源的请求，就直接到 nginx 配置的静态资源目录下面获取资源，如果是动态资源的请求，nginx 利用反向代理的原理，把请求转发给后台应用去处理，从而实现动静分离。</p><p>在使用前后端分离之后，可以很大程度的提升静态资源的访问速度，同时在开过程中也可以让前后端开发并行可以有效的提高开发时间，也可以有些的减少联调时间 。</p><h2 id="其他-nginx-学习笔记" tabindex="-1">其他 Nginx 学习笔记 <a class="header-anchor" href="#其他-nginx-学习笔记" aria-label="Permalink to &quot;其他 Nginx 学习笔记&quot;">​</a></h2><p>Nginx 模块笔记文档：<a href="http://www.zhufengpeixun.com/strong/html/61.10.devops-nginx.html" target="_blank" rel="noreferrer">珠峰架构师成长计划 — nginx</a></p><h2 id="nginx-下载和配置-https" tabindex="-1">nginx 下载和配置 https <a class="header-anchor" href="#nginx-下载和配置-https" aria-label="Permalink to &quot;nginx 下载和配置 https&quot;">​</a></h2><p>Nginx 安装包下载：<a href="https://nginx.org/en/download.html" target="_blank" rel="noreferrer">nginx：下载</a></p><ol><li><p>下载好对应的系统版本的 nginx，然后在你想安装的盘符目录，解压 nginx-1.xxx.zip</p><ol><li><a href="https://blog.csdn.net/zhengcaocao/article/details/126957646" target="_blank" rel="noreferrer">mac 上安装 Nginx 简单详细教程_?Oliver 的博客-CSDN 博客_mac 部署 nginx</a></li></ol></li><li><p>安装 cygwin：Cygwin 是一个在 windows 平台上运行的类 UNIX 模拟环境(第 2~3 步不用也可以)</p><ol><li>官网：<a href="https://www.cygwin.com/" target="_blank" rel="noreferrer">Cygwin</a></li></ol></li><li><p>通过命令行运行：C:\\cygwin64\\bin 目录下的 openssl.exe</p></li><li><p>生成证书(管理员方式打开命令行)</p></li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 1、首先，进入你想创建证书和私钥的目录，例如：nginx/config目录</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> D:</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">dev</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">nginx-1.13.12</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 2、创建服务器私钥，命令会让你输入一个口令：</span></span>
<span class="line"><span style="color:#61AFEF;">openssl</span><span style="color:#98C379;"> genrsa</span><span style="color:#D19A66;"> -des3</span><span style="color:#D19A66;"> -out</span><span style="color:#98C379;"> server.key</span><span style="color:#D19A66;"> 1024</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 3、创建公钥（CSR）：</span></span>
<span class="line"><span style="color:#61AFEF;">openssl</span><span style="color:#98C379;"> req</span><span style="color:#D19A66;"> -new</span><span style="color:#D19A66;"> -key</span><span style="color:#98C379;"> server.key</span><span style="color:#D19A66;"> -out</span><span style="color:#98C379;"> server.csr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 4、不用输入密码</span></span>
<span class="line"><span style="color:#61AFEF;">cp</span><span style="color:#98C379;"> server.key</span><span style="color:#98C379;"> server.key.org</span></span>
<span class="line"><span style="color:#61AFEF;">openssl</span><span style="color:#98C379;"> rsa</span><span style="color:#D19A66;"> -in</span><span style="color:#98C379;"> server.key.org</span><span style="color:#D19A66;"> -out</span><span style="color:#98C379;"> server.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 5、最后标记证书使用上述私钥和公钥：</span></span>
<span class="line"><span style="color:#61AFEF;">openssl</span><span style="color:#98C379;"> x509</span><span style="color:#D19A66;"> -req</span><span style="color:#D19A66;"> -days</span><span style="color:#D19A66;"> 365</span><span style="color:#D19A66;"> -in</span><span style="color:#98C379;"> server.csr</span><span style="color:#D19A66;"> -signkey</span><span style="color:#98C379;"> server.key</span><span style="color:#D19A66;"> -out</span><span style="color:#98C379;"> server.crt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="配置-nginx-nginx-1-23-3-conf-nginx-conf-文件" tabindex="-1">配置 nginx：<code>nginx-1.23.3/conf/nginx.conf</code> 文件 <a class="header-anchor" href="#配置-nginx-nginx-1-23-3-conf-nginx-conf-文件" aria-label="Permalink to &quot;配置 nginx：\`nginx-1.23.3/conf/nginx.conf\` 文件&quot;">​</a></h3><p>Nginx 的主配置文件是 nginx.conf，这个配置文件一共由三部分组成，分别为全局块、events 块和 http 块。</p><p>在 http 块中，又包含 http 全局块、多个 server 块。</p><p>每个 server 块中，可以包含 server 全局块和多个 location 块。在同一配置块中嵌套的配置块，各个之间不存在次序关系</p><h4 id="_1-全局块" tabindex="-1">1.全局块 <a class="header-anchor" href="#_1-全局块" aria-label="Permalink to &quot;1.全局块&quot;">​</a></h4><p>全局块是默认配置文件从开始到 events 块之间的一部分内容，主要设置一些影响 Nginx 服务器整体运行的配置指令，因此，这些指令的作用域是 Nginx 服务器全局。</p><ul><li>user [user] [group] 指定可以运行 nginx 服务的用户和用户组，只能在全局块配置 user 指令在 Windows 上不生效，如果你制定具体用户和用户组会报警告 worker_processes nginx 进程数量 worker_processes 比如设置为 2 nginx 将会开启一个 master 进程和 2 两个 worker 进程</li><li>pid logs/nginx.pid 存放 pid 文件</li><li>error_log logs/error.log; 全局错误日志类型 debug info warn error 存放地址</li></ul><h4 id="_2-events-块" tabindex="-1">2.events 块 <a class="header-anchor" href="#_2-events-块" aria-label="Permalink to &quot;2.events 块&quot;">​</a></h4><p>events 块涉及的指令主要影响 Nginx 服务器与用户的网络连接。常用到的设置包括是否开启对多 worker process 下的网络连接进行序列化，是否允许同时接收多个网络连接，选取哪种事件驱动模型处理连接请求，每个 worker process 可以同时支持的最大连接数等</p><p>accept_mutex 默认开启-开启之后 nginx 的多个 worker 将会以串行的方式来处理，只会有一个 worker 将会被唤起，其他的 worker 继续睡眠，如果不开启将会造成惊群效应多个 worker 全部唤起不过只有一个 Worker 能获取新连接，其它的 Worker 会重新进入休眠状态</p><p>worker_connections 单个进程最大连接数（最大连接数=连接数+进程数）</p><h4 id="_3-http-块" tabindex="-1">3.http 块 <a class="header-anchor" href="#_3-http-块" aria-label="Permalink to &quot;3.http 块&quot;">​</a></h4><p>http 块是 Nginx 服务器配置中的重要部分，代理、缓存和日志定义等绝大多数的功能和第三方模块的配置都可以放在这个模块中。</p><ul><li>include 指令，用于引入其他的配置文件</li><li>default_type 如果 Web 程序没设置，Nginx 也没对应文件的扩展名，就用 Nginx 里默认的 default_type 定义的处理方式。default_type application/octet-stream; #nginx 默认文件类型</li><li>log_format 指令，用于定义日志格式，此指令只能在 http 块中进行配置</li><li>sendfile 简单来说就是启用 sendfile()系统调用来替换 read()和 write()调用，减少系统上下文切换从而提高性能，当 nginx 是静态文件服务器时，能极大提高 nginx 的性能表现</li><li>keepalive_timeout HTTP 有一个 KeepAlive 模式，它告诉 webserver 在处理完一个请求后保持这个 TCP 连接的打开状态。若接收到来自客户端的其它请求，服务端会利用这个未被关闭的连接，而不需要再建立一个连接。</li><li>gzip 开启 Gzip 压缩功能， 可以使网站的 css、js 、xml、html 文件在传输时进行压缩，提高访问速度, 进而优化 Nginx 性能</li></ul><h4 id="_4-server-块" tabindex="-1">4.server 块 <a class="header-anchor" href="#_4-server-块" aria-label="Permalink to &quot;4.server 块&quot;">​</a></h4><p>每一个 http 块都可以包含多个 server 块，而每个 server 块就相当于一台虚拟主机，它内部可有多台主机联合提供服务，一起对外提供在逻辑上关系密切的一组服务</p><p>listen 指令的配置非常灵活，可以单独制定 ip，单独指定端口或者同时指定 ip 和端口</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">listen</span><span style="color:#98C379;"> 127.0.0.1:8000</span><span style="color:#ABB2BF;">;  </span><span style="color:#7F848E;font-style:italic;">#只监听来自127.0.0.1这个IP，请求8000端口的请求</span></span>
<span class="line"><span style="color:#61AFEF;">listen</span><span style="color:#D19A66;"> 127.0.0.1</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">#只监听来自127.0.0.1这个IP，请求80端口的请求（不指定端口，默认80）</span></span>
<span class="line"><span style="color:#61AFEF;">listen</span><span style="color:#D19A66;"> 9999</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">#监听来自所有IP，请求9999端口的请求</span></span>
<span class="line"><span style="color:#61AFEF;">listen</span><span style="color:#E5C07B;"> *</span><span style="color:#98C379;">:9999</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">#和上面效果一样</span></span>
<span class="line"><span style="color:#61AFEF;">listen</span><span style="color:#98C379;"> localhost:8000</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">#和第一种效果一致</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>server_name nginx 允许一个虚拟主机有一个或多个名字，也可以使用通配符&quot;*&quot;来设置虚拟主机的名字 支持 ip 域名 通配符 正则等</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;"> server_name</span><span style="color:#98C379;">  localhost</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_5-location-块" tabindex="-1">5.location 块 <a class="header-anchor" href="#_5-location-块" aria-label="Permalink to &quot;5.location 块&quot;">​</a></h4><p>每个 server 块中可以包含多个 location 块。在整个 Nginx 配置文档中起着重要的作用，而且 Nginx 服务器在许多功能上的灵活性往往在 location 指令的配置中体现出来</p><p>location 指令可以分为以下 3 类：</p><ul><li><p>前缀字符串匹配</p></li><li><p>正则表达式匹配</p></li><li><p>用于内部跳转的命名 location</p></li></ul><h5 id="前缀字符串匹配" tabindex="-1">前缀字符串匹配 <a class="header-anchor" href="#前缀字符串匹配" aria-label="Permalink to &quot;前缀字符串匹配&quot;">​</a></h5><ul><li>精确匹配 =</li><li>前缀匹配 ^~（立刻停止后续的正则搜索）</li><li>按文件中顺序的正则匹配 ~或~*</li><li>匹配不带任何修饰的前缀匹配。</li></ul><h5 id="location-root" tabindex="-1">location root <a class="header-anchor" href="#location-root" aria-label="Permalink to &quot;location root&quot;">​</a></h5><p>root 指定目录的上级目录，并且该上级目录要含有 locatoin 指定名称的同名目录。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">location</span><span style="color:#98C379;"> /img/</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	root</span><span style="color:#98C379;"> /var/www/image</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>若按照这种配置的话，则访问/img/目录下的文件时，nginx 会去/var/www/image/img/目录下找文件</p><h3 id="nginx-配置参考" tabindex="-1">Nginx 配置参考 <a class="header-anchor" href="#nginx-配置参考" aria-label="Permalink to &quot;Nginx 配置参考&quot;">​</a></h3><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">#服务器CPU核数</span></span>
<span class="line"><span style="color:#ABB2BF;">worker_processes  </span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="color:#ABB2BF;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="color:#ABB2BF;">#error_log  logs/error.log  info;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#pid        logs/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">events {</span></span>
<span class="line"><span style="color:#FFFFFF;">    worker_connections</span><span style="color:#FFFFFF;">  1024;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">http {</span></span>
<span class="line"><span style="color:#FFFFFF;">    include</span><span style="color:#FFFFFF;">       mime.types;</span></span>
<span class="line"><span style="color:#FFFFFF;">    default_type</span><span style="color:#FFFFFF;">  application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #log_format</span><span style="color:#FFFFFF;">  main</span><span style="color:#FFFFFF;">  &#39;$remote_addr</span><span style="color:#FFFFFF;"> -</span><span style="color:#FFFFFF;"> $remote_user</span><span style="color:#FFFFFF;"> [$time_local]</span><span style="color:#E06C75;"> &quot;$request&quot;</span><span style="color:#FFFFFF;"> &#39;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">                  &#39;$status</span><span style="color:#FFFFFF;"> $body_bytes_sent</span><span style="color:#E06C75;"> &quot;$http_referer&quot;</span><span style="color:#FFFFFF;"> &#39;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">                  &#39;</span><span style="color:#E06C75;">&quot;$http_user_agent&quot;</span><span style="color:#E06C75;"> &quot;$http_x_forwarded_for&quot;</span><span style="color:#FFFFFF;">&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #access_log</span><span style="color:#FFFFFF;">  logs/access.log</span><span style="color:#FFFFFF;">  main;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    sendfile</span><span style="color:#FFFFFF;">        on;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #tcp_nopush</span><span style="color:#FFFFFF;">     on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #keepalive_timeout</span><span style="color:#FFFFFF;">  0;</span></span>
<span class="line"><span style="color:#FFFFFF;">    keepalive_timeout</span><span style="color:#FFFFFF;">  65;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #gzip</span><span style="color:#FFFFFF;">  on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    server</span><span style="color:#FFFFFF;"> {</span></span>
<span class="line"><span style="color:#FFFFFF;">  #监听端口</span></span>
<span class="line"><span style="color:#FFFFFF;">        listen</span><span style="color:#FFFFFF;">       8080;</span></span>
<span class="line"><span style="color:#FFFFFF;">        server_name</span><span style="color:#FFFFFF;">  localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">        #charset</span><span style="color:#FFFFFF;"> koi8-r;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">        #access_log</span><span style="color:#FFFFFF;">  logs/host.access.log</span><span style="color:#FFFFFF;">  main;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">  #代理的规则</span></span>
<span class="line"><span style="color:#FFFFFF;">        #location</span><span style="color:#FFFFFF;"> /</span><span style="color:#FFFFFF;"> {</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    root</span><span style="color:#FFFFFF;">   html;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    index</span><span style="color:#FFFFFF;">  index.html</span><span style="color:#FFFFFF;"> index.htm;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">  # 前端请求/根路径代理的地址</span></span>
<span class="line"><span style="color:#ABB2BF;">  location / {</span></span>
<span class="line"><span style="color:#FFFFFF;">   proxy_pass</span><span style="color:#FFFFFF;"> http</span><span style="color:#ABB2BF;">:</span><span style="color:#7F848E;font-style:italic;">//192.168.88.1:300</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">  # 服务端请求/api代理的地址</span></span>
<span class="line"><span style="color:#ABB2BF;">  location /api {</span></span>
<span class="line"><span style="color:#FFFFFF;">   proxy_pass</span><span style="color:#FFFFFF;"> http</span><span style="color:#ABB2BF;">:</span><span style="color:#7F848E;font-style:italic;">//127.0.0.1:3000;</span></span>
<span class="line"><span style="color:#FFFFFF;">   proxy_set_header</span><span style="color:#FFFFFF;"> Host</span><span style="color:#FFFFFF;"> $host;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        #error_page  </span><span style="color:#D19A66;">404</span><span style="color:#ABB2BF;">              /</span><span style="color:#D19A66;">404</span><span style="color:#ABB2BF;">.html;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        # redirect server error pages to the static page /</span><span style="color:#D19A66;">50</span><span style="color:#ABB2BF;">x.html</span></span>
<span class="line"><span style="color:#ABB2BF;">        #</span></span>
<span class="line"><span style="color:#ABB2BF;">        error_page   </span><span style="color:#D19A66;">500</span><span style="color:#D19A66;"> 502</span><span style="color:#D19A66;"> 503</span><span style="color:#D19A66;"> 504</span><span style="color:#ABB2BF;">  /</span><span style="color:#D19A66;">50</span><span style="color:#ABB2BF;">x.html;</span></span>
<span class="line"><span style="color:#ABB2BF;">        location = /</span><span style="color:#D19A66;">50</span><span style="color:#ABB2BF;">x.html {</span></span>
<span class="line"><span style="color:#FFFFFF;">            root</span><span style="color:#FFFFFF;">   html;</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        # proxy the PHP scripts to Apache listening on </span><span style="color:#D19A66;">127.0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">80</span></span>
<span class="line"><span style="color:#ABB2BF;">        #</span></span>
<span class="line"><span style="color:#ABB2BF;">        #location ~ \\.php$ {</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    proxy_pass</span><span style="color:#FFFFFF;">   http</span><span style="color:#ABB2BF;">:</span><span style="color:#7F848E;font-style:italic;">//127.0.0.1;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        # pass the PHP scripts to FastCGI server listening on </span><span style="color:#D19A66;">127.0</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0.1</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">9000</span></span>
<span class="line"><span style="color:#ABB2BF;">        #</span></span>
<span class="line"><span style="color:#ABB2BF;">        #location ~ \\.php$ {</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    root</span><span style="color:#FFFFFF;">           html;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    fastcgi_pass</span><span style="color:#FFFFFF;">   127.0.0.1</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">9000</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    fastcgi_index</span><span style="color:#FFFFFF;">  index.php;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    fastcgi_param</span><span style="color:#FFFFFF;">  SCRIPT_FILENAME</span><span style="color:#FFFFFF;">  /scripts$fastcgi_script_name;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    include</span><span style="color:#FFFFFF;">        fastcgi_params;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">        # deny access to .htaccess files, if Apache&#39;s document root</span></span>
<span class="line"><span style="color:#ABB2BF;">        # concurs with nginx&#39;s one</span></span>
<span class="line"><span style="color:#ABB2BF;">        #</span></span>
<span class="line"><span style="color:#ABB2BF;">        #location ~ /\\.ht {</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#FFFFFF;">    deny</span><span style="color:#FFFFFF;">  all;</span></span>
<span class="line"><span style="color:#FFFFFF;">        #</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    # another virtual host using mix of IP-, name-, and port-based configuration</span></span>
<span class="line"><span style="color:#ABB2BF;">    #</span></span>
<span class="line"><span style="color:#ABB2BF;">    #server {</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    listen</span><span style="color:#FFFFFF;">       8000;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    listen</span><span style="color:#FFFFFF;">       somename</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">8080</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    server_name</span><span style="color:#FFFFFF;">  somename</span><span style="color:#FFFFFF;">  alias</span><span style="color:#FFFFFF;">  another.alias;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    location</span><span style="color:#FFFFFF;"> /</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">        root</span><span style="color:#FFFFFF;">   html;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">        index</span><span style="color:#FFFFFF;">  index.html</span><span style="color:#FFFFFF;"> index.htm;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    # HTTPS server</span></span>
<span class="line"><span style="color:#ABB2BF;">    #</span></span>
<span class="line"><span style="color:#ABB2BF;">    #server {</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    listen</span><span style="color:#FFFFFF;">       443</span><span style="color:#FFFFFF;"> ssl;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    server_name</span><span style="color:#FFFFFF;">  localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    ssl_certificate</span><span style="color:#FFFFFF;">      cert.pem;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    ssl_certificate_key</span><span style="color:#FFFFFF;">  cert.key;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    ssl_session_cache</span><span style="color:#FFFFFF;">    shared</span><span style="color:#ABB2BF;">:</span><span style="color:#FFFFFF;">SSL:</span><span style="color:#D19A66;">1</span><span style="color:#FFFFFF;">m;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    ssl_session_timeout</span><span style="color:#D19A66;">  5</span><span style="color:#FFFFFF;">m;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    ssl_ciphers</span><span style="color:#FFFFFF;">  HIGH:!aNULL:!MD</span><span style="color:#D19A66;">5</span><span style="color:#FFFFFF;">;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    ssl_prefer_server_ciphers</span><span style="color:#FFFFFF;">  on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">    location</span><span style="color:#FFFFFF;"> /</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">        root</span><span style="color:#FFFFFF;">   html;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#FFFFFF;">        index</span><span style="color:#FFFFFF;">  index.html</span><span style="color:#FFFFFF;"> index.htm;</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#FFFFFF;">    #</span><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br></div></div><p>访问：<code>https://localhost</code> 即可显示 nginx 目录下 html 下的 index.html 或者 index.htm</p><h3 id="nginx-重定向" tabindex="-1">Nginx 重定向 <a class="header-anchor" href="#nginx-重定向" aria-label="Permalink to &quot;Nginx 重定向&quot;">​</a></h3><p>待定</p><h2 id="nginx-基本使用" tabindex="-1">nginx 基本使用 <a class="header-anchor" href="#nginx-基本使用" aria-label="Permalink to &quot;nginx 基本使用&quot;">​</a></h2><ol><li>以管理员运行 CMD 命令行</li><li>cd 到 nginx 根目录 启动 <code>nginx.exe</code> 文件，启动命令：<code>start nginx</code></li><li>在任务管理器看到两个<img src="`+r+`" alt="52646699755"> <code>nginx.exe</code> 任务在运行，说明 nginx 启动了，其中一个是主进程，一个是工作进程</li></ol><h3 id="常用命令-在-nginx-安装根目录-cmd-命令行执行的命令" tabindex="-1">常用命令(在 nginx 安装根目录 CMD 命令行执行的命令) <a class="header-anchor" href="#常用命令-在-nginx-安装根目录-cmd-命令行执行的命令" aria-label="Permalink to &quot;常用命令(在 nginx 安装根目录 CMD 命令行执行的命令)&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -c</span><span style="color:#98C379;"> /path/to/nginx.conf</span><span style="color:#7F848E;font-style:italic;">  # 以特定目录下的配置文件启动nginx:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -s</span><span style="color:#98C379;">  reload</span><span style="color:#7F848E;font-style:italic;">  # 修改配置后重新加载生效</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -s</span><span style="color:#98C379;">  reopen</span><span style="color:#7F848E;font-style:italic;">   # 重新打开日志文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -s</span><span style="color:#98C379;"> stop</span><span style="color:#7F848E;font-style:italic;">  # 快速停止nginx,暴力停止,可能造成数据丢失</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -s</span><span style="color:#98C379;"> quit</span><span style="color:#7F848E;font-style:italic;">  # 完整有序的停止nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -t</span><span style="color:#7F848E;font-style:italic;">    # 测试当前配置文件是否正确</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -t</span><span style="color:#D19A66;"> -c</span><span style="color:#98C379;"> /path/to/nginx.conf</span><span style="color:#7F848E;font-style:italic;"> # 测试特定的nginx配置文件是否正确</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="nginx-可视化配置工具" tabindex="-1">Nginx 可视化配置工具 <a class="header-anchor" href="#nginx-可视化配置工具" aria-label="Permalink to &quot;Nginx 可视化配置工具&quot;">​</a></h2><h3 id="nginxconfig-简介" tabindex="-1">NginxConfig 简介 <a class="header-anchor" href="#nginxconfig-简介" aria-label="Permalink to &quot;NginxConfig 简介&quot;">​</a></h3><p>Nginx Config 是一个强大的 Nginx 配置文件生成器，号称配置 Nginx 服务器所需的唯一工具。</p><p>正因为 Nginx 功能强大，所以针对其各个功能的配置项会显得特别多，对于我们来说要记住那么多配置是一件十分头疼的事，甚至会经常出现符号书写错误的情况。而 Nginx Config 正是提供了简单配置 Nginx 的方法，通过可视化页面，针对 Nginx 的各个配置项提供了简洁明了的配置方法。</p><p>Nginx Config 支持以下功能的可视化配置：HTTPS、HTTP/2、IPv6、certbot、HSTS、安全请求头、SSL 配置、OCSP 解析器、缓存、gzip、brotli、回退路由、反向代理、www/non-www 重定向、CDN、PHP（TCP/socket、 WordPress、Drupal、Magento、Joomla)、Node.js、Python (Django) 服务器等。</p><p><strong>项目地址</strong>：<a href="https://github.com/digitalocean/nginxconfig.io" target="_blank" rel="noreferrer">https://github.com/digitalocean/nginxconfig.io</a></p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/PlYwEDTEj70h74F0TfBaRv0z2kByFBfINK1aLsyO7bDNt1qSnxeAJeQedp3wXRkYpPjQq7xwHGbP9XHy6F9xng/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>下面是 NginxConfig 使用过程中的一张效果图！</p><p><img src="`+c+`" alt="图片"></p><h3 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h3><h4 id="安装-node-js" tabindex="-1">安装 Node.js <a class="header-anchor" href="#安装-node-js" aria-label="Permalink to &quot;安装 Node.js&quot;">​</a></h4><p>由于<code>NginxConfig</code>是一个基于 Vue 的前端项目，我们首先得安装<code>Node.js</code>。</p><p>首先从官网下载<code>Node.js</code>的安装包</p><h5 id="_1-下载" tabindex="-1">1.下载 <a class="header-anchor" href="#_1-下载" aria-label="Permalink to &quot;1.下载&quot;">​</a></h5><p>访问地址：<a href="https://nodejs.org/zh-cn/download/" target="_blank" rel="noreferrer">https://nodejs.org/zh-cn/download/</a></p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/PlYwEDTEj70h74F0TfBaRv0z2kByFBfI06fsmHFEe6F9o7QjwPCA0MryUgYzu3WpQ66pJ9Kc7q519tLhzUAu7Q/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h5 id="_2-安装" tabindex="-1">2.安装 <a class="header-anchor" href="#_2-安装" aria-label="Permalink to &quot;2.安装&quot;">​</a></h5><p>下载成功后将安装包解压到<code>/usr/local/src/</code>目录下，使用如下命令即可；</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">tar</span><span style="color:#98C379;"> xf</span><span style="color:#98C379;"> node-v16.14.2-linux-x64.tar.xz</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> node-v16.14.2-linux-x64/</span></span>
<span class="line"><span style="color:#61AFEF;">./bin/node</span><span style="color:#D19A66;"> -v</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用<code>./bin/node -v</code>命令可查看当前安装版本；</p><p><img src="`+t+`" alt="图片"></p><p>创建<code>node</code>和<code>npm</code>命令软链接；</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">ln</span><span style="color:#D19A66;"> -s</span><span style="color:#98C379;"> /usr/local/src/node-v16.14.2-linux-x64/bin/node</span><span style="color:#98C379;"> /usr/bin/node</span></span>
<span class="line"><span style="color:#61AFEF;">ln</span><span style="color:#D19A66;"> -s</span><span style="color:#98C379;"> /usr/local/src/node-v16.14.2-linux-x64/bin/npm</span><span style="color:#98C379;"> /usr/bin/npm</span></span>
<span class="line"><span style="color:#61AFEF;">node</span><span style="color:#D19A66;"> -v</span></span>
<span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#D19A66;"> -v</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>查看版本</p><p><img src="`+i+`" alt="图片"></p><h4 id="安装-nginxconfig" tabindex="-1">安装 NginxConfig <a class="header-anchor" href="#安装-nginxconfig" aria-label="Permalink to &quot;安装 NginxConfig&quot;">​</a></h4><p><code>Node.js</code>安装完成后，就可以开始安装<code>NginxConfig</code>了。</p><h5 id="_1-克隆下载-nginxconfig-项目" tabindex="-1">1.克隆下载 NginxConfig 项目 <a class="header-anchor" href="#_1-克隆下载-nginxconfig-项目" aria-label="Permalink to &quot;1.克隆下载 NginxConfig 项目&quot;">​</a></h5><p>访问地址：<a href="https://github.com/digitalocean/nginxconfig.io" target="_blank" rel="noreferrer">https://github.com/digitalocean/nginxconfig.io</a></p><p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/PlYwEDTEj70h74F0TfBaRv0z2kByFBfIMvwc6EpAYnIluBaX7Ovd86MxicYMGgzqpzu74ZPdsobwMjN20icY3xxg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>解压到指定目录，并使用<code>npm</code>命令安装依赖并运行；</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">tar</span><span style="color:#D19A66;"> -zxvf</span><span style="color:#98C379;"> nginxconfig.io-master.tar.gz</span></span>
<span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> install</span></span>
<span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> run</span><span style="color:#98C379;"> dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>NginxConfig</code>运行成功后就可以直接访问了，访问地址：<a href="http://192.168.3.105:8080" target="_blank" rel="noreferrer">http://192.168.3.105:8080</a></p><p><img src="`+F+`" alt="图片"></p><h3 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-label="Permalink to &quot;使用&quot;">​</a></h3><p>接下来我们就体验下<code>NginxConfig</code>的可视化配置生成功能，看看是不是够强大！</p><h4 id="使用准备" tabindex="-1">使用准备 <a class="header-anchor" href="#使用准备" aria-label="Permalink to &quot;使用准备&quot;">​</a></h4><p>首先我们需要安装 Nginx ；</p><p>我们将实现如下功能，通过静态代理访问在不同目录下的静态网站，通过动态代理来访问 SpringBoot 提供的 API 接口；</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 静态代理，访问help文档网站</span></span>
<span class="line"><span style="color:#61AFEF;">help.fogsvc.com</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 动态代理，访问api线上API</span></span>
<span class="line"><span style="color:#61AFEF;">api.fogsvc.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>需要提前修改下本机 host 文件。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">192.168.3.105</span><span style="color:#98C379;"> docs.fogsvc.com</span></span>
<span class="line"><span style="color:#61AFEF;">192.168.3.105</span><span style="color:#98C379;"> api.fogsvc.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="文档网站配置" tabindex="-1">文档网站配置 <a class="header-anchor" href="#文档网站配置" aria-label="Permalink to &quot;文档网站配置&quot;">​</a></h3><p>我们先来配置 help.fogsvc.com 网站的访问，域名为：help.fogsvc.com。</p><p>在<code>NginxConfig</code>中选择好预设为前端，然后修改服务配置，配置好站点、路径和运行目录；</p><p><img src="`+b+'" alt="图片"></p><p>点击下一步，进入 https 设置，不需要 HTTPS 的话可以选择不启用；</p><p><img src="'+y+'" alt="图片"></p><p>然后在全局配置-&gt;安全中去除<code>Content-Security-Policy</code>设置；</p><p><img src="'+d+'" alt="图片"></p><p>再修改性能配置，开启 Gzip 压缩，删除资源有效期限制。</p><p><img src="'+u+'" alt="图片"></p><h3 id="api-网站配置" tabindex="-1">API 网站配置 <a class="header-anchor" href="#api-网站配置" aria-label="Permalink to &quot;API 网站配置&quot;">​</a></h3><p>最后配置下 mall 的 Swagger API 文档网站的访问，域名为：api.fogsvc.com。</p><p>继续添加一个站点，修改服务配置，只需修改站点名称即可；</p><p><img src="'+m+'" alt="图片"></p><p>然后启用反向代理并设置，反向代理到线上 API；</p><p><img src="'+B+'" alt="图片"></p><p>如果路由功能暂时不用，可以关闭。</p><p><img src="'+h+'" alt="图片"></p><p>点击下载按钮直接下载<code>NginxConfig</code>给我们生成好的配置了；</p><p><img src="'+g+'" alt="图片"></p><p>下载完成后改个名字，然后上传到 Linux 服务器的 Nginx 配置目录下，使用如下命令解压；</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">tar</span><span style="color:#D19A66;"> -zxvf</span><span style="color:#98C379;"> nginxconfig.io.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>NginxConfig</code>将为我们生成如下配置文件；</p><p><img src="'+x+`" alt="图片"></p><p>重启 Nginx 使配置生效；</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">docker</span><span style="color:#98C379;"> restart</span><span style="color:#98C379;"> nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>项目地址：<a href="https://github.com/digitalocean/nginxconfig.io" target="_blank" rel="noreferrer">https://github.com/digitalocean/nginxconfig.io</a></p><h2 id="nginx-常用命令" tabindex="-1">Nginx 常用命令 <a class="header-anchor" href="#nginx-常用命令" aria-label="Permalink to &quot;Nginx 常用命令&quot;">​</a></h2><h3 id="_1-配置-nginx-环境变量" tabindex="-1">1.配置 nginx 环境变量 <a class="header-anchor" href="#_1-配置-nginx-环境变量" aria-label="Permalink to &quot;1.配置 nginx 环境变量&quot;">​</a></h3><p>whereis nginx 找到 nginx 安装目录</p><p>前往跟目录 找到 etc 文件夹</p><p>vim profile 打开配置文件</p><p>添加环境变量（前半段 node 忽略）</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">export</span><span style="color:#E06C75;"> PATH</span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;">$PATH</span><span style="color:#ABB2BF;">:/</span><span style="color:#E06C75;">node-v14</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">19</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">1-linux-x64</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">bin</span><span style="color:#ABB2BF;">:/</span><span style="color:#E06C75;">usr</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">local</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">nginx</span><span style="color:#ABB2BF;">/</span><span style="color:#E06C75;">sbin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-nginx-常用命令介绍" tabindex="-1">2.Nginx 常用命令介绍 <a class="header-anchor" href="#_2-nginx-常用命令介绍" aria-label="Permalink to &quot;2.Nginx 常用命令介绍&quot;">​</a></h3><h4 id="_1-查看-nginx-版本号" tabindex="-1">1.查看 nginx 版本号 <a class="header-anchor" href="#_1-查看-nginx-版本号" aria-label="Permalink to &quot;1.查看 nginx 版本号&quot;">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -v</span></span>
<span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -V</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-启动-nginx" tabindex="-1">2.启动 nginx <a class="header-anchor" href="#_2-启动-nginx" aria-label="Permalink to &quot;2.启动 nginx&quot;">​</a></h4><p>直接执行 nginx 即可</p><h4 id="_3-停止-nginx" tabindex="-1">3.停止 nginx <a class="header-anchor" href="#_3-停止-nginx" aria-label="Permalink to &quot;3.停止 nginx&quot;">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -s</span><span style="color:#98C379;"> stop</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Stop 是立即停止</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">nginx</span><span style="color:#D19A66;"> -s</span><span style="color:#98C379;"> quit</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Quit 是一个优雅的关闭方式，Nginx 在退出前完成已经接受的请求处理</p><h4 id="_4-重载-nginx-配置文件" tabindex="-1">4.重载 nginx 配置文件 <a class="header-anchor" href="#_4-重载-nginx-配置文件" aria-label="Permalink to &quot;4.重载 nginx 配置文件&quot;">​</a></h4><p>nginx -s reload</p><h4 id="_5-查看-nginx-进程" tabindex="-1">5 查看 nginx 进程 <a class="header-anchor" href="#_5-查看-nginx-进程" aria-label="Permalink to &quot;5 查看 nginx 进程&quot;">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">ps</span><span style="color:#D19A66;"> -ef</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">ps</span><span style="color:#D19A66;"> -ef</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>输出标准格式的 linux 进程命令</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>grep 命令 是查找， 是一种强大的文本搜索工具 我们这儿是查找 nginx</p><h2 id="nginx-反向代理" tabindex="-1">Nginx 反向代理 <a class="header-anchor" href="#nginx-反向代理" aria-label="Permalink to &quot;Nginx 反向代理&quot;">​</a></h2><p><a href="https://nginx.org/" target="_blank" rel="noreferrer">nginx news</a></p><h3 id="nginx-反向代理的配置语法" tabindex="-1">Nginx 反向代理的配置语法 <a class="header-anchor" href="#nginx-反向代理的配置语法" aria-label="Permalink to &quot;Nginx 反向代理的配置语法&quot;">​</a></h3><p>反向代理中的常用指令：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">proxy_pass</span></span>
<span class="line"><span style="color:#61AFEF;">proxy_set_header</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>proxy_pass</p><p>该指令用来设置被代理服务器地址，可以是主机名称、IP 地址加端口号形式。</p><h4 id="案例-1-代理到哔哩哔哩" tabindex="-1">案例 1 代理到哔哩哔哩 <a class="header-anchor" href="#案例-1-代理到哔哩哔哩" aria-label="Permalink to &quot;案例 1 代理到哔哩哔哩&quot;">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">location</span><span style="color:#98C379;"> /</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">   root</span><span style="color:#98C379;">   html</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">   index</span><span style="color:#98C379;">  index.html</span><span style="color:#98C379;"> index.htm</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">   proxy_pass</span><span style="color:#98C379;"> http://bilibili.com</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>访问/就会被转到哔哩哔哩</p><h4 id="案例-2-nginx-反向代理解决跨域" tabindex="-1">案例 2 nginx 反向代理解决跨域 <a class="header-anchor" href="#案例-2-nginx-反向代理解决跨域" aria-label="Permalink to &quot;案例 2 nginx 反向代理解决跨域&quot;">​</a></h4><h5 id="前端代码" tabindex="-1">前端代码 <a class="header-anchor" href="#前端代码" aria-label="Permalink to &quot;前端代码&quot;">​</a></h5><pre><code>     a.onclick = () =&gt; {
        let xhr = new XMLHttpRequest()

        xhr.open(&#39;GET&#39;,&#39;/api/portal/list&#39;)

        xhr.onreadystatechange = () =&gt; {
            if(xhr.readyState == 4 &amp;&amp;  xhr.status == 200){
               console.log(xhr.responseText);
            }
        }

        xhr.send(null)
     }
</code></pre><h5 id="express-服务端代码" tabindex="-1">express 服务端代码 <a class="header-anchor" href="#express-服务端代码" aria-label="Permalink to &quot;express 服务端代码&quot;">​</a></h5><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">const</span><span style="color:#98C379;"> express</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">&#39;express&#39;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">const</span><span style="color:#98C379;"> app</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> express</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">app.get(</span><span style="color:#61AFEF;">&#39;/portal/list&#39;</span><span style="color:#61AFEF;">,</span><span style="color:#ABB2BF;"> (req, </span><span style="color:#98C379;">res</span><span style="color:#ABB2BF;">) =&gt; {</span></span>
<span class="line"><span style="color:#61AFEF;">    res.json(</span><span style="color:#98C379;">{</span></span>
<span class="line"><span style="color:#61AFEF;">        code:</span><span style="color:#98C379;"> 200,</span></span>
<span class="line"><span style="color:#61AFEF;">        message:</span><span style="color:#98C379;"> &quot;搞咩啊&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    })</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">app.listen(9000,(</span><span style="color:#ABB2BF;">)=&gt;{</span></span>
<span class="line"><span style="color:#61AFEF;">    console.log(</span><span style="color:#61AFEF;">&#39;success&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="nginx-配置文件" tabindex="-1">nginx 配置文件 <a class="header-anchor" href="#nginx-配置文件" aria-label="Permalink to &quot;nginx 配置文件&quot;">​</a></h5><pre><code>    location /api/ {
        proxy_pass http://localhost:9000/;
    }
</code></pre><p>截取到/api/ 将会转发到：<a href="http://localhost:9000/" target="_blank" rel="noreferrer">http://localhost:9000/</a></p><h5 id="proxy-set-header" tabindex="-1">proxy_set_header <a class="header-anchor" href="#proxy-set-header" aria-label="Permalink to &quot;proxy_set_header&quot;">​</a></h5><p>该指令可以更改 Nginx 服务器接收到的客户端请求的请求头信息，然后将新的请求头发送给代理的服务器</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">proxy_set_header</span><span style="color:#98C379;"> X-Real-IP</span><span style="color:#E06C75;"> $remote_addr</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">proxy_set_header</span><span style="color:#98C379;"> X-Real-Port</span><span style="color:#E06C75;"> $remote_port</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">proxy_set_header</span><span style="color:#98C379;"> X-Forwarded-For</span><span style="color:#E06C75;"> $proxy_add_x_forwarded_for</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>三个 header 分别表示：</p><ul><li>X-Real-IP 客户端或上一级代理 ip</li><li>X-Real-Port 客户端或上一级端口</li><li>X-Forwarded-For 包含了客户端和各级代理 ip 的完整 ip 链路</li></ul><p>其中 X-Real-IP 是必需的，后两项选填。当只存在一级 nginx 代理的时候 X-Real-IP 和 X-Forwarded-For 是一致的，而当存在多级代理的时候，X-Forwarded-For 就变成了如下形式</p><p>$remote_addr 是前一节点的 IP，并不一定是用户的真实 IP。</p><h2 id="nginx-vue-history-404-问题" tabindex="-1">Nginx-Vue-History-404 问题 <a class="header-anchor" href="#nginx-vue-history-404-问题" aria-label="Permalink to &quot;Nginx-Vue-History-404 问题&quot;">​</a></h2><p>Vue histroy 模式 跳转路由 404 问题</p><h3 id="问题原因" tabindex="-1">问题原因 <a class="header-anchor" href="#问题原因" aria-label="Permalink to &quot;问题原因&quot;">​</a></h3><p>我们的服务器是根据页面路由，去按路径寻找资源的。我们打包好的 web 站点只有一个 html 页面，不存在其他资源目录下的 html，服务器找不到对应页面所以才报 404。</p><p><img src="`+A+'" alt="image-20240219171948782"></p><h3 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">try_files</span><span style="color:#E06C75;"> $uri</span><span style="color:#E06C75;"> $uri</span><span style="color:#98C379;">/</span><span style="color:#98C379;"> /index.html</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果给出的 file 都没有匹配到，则重新请求最后一个参数给定的 uri，就是新的 location 匹配</p><p>常见的变量：</p><ul><li>$uri 当前请求的 URI，但不含“？”后的参数</li><li>$args 当前请求的参数，即“？”后的宇符串</li><li>$arg_xxx 当前请求里的某个参数，“arg ”后是参数的名字</li><li>$http_xxx 当前请求里的 xxx 头部对应的值</li><li>$sent_http_xxx 返回给客户端的响应头部对应的值</li><li>$remote_addr 客户端 IP 地址。</li><li>$http_cookie 获取 cookie 值</li><li>$cookie_xxx 当前请求的 cookie xxx 对应的值</li><li>$request_uri 浏览器发起的不作任何修改的请求的 url 中的 path 如在www.baidu.com/p1/file?d=111, 其值为/p1/file?d=111</li><li>$uri 指当前的请求 URI，不包括任何参数，反映任何内部重定向或 index 模块所做的修改</li><li>$request_method 请求方法</li></ul><h2 id="nginx-安装使用-go-access-日志分析器" tabindex="-1">Nginx 安装使用 Go-Access-日志分析器 <a class="header-anchor" href="#nginx-安装使用-go-access-日志分析器" aria-label="Permalink to &quot;Nginx 安装使用 Go-Access-日志分析器&quot;">​</a></h2><p>将我们的 Linux 服务器设置为中文版</p><div class="language-cobol line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cobol</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">$ localectl  set-locale LANG=zh_CN.UTF8</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>重启服务器即可</p><p><img src="'+C+`" alt="image-20240219172054687"></p><p>GoAccess 是一款开源、实时，运行在命令行终端下的 web 日志分析工具。该工具提供快速、多样的 HTTP 状态统计，可以令管理员不再纠结于统计各类数据，和繁杂的指令以及一大堆管道/正则表达式说 byebye</p><p><a href="https://xiaoman.blog.csdn.net/article/details/124546293" target="_blank" rel="noreferrer">小满 Linux（第十章 Nginx-Go-Access-日志分析器）_--date-spec=-CSDN 博客</a></p><h2 id="nginx-负载均衡-upstream" tabindex="-1">Nginx-负载均衡 upstream <a class="header-anchor" href="#nginx-负载均衡-upstream" aria-label="Permalink to &quot;Nginx-负载均衡 upstream&quot;">​</a></h2><h3 id="基本语法" tabindex="-1">基本语法 <a class="header-anchor" href="#基本语法" aria-label="Permalink to &quot;基本语法&quot;">​</a></h3><p>upstream 的基本语法如下，一个 upstream 需要设置一个名称，这个名称可以在 server 里面当作 proxy 主机使用。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">upstream</span><span style="color:#98C379;">  node</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">    server</span><span style="color:#98C379;"> 127.0.0.1:9001</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">    server</span><span style="color:#98C379;"> 127.0.0.1:9002</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">    server</span><span style="color:#98C379;"> 127.0.0.1:9003</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>2</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">location</span><span style="color:#98C379;"> /</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">    proxy_pass</span><span style="color:#98C379;"> http://node</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_1-默认状态是按照轮询的方式去做负载的" tabindex="-1">1.默认状态是按照轮询的方式去做负载的 <a class="header-anchor" href="#_1-默认状态是按照轮询的方式去做负载的" aria-label="Permalink to &quot;1.默认状态是按照轮询的方式去做负载的&quot;">​</a></h3><p>使用 express 启动三个服务 分别是 9001 9002 9003</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> express</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;express&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">var</span><span style="color:#E06C75;"> num</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> express</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/list&quot;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">req</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">	res</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">		code</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		message</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;Nginx 负载均衡9001&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Nginx 负载均衡9001&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">num</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">	num</span><span style="color:#56B6C2;">++</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//------------------------------9001</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">9001</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;9001 success&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//-----------------------------------</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> express</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;express&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">var</span><span style="color:#E06C75;"> num</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> express</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/list&quot;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">req</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">	res</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">		code</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		message</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;Nginx 负载均衡9002&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Nginx 负载均衡9002&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">num</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">	num</span><span style="color:#56B6C2;">++</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//------------------------------9002</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">9002</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;9002 success&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//--------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> express</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;express&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">var</span><span style="color:#E06C75;"> num</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> express</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/list&quot;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">req</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">	res</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">		code</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		message</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;Nginx 负载均衡9003&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Nginx 负载均衡9003&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">num</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;">	num</span><span style="color:#56B6C2;">++</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">//------------------------------9003</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">9003</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">	console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;9003 success&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>使用<code>postman</code>或者<code>Apifox</code>等接口测试软件请求压测。</p><p>经过 33 次压测之后 平均每个负载为 11 次证明轮询</p><p><img src="`+v+`" alt="image-20240219172403144"></p><h3 id="_2-权重-weight" tabindex="-1">2.权重 weight <a class="header-anchor" href="#_2-权重-weight" aria-label="Permalink to &quot;2.权重 weight&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;"> upstream</span><span style="color:#98C379;">  node</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">    server</span><span style="color:#98C379;"> 127.0.0.1:9001</span><span style="color:#98C379;"> weight=</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">    server</span><span style="color:#98C379;"> 127.0.0.1:9002</span><span style="color:#98C379;"> weight=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">    server</span><span style="color:#98C379;"> 127.0.0.1:9003</span><span style="color:#98C379;"> weight=</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>权重越大服务器承载的并发就越高</p><p>压测 100 更多的并发打到了 9001</p><p><img src="`+f+`" alt="image-20240219172420050"></p><h3 id="_3-fail-timeout-backup" tabindex="-1">3.fail_timeout backup <a class="header-anchor" href="#_3-fail-timeout-backup" aria-label="Permalink to &quot;3.fail_timeout backup&quot;">​</a></h3><p>fail_timeout 是故障等待超时时间</p><p>backup 是备用服务器参数，可以为一个 upstream 设置一个 backup 的 server，在生产 server 全部都出问题之后，可以自动切换到备用 server 上，为回复服务争取时间</p><pre><code>upstream  node {

    server 127.0.0.1:9001 fail_timeout=60;

    server 127.0.0.1:9002 fail_timeout=20;

    server 127.0.0.1:9003 backup;

}
</code></pre><p><img src="`+E+'" alt="image-20240219172434289"></p>',228)]))}const T=n(_,[["render",k]]);export{z as __pageData,T as default};
