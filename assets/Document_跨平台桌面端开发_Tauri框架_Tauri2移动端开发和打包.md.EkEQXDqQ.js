import{_ as a,c as n,o as l,ah as p}from"./chunks/framework.DqD713j2.js";const e="/FrontEndLearnNotes/assets/image-20241008030836399.CakRm372.png",o="/FrontEndLearnNotes/assets/image-20241008030856415.CC_j94AZ.png",r="/FrontEndLearnNotes/assets/image-20241008030921268.DzdFD9Ct.png",t="/FrontEndLearnNotes/assets/image-20241008030948747.BfciuGbe.png",c="/FrontEndLearnNotes/assets/image-20241008031544427.Cfgd2mRz.png",i="/FrontEndLearnNotes/assets/image-20241008034157567.BE29JJ_n.png",d="/FrontEndLearnNotes/assets/image-20241008040459236.Drl1L81w.png",u="/FrontEndLearnNotes/assets/image-20241008032219938.xQuxBYho.png",y="/FrontEndLearnNotes/assets/image-20241008032233264.Bi-s5ksr.png",b="/FrontEndLearnNotes/assets/image-20241008032258094.DioAe0jd.png",m="/FrontEndLearnNotes/assets/image-20241008032331699.t00-uwJQ.png",F="/FrontEndLearnNotes/assets/image-20241008032345462.E2BFyZtm.png",C="/FrontEndLearnNotes/assets/image-20241008032401381.DEVeB6pD.png",B="/FrontEndLearnNotes/assets/image-20241008032414604.ghjY24fj.png",A="/FrontEndLearnNotes/assets/image-20241008032430496.B-DdbTM4.png",h="/FrontEndLearnNotes/assets/image-20241008032452401.qZVQETNy.png",g="/FrontEndLearnNotes/assets/image-20241008033334978.oAXeg_MM.png",v="/FrontEndLearnNotes/assets/image-20241008034300817.DDtLfQVr.png",w=JSON.parse('{"title":"Tauri2移动端开发和打包","description":"","frontmatter":{},"headers":[],"relativePath":"Document/跨平台桌面端开发/Tauri框架/Tauri2移动端开发和打包.md","filePath":"Document/跨平台桌面端开发/Tauri框架/Tauri2移动端开发和打包.md","lastUpdated":1750954157000}'),E={name:"Document/跨平台桌面端开发/Tauri框架/Tauri2移动端开发和打包.md"};function q(k,s,D,f,_,x){return l(),n("div",null,s[0]||(s[0]=[p(`<h1 id="tauri2移动端开发和打包" tabindex="-1">Tauri2移动端开发和打包 <a class="header-anchor" href="#tauri2移动端开发和打包" aria-label="Permalink to &quot;Tauri2移动端开发和打包&quot;">​</a></h1><h2 id="一、tauri2-0环境搭建与项目创建" tabindex="-1">一、Tauri2.0环境搭建与项目创建 <a class="header-anchor" href="#一、tauri2-0环境搭建与项目创建" aria-label="Permalink to &quot;一、Tauri2.0环境搭建与项目创建&quot;">​</a></h2><h3 id="一、搭建-tauri-2-0-开发环境" tabindex="-1">一、搭建 Tauri 2.0 开发环境 <a class="header-anchor" href="#一、搭建-tauri-2-0-开发环境" aria-label="Permalink to &quot;一、搭建 Tauri 2.0 开发环境&quot;">​</a></h3><blockquote><p>本教程默认你已经安装基本开发环境，如果你没有安装，请查看官方教程：<a href="https://v2.tauri.app/zh-cn/start/prerequisites/" target="_blank" rel="noreferrer">前置要求 | Tauri</a></p></blockquote><p>我当前的环境如下</p><table tabindex="0"><thead><tr><th>软件</th><th>版本</th></tr></thead><tbody><tr><td>Nodejs</td><td>v20.12.2</td></tr><tr><td>pnpm</td><td>v9.12.1</td></tr><tr><td>rust</td><td>1.81.0</td></tr></tbody></table><p>介绍安装pnpm，pnpm是一个好用的Node包管理工具。安装较为简单</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>npm install pnpm -g</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装没有报错就说明安装成功。</p><p>查看版本：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#D19A66;"> -v</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="二、创建-tauri-2-项目" tabindex="-1">二、创建 Tauri 2 项目 <a class="header-anchor" href="#二、创建-tauri-2-项目" aria-label="Permalink to &quot;二、创建 Tauri 2 项目&quot;">​</a></h3><p>官方教程：<a href="https://v2.tauri.app/zh-cn/start/create-project/" target="_blank" rel="noreferrer">创建项目 | Tauri</a></p><p>pnpm创建</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> create</span><span style="color:#98C379;"> tauri-app</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>执行那条命令，以下是输入的选项：</p></blockquote><ol><li>项目名：<code>tauri-vue</code></li><li>前端语言：<code>Typescript / JavaScript</code></li><li>包管理器：<code>pnpm</code></li><li>UI模板：<code>Vue</code></li></ol><h3 id="三、安装依赖" tabindex="-1">三、安装依赖 <a class="header-anchor" href="#三、安装依赖" aria-label="Permalink to &quot;三、安装依赖&quot;">​</a></h3><p>按照提示，应该是依次执行</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>cd tauri-vue</span></span>
<span class="line"><span>pnpm install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>等待依赖安装完成后，就可以运行项目了</p><h3 id="四、编译运行" tabindex="-1">四、编译运行 <a class="header-anchor" href="#四、编译运行" aria-label="Permalink to &quot;四、编译运行&quot;">​</a></h3><p>接下来直接编译运行初始项目，看看效果</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>pnpm tauri dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>命令运行后有一个较长的编译过程</p></blockquote><p>编译完成后，效果如下</p><h3 id="五、设置开发环境" tabindex="-1">五、设置开发环境 <a class="header-anchor" href="#五、设置开发环境" aria-label="Permalink to &quot;五、设置开发环境&quot;">​</a></h3><p>无论是Tauri还是Rust，官方都建议使用VSCode来进行开发，同时对其支持也是相当完善，因此下文使用VSCode编辑器做开发。安装好VSCode后，只需要安装以下安装插件</p><ul><li>Tauri</li><li>rust-analyzer</li><li>vue</li></ul><h2 id="二、项目结构" tabindex="-1">二、项目结构 <a class="header-anchor" href="#二、项目结构" aria-label="Permalink to &quot;二、项目结构&quot;">​</a></h2><p>当前项目文件结构如下</p><p>在当前目录中，需要关心的，基本上只有</p><ul><li>src：Vue前端源文件夹</li><li>src-tauri：Rust后端源文件夹</li></ul><h2 id="tauri的移动端开发环境配置和编译" tabindex="-1">tauri的移动端开发环境配置和编译 <a class="header-anchor" href="#tauri的移动端开发环境配置和编译" aria-label="Permalink to &quot;tauri的移动端开发环境配置和编译&quot;">​</a></h2><h3 id="环境安装" tabindex="-1">环境安装 <a class="header-anchor" href="#环境安装" aria-label="Permalink to &quot;环境安装&quot;">​</a></h3><p>参考官方说明：<a href="https://v2.tauri.app/zh-cn/start/prerequisites/#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%85%8D%E7%BD%AE" target="_blank" rel="noreferrer">前置要求 | Tauri</a></p><p>1.关于C++组件</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">对于</span><span style="color:#98C379;"> Windows</span><span style="color:#98C379;"> 用户，请确保至少安装了</span><span style="color:#98C379;"> Win10</span><span style="color:#98C379;"> SDK</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">10.0.19041.0</span><span style="color:#ABB2BF;">) </span><span style="color:#98C379;">和</span><span style="color:#98C379;"> Visual</span><span style="color:#98C379;"> Studio</span><span style="color:#98C379;"> Build</span><span style="color:#98C379;"> Tools</span><span style="color:#98C379;"> 2022（版本</span><span style="color:#D19A66;"> 17.2</span><span style="color:#98C379;"> 或更高），此外还需要安装以下组件：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Microsoft</span><span style="color:#98C379;"> Visual</span><span style="color:#98C379;"> C++</span><span style="color:#98C379;"> 2015-2022</span><span style="color:#98C379;"> Redistributable</span><span style="color:#ABB2BF;"> (x64)</span></span>
<span class="line"><span style="color:#61AFEF;">Microsoft</span><span style="color:#98C379;"> Visual</span><span style="color:#98C379;"> C++</span><span style="color:#98C379;"> 2015-2022</span><span style="color:#98C379;"> Redistributable</span><span style="color:#ABB2BF;"> (x86)</span></span>
<span class="line"><span style="color:#61AFEF;">Microsoft</span><span style="color:#98C379;"> Visual</span><span style="color:#98C379;"> C++</span><span style="color:#D19A66;"> 2012</span><span style="color:#98C379;"> Redistributable</span><span style="color:#ABB2BF;"> (x86)（可选）</span></span>
<span class="line"><span style="color:#61AFEF;">Microsoft</span><span style="color:#98C379;"> Visual</span><span style="color:#98C379;"> C++</span><span style="color:#D19A66;"> 2013</span><span style="color:#98C379;"> Redistributable</span><span style="color:#ABB2BF;"> (x86)（可选）</span></span>
<span class="line"><span style="color:#61AFEF;">Microsoft</span><span style="color:#98C379;"> Visual</span><span style="color:#98C379;"> C++</span><span style="color:#D19A66;"> 2008</span><span style="color:#98C379;"> Redistributable</span><span style="color:#ABB2BF;"> (x86)（可选）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>2.Rust版本，最新稳定版即可，我已经升到1.70了。并且需要包含安卓的所有跨跨平台编译器。参考上面的链接就是需要运行这个命令了。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">rustup</span><span style="color:#98C379;"> target</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> aarch64-linux-android</span><span style="color:#98C379;"> armv7-linux-androideabi</span><span style="color:#98C379;"> i686-linux-android</span><span style="color:#98C379;"> x86_64-linux-android</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3.Nodejs/npm/pnpm安装。nodejs选择最新的lts版本就好了，当前应该是18.12，npm装完nodejs自带就有。pnpm可以用npm安装。例如用这个命令：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> install</span><span style="color:#D19A66;"> -g</span><span style="color:#98C379;"> pnpm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>4.需要安卓Android Studio开发工具，安装最新版即可。</p><ul><li>SDK安装：打开Android Studio，选择<code>Tool</code>-<code>SDK Manager</code>，然后安装你想要安装的SDK版本。以我为例，我的手机是安卓12，我想打包后的apk兼容安卓9-13，那就勾选完9-13的所有SDK，然后点击<code>Apply</code>即可开始下载（或许需要外网环境</li><li><img src="`+e+'" alt="image-20241008030836399"></li><li>NDK安装：打开Android Studio，选择<code>Tool</code>-<code>SDK Manager</code>，还是上面哪个界面，点击<code>SDK Tools</code>，需要安装<code>Android SDK Build-Tools</code>，<code>NDK (Side by Side)</code>，<code>Android SDK Command Tools (Latest)</code>，<code>Cmake</code>，<code>Android Auto API Simulatros</code>，<code>Android Emulator</code>（安卓模拟器），<code>Android Emulator Hypervisor Driver (installer)</code>，<code>Android SDK Platform-Tools</code>，<code>Google USB Driver</code> (谷歌USB驱动，用于adb调试），<code>Google Web Driver</code>(谷歌wifi驱动，用于adb wifi调试），<code>Intel X86 Emulator Accelerator (HAXM installer)</code>，然后点击<code>Apply</code>开始下载。</li><li><img src="'+o+'" alt="image-20241008030856415"></li><li>拷贝SDK路径：打开Android Studio，选择<code>Tool</code>-<code>SDK Manager</code>，还是上面哪个界面，将<code>Android SDK Locations</code>后面的路径拷贝一下，我的显示是：<code>C:\\Users\\dsz\\AppData\\Local\\Android\\Sdk</code></li></ul><p>5.环境设置。对于Win11：打开<code>Windows设置</code>-<code>系统</code>-<code>系统信息</code>-<code>高级系统设置</code>-<code>环境变量</code>。在用户环境，新建用户变量。下面是几个需要构建的变化。</p><ul><li>变量名：<code>ANDROID_HOME</code>，变量值：<code>C:\\Users\\dsz\\AppData\\Local\\Android\\Sdk</code> 这个路径是从刚刚上一步拷贝而来的这个路径是从刚刚上一步拷贝而来的</li><li>变量名：<code>JAVA_HOME</code>，变量值：<code>C:\\Program Files\\Android\\Android Studio\\jbr</code> (这个路径需要根据你的<strong>Android Studio安装目录</strong>决定，我是默认安装位置，所以就是这个了。)</li><li>变量名：<code>NDK_HOME</code>，变量值：<code>C:\\Users\\dsz\\AppData\\Local\\Android\\Sdk\\ndk\\25.2.9519653</code> （注意这个路径需要你去<code>C:\\Users\\你的用户名\\AppData\\Local\\Android\\Sdk\\ndk</code>找找看，版本号不一定是我这个。</li><li>然后再找到用户变量的<code>Path变量</code>，选择编辑。</li><li><img src="'+r+'" alt="image-20241008030921268"></li><li>然后再新建三个路径（需要根据你的用户名找到对应的路径）：</li><li><code>C:\\Program Files\\Android\\Android Studio\\jbr\\bin</code> 这个提供了一些java运行命令以及最后apk签名的工具。</li><li><code>C:\\Users\\dsz\\AppData\\Local\\Android\\Sdk\\platform-tools</code> 这个下面提供了一些adb工具，可以用来控制你的手机安装软件。</li><li><code>C:\\Users\\dsz\\AppData\\Local\\Android\\Sdk\\build-tools\\34.0.0</code> 这个下面是一些apk查看，编辑的工具，可以用来定位apk错误信息。</li><li>参考截图如下：</li><li><img src="'+t+`" alt="image-20241008030948747"></li><li>保存完环境变量后，需要验证一下。打开powershell。输入下面几个命令，如果没有提示找不到xxx，则说明ok。</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">java</span><span style="color:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#61AFEF;">rustc</span><span style="color:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#61AFEF;">adb</span><span style="color:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#61AFEF;">node</span><span style="color:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#D19A66;"> --version</span></span>
<span class="line"><span style="color:#61AFEF;">aapt</span></span>
<span class="line"><span style="color:#61AFEF;">jarsigner</span><span style="color:#D19A66;"> --help</span></span>
<span class="line"><span style="color:#61AFEF;">keytool</span><span style="color:#D19A66;"> --help</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="迁移项目到tauri-2-0" tabindex="-1">迁移项目到Tauri 2.0 <a class="header-anchor" href="#迁移项目到tauri-2-0" aria-label="Permalink to &quot;迁移项目到Tauri 2.0&quot;">​</a></h3><p><a href="https://v2.tauri.app/zh-cn/start/migrate/" target="_blank" rel="noreferrer">更新和迁移 | Tauri</a></p><ul><li>观察tauri github项目主页：<a href="https://github.com/tauri-apps/tauri" target="_blank" rel="noreferrer">https://github.com/tauri-apps/tauri</a></li><li>主页下面有一个表格，里面写了最新tauri版本。</li><li>运行下面的命令，来更新rust项目中需要的tauri版本。</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> tauri@2.0.0</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> tauri-build@2.0.0</span><span style="color:#D19A66;"> --build</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> install</span><span style="color:#98C379;"> tauri-cli</span><span style="color:#D19A66;"> --version</span><span style="color:#98C379;"> &quot;^2.0.0&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="移动端运行项目-模拟器调试和编译安卓apk" tabindex="-1">移动端运行项目：模拟器调试和编译安卓APK <a class="header-anchor" href="#移动端运行项目-模拟器调试和编译安卓apk" aria-label="Permalink to &quot;移动端运行项目：模拟器调试和编译安卓APK&quot;">​</a></h3><h4 id="_1-需要打开android-studio的安卓模拟器或者adb命令连接你的手机-建议后者会更好一些。" tabindex="-1">1.需要打开Android Studio的安卓模拟器或者adb命令连接你的手机，建议后者会更好一些。 <a class="header-anchor" href="#_1-需要打开android-studio的安卓模拟器或者adb命令连接你的手机-建议后者会更好一些。" aria-label="Permalink to &quot;1.需要打开Android Studio的安卓模拟器或者adb命令连接你的手机，建议后者会更好一些。&quot;">​</a></h4><p>可以用下面的adb命令查看当前电脑已经连接的设备。如果没有，则会运行项目时会自动打开虚拟机中的模拟器。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">adb</span><span style="color:#98C379;"> devices</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>也可以去Android Studio，打开<code>Tool</code>-<code>Device Manager</code>查看你的虚拟机。如果虚拟机也么有，那就需要去Device Manage，点击<code>Create</code>创建一个了。</p><p><img src="`+c+'" alt="image-20241008031544427"></p><h4 id="_2-回到项目根路径-用tauri-2-0编译生成安卓代码" tabindex="-1">2.回到项目根路径，用tauri 2.0编译生成安卓代码 <a class="header-anchor" href="#_2-回到项目根路径-用tauri-2-0编译生成安卓代码" aria-label="Permalink to &quot;2.回到项目根路径，用tauri 2.0编译生成安卓代码&quot;">​</a></h4><p>参考教程：<a href="https://v2.tauri.app/zh-cn/develop/#developing-your-mobile-application" target="_blank" rel="noreferrer">开发 |折腾 (tauri.app)</a></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> init</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_3-以dev环境运行安卓项目" tabindex="-1">3.以dev环境运行安卓项目 <a class="header-anchor" href="#_3-以dev环境运行安卓项目" aria-label="Permalink to &quot;3.以dev环境运行安卓项目&quot;">​</a></h4><p>运行后会依次编译，安卓运行后会依次编译web tauri，安卓，此时手机/虚拟机会自动安装apk。你点击手机屏幕会电脑终端可以看到对应的调试信息。</p><p>这个命令，只要按照前面的配置，可以按下面命令一键运行项目，会自动启动Android Studio安装过的安卓虚拟机</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="'+i+'" alt="image-20241008034157567"></p><p>初次运行需要下载一些依赖项：</p><p><img src="'+d+`" alt="image-20241008040459236"></p><p>运行后，可以在这个项目根目录下的：<code>src-tauri\\gen\\android\\app\\build\\outputs\\apk\\arm64\\debug</code>路径看到这个apk，它的命名为<code>app-arm64-debug.apk</code>。</p><h4 id="_4-正式使用时-一般不需要那么多调试信息-而且也要缩减安装包大小" tabindex="-1">4.正式使用时，一般不需要那么多调试信息，而且也要缩减安装包大小 <a class="header-anchor" href="#_4-正式使用时-一般不需要那么多调试信息-而且也要缩减安装包大小" aria-label="Permalink to &quot;4.正式使用时，一般不需要那么多调试信息，而且也要缩减安装包大小&quot;">​</a></h4><p>所以需要编译一下正式版应用。运行下面的命令即可编译正式版应用，可能需要2-5分钟。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>输出结果如下：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">See</span><span style="color:#98C379;"> https://docs.gradle.org/8.0/userguide/command_line_interface.html#sec:command_line_warnings</span></span>
<span class="line"><span style="color:#61AFEF;">    Finished</span><span style="color:#D19A66;"> 1</span><span style="color:#98C379;"> APK</span><span style="color:#98C379;"> at:</span></span>
<span class="line"><span style="color:#61AFEF;">        C:\\Users\\dsz\\Documents\\rust_web\\tauri_demo\\src-tauri/gen/android\\app/build/outputs/apk/universal/release/app-universal-release-unsigned.apk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    Finished</span><span style="color:#D19A66;"> 1</span><span style="color:#98C379;"> AAB</span><span style="color:#98C379;"> at:</span></span>
<span class="line"><span style="color:#61AFEF;">        C:\\Users\\dsz\\Documents\\rust_web\\tauri_demo\\src-tauri/gen/android\\app/build/outputs/bundle/universalRelease/app-universal-release.aab</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>可以看到生成了apk和aab两个安装包。</li><li>观察apk命名：<code>app-universal-release-unsigned.apk</code>有两个关键信息，<code>universal</code>代表多架构，<code>unsigned</code>代表未包含签名。</li><li>尝试将这个apk放到安卓手机安装，提示没有签名无法安装。</li><li>多架构说明还能精简一下，像手机一般用arm64就行了，多余的目前用不上。</li><li>目前要做的事情是先给apk签名。</li></ul><h4 id="_5-生成签名" tabindex="-1">5.生成签名 <a class="header-anchor" href="#_5-生成签名" aria-label="Permalink to &quot;5.生成签名&quot;">​</a></h4><p>参考教程：<a href="https://v2.tauri.app/zh-cn/distribute/" target="_blank" rel="noreferrer">Distribute | Tauri</a></p><p>根据这个链接，我们需要先生成一个签名。对于windows，使用下面这个命令来生成(注意keystore里面的用户名改成你的，最好是全英语）。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">keytool</span><span style="color:#D19A66;"> -genkey</span><span style="color:#D19A66;"> -v</span><span style="color:#D19A66;"> -keystore</span><span style="color:#98C379;"> C:</span><span style="color:#56B6C2;">\\U</span><span style="color:#98C379;">sers</span><span style="color:#56B6C2;">\\d</span><span style="color:#98C379;">sz</span><span style="color:#56B6C2;">\\u</span><span style="color:#98C379;">pload-keystore.jks</span><span style="color:#D19A66;"> -storetype</span><span style="color:#98C379;"> JKS</span><span style="color:#D19A66;"> -keyalg</span><span style="color:#98C379;"> RSA</span><span style="color:#D19A66;"> -keysize</span><span style="color:#D19A66;"> 2048</span><span style="color:#D19A66;"> -validity</span><span style="color:#D19A66;"> 10000</span><span style="color:#D19A66;"> -alias</span><span style="color:#98C379;"> upload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>注意口令千万记牢固了，否则要重新生成了，会影响到后期的上架应用商店问题。</li><li>参考输入</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">输入密钥库口令:</span></span>
<span class="line"><span style="color:#61AFEF;">再次输入新口令:</span></span>
<span class="line"><span style="color:#61AFEF;">您的名字与姓氏是什么?</span></span>
<span class="line"><span style="color:#ABB2BF;">  [Unknown]</span><span style="color:#56B6C2;">:</span><span style="color:#98C379;">  Tlntin</span><span style="color:#98C379;"> Deng</span></span>
<span class="line"><span style="color:#61AFEF;">您的组织单位名称是什么?</span></span>
<span class="line"><span style="color:#ABB2BF;">  [Unknown]</span><span style="color:#56B6C2;">:</span><span style="color:#98C379;">  MyCompany</span></span>
<span class="line"><span style="color:#61AFEF;">您的组织名称是什么?</span></span>
<span class="line"><span style="color:#ABB2BF;">  [Unknown]</span><span style="color:#56B6C2;">:</span><span style="color:#98C379;">  MyOrg</span></span>
<span class="line"><span style="color:#61AFEF;">您所在的城市或区域名称是什么?</span></span>
<span class="line"><span style="color:#ABB2BF;">  [Unknown]</span><span style="color:#56B6C2;">:</span><span style="color:#98C379;">  GuangZhou</span></span>
<span class="line"><span style="color:#61AFEF;">您所在的省/市/自治区名称是什么?</span></span>
<span class="line"><span style="color:#ABB2BF;">  [Unknown]</span><span style="color:#56B6C2;">:</span><span style="color:#98C379;">  GuangDong</span></span>
<span class="line"><span style="color:#61AFEF;">该单位的双字母国家/地区代码是什么?</span></span>
<span class="line"><span style="color:#ABB2BF;">  [Unknown]</span><span style="color:#56B6C2;">:</span><span style="color:#98C379;">  CN</span></span>
<span class="line"><span style="color:#E06C75;">CN</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">Tlntin</span><span style="color:#61AFEF;"> Deng,</span><span style="color:#98C379;"> OU=MyCompany,</span><span style="color:#98C379;"> O=MyOrg,</span><span style="color:#98C379;"> L=GuangZhou,</span><span style="color:#98C379;"> ST=GuangDong,</span><span style="color:#98C379;"> C=CN是否正确?</span></span>
<span class="line"><span style="color:#ABB2BF;">  [否]</span><span style="color:#56B6C2;">:</span><span style="color:#98C379;">  Y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>生成完签名后，还需要将签名应用到apk中，还是参考上面的链接。先建一个<code>src-tauri/gen/android/key.properties</code>文件。填入你的口令以及签名路径：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E06C75;">storePassword</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">xxxxxxxxx</span></span>
<span class="line"><span style="color:#E06C75;">keyPassword</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">xxxxxxxxx</span></span>
<span class="line"><span style="color:#E06C75;">keyAlias</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">upload</span></span>
<span class="line"><span style="color:#E06C75;">storeFile</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">C:</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">Users</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">dsz</span><span style="color:#56B6C2;">\\\\</span><span style="color:#98C379;">upload-keystore.jks</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>修改<code>src-tauri/gen/android/app/build.gradle.kts</code>文件。基本修改内容就是参考链接里面说的。我这里不再废话了。修改完长这样：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">import</span><span style="color:#98C379;"> java.util.Properties</span></span>
<span class="line"><span style="color:#61AFEF;">import</span><span style="color:#98C379;"> java.io.FileInputStream</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">plugins</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">    id(</span><span style="color:#61AFEF;">&quot;com.android.application&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    id(</span><span style="color:#61AFEF;">&quot;org.jetbrains.kotlin.android&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    id(</span><span style="color:#61AFEF;">&quot;rust&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">val</span><span style="color:#98C379;"> keyPropertiesFile</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> rootProject.file</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">&quot;key.properties&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">val</span><span style="color:#98C379;"> keyProperties</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> Properties</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#61AFEF;">keyProperties.load(FileInputStream(keyPropertiesFile</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">android</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">    compileSdk</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> 33</span></span>
<span class="line"><span style="color:#61AFEF;">    namespace</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;com.tauri.tauri_demo&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">    defaultConfig</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">        manifestPlaceholders[</span><span style="color:#61AFEF;">&quot;usesCleartextTraffic&quot;</span><span style="color:#61AFEF;">]</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;false&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">        applicationId</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;com.tauri.tauri_demo&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">        minSdk</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> 24</span></span>
<span class="line"><span style="color:#61AFEF;">        targetSdk</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> 33</span></span>
<span class="line"><span style="color:#61AFEF;">        versionCode</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#61AFEF;">        versionName</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;1.0&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    signingConfigs</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">       create(</span><span style="color:#61AFEF;">&quot;release&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">           keyAlias</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> keyProperties[&quot;keyAlias&quot;]</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> String</span></span>
<span class="line"><span style="color:#61AFEF;">           keyPassword</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> keyProperties[&quot;keyPassword&quot;]</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> String</span></span>
<span class="line"><span style="color:#61AFEF;">           storeFile</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> file</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">keyProperties[</span><span style="color:#61AFEF;">&quot;storeFile&quot;</span><span style="color:#61AFEF;">]</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> String</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">           storePassword</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> keyProperties[&quot;storePassword&quot;]</span><span style="color:#98C379;"> as</span><span style="color:#98C379;"> String</span></span>
<span class="line"><span style="color:#ABB2BF;">       }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    buildTypes</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">        getByName(</span><span style="color:#61AFEF;">&quot;debug&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">            manifestPlaceholders[</span><span style="color:#61AFEF;">&quot;usesCleartextTraffic&quot;</span><span style="color:#61AFEF;">]</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;true&quot;</span></span>
<span class="line"><span style="color:#61AFEF;">            isDebuggable</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> true</span></span>
<span class="line"><span style="color:#61AFEF;">            isJniDebuggable</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> true</span></span>
<span class="line"><span style="color:#61AFEF;">            isMinifyEnabled</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> false</span></span>
<span class="line"><span style="color:#61AFEF;">            packaging</span><span style="color:#98C379;"> {</span><span style="color:#98C379;">                jniLibs.keepDebugSymbols.add</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">&quot;*/arm64-v8a/*.so&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">                jniLibs.keepDebugSymbols.add(</span><span style="color:#61AFEF;">&quot;*/armeabi-v7a/*.so&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">                jniLibs.keepDebugSymbols.add(</span><span style="color:#61AFEF;">&quot;*/x86/*.so&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">                jniLibs.keepDebugSymbols.add(</span><span style="color:#61AFEF;">&quot;*/x86_64/*.so&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#61AFEF;">        getByName(</span><span style="color:#61AFEF;">&quot;release&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">            isMinifyEnabled</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> true</span></span>
<span class="line"><span style="color:#61AFEF;">            signingConfig</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> signingConfigs.getByName</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">&quot;release&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">            proguardFiles(</span></span>
<span class="line"><span style="color:#61AFEF;">                *fileTree(</span><span style="color:#61AFEF;">&quot;.&quot;</span><span style="color:#ABB2BF;">) { </span><span style="color:#61AFEF;">include(</span><span style="color:#61AFEF;">&quot;**/*.pro&quot;</span><span style="color:#ABB2BF;">) }</span></span>
<span class="line"><span style="color:#61AFEF;">                    .plus(getDefaultProguardFile(</span><span style="color:#61AFEF;">&quot;proguard-android-optimize.txt&quot;</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#61AFEF;">                    .toList</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;">.toTypedArray</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            )</span></span>
<span class="line"><span style="color:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#61AFEF;">    kotlinOptions</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">        jvmTarget</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;1.8&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">rust</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">    rootDirRel</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;../../../&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">dependencies</span><span style="color:#98C379;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">    implementation(</span><span style="color:#61AFEF;">&quot;androidx.webkit:webkit:1.6.1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    implementation(</span><span style="color:#61AFEF;">&quot;androidx.appcompat:appcompat:1.6.1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    implementation(</span><span style="color:#61AFEF;">&quot;com.google.android.material:material:1.8.0&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    testImplementation(</span><span style="color:#61AFEF;">&quot;junit:junit:4.13.2&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    androidTestImplementation(</span><span style="color:#61AFEF;">&quot;androidx.test.ext:junit:1.1.4&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">    androidTestImplementation(</span><span style="color:#61AFEF;">&quot;androidx.test.espresso:espresso-core:3.5.0&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">apply(from</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;tauri.build.gradle.kts&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><ul><li>在项目根目录，终端环境下，重新运行一次编译命令。</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>输出结果如下：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">See</span><span style="color:#98C379;"> https://docs.gradle.org/8.0/userguide/command_line_interface.html#sec:command_line_warnings</span></span>
<span class="line"><span style="color:#61AFEF;">    Finished</span><span style="color:#D19A66;"> 1</span><span style="color:#98C379;"> APK</span><span style="color:#98C379;"> at:</span></span>
<span class="line"><span style="color:#61AFEF;">        C:\\Users\\dsz\\Documents\\rust_web\\tauri_demo\\src-tauri/gen/android\\app/build/outputs/apk/universal/release/app-universal-release.apk</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    Finished</span><span style="color:#D19A66;"> 1</span><span style="color:#98C379;"> AAB</span><span style="color:#98C379;"> at:</span></span>
<span class="line"><span style="color:#61AFEF;">        C:\\Users\\dsz\\Documents\\rust_web\\tauri_demo\\src-tauri/gen/android\\app/build/outputs/bundle/universalRelease/app-universal-release.aab</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>可以看到文件没有提示未签名（unsigned）了。</li></ul><h4 id="_6-精简架构-可选-观察一下目前apk的信息-注意路径改成你的-。" tabindex="-1">6.精简架构（可选），观察一下目前apk的信息（注意路径改成你的）。 <a class="header-anchor" href="#_6-精简架构-可选-观察一下目前apk的信息-注意路径改成你的-。" aria-label="Permalink to &quot;6.精简架构（可选），观察一下目前apk的信息（注意路径改成你的）。&quot;">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">aapt</span><span style="color:#98C379;"> dump</span><span style="color:#98C379;"> badging</span><span style="color:#98C379;"> C:</span><span style="color:#56B6C2;">\\U</span><span style="color:#98C379;">sers</span><span style="color:#56B6C2;">\\d</span><span style="color:#98C379;">sz</span><span style="color:#56B6C2;">\\D</span><span style="color:#98C379;">ocuments</span><span style="color:#56B6C2;">\\r</span><span style="color:#98C379;">ust_web</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">auri_demo</span><span style="color:#56B6C2;">\\s</span><span style="color:#98C379;">rc-tauri/gen/android</span><span style="color:#56B6C2;">\\a</span><span style="color:#98C379;">pp/build/outputs/apk/universal/release/app-universal-release.apk</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>输出结果：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">native-code:</span><span style="color:#98C379;"> &#39;arm64-v8a&#39;</span><span style="color:#98C379;"> &#39;armeabi-v7a&#39;</span><span style="color:#98C379;"> &#39;x86&#39;</span><span style="color:#98C379;"> &#39;x86_64</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>可以看到目前有4种架构，分别是arm 64位/arm 32位，x86 32位，x86 64位，一般来说，我们手机都是arm架构，除非用电脑模拟器，否则只需要arm64就行。</li><li>获取编译安卓时的帮助信息</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> build</span><span style="color:#D19A66;"> --help</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>输出结果：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">Android</span><span style="color:#98C379;"> build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Usage:</span><span style="color:#98C379;"> pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> build</span><span style="color:#ABB2BF;"> [OPTIONS]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">Options:</span></span>
<span class="line"><span style="color:#61AFEF;">  -d,</span><span style="color:#D19A66;"> --debug</span><span style="color:#98C379;">                     Builds</span><span style="color:#98C379;"> with</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> debug</span><span style="color:#98C379;"> flag</span></span>
<span class="line"><span style="color:#61AFEF;">  -v,</span><span style="color:#D19A66;"> --verbose...</span><span style="color:#98C379;">                Enables</span><span style="color:#98C379;"> verbose</span><span style="color:#98C379;"> logging</span></span>
<span class="line"><span style="color:#61AFEF;">  -t,</span><span style="color:#D19A66;"> --target</span><span style="color:#ABB2BF;"> [&lt;TARGETS&gt;...]     Which targets to build (</span><span style="color:#61AFEF;">all</span><span style="color:#98C379;"> by</span><span style="color:#98C379;"> default</span><span style="color:#ABB2BF;">) [possible values: aarch64, armv7, i686, x86_64]</span></span>
<span class="line"><span style="color:#61AFEF;">  -f,</span><span style="color:#D19A66;"> --features</span><span style="color:#ABB2BF;"> [&lt;FEATURES&gt;...]  List of pnpm features to activate</span></span>
<span class="line"><span style="color:#61AFEF;">  -c,</span><span style="color:#D19A66;"> --config</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">CONFI</span><span style="color:#ABB2BF;">G&gt;           </span><span style="color:#98C379;">JSON</span><span style="color:#98C379;"> string</span><span style="color:#98C379;"> or</span><span style="color:#98C379;"> path</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> JSON</span><span style="color:#98C379;"> file</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> merge</span><span style="color:#98C379;"> with</span><span style="color:#98C379;"> tauri.conf.json</span></span>
<span class="line"><span style="color:#61AFEF;">      --split-per-abi</span><span style="color:#98C379;">             Whether</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> split</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> APKs</span><span style="color:#98C379;"> and</span><span style="color:#98C379;"> AABs</span><span style="color:#98C379;"> per</span><span style="color:#98C379;"> ABIs</span></span>
<span class="line"><span style="color:#61AFEF;">      --apk</span><span style="color:#98C379;">                       Build</span><span style="color:#98C379;"> APKs</span></span>
<span class="line"><span style="color:#61AFEF;">      --aab</span><span style="color:#98C379;">                       Build</span><span style="color:#98C379;"> AABs</span></span>
<span class="line"><span style="color:#61AFEF;">  -o,</span><span style="color:#D19A66;"> --open</span><span style="color:#98C379;">                      Open</span><span style="color:#98C379;"> Android</span><span style="color:#98C379;"> Studio</span></span>
<span class="line"><span style="color:#61AFEF;">  -h,</span><span style="color:#D19A66;"> --help</span><span style="color:#98C379;">                      Print</span><span style="color:#98C379;"> help</span></span>
<span class="line"><span style="color:#61AFEF;">  -V,</span><span style="color:#D19A66;"> --version</span><span style="color:#98C379;">                   Print</span><span style="color:#98C379;"> version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>注意：<code>-t, --target [&lt;TARGETS&gt;...] Which targets to build (all by default) [possible values: aarch64, armv7, i686, x86_64]</code> 这里说<code>all by default</code>，默认是4种架构都支持，我们需要arm64，所以就选<code>aarch64</code>即可。</li><li>于是下面编译正式版时，指定一下架构aarch64。在项目根目录，终端环境下，重新运行一次编译命令。</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> build</span><span style="color:#D19A66;"> --target</span><span style="color:#98C379;"> aarch64</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>观察输出结果，命名好像没有变化，还是通用架构，已签名。</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">See</span><span style="color:#98C379;"> https://docs.gradle.org/8.0/userguide/command_line_interface.html#sec:command_line_warnings</span></span>
<span class="line"><span style="color:#61AFEF;">    Finished</span><span style="color:#D19A66;"> 1</span><span style="color:#98C379;"> APK</span><span style="color:#98C379;"> at:</span><span style="color:#ABB2BF;">                                                                                                                                                                             </span></span>
<span class="line"><span style="color:#61AFEF;">        C:\\Users\\dsz\\Documents\\rust_web\\tauri_demo\\src-tauri/gen/android\\app/build/outputs/apk/universal/release/app-universal-release.apk</span><span style="color:#ABB2BF;">                                                         </span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">    Finished</span><span style="color:#D19A66;"> 1</span><span style="color:#98C379;"> AAB</span><span style="color:#98C379;"> at:</span></span>
<span class="line"><span style="color:#61AFEF;">        C:\\Users\\dsz\\Documents\\rust_web\\tauri_demo\\src-tauri/gen/android\\app/build/outputs/bundle/universalRelease/app-universal-release.aab</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>观察一下新apk安装包的信息：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">aapt</span><span style="color:#98C379;"> dump</span><span style="color:#98C379;"> badging</span><span style="color:#98C379;"> C:</span><span style="color:#56B6C2;">\\U</span><span style="color:#98C379;">sers</span><span style="color:#56B6C2;">\\d</span><span style="color:#98C379;">sz</span><span style="color:#56B6C2;">\\D</span><span style="color:#98C379;">ocuments</span><span style="color:#56B6C2;">\\r</span><span style="color:#98C379;">ust_web</span><span style="color:#56B6C2;">\\t</span><span style="color:#98C379;">auri_demo</span><span style="color:#56B6C2;">\\s</span><span style="color:#98C379;">rc-tauri/gen/android</span><span style="color:#56B6C2;">\\a</span><span style="color:#98C379;">pp/build/outputs/apk/universal/release/app-universal-release.apk</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>输出结果：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">native-code:</span><span style="color:#98C379;"> &#39;arm64-v8a</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>目前只支持单一架构了。文件名大小从38M到11M，减少了70%多。</li><li>然后把这个安装包发到手机上，就可以安装了。如果提示签名不一致，那就卸载一下旧版。</li></ul><h2 id="环境配置2" tabindex="-1">环境配置2 <a class="header-anchor" href="#环境配置2" aria-label="Permalink to &quot;环境配置2&quot;">​</a></h2><h3 id="文档" tabindex="-1">文档 <a class="header-anchor" href="#文档" aria-label="Permalink to &quot;文档&quot;">​</a></h3><p>配置文档：<a href="https://v2.tauri.app/zh-cn/guides/prerequisites/#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%85%8D%E7%BD%AE" target="_blank" rel="noreferrer">移动端配置</a></p><p>安全：<a href="https://v2.tauri.app/zh-cn/reference/acl/capability/" target="_blank" rel="noreferrer">Capability | Tauri</a></p><h3 id="_1-安装androidstudio以及对应版本-可以是其他版本-但路径要对应" tabindex="-1">1.安装AndroidStudio以及对应版本(可以是其他版本，但路径要对应) <a class="header-anchor" href="#_1-安装androidstudio以及对应版本-可以是其他版本-但路径要对应" aria-label="Permalink to &quot;1.安装AndroidStudio以及对应版本(可以是其他版本，但路径要对应)&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">安装Android</span><span style="color:#98C379;"> Sdk</span><span style="color:#98C379;"> Platform</span><span style="color:#D19A66;"> 34</span></span>
<span class="line"><span style="color:#61AFEF;">安装Android</span><span style="color:#98C379;"> SDK</span><span style="color:#98C379;"> Platform-Tools</span></span>
<span class="line"><span style="color:#61AFEF;">安装NDK</span><span style="color:#ABB2BF;"> (Side </span><span style="color:#98C379;">by</span><span style="color:#98C379;"> side</span><span style="color:#ABB2BF;">) 26.0.10792818</span></span>
<span class="line"><span style="color:#61AFEF;">安装Android</span><span style="color:#98C379;"> SDK</span><span style="color:#98C379;"> Build-Tools</span><span style="color:#D19A66;"> 34.0</span></span>
<span class="line"><span style="color:#61AFEF;">安装Android</span><span style="color:#98C379;"> SDK</span><span style="color:#98C379;"> Command-line</span><span style="color:#98C379;"> Tools</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-配置环境变量-建议直接配置在系统环境" tabindex="-1">2.配置环境变量(建议直接配置在系统环境) <a class="header-anchor" href="#_2-配置环境变量-建议直接配置在系统环境" aria-label="Permalink to &quot;2.配置环境变量(建议直接配置在系统环境)&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">rustup</span><span style="color:#98C379;"> target</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> aarch64-linux-android</span><span style="color:#98C379;"> armv7-linux-androideabi</span><span style="color:#98C379;"> i686-linux-android</span><span style="color:#98C379;"> x86_64-linux-android</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#这里根据具体路径进行设置</span></span>
<span class="line"><span style="color:#ABB2BF;">[System.Environment]::SetEnvironmentVariable(</span><span style="color:#61AFEF;">&quot;JAVA_HOME&quot;</span><span style="color:#61AFEF;">,</span><span style="color:#98C379;"> &quot;C:\\Program Files\\Android\\Android Studio\\jbr&quot;,</span><span style="color:#98C379;"> &quot;User&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">[System.Environment]::SetEnvironmentVariable(</span><span style="color:#61AFEF;">&quot;ANDROID_HOME&quot;</span><span style="color:#61AFEF;">,</span><span style="color:#98C379;"> &quot;</span><span style="color:#E06C75;">$env</span><span style="color:#98C379;">:LocalAppData\\Android\\Sdk&quot;,</span><span style="color:#98C379;"> &quot;User&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">[System.Environment]::SetEnvironmentVariable(</span><span style="color:#61AFEF;">&quot;NDK_HOME&quot;</span><span style="color:#61AFEF;">,</span><span style="color:#98C379;"> &quot;</span><span style="color:#E06C75;">$env</span><span style="color:#98C379;">:LocalAppData\\Android\\Sdk\\ndk\\26.0.10792818&quot;,</span><span style="color:#98C379;"> &quot;User&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-初始化tauri文件-这里对非安卓同样有效" tabindex="-1">3.初始化tauri文件(这里对非安卓同样有效) <a class="header-anchor" href="#_3-初始化tauri文件-这里对非安卓同样有效" aria-label="Permalink to &quot;3.初始化tauri文件(这里对非安卓同样有效)&quot;">​</a></h3><p>运行命令</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> init</span><span style="color:#7F848E;font-style:italic;">    #找一个空文件夹初始化tauri项目(建议先配前端，他可以自动分析)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Where are your web assets：如果是标准项目../src目录即可，如果是vite配置../dist</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># What is the URL of your dev server?： 如果是vite，http://localhost:%vite端口%。否则src目录即可</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># What is your frontend dev command?：如果是vite，则为npm run dev，否则空</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># What is your frontend build command? ：如果是vite，则为npm run build，否则空</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>配置好后修改tauri.conf.json的identifier</p><h3 id="_4-初始化tauri安卓环境" tabindex="-1">4.初始化tauri安卓环境 <a class="header-anchor" href="#_4-初始化tauri安卓环境" aria-label="Permalink to &quot;4.初始化tauri安卓环境&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> init</span><span style="color:#7F848E;font-style:italic;">    # 初始化安卓项目</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> open</span><span style="color:#7F848E;font-style:italic;">    # 通过android studio打开安卓项目(会自动下载gradle环境)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_5-额外需要配置的东西" tabindex="-1">5.额外需要配置的东西 <a class="header-anchor" href="#_5-额外需要配置的东西" aria-label="Permalink to &quot;5.额外需要配置的东西&quot;">​</a></h3><p>配置powershell开发者模式</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Windows启动开发者模式</span></span>
<span class="line"><span style="color:#61AFEF;">reg</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> &quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\AppModelUnlock&quot;</span><span style="color:#98C379;"> /t</span><span style="color:#98C379;"> REG_DWORD</span><span style="color:#98C379;"> /f</span><span style="color:#98C379;"> /v</span><span style="color:#98C379;"> &quot;AllowDevelopmentWithoutDevLicense&quot;</span><span style="color:#98C379;"> /d</span><span style="color:#98C379;"> &quot;1&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-运行" tabindex="-1">6.运行 <a class="header-anchor" href="#_6-运行" aria-label="Permalink to &quot;6.运行&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> dev</span><span style="color:#7F848E;font-style:italic;"> # 测试</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> build</span><span style="color:#7F848E;font-style:italic;">   # 构建</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> dev</span><span style="color:#7F848E;font-style:italic;">     # 测试安卓</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> tauri</span><span style="color:#98C379;"> android</span><span style="color:#98C379;"> build</span><span style="color:#7F848E;font-style:italic;">   # 构建安卓</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_7-修改配置用来发布" tabindex="-1">7.修改配置用来发布 <a class="header-anchor" href="#_7-修改配置用来发布" aria-label="Permalink to &quot;7.修改配置用来发布&quot;">​</a></h3><p>链接</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;bundle&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">  &quot;active&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,    </span><span style="color:#FFFFFF;">#</span><span style="color:#FFFFFF;"> 这个直接true就行，代表绑捆的应用，跟targets挂钩</span></span>
<span class="line"><span style="color:#E06C75;">  &quot;category&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;类型&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  &quot;copyright&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;软件协议&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  &quot;identifier&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;唯一标识符&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  &quot;longDescription&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;长介绍&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  &quot;shortDescription&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;短介绍&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">  &quot;publisher&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;发布者&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">},</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_8-对发布后的apk进行签名" tabindex="-1">8.对发布后的apk进行签名 <a class="header-anchor" href="#_8-对发布后的apk进行签名" aria-label="Permalink to &quot;8.对发布后的apk进行签名&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#创建签名，接下来签名密码要记住</span></span>
<span class="line"><span style="color:#61AFEF;">keytool</span><span style="color:#D19A66;"> -genkey</span><span style="color:#D19A66;"> -v</span><span style="color:#D19A66;"> -keystore</span><span style="color:#98C379;"> 密钥存储位置</span><span style="color:#D19A66;"> -alias</span><span style="color:#98C379;"> 密钥别名</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">一般和密钥一样就行</span><span style="color:#ABB2BF;">) </span><span style="color:#D19A66;">-keyalg</span><span style="color:#98C379;"> RSA</span><span style="color:#D19A66;"> -validity</span><span style="color:#D19A66;"> 30000</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">持续时间</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#用apksigner进行签名</span></span>
<span class="line"><span style="color:#61AFEF;">apksigner</span><span style="color:#98C379;"> sign</span><span style="color:#D19A66;"> --ks</span><span style="color:#ABB2BF;"> (签名地址) --ks-key-alias (</span><span style="color:#61AFEF;">别名</span><span style="color:#ABB2BF;">) --out (</span><span style="color:#61AFEF;">签名后的apk地址</span><span style="color:#ABB2BF;">) (</span><span style="color:#61AFEF;">待签名apk地址</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#进行验证</span></span>
<span class="line"><span style="color:#61AFEF;">apksigner</span><span style="color:#98C379;"> verify</span><span style="color:#D19A66;"> -v</span><span style="color:#D19A66;"> --print-certs</span><span style="color:#ABB2BF;"> (apk地址)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#修改对齐(如果安装报对齐错误再使用)</span></span>
<span class="line"><span style="color:#61AFEF;">zipalign</span><span style="color:#D19A66;"> -c</span><span style="color:#D19A66;"> -v</span><span style="color:#D19A66;"> 4</span><span style="color:#98C379;"> existing.apk</span><span style="color:#7F848E;font-style:italic;"> #查看应用对齐方式</span></span>
<span class="line"><span style="color:#61AFEF;">zipalign</span><span style="color:#D19A66;"> -p</span><span style="color:#D19A66;"> -f</span><span style="color:#D19A66;"> -v</span><span style="color:#D19A66;"> 4</span><span style="color:#98C379;"> infile.apk</span><span style="color:#98C379;"> outfile.apk</span><span style="color:#7F848E;font-style:italic;">  #修改对齐(直接用这个即可，上面这个是输出信息的)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="开启远程调试功能" tabindex="-1">开启远程调试功能 <a class="header-anchor" href="#开启远程调试功能" aria-label="Permalink to &quot;开启远程调试功能&quot;">​</a></h2><p>本节内容为使用Tauri App使用远程调试功能，借助<strong>PageSpy</strong>提供的强大功能，Tauri可以很方便的调试自己的App，除断点调试无法实现外，抓包，元素审查，查看localstorage以及查看系统特性等功能都是可以使用的，基本可以满足调试要求，并且接入相当简单，推荐大家在使用Tauri调试移动端时使用。（比如安卓，tauri是可以读logcat的，但是总是会输出一些无关信息，影响开发效率，还是这种Chrome开发这工具的更方便，但logcat你也得学会看，这只是方不方便的区别）</p><h3 id="一、搭建pagespy环境" tabindex="-1">一、搭建PageSpy环境 <a class="header-anchor" href="#一、搭建pagespy环境" aria-label="Permalink to &quot;一、搭建PageSpy环境&quot;">​</a></h3><p>第一步先搭建PageSpy环境，首先找官方仓库，你只要在Github搜 <code>page-spy-web</code> 就可以了，当然也可以直接使用我的命令，前提是得有docker或者podman。</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span># docker 部署</span></span>
<span class="line"><span>docker run -d --restart=always -p 6752:6752 --name=&quot;pageSpy&quot; ghcr.io/huolalatech/page-spy-web:release</span></span>
<span class="line"><span># podman 部署</span></span>
<span class="line"><span>podman run -d --restart=always -p 6752:6752 --name=&quot;pageSpy&quot; ghcr.io/huolalatech/page-spy-web:release</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>你也可以使用Node来部署</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">yarn</span><span style="color:#98C379;"> global</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> @huolala-tech/page-spy-api</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果你使用 npm</span></span>
<span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> install</span><span style="color:#D19A66;"> -g</span><span style="color:#98C379;"> @huolala-tech/page-spy-api</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>安装完只要命令行运行<code>page-spy-api</code>启动服务，然后访问<code>ip:6752</code>就可以了。</p><p>打开页面显示</p><p><img src="`+u+'" alt="image-20241008032219938"></p><h3 id="二、接入sdk" tabindex="-1">二、接入SDK <a class="header-anchor" href="#二、接入sdk" aria-label="Permalink to &quot;二、接入SDK&quot;">​</a></h3><p>点击接入SDK就会出现</p><p><img src="'+y+`" alt="image-20241008032233264"></p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">script</span><span style="color:#D19A66;"> crossorigin</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;anonymous&quot;</span><span style="color:#D19A66;"> src</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;http://localhost:6752/page-spy/index.min.js&quot;</span><span style="color:#ABB2BF;">&gt;&lt;/</span><span style="color:#E06C75;">script</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">script</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#E5C07B;">   window</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">$pageSpy</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> PageSpy</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">script</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="`+b+'" alt="image-20241008032258094"></p><blockquote><p>localhost换成你的远程地址才可用</p></blockquote><h3 id="三、进行远程调试" tabindex="-1">三、进行远程调试 <a class="header-anchor" href="#三、进行远程调试" aria-label="Permalink to &quot;三、进行远程调试&quot;">​</a></h3><p>此时运行你的项目，会出现一个logo</p><p><img src="'+m+'" alt="image-20241008032331699"></p><p>表明已经连接到远程调试了，然后在<strong>PageSpy</strong>的Web页面进入房间页面，就会有你的设备</p><p><img src="'+F+'" alt="image-20241008032345462"></p><p><img src="'+C+'" alt="image-20241008032401381"></p><p>能做Tauri开发说明你已经是个老玩家了，这个界面会相当熟悉，新手也不用慌，可以F12玩玩你的开发者工具。</p><h3 id="调试控制台" tabindex="-1">调试控制台 <a class="header-anchor" href="#调试控制台" aria-label="Permalink to &quot;调试控制台&quot;">​</a></h3><p>控制台查看调试输出的内容，以及进行一些js命令的运行。</p><p><img src="'+B+'" alt="image-20241008032414604"></p><h3 id="网络抓包" tabindex="-1">网络抓包 <a class="header-anchor" href="#网络抓包" aria-label="Permalink to &quot;网络抓包&quot;">​</a></h3><p>抓取请求响应，调试必备。</p><p><img src="'+A+'" alt="image-20241008032430496"></p><h3 id="审查元素" tabindex="-1">审查元素 <a class="header-anchor" href="#审查元素" aria-label="Permalink to &quot;审查元素&quot;">​</a></h3><p><img src="'+h+'" alt="image-20241008032452401"></p><h3 id="四、延伸" tabindex="-1">四、延伸 <a class="header-anchor" href="#四、延伸" aria-label="Permalink to &quot;四、延伸&quot;">​</a></h3><p><strong>PageSpy</strong>功能很强大，基本上，利用Webview来实现跨端App的，都可以拿来调试，如果开发工具没有像Uniapp一样自带真机调试功能，使用这种远程调试还是很值得的，而且想要去除也是相当容易。</p><h1 id="移动端运行报错" tabindex="-1">移动端运行报错 <a class="header-anchor" href="#移动端运行报错" aria-label="Permalink to &quot;移动端运行报错&quot;">​</a></h1><h2 id="第一次运行下载报错问题" tabindex="-1">第一次运行下载报错问题 <a class="header-anchor" href="#第一次运行下载报错问题" aria-label="Permalink to &quot;第一次运行下载报错问题&quot;">​</a></h2><p>第一次运行移动端，需要下载一些以来，可能会因为网络下载报错，请调整好网络。</p><h2 id="运行报错-error-sending-request-for-url-http-localhost-1420" tabindex="-1">运行报错：error sending request for url(<a href="http://localhost:1420/" target="_blank" rel="noreferrer">http://localhost:1420/</a>) <a class="header-anchor" href="#运行报错-error-sending-request-for-url-http-localhost-1420" aria-label="Permalink to &quot;运行报错：error sending request for url(http://localhost:1420/)&quot;">​</a></h2><p><img src="'+g+'" alt="image-20241008033334978"></p><p>参考Issue：<a href="https://github.com/tauri-apps/tauri/issues/9509" target="_blank" rel="noreferrer">bug：<code>error sending request for url (http://192.168.0.x:1420/)</code> on iOS · Issue #9509 · tauri-apps/tauri (github.com)</a></p><p>需要将<code>tauri.config.json</code>中的<code>beforeDevCommand</code>改为<code>pnpm dev --host</code>使得网页内容可以在局域网中访问。再将devUrl中的IP改为开发者电脑的，使得手机可以从电脑端获取网页资源。</p><p><img src="'+v+`" alt="image-20241008034300817"></p><p>我实际试过了，在字段：<code>beforeDevCommand</code>后面添加成：<code>&quot;beforeDevCommand&quot;: &quot;pnpm dev --host&quot;</code> 这样就行了。</p><h1 id="使用barcode-scanner实现扫码功能-安卓" tabindex="-1">使用Barcode Scanner实现扫码功能（安卓） <a class="header-anchor" href="#使用barcode-scanner实现扫码功能-安卓" aria-label="Permalink to &quot;使用Barcode Scanner实现扫码功能（安卓）&quot;">​</a></h1><p>首先，本节内容是假设你已经会使用Tauri2.0搭建移动端项目，并且你的App需要添加一个扫码功能，如果你正对此出现的各种离谱问题，比如Rust插件依赖装不上，好不容易装上依赖但是又出现App闪退等问题，那么看这篇文章就对了，哪怕你第一次接触Tauri，学习一下也是好的。</p><blockquote><p>关于Tauri系列的其他内容在后面几天将陆续更新，本节首先发布是因为这个问题比较紧急。后面会从Tauri2.0移动端框架的搭建，调试等方面做点介绍，旨在大家能真实的用上Tauri，它不是个花架子。</p></blockquote><h2 id="一、barcode-scanner插件" tabindex="-1">一、Barcode Scanner插件 <a class="header-anchor" href="#一、barcode-scanner插件" aria-label="Permalink to &quot;一、Barcode Scanner插件&quot;">​</a></h2><p>Tauri2.0当前还处于Alpha测试阶段，一些内容尚未发布，且不稳定。但是一些功能已经可以使用了，比如扫码。（还有个Deep Linking后续聊）它的文档是严重落后与开发的，而且开发也极其缓慢，半年就更新出个扫码功能，而且还一堆破Bug，我这里只是将就写写，内容供大家参考。</p><h2 id="二、使用步骤" tabindex="-1">二、使用步骤 <a class="header-anchor" href="#二、使用步骤" aria-label="Permalink to &quot;二、使用步骤&quot;">​</a></h2><h3 id="_1-安装插件" tabindex="-1">1.安装插件 <a class="header-anchor" href="#_1-安装插件" aria-label="Permalink to &quot;1.安装插件&quot;">​</a></h3><h4 id="安装要求" tabindex="-1">安装要求 <a class="header-anchor" href="#安装要求" aria-label="Permalink to &quot;安装要求&quot;">​</a></h4><p>该插件安装分为两部分：</p><ol><li>Rust后端插件</li><li>前端插件</li></ol><p>在安装之前，需要明确，检查你的环境是否正确，如果不正确，就会出现插件安装失败，或者插件安装不上。</p><ol><li>需要Rust至少1.64版本，直接用最新的1.70+版本，如果你的不够请更新。</li><li>需要明确你使用的前端包管理工具，支持pnpm，npm和yarn，我使用的是pnpm。</li></ol><p>最后一个必须检查的问题，就是你项目使用的tauri版本，<strong>不能</strong>使用最新的<strong>alpha.18</strong>版本，会有依赖冲突，表现为shell这个库爆红。</p><blockquote><h5 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h5><p>将你的Tauri版本改为<strong>alpha.13</strong></p></blockquote><p>如果你按照这个方式修改了但是仍然出现闪退问题，就将pnpm.lock改回去，直到能运行不闪退，然后将你的Tauri版本改为<strong>alpha.13</strong>，重新构建，就可以解决问题了。解决插件装不上和闪退问题。</p><h4 id="安装rust后端插件" tabindex="-1">安装Rust后端插件 <a class="header-anchor" href="#安装rust后端插件" aria-label="Permalink to &quot;安装Rust后端插件&quot;">​</a></h4><p>github提供的写法是</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">[dependencies]</span></span>
<span class="line"><span style="color:#61AFEF;">tauri-plugin-barcode-scanner</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;2.0.0-alpha&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用git源:</span></span>
<span class="line"><span style="color:#61AFEF;">tauri-plugin-barcode-scanner</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> {</span><span style="color:#98C379;"> git</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;https://github.com/tauri-apps/plugins-workspace&quot;,</span><span style="color:#98C379;"> branch</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;v2&quot;</span><span style="color:#98C379;"> }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果你真的这么写，那么你必然踩坑。我怀疑这段文字是使用机器生成的，因为所有插件都是这么写的，但是看他的example里却不是这么用的，推荐使用以下写法</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">[target.</span><span style="color:#98C379;">&quot;cfg(any(target_os = </span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">android</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">, target_os = </span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">ios</span><span style="color:#56B6C2;">\\&quot;</span><span style="color:#98C379;">))&quot;</span><span style="color:#ABB2BF;">.dependencies]</span></span>
<span class="line"><span style="color:#61AFEF;">tauri-plugin-barcode-scanner</span><span style="color:#98C379;"> =</span><span style="color:#98C379;"> &quot;2.0.0-alpha.2&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p><strong>注意</strong></p><p>不要使用pnpm来更新依赖，使用pnpm clean以后，使用tauri的命令让他自己跑，就不会报错了。</p></blockquote><h4 id="安装前端插件" tabindex="-1">安装前端插件 <a class="header-anchor" href="#安装前端插件" aria-label="Permalink to &quot;安装前端插件&quot;">​</a></h4><p>此部分内容，只要按照你的包管理工具安装即可，选任意一个</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> @tauri-apps/plugin-barcode-scanner</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># or</span></span>
<span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> @tauri-apps/plugin-barcode-scanner</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># or</span></span>
<span class="line"><span style="color:#61AFEF;">yarn</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> @tauri-apps/plugin-barcode-scanner</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># alternatively with Git:</span></span>
<span class="line"><span style="color:#61AFEF;">pnpm</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> https://github.com/tauri-apps/tauri-plugin-barcode-scanner#v2</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># or</span></span>
<span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> https://github.com/tauri-apps/tauri-plugin-barcode-scanner#v2</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># or</span></span>
<span class="line"><span style="color:#61AFEF;">yarn</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> https://github.com/tauri-apps/tauri-plugin-barcode-scanner#v2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-使用" tabindex="-1">2.使用 <a class="header-anchor" href="#_2-使用" aria-label="Permalink to &quot;2.使用&quot;">​</a></h3><p>使用如果没有出现问题会相当简单，如果你是按照我给的流程来安装的话。</p><h4 id="注册插件" tabindex="-1">注册插件 <a class="header-anchor" href="#注册插件" aria-label="Permalink to &quot;注册插件&quot;">​</a></h4><p>在main.rs中注册插件就行，如果爆红，就看上面</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">fn</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E5C07B;">    tauri</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Builder</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">default</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">plugin</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">tauri_plugin_barcode_scanner</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">init</span><span style="color:#ABB2BF;">())</span><span style="color:#7F848E;font-style:italic;">// 添加这行</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">tauri</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">generate_context!</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">expect</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;error while running tauri application&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="调用扫码功能" tabindex="-1">调用扫码功能 <a class="header-anchor" href="#调用扫码功能" aria-label="Permalink to &quot;调用扫码功能&quot;">​</a></h4><p>导入包</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">scan</span><span style="color:#ABB2BF;"> } </span><span style="color:#C678DD;">from</span><span style="color:#98C379;"> &quot;@tauri-apps/plugin-barcode-scanner&quot;</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后直接调用即可</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">scan</span><span style="color:#ABB2BF;">({ </span></span>
<span class="line"><span style="color:#E06C75;">    windowed</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">, </span></span>
<span class="line"><span style="color:#E06C75;">    formats</span><span style="color:#ABB2BF;">: [</span><span style="color:#E5C07B;">Format</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">QRCode</span><span style="color:#ABB2BF;">] </span></span>
<span class="line"><span style="color:#ABB2BF;">    }).</span><span style="color:#61AFEF;">then</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">resp</span><span style="color:#C678DD;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">          console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`响应内容: </span><span style="color:#C678DD;">\${</span><span style="color:#E5C07B;">resp</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">content</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">        })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果你想要更加详细的了解，那么主要注意的有</p><ol><li><strong>resp</strong>是Scanned类型的，他的定义为</li></ol><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> interface</span><span style="color:#E5C07B;"> Scanned</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">    content</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">string</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    format</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Format</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    bounds</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">unknown</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>扫码的类型是可以定义的，也就是Format</li></ol><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> declare</span><span style="color:#C678DD;"> enum</span><span style="color:#E5C07B;"> Format</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">    QRCode</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;QR_CODE&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    UPC_A</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;UPC_A&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    UPC_E</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;UPC_E&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    EAN8</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;EAN_8&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    EAN13</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;EAN_13&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    Code39</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;CODE_39&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    Code93</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;CODE_93&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    Code128</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;CODE_128&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    Codabar</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;CODABAR&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    ITF</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;ITF&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    Aztec</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;AZTEC&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    DataMatrix</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;DATA_MATRIX&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    PDF417</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;PDF_417&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol><li>摄像头也是可以指定的，相关代码为</li></ol><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">export</span><span style="color:#C678DD;"> interface</span><span style="color:#E5C07B;"> ScanOptions</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">    cameraDirection</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;back&quot;</span><span style="color:#ABB2BF;"> | </span><span style="color:#98C379;">&quot;front&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;">    formats</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Format</span><span style="color:#ABB2BF;">[];</span></span>
<span class="line"><span style="color:#E06C75;">    windowed</span><span style="color:#C678DD;">?</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">boolean</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,213)]))}const P=a(E,[["render",q]]);export{w as __pageData,P as default};
