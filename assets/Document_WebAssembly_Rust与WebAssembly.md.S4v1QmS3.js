import{_ as a,c as n,o as p,ah as l}from"./chunks/framework.DqD713j2.js";const e="/FrontEndLearnNotes/assets/image-20240506193358584.euPN-WPH.png",o="/FrontEndLearnNotes/assets/image-20240506193601784.Cc7X9pVX.png",r="/FrontEndLearnNotes/assets/640-1714382843164-30.98i0N18s.webp",t="/FrontEndLearnNotes/assets/640-1714382843164-31.ClvkOGMZ.webp",c="/FrontEndLearnNotes/assets/640-1714382843164-32.DefbCrFa.webp",i="/FrontEndLearnNotes/assets/640-1714382843164-33.jfaglyWY.webp",b="/FrontEndLearnNotes/assets/640-1714382843164-34.mSz6bfCQ.webp",B="/FrontEndLearnNotes/assets/640-1714382843164-35.LA1OVlyP.webp",y="/FrontEndLearnNotes/assets/640-1714382843164-36.CZeLu_aN.webp",u="/FrontEndLearnNotes/assets/640-1714382843165-37.fCwvsCzm.webp",m="/FrontEndLearnNotes/assets/640-1714382843165-38.BvM9gqiz.webp",d="/FrontEndLearnNotes/assets/640-1714382843165-39.DRkNZSOy.webp",F="/FrontEndLearnNotes/assets/640-1714382843165-40.AHH90TbX.webp",A="/FrontEndLearnNotes/assets/640-1714382843165-41.BhMJAzvb.webp",C="/FrontEndLearnNotes/assets/640-1714382843165-42.BYrOQLGZ.webp",h="/FrontEndLearnNotes/assets/640-1714382843165-43.DHnXQUey.webp",D=JSON.parse('{"title":"Rustä¸WebAssembly","description":"","frontmatter":{},"headers":[],"relativePath":"Document/WebAssembly/Rustä¸WebAssembly.md","filePath":"Document/WebAssembly/Rustä¸WebAssembly.md","lastUpdated":1750954157000}'),g={name:"Document/WebAssembly/Rustä¸WebAssembly.md"};function E(w,s,f,v,k,_){return p(),n("div",null,s[0]||(s[0]=[l(`<h1 id="rustä¸webassembly" tabindex="-1">Rustä¸WebAssembly <a class="header-anchor" href="#rustä¸webassembly" aria-label="Permalink to &quot;Rustä¸WebAssembly&quot;">â€‹</a></h1><p>æ•™ç¨‹ï¼š<a href="https://rustmagazine.github.io/rust_magazine_2021/chapter_2/rust_wasm_frontend.html" target="_blank" rel="noreferrer">å‰ç«¯å…¥é—¨ ï½œ Rust å’Œ WebAssembly - Rustç²¾é€‰ (rustmagazine.github.io)</a></p><h2 id="rustçš„webassemblyè¿è¡Œæ—¶åº“" tabindex="-1">Rustçš„WebAssemblyè¿è¡Œæ—¶åº“ <a class="header-anchor" href="#rustçš„webassemblyè¿è¡Œæ—¶åº“" aria-label="Permalink to &quot;Rustçš„WebAssemblyè¿è¡Œæ—¶åº“&quot;">â€‹</a></h2><p>Rustä¸WebAssemblyçš„ç»“åˆä¸ºæ„å»ºé«˜æ€§èƒ½ã€å®‰å…¨ä¸”å¼€æ”¾çš„WebAssemblyåº”ç”¨æä¾›äº†è®¸å¤šä¼˜åŠ¿ã€‚</p><p>èƒ½å¤Ÿæ–¹ä¾¿åœ°åœ¨webä¸Šä¸JavaScriptäº’æ“ä½œã€‚Rustèƒ½å¤Ÿåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä½¿å¾—å®ƒåœ¨è®¸å¤šç”¨ä¾‹ä¸­éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š</p><ul><li>CPUå¯†é›†å‹å·¥ä½œ(åŠ å¯†)</li><li>GPUå¯†é›†å‹å·¥ä½œ(å›¾åƒ/è§†é¢‘å¤„ç†ã€å›¾åƒè¯†åˆ«)</li></ul><p>æ–‡æ¡£ï¼š<a href="https://www.rust-lang.org/zh-CN/what/wasm" target="_blank" rel="noreferrer">https://www.rust-lang.org/zh-CN/what/wasm</a></p><h3 id="ä»¥ä¸‹æ˜¯ä¸€äº›ä¸rustå’Œwebassemblyç›¸å…³çš„åº“å’Œå·¥å…·" tabindex="-1">ä»¥ä¸‹æ˜¯ä¸€äº›ä¸Rustå’ŒWebAssemblyç›¸å…³çš„åº“å’Œå·¥å…·ï¼š <a class="header-anchor" href="#ä»¥ä¸‹æ˜¯ä¸€äº›ä¸rustå’Œwebassemblyç›¸å…³çš„åº“å’Œå·¥å…·" aria-label="Permalink to &quot;ä»¥ä¸‹æ˜¯ä¸€äº›ä¸Rustå’ŒWebAssemblyç›¸å…³çš„åº“å’Œå·¥å…·ï¼š&quot;">â€‹</a></h3><ol><li><strong>wasm-bindgen</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥è½»æ¾åœ°å°†Rustä»£ç ä¸WebAssemblyä¹‹é—´ç”Ÿæˆç»‘å®šä»£ç ï¼Œä½¿å®ƒä»¬å¯ä»¥åœ¨JavaScriptä¸­è°ƒç”¨ã€‚å®ƒç®€åŒ–äº†Rustå’ŒWebAssemblyä¹‹é—´çš„äº’æ“ä½œæ€§ã€‚</li><li><strong>wasm-bindgen-cli</strong>ï¼š</li><li><strong>web-sys</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªRuståº“ï¼Œæä¾›äº†å¯¹Webå¹³å°APIçš„é¢„æ‰“åŒ…ç»‘å®šã€‚ä½¿ç”¨web-sysï¼Œæ‚¨å¯ä»¥åœ¨Rustä¸­ç›´æ¥è°ƒç”¨æµè§ˆå™¨çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™JavaScriptã€‚</li><li><strong>wasm-pack</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºã€æ‰“åŒ…å’Œå‘å¸ƒRust WebAssemblyåŒ…çš„å·¥å…·ã€‚å®ƒå¯ä»¥å°†Rust WebAssemblyæ¨¡å—å‘å¸ƒåˆ°npmç­‰åŒ…ä»“åº“ä¸­å¿ƒï¼Œå¹¶ä¸webpackã€Parcelç­‰å·¥å…·ä¸€èµ·ä½¿ç”¨ã€‚</li><li><strong>napi-rs</strong>ï¼š</li><li><strong>yew</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç°ä»£çš„Rustå‰ç«¯æ¡†æ¶ï¼Œç”¨äºæ„å»ºWebåº”ç”¨ç¨‹åºã€‚å®ƒä½¿ç”¨WebAssemblyä½œä¸ºç›®æ ‡ï¼Œå…è®¸æ‚¨åœ¨æ•´ä¸ªWebåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨Rustã€‚</li><li><strong>source-map</strong>ï¼šå¦‚æœæ‚¨éœ€è¦åœ¨WebAssemblyä¸­å¤„ç†æºæ˜ å°„ï¼Œå¯ä»¥ä½¿ç”¨Rustæ¥æé«˜æ€§èƒ½ã€‚Rustä¸ä¼šå¼ºè¿«æ‚¨åœ¨æ˜ç¡®è¡¨è¾¾æ„å›¾å’Œè¿è¡Œæ—¶æ€§èƒ½ä¹‹é—´åšå‡ºé€‰æ‹©ã€‚</li></ol><p>æ€»ä¹‹ï¼ŒRustå’ŒWebAssemblyçš„ç»“åˆä¸ºæ„å»ºé«˜æ€§èƒ½ã€å®‰å…¨ä¸”ç°ä»£çš„Webåº”ç”¨æä¾›äº†å¼ºå¤§çš„å·¥å…·å’Œç”Ÿæ€ç³»ç»Ÿã€‚</p><h1 id="ä½¿ç”¨wasm-bindgen-cli" tabindex="-1">ä½¿ç”¨wasm-bindgen-cli <a class="header-anchor" href="#ä½¿ç”¨wasm-bindgen-cli" aria-label="Permalink to &quot;ä½¿ç”¨wasm-bindgen-cli&quot;">â€‹</a></h1><p>åˆ›å»ºä¸€ä¸ªç®€å•çš„å›¾åƒå¤„ç†æ¨¡å—ï¼Œå­—èŠ‚æ•°ç»„æ“ä½œå’Œæ•°æ®å¤„ç†æ˜¯Rustå¯ä»¥æ˜¾è‘—æé«˜åº”ç”¨ç¨‹åºé€Ÿåº¦çš„é¢†åŸŸã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®‰è£…äº†wasm32-unknown-unknownã€‚å¦‚æœæ²¡æœ‰ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">rustup</span><span style="color:#98C379;"> target</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> wasm32-unknown-unknown</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>è¯·æ³¨æ„ï¼Œä¸ºäº†æµ‹è¯•æˆ‘ä»¬çš„æ¨¡å—ï¼Œè¿˜éœ€è¦é¢å¤–å®‰è£…npm(æˆ–ä»»ä½•æ›¿ä»£æ–¹æ¡ˆ)ã€‚</p><h2 id="æ„å»ºé¡¹ç›®" tabindex="-1">æ„å»ºé¡¹ç›® <a class="header-anchor" href="#æ„å»ºé¡¹ç›®" aria-label="Permalink to &quot;æ„å»ºé¡¹ç›®&quot;">â€‹</a></h2><p>é¦–å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸ºwasm-exampleçš„æ–°é¡¹ç›®ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">cargo</span><span style="color:#98C379;"> init</span><span style="color:#D19A66;"> --lib</span><span style="color:#98C379;"> wasm-example</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç„¶åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ä¾èµ–é¡¹ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">cargo</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> wasm-bindgen@0.2.91</span></span>
<span class="line"><span style="color:#61AFEF;">cargo</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> js-sys@0.3.68</span></span>
<span class="line"><span style="color:#61AFEF;">cargo</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> image@0.25.0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æˆ‘ä»¬è¿˜éœ€è¦å°†åŠ¨æ€åº“æ ‡å¿—æ·»åŠ åˆ°Cargo.tomlæ–‡ä»¶ä¸­ã€‚é€šå¸¸ï¼Œå®ƒè®©CargoçŸ¥é“æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªåŠ¨æ€ç³»ç»Ÿåº“â€”â€”ä½†æ˜¯å½“å®ƒä¸WebAssemblyç›®æ ‡ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒçš„æ„æ€æ˜¯â€œåˆ›å»ºä¸€ä¸ªæ²¡æœ‰å¯åŠ¨å‡½æ•°çš„*.wasmæ–‡ä»¶â€ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">[lib]</span></span>
<span class="line"><span style="color:#61AFEF;">crate-type</span><span style="color:#98C379;"> =</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;cdylib&quot;</span><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸ºäº†èƒ½å¤Ÿåœ¨Rustä¸­ä½¿ç”¨JavaScriptç±»å‹ï¼Œé™¤äº†ä½¿ç”¨wasm-bindgenå®ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨extern Cã€‚è¿™å…è®¸æˆ‘ä»¬ç›´æ¥ä»JavaScriptä¸­å¯¼å…¥å‡½æ•°åˆ°Rustä¸­ï¼</p><p>WASMä¸­çš„Hello Worldä¾‹å­æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> wasm_bindgen</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">prelude</span><span style="color:#ABB2BF;">::*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#C678DD;">extern</span><span style="color:#98C379;"> &quot;C&quot;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    fn</span><span style="color:#61AFEF;"> alert</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">s</span><span style="color:#ABB2BF;">: &amp;</span><span style="color:#E5C07B;">str</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#C678DD;">pub</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> greet</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: &amp;</span><span style="color:#E5C07B;">str</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">    alert</span><span style="color:#ABB2BF;">(&amp;</span><span style="color:#61AFEF;">format!</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Hello, {}!&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>æ³¨æ„ï¼Œå¤–éƒ¨Cä»£ç ä¸­çš„alertå‡½æ•°ç›´æ¥å–è‡ªJavaScriptï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨Rustå‡½æ•°ä¸­è°ƒç”¨å®ƒã€‚å¦‚æœæˆ‘ä»¬è¦ç¼–è¯‘å®ƒå¹¶åœ¨JavaScriptæ–‡ä»¶ä¸­æ‰§è¡Œï¼Œå®ƒå°†ä¸ä»å¸¸è§„JavaScriptæ–‡ä»¶ä¸­è°ƒç”¨alert()ç›¸åŒã€‚</p><p>æˆ‘ä»¬å¯ä»¥åº”ç”¨ç›¸åŒçš„é€»è¾‘æ¥å¤„ç†å…¶ä»–ç±»å‹å’Œå‡½æ•°â€”â€”ç¼“å†²åŒºã€‚JavaScriptä¸­çš„<code>Vec&lt;u8&gt;</code>å¯ä»¥ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¡¨ç¤ºï¼š</p><ul><li><p>Uint8Arrayç±»å‹(ç›´æ¥ç›¸å½“äºJavaScriptä¸­çš„<code>Vec&lt;u8&gt;</code>)</p></li><li><p>Bufferç±»å‹</p></li></ul><p>Bufferæ˜¯Uint8Arrayçš„å­ç±»ã€‚è¿™æ˜¯å› ä¸ºå½“Node.jsç¬¬ä¸€æ¬¡å‘å¸ƒæ—¶ï¼Œæ²¡æœ‰Uint8Arrayç±»å‹-è¿™å°±æ˜¯å¯¼è‡´Bufferç±»å‹åˆ›å»ºçš„åŸå› ã€‚åæ¥ï¼Œå½“Uint8Arraysè¢«å¼•å…¥ES6æ—¶ï¼Œä¸¤è€…æœ€ç»ˆè¢«åˆå¹¶ã€‚è®¸å¤šJavaScriptåº“ä»ç„¶ä½¿ç”¨Bufferï¼Œé€šè¿‡ä½¿ç”¨js-sysï¼Œæˆ‘ä»¬å¯ä»¥åœ¨JavaScriptå’ŒRustä¹‹é—´å®ç°äº’æ“ä½œæ€§ã€‚</p><p>è®©æˆ‘ä»¬åœ¨src/lib.rsæ–‡ä»¶ä¸­ä¸€ä¸ªå®šä¹‰Bufferç±»å‹å’Œæä¾›ä¸€ä¸ªæ–¹æ³•buffer()æ–¹æ³•ï¼š</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> js_sys</span><span style="color:#ABB2BF;">::{wasm_bindgen, </span><span style="color:#E5C07B;">ArrayBuffer</span><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// è¿™å®šä¹‰äº†Node.jsçš„Bufferç±»å‹</span></span>
<span class="line"><span style="color:#ABB2BF;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#C678DD;">extern</span><span style="color:#98C379;"> &quot;C&quot;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    pub</span><span style="color:#C678DD;"> type</span><span style="color:#E5C07B;"> Buffer</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    #[wasm_bindgen(method, getter)]</span></span>
<span class="line"><span style="color:#C678DD;">    fn</span><span style="color:#61AFEF;"> buffer</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">this</span><span style="color:#ABB2BF;">: &amp;</span><span style="color:#E5C07B;">Buffer</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#E5C07B;">ArrayBuffer</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    #[wasm_bindgen(method, getter, js_name </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> byteOffset)]</span></span>
<span class="line"><span style="color:#C678DD;">    fn</span><span style="color:#61AFEF;"> byte_offset</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">this</span><span style="color:#ABB2BF;">: &amp;</span><span style="color:#E5C07B;">Buffer</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#E5C07B;">u32</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    #[wasm_bindgen(method, getter)]</span></span>
<span class="line"><span style="color:#C678DD;">    fn</span><span style="color:#61AFEF;"> length</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">this</span><span style="color:#ABB2BF;">: &amp;</span><span style="color:#E5C07B;">Buffer</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#E5C07B;">u32</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬ç¼–å†™WASMå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¼•ç”¨Bufferç±»å‹ï¼</p><p>è®©æˆ‘ä»¬ç¼–å†™ç”¨äºè½¬æ¢å›¾åƒæ–‡ä»¶æ ¼å¼çš„Rustå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°éœ€è¦ä¸Šé¢å®šä¹‰çš„ç¼“å†²åŒºï¼Œå®ƒè¿”å›<code>Vec&lt;u8&gt;</code>ã€‚å½“æˆ‘ä»¬é€šè¿‡wasm-packæˆ–å…¶ä»–ç¼–è¯‘å™¨ç¼–è¯‘å®ƒæ—¶ï¼Œå®ƒå°†è‡ªåŠ¨è½¬æ¢ä¸ºUint8Arrayã€‚</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> image</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">io</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Reader</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> image</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">ImageFormat</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> js_sys</span><span style="color:#ABB2BF;">::{wasm_bindgen, </span><span style="color:#E5C07B;">ArrayBuffer</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Uint8Array</span><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> std</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">io</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Cursor</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> wasm_bindgen</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">prelude</span><span style="color:#ABB2BF;">::wasm_bindgen;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// .. extern C stuff goes here</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#C678DD;">pub</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> convert_image</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">buffer</span><span style="color:#ABB2BF;">: &amp;</span><span style="color:#E5C07B;">Buffer</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#E5C07B;">Vec</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">u8</span><span style="color:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // è¿™å°†ä»Node.jsç¼“å†²åŒºè½¬æ¢ä¸ºVec&lt;u8&gt;</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> bytes</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Vec</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">u8</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> Uint8Array</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new_with_byte_offset_and_length</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#ABB2BF;">        &amp;</span><span style="color:#E06C75;">buffer</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">buffer</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#E06C75;">        buffer</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">byte_offset</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#E06C75;">        buffer</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">length</span><span style="color:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#ABB2BF;">    )</span></span>
<span class="line"><span style="color:#ABB2BF;">    .</span><span style="color:#61AFEF;">to_vec</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> img2</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Reader</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Cursor</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">bytes</span><span style="color:#ABB2BF;">))</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">with_guessed_format</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#C678DD;"> mut</span><span style="color:#E06C75;"> new_vec</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Vec</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">u8</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> Vec</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">    img2</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">write_to</span><span style="color:#ABB2BF;">(&amp;</span><span style="color:#C678DD;">mut</span><span style="color:#E5C07B;"> Cursor</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(&amp;</span><span style="color:#C678DD;">mut</span><span style="color:#E06C75;"> new_vec</span><span style="color:#ABB2BF;">), </span><span style="color:#E5C07B;">ImageFormat</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Jpeg</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">        .</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    new_vec</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="é€šè¿‡wasm-bindgen-cliæ„å»º" tabindex="-1">é€šè¿‡wasm-bindgen-cliæ„å»º <a class="header-anchor" href="#é€šè¿‡wasm-bindgen-cliæ„å»º" aria-label="Permalink to &quot;é€šè¿‡wasm-bindgen-cliæ„å»º&quot;">â€‹</a></h2><p>é¦–å…ˆï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…wasm-bindgen-cliï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">cargo</span><span style="color:#98C379;"> install</span><span style="color:#98C379;"> wasm-bindgen-cli</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºwasm32-unknown-unknown targetï¼Œå°†Rustä»£ç ç¼–è¯‘åˆ°WASMï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">cargo</span><span style="color:#98C379;"> build</span><span style="color:#D19A66;"> --target=wasm32-unknown-unknown</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>æ¥ä¸‹æ¥ï¼Œéœ€è¦ä½¿ç”¨wasm-bindgenå‘½ä»¤æ¥ç”ŸæˆJSç²˜åˆä»£ç ï¼Œä»¥ä½¿å…¶æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬ä½¿ç”¨nodejs targetï¼Œå®ƒå°†ç”Ÿæˆä¸€ä¸ªCommonJSæ¨¡å—ï¼Œå¹¶å°†å…¶æ”¾åœ¨./pkgæ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åå°±å¯ä»¥å°†å…¶æ¤å…¥åˆ°ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„åœ°æ–¹ã€‚</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">wasm-bindgen</span><span style="color:#D19A66;"> --target</span><span style="color:#98C379;"> nodejs</span><span style="color:#D19A66;"> --out-dir</span><span style="color:#98C379;"> ./pkg</span><span style="color:#98C379;"> ./target/wasm32-unknown-unknown/debug/wasm_example.wasm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†WASMä»£ç ä½œä¸ºåŒ…å‘å¸ƒã€‚</p><p>å¦‚æœä½ ä¸æƒ³ä½¿ç”¨CommonJSï¼Œæ¯”å¦‚ä½ æ­£åœ¨ä½¿ç”¨ESM (EcmaScriptæ¨¡å—ï¼Œæˆ–ES6æ¨¡å—)ï¼ŒCLIç›®å‰æ”¯æŒç”Ÿæˆä»¥ä¸‹å‡ ç§targetï¼š</p><ul><li>bundlerï¼šç”Ÿæˆç”¨äºWebpackç­‰æ†ç»‘å™¨çš„ä»£ç </li><li>Webï¼šå¯ç›´æ¥åœ¨Webæµè§ˆå™¨ä¸­åŠ è½½</li><li>nodejsï¼šå¯é€šè¿‡requireä½œä¸ºCommonJSçš„Node.jsæ¨¡å—åŠ è½½</li><li>denoï¼šå¯ç”¨ä½œdenoæ¨¡å—</li><li>no-modulesï¼šåƒwebç›®æ ‡ï¼Œä½†ä¸ä½¿ç”¨ESæ¨¡å—</li></ul><p>å°±ä½¿ç”¨å“ªç§ç¼–è¯‘å™¨è€Œè¨€ï¼Œæœ€ç®€å•çš„æ–¹æ³•é€šå¸¸æ˜¯ä½¿ç”¨Webpackï¼Œå› ä¸ºå®ƒæ˜¯æœ€å…¼å®¹çš„ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼æˆ‘ä»¬å°†ä½¿ç”¨Express.jså¯åŠ¨ä¸€ä¸ªJavaScriptåç«¯æœåŠ¡å™¨ã€‚åœ¨Rusté¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹ä»£ç (ä¸ºäº†æ–¹ä¾¿èµ·è§)ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> init</span><span style="color:#D19A66;"> -y</span></span>
<span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> i</span><span style="color:#98C379;"> express</span><span style="color:#98C379;"> express-fileupload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªserver.jsæ–‡ä»¶ï¼Œå¹¶æ’å…¥ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> express</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;express&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> fileUpload</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;express-fileupload&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> cors</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;cors&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> bodyParser</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;body-parser&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> morgan</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;morgan&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> _</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;lodash&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">convert_image</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;./pkg/wasm_example.js&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> app</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> express</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> port</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 3030</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">fileUpload</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">    createParentPath</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#ABB2BF;">}));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">cors</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">bodyParser</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">json</span><span style="color:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">bodyParser</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">urlencoded</span><span style="color:#ABB2BF;">({</span><span style="color:#E06C75;">extended</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">}));</span></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">use</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">morgan</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;dev&#39;</span><span style="color:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/&#39;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">req</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">  res</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">send</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`</span></span>
<span class="line"><span style="color:#98C379;">    &lt;h2&gt;With &lt;code&gt;&quot;express&quot;&lt;/code&gt; npm package&lt;/h2&gt;</span></span>
<span class="line"><span style="color:#98C379;">    &lt;form action=&quot;/api/upload&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;div&gt;Text field title: &lt;input type=&quot;text&quot; name=&quot;title&quot; /&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;div&gt;File: &lt;input type=&quot;file&quot; name=&quot;file&quot;/&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#98C379;">      &lt;input type=&quot;submit&quot; value=&quot;Upload&quot; /&gt;</span></span>
<span class="line"><span style="color:#98C379;">    &lt;/form&gt;</span></span>
<span class="line"><span style="color:#98C379;">  \`</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;/api/upload&#39;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">req</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">next</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    const</span><span style="color:#E5C07B;"> image</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> convert_image</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">req</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">files</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">file</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">    res</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setHeader</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Content-disposition&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;attachment; filename=&quot;meme.jpeg&quot;&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">    res</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setHeader</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;Content-type&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;image/jpg&#39;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">    res</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">send</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">image</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">listen</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">port</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">  console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`Example app listening on port </span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">port</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>è¿™æ®µä»£ç åšäº†ä»¥ä¸‹å·¥ä½œï¼š</p><ul><li>åœ¨ç«¯å£3030è®¾ç½®äº†ä¸€ä¸ªExpressæœåŠ¡å™¨</li><li>æˆ‘ä»¬åœ¨/ä¸Šæœ‰ä¸€ä¸ªè·¯ç”±ï¼Œå½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®å®ƒæ—¶ï¼Œå®ƒä¼šç»™æˆ‘ä»¬ä¸€ä¸ªHTMLè¡¨å•</li><li>æˆ‘ä»¬æœ‰ä¸€ä¸ªAPIè·¯ç”±ï¼Œå®ƒå°†ä»æ–‡ä»¶ä¸Šä¼ ä¸­è·å–æ•°æ®ï¼Œå°†å…¶è½¬æ¢ä¸ºæ–°æ ¼å¼ï¼Œè®¾ç½®æ­£ç¡®çš„å¤´ä¿¡æ¯å¹¶è¿”å›æ–°å›¾åƒã€‚</li></ul><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">node</span><span style="color:#98C379;"> server.js</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥<a href="http://localhost:3030/%EF%BC%8C%E5%A6%82%E5%9B%BE%EF%BC%9A" target="_blank" rel="noreferrer">http://localhost:3030/ï¼Œå¦‚å›¾ï¼š</a></p><p><img src="`+e+`" alt="image-20240506193358584"></p><p>è¯·æ³¨æ„ï¼Œæ ¹æ®ç”¨äºå›¾åƒæ–‡ä»¶æ ¼å¼è½¬æ¢çš„è®¾ç½®ï¼Œè½¬æ¢åçš„æ–‡ä»¶å¤§å°å¯èƒ½ä¼šå¢åŠ ã€‚è¿™æ˜¯å› ä¸ºä½¿ç”¨çš„æ˜¯æ— æŸè½¬æ¢ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨æœ‰æŸè½¬æ¢æ¥å‡å°æ–‡ä»¶å¤§å°ï¼Œéœ€è¦åœ¨Rustä»£ç ä¸­å®ä¾‹åŒ–å›¾åƒç¼–ç å™¨æ—¶ä½¿ç”¨new_with_qualityæ–¹æ³•ã€‚</p><p>è™½ç„¶wasm-bindgen-cliå¾ˆæœ‰ç”¨ï¼Œä½†å®ƒä¹Ÿæ˜¯æˆ‘ä»¬é€‰é¡¹ä¸­æœ€åº•å±‚çš„CLIï¼Œåœ¨ä½¿ç”¨å®ƒæ—¶å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚wasm-bindgenç‰ˆæœ¬ä¸å…¼å®¹é—®é¢˜ã€‚</p><h1 id="wasm-packçš„ä½¿ç”¨" tabindex="-1">Wasm-packçš„ä½¿ç”¨ <a class="header-anchor" href="#wasm-packçš„ä½¿ç”¨" aria-label="Permalink to &quot;Wasm-packçš„ä½¿ç”¨&quot;">â€‹</a></h1><p>wasm-packæ˜¯ä¸€ä¸ªæ—¨åœ¨å°†Rustç¼–è¯‘ä¸ºWASMçš„ä¸€ç«™å¼å·¥å…·ã€‚å®ƒåŒ…å«ä¸€ä¸ªCLIï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥å®‰è£…å®ƒï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">cargo</span><span style="color:#98C379;"> install</span><span style="color:#98C379;"> wasm-pack</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ä¸ä½¿ç”¨wasm-bindgen-cliç›¸æ¯”ï¼Œå®ƒæœ‰è®¸å¤šè´¨é‡ä¸Šçš„å‡çº§ï¼š</p><ul><li><p>é™„å¸¦ä¸€ä¸ªWebAssemblyåˆ†é…å™¨wee_allocï¼Œå®ƒçš„ä»£ç å ç”¨(é¢„å‹ç¼©)ä¸º1kBã€‚</p></li><li><p>é™„å¸¦ä¸€ä¸ªpanicé’©å­ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•Rust panicæ¶ˆæ¯ã€‚</p></li></ul><p>è¦åˆå§‹åŒ–æˆ‘ä»¬çš„é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">wasm-pack</span><span style="color:#98C379;"> new</span><span style="color:#98C379;"> wasm-example-2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å®ƒå°†ä¸ºæˆ‘ä»¬åšæ‰€æœ‰çš„äº‹æƒ…ã€‚åœ¨ä»£ç æ–¹é¢ï¼Œæˆ‘ä»¬çš„ä¸»å‡½æ•°(å’ŒC/JSç»‘å®š)å°†ä¿æŒä¸wasm-packç›¸åŒï¼Œå®ƒä¸»è¦æä¾›å·¥å…·æ·»åŠ ï¼Œä½¿ç¼–è¯‘æ›´å®¹æ˜“ã€‚</p><p>ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ„å»ºWASMï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">wasm-pack</span><span style="color:#98C379;"> build</span></span>
<span class="line"><span style="color:#61AFEF;">æˆ–</span></span>
<span class="line"><span style="color:#61AFEF;">wasm-pack</span><span style="color:#98C379;"> build</span><span style="color:#D19A66;"> --target</span><span style="color:#98C379;"> nodejs</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="å¼€æºæ’ä»¶" tabindex="-1">å¼€æºæ’ä»¶ <a class="header-anchor" href="#å¼€æºæ’ä»¶" aria-label="Permalink to &quot;å¼€æºæ’ä»¶&quot;">â€‹</a></h3><p><a href="https://github.com/rwasm/vite-plugin-rsw" target="_blank" rel="noreferrer">rwasm/vite-plugin-rswï¼š ğŸ¦ ç”¨äº Vite çš„ wasm-pack æ’ä»¶ (github.com)</a></p><h2 id="wasm-bpf-åœ¨-webassembly-ä¸­æ„å»ºå’Œè¿è¡Œ-ebpf-ç¨‹åºçš„å·¥å…·é“¾ä¸è¿è¡Œæ—¶" tabindex="-1">Wasm-bpfï¼šåœ¨ WebAssembly ä¸­æ„å»ºå’Œè¿è¡Œ eBPF ç¨‹åºçš„å·¥å…·é“¾ä¸è¿è¡Œæ—¶ <a class="header-anchor" href="#wasm-bpf-åœ¨-webassembly-ä¸­æ„å»ºå’Œè¿è¡Œ-ebpf-ç¨‹åºçš„å·¥å…·é“¾ä¸è¿è¡Œæ—¶" aria-label="Permalink to &quot;Wasm-bpfï¼šåœ¨ WebAssembly ä¸­æ„å»ºå’Œè¿è¡Œ eBPF ç¨‹åºçš„å·¥å…·é“¾ä¸è¿è¡Œæ—¶&quot;">â€‹</a></h2><ul><li>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/eunomia-bpf/wasm-bpf" target="_blank" rel="noreferrer">https://github.com/eunomia-bpf/wasm-bpf</a></li><li>å®˜ç½‘ï¼š<a href="https://eunomia.dev/wasm-bpf/" target="_blank" rel="noreferrer">eunomia.dev/wasm-bpf/</a></li></ul><h3 id="é¡¹ç›®æè¿°" tabindex="-1">é¡¹ç›®æè¿°ï¼š <a class="header-anchor" href="#é¡¹ç›®æè¿°" aria-label="Permalink to &quot;é¡¹ç›®æè¿°ï¼š&quot;">â€‹</a></h3><p>Wasm æœ€åˆæ˜¯ä»¥æµè§ˆå™¨å®‰å…¨æ²™ç›’ä¸ºç›®çš„å¼€å‘çš„ï¼Œå‘å±•åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒWebAssembly å·²ç»æˆä¸ºä¸€ä¸ªç”¨äºäº‘åŸç”Ÿè½¯ä»¶ç»„ä»¶çš„é«˜æ€§èƒ½ã€è·¨å¹³å°å’Œå¤šè¯­è¨€è½¯ä»¶æ²™ç®±ç¯å¢ƒï¼ŒWasm è½»é‡çº§å®¹å™¨ä¹Ÿéå¸¸é€‚åˆä½œä¸ºä¸‹ä¸€ä»£æ— æœåŠ¡å™¨å¹³å°è¿è¡Œæ—¶ã€‚å¦ä¸€ä¸ªä»¤äººå…´å¥‹çš„è¶‹åŠ¿æ˜¯ eBPF çš„å…´èµ·ï¼Œå®ƒä½¿äº‘åŸç”Ÿå¼€å‘äººå‘˜èƒ½å¤Ÿæ„å»ºå®‰å…¨çš„ç½‘ç»œã€æœåŠ¡ç½‘æ ¼å’Œå¤šç§å¯è§‚æµ‹æ€§ç»„ä»¶ï¼Œå¹¶ä¸”å®ƒä¹Ÿåœ¨é€æ­¥æ¸—é€å’Œæ·±å…¥åˆ°å†…æ ¸çš„å„ä¸ªç»„ä»¶ï¼Œæä¾›æ›´å¼ºå¤§çš„å†…æ ¸æ€å¯ç¼–ç¨‹äº¤äº’èƒ½åŠ›ã€‚</p><p>ç°åœ¨ï¼Œå€ŸåŠ© Wasm-bpf ç¼–è¯‘å·¥å…·é“¾å’Œè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Wasm å°† eBPF ç¨‹åºç¼–å†™ä¸ºè·¨å¹³å°çš„æ¨¡å—ï¼ŒåŒæ—¶ä½¿ç”¨ C/C++ æˆ– Rust æ¥ç¼–å†™ Wasm-eBPF ç¨‹åºå¹¶å‘å¸ƒã€‚é€šè¿‡åœ¨ WebAssembly ä¸­ä½¿ç”¨ eBPF ç¨‹åºï¼Œæˆ‘ä»¬ä¸ä»…èƒ½è®© Wasm åº”ç”¨äº«å—åˆ° eBPF çš„é«˜æ€§èƒ½å’Œå¯¹ç³»ç»Ÿæ¥å£çš„è®¿é—®èƒ½åŠ›ï¼Œè¿˜å¯ä»¥è®© eBPF ç¨‹åºä½¿ç”¨åˆ° Wasm çš„æ²™ç®±ã€çµæ´»æ€§ã€è·¨å¹³å°æ€§ã€å’ŒåŠ¨æ€åŠ è½½ï¼Œå¹¶ä¸”ä½¿ç”¨ Wasm çš„ OCI é•œåƒæ¥æ–¹ä¾¿ã€å¿«æ·åœ°åˆ†å‘å’Œç®¡ç† eBPF ç¨‹åºã€‚ç»“åˆè¿™ä¸¤ç§æŠ€æœ¯ï¼Œæˆ‘ä»¬å°†ä¼šç»™ eBPF å’Œ Wasm ç”Ÿæ€æ¥ä¸€ä¸ªå…¨æ–°çš„å¼€å‘ä½“éªŒï¼</p><p>Wasm-bpf æ˜¯ä¸€ä¸ª WebAssembly eBPF åº“å’Œè¿è¡Œæ—¶ï¼Œ åŸºäº <a href="https://facebookmicrosites.github.io/bpf/blog/2020/02/19/bpf-portability-and-co-re.html" target="_blank" rel="noreferrer">CO-RE</a>(ä¸€æ¬¡ç¼–å†™ â€“ åˆ°å¤„è¿è¡Œ) <a href="https://github.com/libbpf/libbpf" target="_blank" rel="noreferrer">libbpf</a> å’Œ <a href="https://github.com/bytecodealliance/wasm-micro-runtime" target="_blank" rel="noreferrer">wasm-micro-runtime</a> å®ç°ã€‚</p><ul><li>äº®ç‚¹ï¼š</li><li><code>é€šç”¨</code>: ç»™ WASM æä¾›å¤§éƒ¨åˆ†çš„ eBPF åŠŸèƒ½ã€‚ æ¯”å¦‚ä» <code>ring buffer</code> æˆ–è€… <code>perf buffer</code> ä¸­è·å–æ•°æ®ã€ é€šè¿‡ <code>maps</code> æä¾› <code>å†…æ ¸</code> eBPF å’Œ <code>ç”¨æˆ·æ€</code> Wasm ç¨‹åºä¹‹é—´çš„åŒå‘é€šä¿¡ã€ åŠ¨æ€ <code>åŠ è½½</code>, <code>é™„åŠ </code> æˆ–è€… <code>è§£é™¤é™„åŠ </code> eBPFç¨‹åºç­‰ã€‚ æ”¯æŒå¤§é‡çš„ eBPF ç¨‹åºç±»å‹å’Œ map ç±»å‹ï¼Œ è¦†ç›–äº†ç”¨äº <code>tracingï¼ˆè·Ÿè¸ªï¼‰</code>, <code>networkingï¼ˆç½‘ç»œï¼‰</code>, <code>securityï¼ˆå®‰å…¨ï¼‰</code> çš„ä½¿ç”¨åœºæ™¯ã€‚</li><li><code>é«˜æ€§èƒ½</code>: å¯¹äºå¤æ‚æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰é¢å¤–çš„ <code>åºåˆ—åŒ–</code> å¼€é”€ã€‚ é€šè¿‡ <code>å…±äº«å†…å­˜</code> æ¥é¿å…åœ¨ Host å’Œ WASM ç«¯ä¹‹é—´çš„é¢å¤–æ•°æ®æ‹·è´ã€‚</li><li><code>ç®€å•ä¾¿æ·çš„å¼€å‘ä½“éªŒ</code>: æä¾›å’Œ <a href="https://github.com/libbpf/libbpf-bootstrap" target="_blank" rel="noreferrer">libbpf-bootstrap</a> ç›¸ä¼¼çš„å¼€å‘ä½“éªŒï¼Œ <code>è‡ªåŠ¨ç”Ÿæˆ</code> Wasm-eBPF çš„ <code>skeleton</code> å¤´æ–‡ä»¶ä»¥åŠç”¨äºç»‘å®šçš„ <code>ç±»å‹</code> å®šä¹‰ã€‚</li><li><code>éå¸¸è½»é‡</code>: ç¼–è¯‘å®Œæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶åªæœ‰ <code>1.5 MB</code> çš„å¤§å°ï¼Œç¼–è¯‘å¥½çš„ WASM æ¨¡å—åªæœ‰ <code>~90K</code> ï¼Œè¿œè¿œæ¯”ä¼ ç»Ÿçš„ä»¥å®¹å™¨æ–¹å¼åˆ†å‘å’Œè¿è¡Œ eBPF ç¨‹åºæ¥çš„è½»é‡ï¼ŒåŒæ—¶ä¿æŒè‰¯å¥½çš„éš”ç¦»æ€§å’Œæ²™ç®±ç‰¹æ€§ã€‚ä½ å¯ä»¥éå¸¸å®¹æ˜“åœ°ä½¿ç”¨ä»»ä½•è¯­è¨€ï¼Œåœ¨ä»»ä½•å¹³å°ä¸Šå»ºç«‹ä½ è‡ªå·±çš„ Wasm-eBPF è¿è¡Œæ—¶ï¼Œä½¿ç”¨ç›¸åŒçš„å·¥å…·é“¾æ¥æ„å»ºåº”ç”¨ï¼</li></ul><p><img src="https://user-images.githubusercontent.com/34985212/218979864-80668806-b197-4e10-8447-6a1a21832a3f.png" alt="WASI-bpf"></p><ul><li>æ¼”ç¤ºè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1vD4y1P78S/" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV1vD4y1P78S/</a></li><li>ç¤ºä¾‹ä»£ç ï¼š</li></ul><p>ä½¿ç”¨ C/C++ åœ¨ Wasm ä¸­æ„å»º eBPF åº”ç”¨ï¼Œå°† eBPF å­—èŠ‚ç åŠ è½½åˆ°å†…æ ¸å¹¶å¤„ç†å†…æ ¸è¿”å›çš„å¯¹åº”çš„æ•°æ®</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>    /* Load and verify BPF application */</span></span>
<span class="line"><span>    skel = bootstrap_bpf__open();</span></span>
<span class="line"><span>    if (!skel) {</span></span>
<span class="line"><span>        fprintf(stderr, &quot;Failed to open and load BPF skeleton\\n&quot;);</span></span>
<span class="line"><span>        return 1;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /* Parameterize BPF code with minimum duration parameter */</span></span>
<span class="line"><span>    skel-&gt;rodata-&gt;min_duration_ns = env.min_duration_ms * 1000000ULL;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /* Load &amp; verify BPF programs */</span></span>
<span class="line"><span>    err = bootstrap_bpf__load(skel);</span></span>
<span class="line"><span>    if (err) {</span></span>
<span class="line"><span>        fprintf(stderr, &quot;Failed to load and verify BPF skeleton\\n&quot;);</span></span>
<span class="line"><span>        goto cleanup;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    /* Attach tracepoints */</span></span>
<span class="line"><span>    err = bootstrap_bpf__attach(skel);</span></span>
<span class="line"><span>    if (err) {</span></span>
<span class="line"><span>        fprintf(stderr, &quot;Failed to attach BPF skeleton\\n&quot;);</span></span>
<span class="line"><span>        goto cleanup;</span></span>
<span class="line"><span>    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>ä½¿ç”¨ Rust åœ¨ Wasm ä¸­ç¼–å†™ eBPF åº”ç”¨ï¼š</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>extern &quot;C&quot; fn handle_event(_ctx: u32, data: u32, _data_sz: u32) {</span></span>
<span class="line"><span>    let event_slice = unsafe { slice::from_raw_parts(data as *const Event, 1) };</span></span>
<span class="line"><span>    let event = &amp;event_slice[0];</span></span>
<span class="line"><span>    let pid = event.pid;</span></span>
<span class="line"><span>    let ppid = event.ppid;</span></span>
<span class="line"><span>    let exit_code = event.exit_code;</span></span>
<span class="line"><span>    if event.exit_event == 1 {</span></span>
<span class="line"><span>        print!(</span></span>
<span class="line"><span>            &quot;{:&lt;8} {:&lt;5} {:&lt;16} {:&lt;7} {:&lt;7} [{}]&quot;,</span></span>
<span class="line"><span>            &quot;TIME&quot;,</span></span>
<span class="line"><span>            &quot;EXIT&quot;,</span></span>
<span class="line"><span>            unsafe { CStr::from_ptr(event.comm.as_ptr() as *const i8) }</span></span>
<span class="line"><span>                .to_str()</span></span>
<span class="line"><span>                .unwrap(),</span></span>
<span class="line"><span>            pid,</span></span>
<span class="line"><span>            ppid,</span></span>
<span class="line"><span>            exit_code</span></span>
<span class="line"><span>        );</span></span>
<span class="line"><span>        ...</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>ä¸€è¡Œå‘½ä»¤ä»äº‘ç«¯çš„ Github Packages ä¸­ä¸‹è½½å¹¶è¿è¡Œ eBPF ç¨‹åºï¼Œæˆ–é€šè¿‡ Github Packages å‘å¸ƒï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># push to Github Packages</span></span>
<span class="line"><span style="color:#61AFEF;">ecli</span><span style="color:#98C379;"> push</span><span style="color:#98C379;"> https://ghcr.io/eunomia-bpf/sigsnoop:latest</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># pull from Github Packages</span></span>
<span class="line"><span style="color:#61AFEF;">ecli</span><span style="color:#98C379;"> pull</span><span style="color:#98C379;"> https://ghcr.io/eunomia-bpf/sigsnoop:latest</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># run eBPF program</span></span>
<span class="line"><span style="color:#61AFEF;">ecli</span><span style="color:#98C379;"> run</span><span style="color:#98C379;"> https://ghcr.io/eunomia-bpf/sigsnoop:latest</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>åç»­æ›´æ–°è®¡åˆ’ï¼š <ul><li>ç»§ç»­å®Œå–„å¤šç§è¯­è¨€æ”¯æŒï¼›</li><li>æ”¯æŒæ›´å®Œå–„çš„ eBPF ç‰¹æ€§ï¼›</li><li>æ¢ç´¢æ›´å¤šçš„åº”ç”¨åœºæ™¯ï¼›</li></ul></li></ul><h1 id="napi-rsçš„ä½¿ç”¨" tabindex="-1">napi-rsçš„ä½¿ç”¨ <a class="header-anchor" href="#napi-rsçš„ä½¿ç”¨" aria-label="Permalink to &quot;napi-rsçš„ä½¿ç”¨&quot;">â€‹</a></h1><p>napi-rsæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºåœ¨Rustä¸­æ„å»ºé¢„ç¼–è¯‘çš„Node.jsæ’ä»¶ã€‚å¦‚æœä½ å‘ç°ä½¿ç”¨wasm-bindgenå¤ªå¤æ‚è€Œæ— æ³•ä½¿ç”¨ï¼Œå¹¶ä¸”åªæƒ³ç¼–å†™Node.jsçš„ä¸œè¥¿ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚è¦ä½¿ç”¨å®ƒã€‚å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥å®‰è£…å®ƒ(éœ€è¦npmæˆ–å®ƒçš„æ›¿ä»£å“)ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> install</span><span style="color:#D19A66;"> -g</span><span style="color:#98C379;"> @napi-rs/cli</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å®‰è£…å®Œæˆåï¼Œå°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºæ–°çš„napié¡¹ç›®äº†ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">napi</span><span style="color:#98C379;"> new</span><span style="color:#98C379;"> wasm-example-3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>napi-rsç¡®å®å¸¦æ¥äº†ä¸€äº›ä»£ç çš„å˜åŒ–ï¼Œä½ å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°ï¼šæˆ‘ä»¬æœ€ç»ˆå¯ä»¥æ‘†è„±â€œextern Câ€å—ï¼Œè€Œæ˜¯ä½¿ç”¨napiçš„bindgen_preludeæ¥åŒ…å«æˆ‘ä»¬éœ€è¦çš„ä»»ä½•ä¸œè¥¿ã€‚</p><div class="language-rust line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> napi</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">bindgen_prelude</span><span style="color:#ABB2BF;">::*;</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> image</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">io</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Reader</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> image</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">ImageFormat</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> image</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">ImageOutputFormat</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">use</span><span style="color:#E5C07B;"> std</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">io</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Cursor</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[macro_use]</span></span>
<span class="line"><span style="color:#C678DD;">extern</span><span style="color:#C678DD;"> crate</span><span style="color:#ABB2BF;"> napi_derive;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">#[napi]</span></span>
<span class="line"><span style="color:#C678DD;">pub</span><span style="color:#C678DD;"> fn</span><span style="color:#61AFEF;"> convert_image</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">buffer</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Buffer</span><span style="color:#ABB2BF;">) -&gt; </span><span style="color:#E5C07B;">Result</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">Buffer</span><span style="color:#ABB2BF;">&gt; {</span></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> bytes</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Vec</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">u8</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> buffer</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">into</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#E06C75;"> img2</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Reader</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Cursor</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">bytes</span><span style="color:#ABB2BF;">)).</span><span style="color:#61AFEF;">with_guessed_format</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">decode</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    let</span><span style="color:#C678DD;"> mut</span><span style="color:#E06C75;"> new_vec</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">Vec</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">u8</span><span style="color:#ABB2BF;">&gt; </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> Vec</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;">    img2</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">write_to</span><span style="color:#ABB2BF;">(&amp;</span><span style="color:#C678DD;">mut</span><span style="color:#E5C07B;"> Cursor</span><span style="color:#ABB2BF;">::</span><span style="color:#61AFEF;">new</span><span style="color:#ABB2BF;">(&amp;</span><span style="color:#C678DD;">mut</span><span style="color:#E06C75;"> new_vec</span><span style="color:#ABB2BF;">), </span><span style="color:#E5C07B;">ImageFormat</span><span style="color:#ABB2BF;">::</span><span style="color:#E5C07B;">Jpeg</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">unwrap</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">    Ok</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">new_vec</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">into</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š</p><ul><li>æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨â€œextern Câ€æ‰‹åŠ¨å¯¼å…¥ä»»ä½•ä¸œè¥¿</li><li>æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä½¿ç”¨Node.jså†…éƒ¨ç»„ä»¶</li></ul><p>å½“ç„¶ï¼Œå°½ç®¡æœ‰è¿™äº›ä¼˜ç‚¹ï¼Œä½†æ˜¯napi-rsåªä¸Node.jså…¼å®¹ï¼ŒåŒæ—¶è¿˜éœ€è¦ä½¿ç”¨Nodeç”Ÿæ€ç³»ç»Ÿæ¥æ›´æ–°CLIï¼Œä»rustä¼˜å…ˆçš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç‚¹å¥‡æ€ªçš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œnapi-rsæ˜¯ç”¨Rustå¼€å§‹ç¼–å†™Node.jsçš„ä¸€ç§éå¸¸ç®€å•çš„æ–¹æ³•ã€‚å¦‚æœè¦ä¸ºæµè§ˆå™¨ç¼–å†™ä¸€äº›é€šç”¨WASMä»£ç ï¼Œè¿˜æ˜¯éœ€è¦ä½¿ç”¨wasm-packæˆ–wasm-bindgenã€‚</p><h1 id="emsdk-emscripten-åº“çš„ä½¿ç”¨" tabindex="-1">emsdk(Emscripten)åº“çš„ä½¿ç”¨ <a class="header-anchor" href="#emsdk-emscripten-åº“çš„ä½¿ç”¨" aria-label="Permalink to &quot;emsdk(Emscripten)åº“çš„ä½¿ç”¨&quot;">â€‹</a></h1><h2 id="åœ¨æµè§ˆå™¨å†…å®ç°å…‰çº¿è¿½è¸ª" tabindex="-1">åœ¨æµè§ˆå™¨å†…å®ç°å…‰çº¿è¿½è¸ª <a class="header-anchor" href="#åœ¨æµè§ˆå™¨å†…å®ç°å…‰çº¿è¿½è¸ª" aria-label="Permalink to &quot;åœ¨æµè§ˆå™¨å†…å®ç°å…‰çº¿è¿½è¸ª&quot;">â€‹</a></h2><p><a href="https://juejin.cn/post/7363164003138797605" target="_blank" rel="noreferrer">juejin.cn/post/7363164003138797605</a></p><h1 id="wasmtimeåº“çš„ä½¿ç”¨" tabindex="-1">Wasmtimeåº“çš„ä½¿ç”¨ <a class="header-anchor" href="#wasmtimeåº“çš„ä½¿ç”¨" aria-label="Permalink to &quot;Wasmtimeåº“çš„ä½¿ç”¨&quot;">â€‹</a></h1><p>GitHubï¼š<a href="https://github.com/bytecodealliance/wasmtime" target="_blank" rel="noreferrer">https://github.com/bytecodealliance/wasmtime</a></p><p>å®˜ç½‘ï¼š<a href="https://wasmtime.dev/" target="_blank" rel="noreferrer">https://wasmtime.dev/</a></p><p>Wasmtime æ˜¯ä¸€ä¸ªç”¨äºWebAssemblyï¼ˆç®€ç§°WASMï¼‰çš„ç‹¬ç«‹è¿è¡Œæ—¶ï¼Œå®ƒç”±Bytecode Allianceé¡¹ç›®å¼€å‘ã€‚WASMæ˜¯ä¸€ç§ä¸ºæ›´é«˜æ•ˆæ‰§è¡Œå’Œæ›´å®‰å…¨çš„Webåº”ç”¨è€Œè®¾è®¡çš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ã€‚Wasmtimeè¿è¡Œæ—¶ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç³»åˆ—ä¸°å¯Œã€ç¬¦åˆWASMæ ‡å‡†çš„APIï¼Œå¹¶é€šè¿‡ä¼˜åŒ–ç”Ÿæˆé«˜è´¨é‡çš„æœºå™¨ä»£ç ï¼Œä½¿WASMåº”ç”¨èƒ½åœ¨å„ç§ç¯å¢ƒä¸­å¿«é€Ÿã€å®‰å…¨åœ°è¿è¡Œã€‚</p><h2 id="å®‰è£…ä¸ä½¿ç”¨wasmtimeè¿è¡Œæ—¶" tabindex="-1">å®‰è£…ä¸ä½¿ç”¨Wasmtimeè¿è¡Œæ—¶ <a class="header-anchor" href="#å®‰è£…ä¸ä½¿ç”¨wasmtimeè¿è¡Œæ—¶" aria-label="Permalink to &quot;å®‰è£…ä¸ä½¿ç”¨Wasmtimeè¿è¡Œæ—¶&quot;">â€‹</a></h2><p>æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹ç®€å•çš„å®‰è£…è„šæœ¬åœ¨Linuxå’ŒmacOSä¸Šå®‰è£…Wasmtime CLIï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">curl</span><span style="color:#98C379;"> https://wasmtime.dev/install.sh</span><span style="color:#D19A66;"> -sSf</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">bash</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>å¯¹äºWindowsç”¨æˆ·æˆ–å…¶ä»–æ„Ÿå…´è¶£çš„ç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥ä»GitHubçš„Releasesé¡µé¢ä¸‹è½½å®‰è£…ç¨‹åºå’ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>å®‰è£…å®ŒWasmtimeåï¼Œå¦‚æœæ‚¨å·²ç»å®‰è£…äº†Rustç¼–è¯‘å™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤æ¥ç¼–è¯‘å’Œè¿è¡ŒRustæºä»£ç ï¼š</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">//</span><span style="color:#98C379;"> Rustæºä»£ç </span></span>
<span class="line"><span style="color:#61AFEF;">fn</span><span style="color:#98C379;"> main</span><span style="color:#ABB2BF;">() </span><span style="color:#98C379;">{</span></span>
<span class="line"><span style="color:#61AFEF;">    println!(</span><span style="color:#61AFEF;">&quot;Hello, world!&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"><span style="color:#61AFEF;">//</span><span style="color:#98C379;"> ç¼–è¯‘å’Œè¿è¡Œå‘½ä»¤</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> rustup</span><span style="color:#98C379;"> target</span><span style="color:#98C379;"> add</span><span style="color:#98C379;"> wasm32-wasi</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> rustc</span><span style="color:#98C379;"> hello.rs</span><span style="color:#D19A66;"> --target</span><span style="color:#98C379;"> wasm32-wasi</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> wasmtime</span><span style="color:#98C379;"> hello.wasm</span></span>
<span class="line"><span style="color:#61AFEF;">//</span><span style="color:#98C379;"> è¾“å‡ºï¼šHello,</span><span style="color:#98C379;"> world!</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å°†Rustæºä»£ç ç¼–è¯‘ä¸ºWASMï¼Œå¹¶ä½¿ç”¨Wasmtimeè¿è¡Œå®ƒã€‚</p><h2 id="wasmtimeçš„ä¸»è¦ç‰¹æ€§" tabindex="-1">Wasmtimeçš„ä¸»è¦ç‰¹æ€§ <a class="header-anchor" href="#wasmtimeçš„ä¸»è¦ç‰¹æ€§" aria-label="Permalink to &quot;Wasmtimeçš„ä¸»è¦ç‰¹æ€§&quot;">â€‹</a></h2><ul><li><strong>é€Ÿåº¦å¿«</strong>ï¼šWasmtimeåŸºäºä¼˜åŒ–çš„Craneliftä»£ç ç”Ÿæˆå™¨æ„å»ºï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆé«˜è´¨é‡çš„æœºå™¨ä»£ç ã€‚Wasmtimeé’ˆå¯¹æœ‰æ•ˆå®ä¾‹åŒ–ã€åµŒå…¥è€…å’Œwasmä¹‹é—´çš„ä½å¼€é”€è°ƒç”¨ä»¥åŠå¹¶å‘å®ä¾‹çš„å¯æ‰©å±•æ€§è¿›è¡Œä¼˜åŒ–ã€‚</li><li><strong>å®‰å…¨</strong>ï¼šWasmtimeçš„å¼€å‘å¼ºçƒˆä¸“æ³¨äºæ­£ç¡®æ€§å’Œå®‰å…¨æ€§ã€‚æ¯ä¸ªWasmtimeç‰¹æ€§éƒ½é€šè¿‡ä»”ç»†çš„å®¡æŸ¥å’Œè€ƒè™‘é€šè¿‡RFCè¿‡ç¨‹ã€‚ä¸€æ—¦ç‰¹æ€§è¢«è®¾è®¡å’Œå®ç°ï¼Œä»–ä»¬å°±ä¼šç»å—Googleçš„OSS Fuzzæä¾›çš„24/7æ¨¡ç³Šæµ‹è¯•ã€‚éšç€ç‰¹æ€§çš„ç¨³å®šï¼Œä»–ä»¬æˆä¸ºç‰ˆæœ¬å‘å¸ƒçš„ä¸€éƒ¨åˆ†ï¼Œå½“äº‹æƒ…å‡ºé”™æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ˜ç¡®çš„å®‰å…¨ç­–ç•¥æ¥å¿«é€Ÿç¼“è§£å¹¶ä¿®å¤ä»»ä½•é—®é¢˜ã€‚æˆ‘ä»¬éµå¾ªæ·±åº¦é˜²å¾¡çš„æœ€ä½³å®è·µï¼Œå¹¶é›†æˆé’ˆå¯¹åƒSpectreè¿™æ ·çš„é—®é¢˜çš„ä¿æŠ¤å’Œç¼“è§£æªæ–½ã€‚</li><li><strong>å¯é…ç½®</strong>ï¼šWasmtimeä½¿ç”¨åˆç†çš„é»˜è®¤è®¾ç½®ï¼Œä½†ä¹Ÿå¯ä»¥é…ç½®æä¾›å¯¹CPUå’Œå†…å­˜æ¶ˆè€—ç­‰æ–¹é¢çš„æ›´ç²¾ç»†æ§åˆ¶ã€‚</li></ul><p>Wasmtimeè¿˜æä¾›äº†è®¸å¤šè¯­è¨€æ”¯æŒã€‚</p><p>Bytecode Allianceæ”¯æŒçš„è¯­è¨€åŒ…æ‹¬Rustï¼ˆwasmtime crateï¼‰ã€Cï¼ˆwasm.hã€wasi.hã€wasmtime.hå¤´æ–‡ä»¶ï¼‰ã€C++ï¼ˆwasmtime-cppåº“ï¼‰ã€Pythonï¼ˆwasmtime PyPIåŒ…ï¼‰ã€.NETï¼ˆWasmtime NuGetåŒ…ï¼‰ã€Goï¼ˆwasmtime-goåº“ï¼‰å’ŒRubyï¼ˆwasmtimeå®çŸ³ï¼‰ã€‚ç¤¾åŒºè¿˜æ”¯æŒäº†Elixirï¼ˆwasmex hexåŒ…ï¼‰å’ŒPerlï¼ˆWasm PerlåŒ…çš„Wasm::Wasmtimeï¼‰ã€‚</p><h1 id="å‰ç«¯åŠ å¯†å®è·µ-åˆ©ç”¨rustä¸webassemblyå°è£…å®‰å…¨çš„åŠ å¯†å·¥å…·" tabindex="-1">å‰ç«¯åŠ å¯†å®è·µï¼šåˆ©ç”¨Rustä¸WebAssemblyå°è£…å®‰å…¨çš„åŠ å¯†å·¥å…· <a class="header-anchor" href="#å‰ç«¯åŠ å¯†å®è·µ-åˆ©ç”¨rustä¸webassemblyå°è£…å®‰å…¨çš„åŠ å¯†å·¥å…·" aria-label="Permalink to &quot;å‰ç«¯åŠ å¯†å®è·µï¼šåˆ©ç”¨Rustä¸WebAssemblyå°è£…å®‰å…¨çš„åŠ å¯†å·¥å…·&quot;">â€‹</a></h1><p>åœ¨å½“å‰æ—¥ç›Šé‡è§†æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤çš„æ—¶ä»£ï¼Œå‰ç«¯åº”ç”¨ä¸­æ•°æ®çš„å®‰å…¨ä¼ è¾“å’Œå­˜å‚¨æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä¸€ä¸ªå…³äºä½¿ç”¨Rustè¯­è¨€ç»“åˆWebAssemblyï¼ˆWASMï¼‰æŠ€æœ¯ï¼Œåœ¨å‰ç«¯ç¯å¢ƒä¸­å®ç°é«˜æ•ˆä¸”å®‰å…¨çš„åŠ å¯†åŠŸèƒ½çš„è°ƒç ”ä¸å®è·µè¿‡ç¨‹ã€‚</p><h2 id="ä¸€-èƒŒæ™¯çŸ¥è¯†ä»‹ç»åŠç›®æ ‡" tabindex="-1">ä¸€ï¼èƒŒæ™¯çŸ¥è¯†ä»‹ç»åŠç›®æ ‡ <a class="header-anchor" href="#ä¸€-èƒŒæ™¯çŸ¥è¯†ä»‹ç»åŠç›®æ ‡" aria-label="Permalink to &quot;ä¸€ï¼èƒŒæ™¯çŸ¥è¯†ä»‹ç»åŠç›®æ ‡&quot;">â€‹</a></h2><p>å‰ç«¯åŠ å¯†æŠ€æœ¯</p><p>å‰ç«¯åŠ å¯†æŠ€æœ¯æ˜¯æŒ‡åœ¨å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰æ‰§è¡ŒåŠ å¯†æ“ä½œçš„æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯å…è®¸æ•°æ®åœ¨å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰è¿›è¡ŒåŠ å¯†ï¼Œä»è€Œå¢å¼ºäº†æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§ä¿æŠ¤ã€‚å‰ç«¯åŠ å¯†æŠ€æœ¯é€šå¸¸ä½¿ç”¨JavaScriptæ¥å®ç°ï¼Œä½†è¿‘å¹´æ¥ï¼Œéšç€WebAssemblyï¼ˆWasmï¼‰çš„å‘å±•ï¼Œå‰ç«¯åŠ å¯†æ€§èƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚</p><p>å‰ç«¯åŠ å¯†æŠ€æœ¯ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p><p>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼šå¦‚AESï¼ˆé«˜çº§åŠ å¯†æ ‡å‡†ï¼‰ã€‚è¿™ç§ç®—æ³•ä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚æ•°æ®çš„å®‰å…¨æ€§ä¾èµ–äºå¯†é’¥çš„ä¿å¯†æ€§ã€‚AESç®—æ³•åœ¨å‰ç«¯åŠ å¯†ä¸­å¹¿æ³›ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ—¢å®‰å…¨åˆé«˜æ•ˆï¼›éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼šå¦‚RSAã€‚è¿™ç§ç®—æ³•ä½¿ç”¨ä¸€å¯¹å¯†é’¥ï¼Œä¸€ä¸ªç”¨äºåŠ å¯†ï¼ˆå…¬é’¥ï¼‰ï¼Œå¦ä¸€ä¸ªç”¨äºè§£å¯†ï¼ˆç§é’¥ï¼‰ã€‚å…¬é’¥å¯ä»¥å…¬å¼€ï¼Œè€Œç§é’¥å¿…é¡»ä¿å¯†ã€‚éå¯¹ç§°åŠ å¯†ç®—æ³•åœ¨æ•°å­—ç­¾åå’Œå¯†é’¥äº¤æ¢ç­‰åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ï¼›å“ˆå¸Œç®—æ³•ï¼šå¦‚MD5å’ŒSHA-256ã€‚è¿™äº›ç®—æ³•å°†ä»»æ„é•¿åº¦çš„æ•°æ®æ˜ å°„ä¸ºå›ºå®šé•¿åº¦çš„å“ˆå¸Œå€¼ã€‚å“ˆå¸Œç®—æ³•æ˜¯ä¸å¯é€†çš„ï¼Œå³æ— æ³•é€šè¿‡å“ˆå¸Œå€¼è¿˜åŸåŸå§‹æ•°æ®ã€‚å“ˆå¸Œç®—æ³•å¸¸ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œç”Ÿæˆæ•°å­—ç­¾åã€‚</p><p>åœ¨å‰ç«¯åŠ å¯†ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘ä¸€äº›é¢å¤–çš„å› ç´ ï¼Œå¦‚åŠ å¯†æ€§èƒ½ã€æµè§ˆå™¨å…¼å®¹æ€§ä»¥åŠåŠ å¯†å¯†é’¥çš„ç®¡ç†ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¼€å‘è€…é€šå¸¸ä¼šä½¿ç”¨ä¸€äº›ä¸“é—¨çš„åŠ å¯†åº“ï¼Œå¦‚crypto-jsï¼Œè¿™äº›åº“æä¾›äº†ä¸°å¯Œçš„åŠ å¯†åŠŸèƒ½ï¼Œå¹¶ä¸”é’ˆå¯¹Webç¯å¢ƒè¿›è¡Œäº†ä¼˜åŒ–ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å‰ç«¯åŠ å¯†å¯ä»¥å¢å¼ºæ•°æ®çš„å®‰å…¨æ€§ï¼Œä½†å®ƒå¹¶ä¸èƒ½å®Œå…¨é˜²æ­¢æ•°æ®æ³„éœ²ã€‚å› æ­¤ï¼Œåœ¨åç«¯ä¹Ÿéœ€è¦é‡‡å–ç›¸åº”çš„å®‰å…¨æªæ–½æ¥ä¿æŠ¤æ•°æ®ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå‰ç«¯åŠ å¯†é€šå¸¸ä¸å…¶ä»–å®‰å…¨æœºåˆ¶ï¼ˆå¦‚HTTPSã€è®¿é—®æ§åˆ¶ç­‰ï¼‰ç»“åˆä½¿ç”¨ï¼Œä»¥æä¾›æ›´å…¨é¢çš„æ•°æ®ä¿æŠ¤ã€‚</p><h3 id="aesåŠ å¯†" tabindex="-1">AESåŠ å¯† <a class="header-anchor" href="#aesåŠ å¯†" aria-label="Permalink to &quot;AESåŠ å¯†&quot;">â€‹</a></h3><p>AESåŠ å¯†æœ‰AES-128ã€AES-192ã€AES-256ä¸‰ç§ï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ç§å¯†é’¥é•¿åº¦128bitsï¼ˆ16å­—èŠ‚ï¼‰ã€192bitsï¼ˆ24å­—èŠ‚ï¼‰ã€256bitsï¼ˆ32å­—èŠ‚ï¼‰ã€‚å½“ç„¶ï¼Œå¯†é’¥è¶Šé•¿ï¼Œå®‰å…¨æ€§è¶Šé«˜ï¼ŒåŠ è§£å¯†èŠ±è´¹æ—¶é—´ä¹Ÿè¶Šé•¿ã€‚é»˜è®¤çš„æ˜¯ AES-128ï¼Œå…¶å®‰å…¨æ€§å®Œå…¨å¤Ÿç”¨ã€‚</p><p>AES ç®—æ³•ä¸ºæœ€å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•(å¾®ä¿¡å°ç¨‹åºåŠ å¯†ä¼ è¾“å°±æ˜¯ç”¨è¿™ä¸ªåŠ å¯†ç®—æ³•çš„)ã€‚å¯¹ç§°åŠ å¯†ç®—æ³•ä¹Ÿå°±æ˜¯åŠ å¯†å’Œè§£å¯†ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œå…·ä½“çš„åŠ å¯†æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="`+o+'" alt="image-20240506193601784"></p><p>AESæœ‰äº”ç§åŠ å¯†æ¨¡å¼ï¼ˆCBCã€ECBã€CTRã€OCFã€CFBï¼‰ï¼Œåˆ†ç»„å¯†ç æœ‰äº”ç§å·¥ä½œä½“åˆ¶ï¼š</p><p>1.ç”µç æœ¬æ¨¡å¼ï¼ˆElectronic Codebook Book (ECB)ï¼‰ï¼›</p><p>2.å¯†ç åˆ†ç»„é“¾æ¥æ¨¡å¼ï¼ˆCipher Block Chaining (CBC)ï¼‰ï¼›</p><p>3.è®¡ç®—å™¨æ¨¡å¼ï¼ˆCounter (CTR)ï¼‰ï¼›</p><p>4.å¯†ç åé¦ˆæ¨¡å¼ï¼ˆCipher FeedBack (CFB)ï¼‰ï¼›</p><p>5.è¾“å‡ºåé¦ˆæ¨¡å¼ï¼ˆOutput FeedBack (OFB)ï¼‰ã€‚</p><h3 id="webassembly" tabindex="-1">WebAssembly <a class="header-anchor" href="#webassembly" aria-label="Permalink to &quot;WebAssembly&quot;">â€‹</a></h3><p>WebAssemblyï¼ˆç®€ç§°Wasmï¼‰æ˜¯ä¸€ç§ä¸ºæµè§ˆå™¨è®¾è®¡çš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼ï¼Œå®ƒä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå°†ä»¥å…¶ä»–è¯­è¨€ï¼ˆå¦‚Cã€C++ã€Rustç­‰ï¼‰ç¼–å†™çš„ä»£ç ç¼–è¯‘æˆWebAssemblyæ ¼å¼ï¼Œç„¶ååœ¨ç°ä»£ç½‘ç»œæµè§ˆå™¨ä¸­é«˜æ•ˆã€å®‰å…¨åœ°è¿è¡Œã€‚WebAssemblyçš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†è§£å†³JavaScriptåœ¨æ€§èƒ½ä¸Šçš„ç“¶é¢ˆï¼ŒåŒæ—¶ä¿æŒä¸Webå¹³å°çš„å…¼å®¹æ€§ã€‚</p><p>WebAssemblyçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><p>é«˜æ•ˆæ€§ï¼šWebAssemblyä»£ç æ¥è¿‘åŸç”Ÿåº”ç”¨çš„è¿è¡Œé€Ÿåº¦ï¼Œå¯ä»¥åœ¨ä¸åŒçš„å¹³å°ä¸Šä»¥æ¥è¿‘æœ¬åœ°é€Ÿåº¦è¿è¡Œï¼Œä»è€Œæå‡äº†åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>å®‰å…¨æ€§ï¼šWebAssemblyè¢«é™åˆ¶åœ¨ä¸€ä¸ªå®‰å…¨çš„æ²™ç®±æ‰§è¡Œç¯å¢ƒä¸­ï¼Œéµå¾ªæµè§ˆå™¨çš„åŒæºç­–ç•¥å’Œæˆæƒç­–ç•¥ï¼Œç¡®ä¿äº†ä»£ç çš„å®‰å…¨è¿è¡Œã€‚</p><p>å¯ç§»æ¤æ€§ï¼šWebAssemblyæ˜¯ä¸€ç§å¼€æ”¾çš„ã€ä¸å¹³å°æ— å…³çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æµè§ˆå™¨å’Œå¹³å°ä¸Šè¿è¡Œï¼Œæ— éœ€è¿›è¡Œé¢å¤–çš„ä¿®æ”¹ã€‚</p><p>å…¼å®¹æ€§ï¼šWebAssemblyè®¾è®¡ä¸ºä¸ç°æœ‰çš„WebæŠ€æœ¯æ— ç¼é›†æˆï¼Œå¯ä»¥åµŒå…¥åˆ°JavaScriptä»£ç ä¸­ï¼Œæˆ–è€…ä½œä¸ºç‹¬ç«‹çš„æ¨¡å—è¿è¡Œã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æ”¯æŒä¸å…¶ä»–ç½‘ç»œæŠ€æœ¯çš„å’Œè°å…±å¤„ï¼Œä¿æŒå‘åå…¼å®¹ã€‚</p><p>WebAssemblyçš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºåœ¨çº¿æ¸¸æˆã€è§†é¢‘ä¸éŸ³é¢‘ç¼–è§£ç å™¨ã€å®šåˆ¶åŒ–çš„æ•°æ®å‹ç¼©ã€3Dæ¨¡å‹æ¸²æŸ“ã€åª’ä½“ç¼–è¾‘å·¥å…·ã€è¯­éŸ³åˆæˆä¸è¯­éŸ³è¯†åˆ«ã€å®¢æˆ·ç«¯çš„è®¡ç®—æœºè§†è§‰ç­‰ã€‚æ­¤å¤–ï¼ŒWebAssemblyè¿˜å¯ä»¥ç”¨äºæœåŠ¡ç«¯æ‰§è¡Œä¸å¯ä¿¡ä»»çš„ä»£ç ï¼Œå¦‚æœåŠ¡ç«¯åº”ç”¨ã€ç§»åŠ¨æ··åˆåŸç”Ÿåº”ç”¨ç­‰ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒWebAssemblyä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§æ–°çš„æ–¹å¼æ¥æå‡Webåº”ç”¨çš„æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œä½¿å¾—æ›´å¤šçš„é«˜çº§è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨Webå¹³å°ä¸Šé«˜æ•ˆè¿è¡Œã€‚</p><h3 id="rustè¯­è¨€" tabindex="-1">Rustè¯­è¨€ <a class="header-anchor" href="#rustè¯­è¨€" aria-label="Permalink to &quot;Rustè¯­è¨€&quot;">â€‹</a></h3><p>Rustæ˜¯ä¸€ç§ç°ä»£çš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ï¼Œç”±Mozillaä¸»å¯¼å¼€å‘å¹¶äº2010å¹´é¦–æ¬¡å‘å¸ƒã€‚Rustçš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†å…‹æœC++ç­‰ä¼ ç»Ÿç³»ç»Ÿçº§è¯­è¨€ä¸­å¸¸è§çš„å†…å­˜å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶åˆä¸ç‰ºç‰²æ€§èƒ½ã€‚Rustçš„æ ¸å¿ƒç†å¿µåœ¨äºæä¾›â€œé›¶å¼€é”€æŠ½è±¡â€ï¼Œè¿™æ„å‘³ç€ç¨‹åºå‘˜å¯ä»¥åœ¨äº«å—é«˜çº§åˆ«æŠ½è±¡å¸¦æ¥çš„ä¾¿åˆ©çš„åŒæ—¶ï¼Œè¿˜èƒ½ä¿æŒæ¥è¿‘Cæˆ–C++çš„è¿è¡Œé€Ÿåº¦ã€‚</p><h3 id="rustä¸åŠ å¯†å®‰å…¨æ€§" tabindex="-1">Rustä¸åŠ å¯†å®‰å…¨æ€§ <a class="header-anchor" href="#rustä¸åŠ å¯†å®‰å…¨æ€§" aria-label="Permalink to &quot;Rustä¸åŠ å¯†å®‰å…¨æ€§&quot;">â€‹</a></h3><p>åœ¨åŠ å¯†é¢†åŸŸï¼ŒRustçš„é‡è¦æ€§ä½“ç°åœ¨å…¶ä¸¥æ ¼çš„å†…å­˜ç®¡ç†æ¨¡å‹ä¸Šã€‚Rusté€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿå’Œå€Ÿç”¨ checker æœºåˆ¶æœ‰æ•ˆåœ°é¢„é˜²äº†è¯¸å¦‚ç¼“å†²åŒºæº¢å‡ºã€ç©ºæŒ‡é’ˆè§£å¼•ç”¨ã€æ•°æ®ç«äº‰ç­‰å†…å­˜é”™è¯¯ï¼Œè¿™ç±»é”™è¯¯åœ¨å¤„ç†æ•æ„Ÿä¿¡æ¯å¦‚å¯†é’¥å’ŒåŠ å¯†æ•°æ®æ—¶å¯èƒ½å¯¼è‡´ä¸¥é‡çš„å®‰å…¨æ¼æ´ã€‚å› æ­¤ï¼Œä½¿ç”¨Rustå¼€å‘åŠ å¯†åº“èƒ½å¤Ÿæå¤§åœ°æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œå‡å°‘å› ç¼–ç¨‹é”™è¯¯å¼•å‘çš„å®‰å…¨é£é™©ã€‚</p><h3 id="é«˜æ€§èƒ½åŠ å¯†" tabindex="-1">é«˜æ€§èƒ½åŠ å¯† <a class="header-anchor" href="#é«˜æ€§èƒ½åŠ å¯†" aria-label="Permalink to &quot;é«˜æ€§èƒ½åŠ å¯†&quot;">â€‹</a></h3><p>Rustæ”¯æŒæ— åƒåœ¾å›æ”¶çš„å†…å­˜ç®¡ç†ï¼Œå…è®¸å¼€å‘è€…ç›´æ¥æ“ä½œå†…å­˜ï¼Œè¿™å¯¹äºåŠ å¯†ç®—æ³•å®ç°ä¸­çš„å¯†é›†è®¡ç®—å’Œä½å»¶è¿Ÿåœºæ™¯è‡³å…³é‡è¦ã€‚Rustç¼–è¯‘å™¨å¯ä»¥ç”Ÿæˆé«˜æ•ˆçš„æœ¬æœºä»£ç ï¼Œä»è€Œè®©åŠ å¯†ç®—æ³•åœ¨è¿è¡Œæ—¶è¾¾åˆ°æ¥è¿‘Cè¯­è¨€çš„æ€§èƒ½æ°´å¹³ã€‚</p><h3 id="å¹¶å‘å®‰å…¨" tabindex="-1">å¹¶å‘å®‰å…¨ <a class="header-anchor" href="#å¹¶å‘å®‰å…¨" aria-label="Permalink to &quot;å¹¶å‘å®‰å…¨&quot;">â€‹</a></h3><p>Rustå¼ºè°ƒå¹¶å‘å®‰å…¨ï¼Œå…¶è¯­è¨€ç‰¹æ€§ç¡®ä¿äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚åŠ å¯†åº“å¸¸å¸¸éœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å·¥ä½œï¼Œå¦‚å¤„ç†å¤§é‡å¹¶å‘åŠ å¯†è¯·æ±‚ï¼Œæ­¤æ—¶Rustæä¾›çš„å¼ºå¤§å¹¶å‘æ§åˆ¶å·¥å…·å¯ä»¥æœ‰æ•ˆé˜²æ­¢æ•°æ®ç«äº‰å’Œå…¶ä»–å¹¶å‘ç›¸å…³çš„bugã€‚</p><h2 id="äºŒã€é¡¹ç›®å®æ–½æ­¥éª¤" tabindex="-1">äºŒã€é¡¹ç›®å®æ–½æ­¥éª¤ <a class="header-anchor" href="#äºŒã€é¡¹ç›®å®æ–½æ­¥éª¤" aria-label="Permalink to &quot;äºŒã€é¡¹ç›®å®æ–½æ­¥éª¤&quot;">â€‹</a></h2><ol><li>é€‰æ‹©ä¸å¼€å‘RuståŠ å¯†åº“ï¼šé¦–å…ˆé€‰å®šmagiccryptoè¿™æ ·çš„å¯ä¿¡åŠ å¯†åº“ä½œä¸ºåŸºç¡€æ”¯æŒï¼ŒåŸºäºæ­¤å¼€å‘ä¸€ä¸ªä¸“é—¨é’ˆå¯¹AESåŠ å¯†/è§£å¯†æ“ä½œçš„æ¨¡å—ã€‚</li><li>Ruståˆ°WebAssemblyçš„ç¼–è¯‘ï¼šä½¿ç”¨wasm-packç­‰å·¥å…·å°†RuståŠ å¯†æ¨¡å—ç¼–è¯‘æˆWebAssemblyæ¨¡å—ï¼Œç¡®ä¿ç”Ÿæˆçš„.wasmæ–‡ä»¶å¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å®‰å…¨ã€é«˜æ•ˆåœ°è¿è¡Œã€‚</li><li>JavaScriptæ¥å£å°è£…ï¼šåˆ›å»ºJavaScriptå±‚é€‚é…ä»£ç ï¼Œå€ŸåŠ©WebAssemblyçš„å¯¼å…¥å¯¼å‡ºæœºåˆ¶ï¼Œå°†RuståŠ å¯†APIæš´éœ²ç»™JavaScriptè°ƒç”¨ï¼Œå®ç°ä¸¤è€…ä¹‹é—´çš„æ— ç¼é›†æˆã€‚</li><li>å‰ç«¯é¡¹ç›®çš„é›†æˆï¼šåœ¨å®é™…å‰ç«¯åº”ç”¨ä¸­å¼•å…¥ç¼–è¯‘å¥½çš„WebAssemblyåŠ å¯†æ¨¡å—ï¼Œå¹¶ç¼–å†™ç›¸å…³ä¸šåŠ¡é€»è¾‘ä»¥å®ç°åœ¨ç”¨æˆ·ç™»å½•å¯†ç åŠ å¯†ã€æ•æ„Ÿä¿¡æ¯ä¼ è¾“åŠ å¯†ç­‰åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚</li></ol><h2 id="ä¸‰ã€å®è·µç»†èŠ‚ä¸æŒ‘æˆ˜" tabindex="-1">ä¸‰ã€å®è·µç»†èŠ‚ä¸æŒ‘æˆ˜ <a class="header-anchor" href="#ä¸‰ã€å®è·µç»†èŠ‚ä¸æŒ‘æˆ˜" aria-label="Permalink to &quot;ä¸‰ã€å®è·µç»†èŠ‚ä¸æŒ‘æˆ˜&quot;">â€‹</a></h2><p>æœ¬æ–‡é‡‡ç”¨rust+wasmçš„æ–¹æ³•åŠ å¯†å‰ç«¯AESç®—æ³•ä¸­çš„keyå’Œivï¼Œé¿å…åœ¨æµè§ˆå™¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­æ˜æ–‡æš´æ¼å‡ºæ¥ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><h3 id="step1-åˆ›å»ºrusté¡¹ç›®" tabindex="-1">Step1 åˆ›å»ºRusté¡¹ç›®ï¼š <a class="header-anchor" href="#step1-åˆ›å»ºrusté¡¹ç›®" aria-label="Permalink to &quot;Step1 åˆ›å»ºRusté¡¹ç›®ï¼š&quot;">â€‹</a></h3><p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://rustwasm.github.io/docs/book/game-of-life/hello-world.html" target="_blank" rel="noreferrer">https://rustwasm.github.io/docs/book/game-of-life/hello-world.html</a></p><p>ç›®å½•å¦‚ä¸‹</p><p><img src="'+r+'" alt="å›¾ç‰‡"></p><h3 id="step2-å®ç°åŠ å¯†é€»è¾‘" tabindex="-1">Step2 å®ç°åŠ å¯†é€»è¾‘ï¼š <a class="header-anchor" href="#step2-å®ç°åŠ å¯†é€»è¾‘" aria-label="Permalink to &quot;Step2 å®ç°åŠ å¯†é€»è¾‘ï¼š&quot;">â€‹</a></h3><p>å¼•å…¥åŠ å¯†åº“MagicCrypt</p><p>MagicCryptåœ°å€ï¼š<a href="https://github.com/magiclen/rust-magiccrypt" target="_blank" rel="noreferrer">https://github.com/magiclen/rust-magiccrypt</a></p><p>MagicCryptæ˜¯ä¸€ä¸ªJava/PHP/NodeJS/Ruståº“ï¼Œç”¨äºä½¿ç”¨æ•°æ®åŠ å¯†æ ‡å‡†ï¼ˆDESï¼‰æˆ–é«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆAESï¼‰ç®—æ³•åŠ å¯†/è§£å¯†å­—ç¬¦ä¸²ã€æ–‡ä»¶æˆ–æ•°æ®ã€‚å®ƒæ”¯æŒCBCåˆ†ç»„å¯†ç æ¨¡å¼ã€PKCS5å¡«å……ä»¥åŠ64ã€128ã€192æˆ–256ä½çš„å¯†é’¥é•¿åº¦ã€‚å¦‚æœåŠ å¯†æ•°æ®æ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†è‡ªåŠ¨æ ¼å¼åŒ–ä¸ºBase64ã€‚</p><p>éœ€è¦è®¾ç½®Rustå¼€å‘ç¯å¢ƒï¼šrustup</p><p><img src="'+t+'" alt="å›¾ç‰‡"></p><p>è°ƒç”¨åŠ å¯†æ–¹æ³•</p><p><img src="'+c+'" alt="å›¾ç‰‡"></p><h3 id="step3-æ‰“åŒ…ä¸ºwebassemblyä¾èµ–æ–‡ä»¶" tabindex="-1">Step3 æ‰“åŒ…ä¸ºWebAssemblyä¾èµ–æ–‡ä»¶ï¼š <a class="header-anchor" href="#step3-æ‰“åŒ…ä¸ºwebassemblyä¾èµ–æ–‡ä»¶" aria-label="Permalink to &quot;Step3 æ‰“åŒ…ä¸ºWebAssemblyä¾èµ–æ–‡ä»¶ï¼š&quot;">â€‹</a></h3><p>wasm-pack build</p><p>è·å¾—pkgæ–‡ä»¶</p><p>Pkgæ–‡ä»¶ç›®å½•å¦‚ä¸‹</p><p><img src="'+i+'" alt="å›¾ç‰‡"></p><h3 id="step4-é›†æˆåˆ°å‰ç«¯é¡¹ç›®" tabindex="-1">Step4 é›†æˆåˆ°å‰ç«¯é¡¹ç›®ï¼š <a class="header-anchor" href="#step4-é›†æˆåˆ°å‰ç«¯é¡¹ç›®" aria-label="Permalink to &quot;Step4 é›†æˆåˆ°å‰ç«¯é¡¹ç›®ï¼š&quot;">â€‹</a></h3><p>å°†ç”Ÿæˆçš„pkgæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å‰ç«¯é¡¹ç›®çš„é€‚å½“è·¯å¾„ä¸‹ã€‚</p><p>åœ¨å‰ç«¯é¡¹ç›®çš„package.jsonæ–‡ä»¶ä¸­æ·»åŠ æŒ‡å‘pkgæ–‡ä»¶å¤¹ä¸­JavaScriptç»‘å®šæ–‡ä»¶çš„å¼•ç”¨ï¼Œå¹¶è¿è¡Œnpm installå®‰è£…æœ¬åœ°ä¾èµ–ã€‚</p><p>åœ¨Viteé…ç½®æ–‡ä»¶vite.config.jsä¸­å¯ç”¨WASMæ’ä»¶ä»¥ä¾¿æ­£ç¡®åŠ è½½å’Œè§£æ.wasmæ–‡ä»¶ï¼š</p><p><img src="'+b+'" alt="å›¾ç‰‡"></p><p>åœ¨package.jsonä¸­è¾“å…¥pkgçš„åœ°å€</p><p><img src="'+B+'" alt="å›¾ç‰‡"></p><p>Npm install</p><p>åœ¨vite.config.jsä¸­å®‰è£…</p><p><img src="'+y+'" alt="å›¾ç‰‡"></p><p><img src="'+u+'" alt="å›¾ç‰‡"></p><h3 id="step5-åœ¨å¯¹åº”åœ°æ–¹å¼•å…¥æ‰€éœ€çš„åŠ å¯†å‡½æ•°" tabindex="-1">Step5 åœ¨å¯¹åº”åœ°æ–¹å¼•å…¥æ‰€éœ€çš„åŠ å¯†å‡½æ•° <a class="header-anchor" href="#step5-åœ¨å¯¹åº”åœ°æ–¹å¼•å…¥æ‰€éœ€çš„åŠ å¯†å‡½æ•°" aria-label="Permalink to &quot;Step5 åœ¨å¯¹åº”åœ°æ–¹å¼•å…¥æ‰€éœ€çš„åŠ å¯†å‡½æ•°&quot;">â€‹</a></h3><p><img src="'+m+'" alt="å›¾ç‰‡"></p><p>å°†éœ€è¦åŠ å¯†çš„å†…å®¹ä¼ å…¥å¼•å…¥çš„å‡½æ•°</p><p>åœ¨é¡µé¢è°ƒç”¨</p><p><img src="'+d+'" alt="å›¾ç‰‡"></p><p><img src="'+F+'" alt="å›¾ç‰‡"></p><p>å³å¯è·å–åŠ å¯†åçš„å†…å®¹</p><p><img src="'+A+'" alt="å›¾ç‰‡"></p><h3 id="step6-å°†åŠ å¯†åçš„å†…å®¹è§£å¯†éªŒè¯" tabindex="-1">Step6 å°†åŠ å¯†åçš„å†…å®¹è§£å¯†éªŒè¯ <a class="header-anchor" href="#step6-å°†åŠ å¯†åçš„å†…å®¹è§£å¯†éªŒè¯" aria-label="Permalink to &quot;Step6 å°†åŠ å¯†åçš„å†…å®¹è§£å¯†éªŒè¯&quot;">â€‹</a></h3><p><img src="'+C+'" alt="å›¾ç‰‡"></p><p>è§£å¯†å¾—åˆ°å‰ç«¯åŠ å¯†ä¹‹å‰çš„å†…å®¹ï¼ŒåŠ å¯†å®è·µæˆåŠŸ</p><p>å°†å‰ç«¯åŠ å¯†ç»“æœå‘ç»™åç«¯ï¼Œåç«¯è§£å¯†æˆåŠŸ</p><p><img src="'+h+'" alt="å›¾ç‰‡"></p><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æˆåŠŸåœ°åœ¨å‰ç«¯ç¯å¢ƒä¸­åˆ©ç”¨Rustå’ŒWebAssemblyçš„ä¼˜åŠ¿ï¼Œæ„å»ºä¸€ä¸ªé«˜æ•ˆã€å®‰å…¨çš„åŠ å¯†è§£å†³æ–¹æ¡ˆï¼Œæå¤§åœ°å¢å¼ºäº†åº”ç”¨ç¨‹åºçš„æ•°æ®å®‰å…¨ä¿éšœèƒ½åŠ›ã€‚åŒæ—¶ï¼Œè¿™ä¸€æ–¹æ¡ˆä¹Ÿå¼ºè°ƒäº†ç»¼åˆè¿ç”¨å¤šç§å®‰å…¨æªæ–½çš„é‡è¦æ€§ï¼ŒåŒ…æ‹¬å‰ç«¯åŠ å¯†ã€HTTPSåè®®ä»¥åŠä¸¥æ ¼çš„åç«¯æ•°æ®ä¿æŠ¤ç­–ç•¥ç­‰ã€‚</p><h1 id="ä¼˜ç§€çš„rust-webassemblyé¡¹ç›®" tabindex="-1">ä¼˜ç§€çš„Rust WebAssemblyé¡¹ç›® <a class="header-anchor" href="#ä¼˜ç§€çš„rust-webassemblyé¡¹ç›®" aria-label="Permalink to &quot;ä¼˜ç§€çš„Rust WebAssemblyé¡¹ç›®&quot;">â€‹</a></h1><p>æ–‡æ¡£ï¼š<a href="https://www.rust-lang.org/zh-CN/what/wasm" target="_blank" rel="noreferrer">https://www.rust-lang.org/zh-CN/what/wasm</a></p><p>ä»¥ä¸‹æ˜¯ä¸€äº›ä¸Rustå’ŒWebAssemblyç›¸å…³çš„ä¼˜ç§€é¡¹ç›®ï¼š</p><ol><li><strong>deno</strong>ï¼šä½œä¸ºNode.jsçš„æ›¿ä»£ï¼Œdenoæ—¨åœ¨ä¸ºTypeScript/Javascriptæä¾›æ›´ç°ä»£ã€æ›´å®‰å…¨ã€æ›´å¼ºå¤§çš„è¿è¡Œæ—¶ã€‚å®ƒå†…ç½®äº†è®¸å¤šå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºæ‰“åŒ…ã€ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ã€æ–‡æ¡£ã€æµ‹è¯•ã€lintç­‰.</li><li><strong>alacritty</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªè·¨å¹³å°ã€åŸºäºOpenGLçš„ç»ˆç«¯ï¼Œæ€§èƒ½æé«˜ä¸”æ”¯æŒè‡ªå®šä¹‰å’Œå¯æ‰©å±•æ€§.</li><li><strong>starship</strong>ï¼šä¸€ä¸ªå‘½ä»¤è¡Œæç¤ºï¼Œæ”¯æŒä»»ä½•shellï¼ŒåŒ…æ‹¬zshã€‚å®ƒç®€å•æ˜“ç”¨ã€éå¸¸å¿«ä¸”é«˜åº¦å¯é…ç½®ï¼ŒåŒæ—¶æ”¯æŒæ™ºèƒ½æç¤º.</li><li><strong>MeiliSearch</strong>ï¼šä¸€ä¸ªè½»é‡çº§æœç´¢å¹³å°ï¼Œç”¨äºç»ˆç«¯ç”¨æˆ·æä¾›è¾¹è¾“å…¥è¾¹æç¤ºçš„å³åˆ»æœç´¢åŠŸèƒ½ã€‚é€‚ç”¨äºç½‘é¡µç«¯æˆ–APPçš„æœç´¢æ¡.</li><li><strong>swc</strong>ï¼šTypescript/Javascriptç¼–è¯‘å™¨ï¼Œç”¨äºç¼–è¯‘ã€å‹ç¼©å’Œæ‰“åŒ…JSã€‚è¢«Next.jsã€Parcelã€Denoç­‰çŸ¥åé¡¹ç›®ä½¿ç”¨ï¼Œæ€§èƒ½éå¸¸é«˜.</li><li><strong>yew</strong>ï¼šä¸€ä¸ªæ­£åœ¨æ´»è·ƒå¼€å‘çš„Rust/Wasmæ¡†æ¶ï¼Œç”¨äºæ„å»ºWebåº”ç”¨.</li><li><strong>firecracker</strong>ï¼šä¸€ä¸ªå®‰å…¨ã€é«˜æ€§èƒ½çš„æ— æœåŠ¡è®¡ç®—è™šæ‹Ÿæœºï¼Œç”±Amazonå…¬å¸å¼€å‘ï¼Œä¸ºAWSéƒ¨åˆ†äº‘è®¡ç®—æœåŠ¡æä¾›æ”¯æŒ.</li><li><strong>nushell</strong>ï¼šä¸€ä¸ªå…¨æ–°çš„shellï¼Œä½¿ç”¨Rustå®ç°ï¼Œå…·æœ‰ç°ä»£åŒ–ç‰¹æ€§ï¼Œä¾‹å¦‚ä½¿ç”¨SQLè¯­æ³•æ¥é€‰æ‹©å†…å®¹.</li><li><strong>tokio</strong>ï¼šä¸€ä¸ªå¼‚æ­¥IOçš„è¿è¡Œæ—¶ï¼Œæä¾›äº†I/Oã€ç½‘ç»œã€è°ƒåº¦ã€å®šæ—¶å™¨ç­‰å¼‚æ­¥ç¼–ç¨‹æ‰€å¿…é¡»çš„åŠŸèƒ½å’Œå·¥å…·ï¼Œæ€§èƒ½å’ŒåŠŸèƒ½éƒ½å¼‚å¸¸å¼ºå¤§.</li><li><strong>AppFlowy</strong>ï¼šNotionçš„å¼€æºå®ç°ï¼Œä½¿ç”¨Rustå’ŒFlutteræ„å»ºï¼Œç”¨äºç”¨æˆ·æ–‡æ¡£å’Œæ•°æ®çš„ç®¡ç†.</li><li><strong>Bevy</strong>ï¼šä¸€ä¸ªæ•°æ®é©±åŠ¨çš„æ¸¸æˆå¼•æ“ï¼Œæ”¯æŒ2Då’Œ3Då›¾å½¢å¼€å‘ï¼Œç¤¾åŒºæ´»è·ƒä¸”æ›´æ–°å¿«.</li><li><strong>actix-web</strong>ï¼šå…¨ä¸–ç•Œæœ€å¿«çš„webæ¡†æ¶ä¹‹ä¸€ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œæ€§èƒ½å¼ºå¤§.</li><li><strong>iced</strong>ï¼šä¸€ä¸ªè·¨å¹³å°GUIåº“ï¼Œå…·æœ‰ç®€å•æ˜“ç”¨ã€æ¨¡å—åŒ–è®¾è®¡ã€å“åº”å¼å¸ƒå±€ç­‰ä¼˜ç‚¹.</li><li><strong>wasmer</strong>ï¼šä¸šç•Œé¢†å…ˆçš„WASMè¿è¡Œæ—¶ï¼Œæ”¯æŒWASIå’ŒEmscripten.</li><li><strong>ruffle</strong>ï¼šç”¨Rustå†™çš„Flash Playeræ¨¡æ‹Ÿå™¨ï¼Œæ”¯æŒæ¡Œé¢ç«¯å’ŒWebç«¯ï¼Œé€šè¿‡WASMæä¾›æ”¯æŒ.</li><li><strong>rustdesk</strong>ï¼šå›½å†…å›¢é˜Ÿå¼€å‘çš„ä¸€æ¬¾è¿œç¨‹æ¡Œé¢è½¯ä»¶ï¼Œä½¿ç”¨Rustå’ŒFlutteræ„å»º.</li><li><strong>RustPython</strong>ï¼šä½¿ç”¨Rustå®ç°çš„Pythonè§£é‡Šå™¨ï¼Œæ”¯æŒPython3.</li><li><strong>vector</strong>ï¼šä¸€ä¸ªæ€§èƒ½å¾ˆé«˜çš„æ•°æ®é‡‡é›†agentï¼Œç”¨äºé‡‡é›†æœ¬åœ°çš„æ—¥å¿—ã€ç›‘æ§ç­‰æ•°æ®ï¼Œå‘é€åˆ°è¿œç¨‹çš„kafkaã€jaegerç­‰æ•°æ®ä¸‹æ²‰ç«¯.</li><li><strong>mdbook</strong>ï¼šåŸºäºmarkdownæ–‡ä»¶è‡ªåŠ¨åˆ›å»ºåœ¨çº¿ç”µå­ä¹¦çš„å·¥å…·.</li><li><strong>zola</strong>ï¼šé™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œç±»ä¼¼hugo.</li></ol>',198)]))}const q=a(g,[["render",E]]);export{D as __pageData,q as default};
