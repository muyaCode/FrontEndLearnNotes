import{_ as n,c as a,o as l,ah as p}from"./chunks/framework.DqD713j2.js";const e="/FrontEndLearnNotes/assets/01-egg%E5%9C%A8%E9%98%BF%E9%87%8C.BwCV-dal.png",o="/FrontEndLearnNotes/assets/02-Nodejs%E5%9C%A8%E9%98%BF%E9%87%8C.CHMYsldm.png",F=JSON.parse('{"title":"EggJs æ¡†æ¶","description":"","frontmatter":{},"headers":[],"relativePath":"Document/Nodeåç«¯æ¡†æ¶å¼€å‘/Koaæ¡†æ¶/EggJSæ¡†æ¶.md","filePath":"Document/Nodeåç«¯æ¡†æ¶å¼€å‘/Koaæ¡†æ¶/EggJSæ¡†æ¶.md","lastUpdated":1750954157000}'),t={name:"Document/Nodeåç«¯æ¡†æ¶å¼€å‘/Koaæ¡†æ¶/EggJSæ¡†æ¶.md"};function r(c,s,B,i,y,b){return l(),a("div",null,s[0]||(s[0]=[p('<h1 id="eggjs-æ¡†æ¶" tabindex="-1">EggJs æ¡†æ¶ <a class="header-anchor" href="#eggjs-æ¡†æ¶" aria-label="Permalink to &quot;EggJs æ¡†æ¶&quot;">â€‹</a></h1><h2 id="eggjs-ä»‹ç»" tabindex="-1">EggJs ä»‹ç» <a class="header-anchor" href="#eggjs-ä»‹ç»" aria-label="Permalink to &quot;EggJs ä»‹ç»&quot;">â€‹</a></h2><p>EggJs æ˜¯é˜¿é‡Œä¸ºä½¿ç”¨ Node.js &amp; Koa æ„å»ºæ›´å¥½çš„ä¼ä¸šæ¡†æ¶å’Œåº”ç”¨ç¨‹åºè€Œè¯ç”Ÿ</p><p>Egg é€‰æ‹©äº† Koa ä½œä¸ºå…¶åŸºç¡€æ¡†æ¶ï¼Œåœ¨å®ƒçš„æ¨¡å‹åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥å¯¹å®ƒè¿›è¡Œäº†ä¸€äº›å¢å¼º</p><h3 id="egg-åœ¨é˜¿é‡Œ" tabindex="-1">Egg åœ¨é˜¿é‡Œ <a class="header-anchor" href="#egg-åœ¨é˜¿é‡Œ" aria-label="Permalink to &quot;Egg åœ¨é˜¿é‡Œ&quot;">â€‹</a></h3><p><img src="'+e+'" alt="01-eggåœ¨é˜¿é‡Œ.png"></p><h3 id="node-åœ¨é˜¿é‡Œ" tabindex="-1">Node åœ¨é˜¿é‡Œ <a class="header-anchor" href="#node-åœ¨é˜¿é‡Œ" aria-label="Permalink to &quot;Node åœ¨é˜¿é‡Œ&quot;">â€‹</a></h3><p><img src="'+o+`" alt="02-Nodejsåœ¨é˜¿é‡Œ.png"></p><h3 id="egg-ç‰¹æ€§" tabindex="-1">Egg ç‰¹æ€§ <a class="header-anchor" href="#egg-ç‰¹æ€§" aria-label="Permalink to &quot;Egg ç‰¹æ€§&quot;">â€‹</a></h3><ul><li>æä¾›åŸºäº EggÂ <a href="https://www.eggjs.org/zh-CN/advanced/framework" target="_blank" rel="noreferrer">å®šåˆ¶ä¸Šå±‚æ¡†æ¶</a>çš„èƒ½åŠ›</li><li>é«˜åº¦å¯æ‰©å±•çš„<a href="https://www.eggjs.org/zh-CN/basics/plugin" target="_blank" rel="noreferrer">æ’ä»¶æœºåˆ¶</a></li><li>å†…ç½®<a href="https://www.eggjs.org/zh-CN/advanced/cluster-client" target="_blank" rel="noreferrer">å¤šè¿›ç¨‹ç®¡ç†</a></li><li><strong>åŸºäº Â <a href="http://koajs.com/" target="_blank" rel="noreferrer">Koa</a>Â  å¼€å‘ï¼Œæ€§èƒ½ä¼˜å¼‚</strong></li><li>æ¡†æ¶ç¨³å®šï¼Œæµ‹è¯•è¦†ç›–ç‡é«˜</li><li><a href="https://www.eggjs.org/zh-CN/intro/progressive" target="_blank" rel="noreferrer">æ¸è¿›å¼å¼€å‘</a></li></ul><h3 id="egg-ä¼˜åŠ¿" tabindex="-1">Egg ä¼˜åŠ¿ <a class="header-anchor" href="#egg-ä¼˜åŠ¿" aria-label="Permalink to &quot;Egg ä¼˜åŠ¿&quot;">â€‹</a></h3><ul><li><p>1.Express å’Œ Koa æ²¡æœ‰çº¦æŸå’Œè§„èŒƒ, ä¼šå¯¼è‡´å›¢é˜Ÿçš„æ²Ÿé€šæˆæœ¬å’Œé¡¹ç›®çš„ç»´æŠ¤æˆæœ¬å˜é«˜ï¼ŒEggJS æœ‰çº¦æŸå’Œè§„èŒƒ, ä¼šå¤§å¤§é™ä½å›¢é˜Ÿçš„æ²Ÿé€šæˆæœ¬å’Œé¡¹ç›®çš„ç»´æŠ¤æˆæœ¬</p><ul><li><p>ä»€ä¹ˆæ˜¯æœ‰çº¦æŸå’Œè§„èŒƒ?</p><p>å’Œ ESLint æ£€æŸ¥ JS ä»£ç ä¸€æ ·, æœ‰ä¸€å¥—æ ‡å‡†, å¿…é¡»ä¸¥æ ¼éµå®ˆè¿™å¥—æ ‡å‡† ,å¦åˆ™å°±ä¼šæŠ¥é”™</p><p><a href="https://eggjs.org/zh-cn/basics/structure.html" target="_blank" rel="noreferrer">https://eggjs.org/zh-cn/basics/structure.html</a></p></li></ul></li><li><p>2.é˜¿é‡Œå†…éƒ¨å¤§é‡ä¼ä¸šçº§é¡¹ç›®ä½¿ç”¨ egg å¼€å‘, å®è·µå‡ºçœŸçŸ¥</p></li><li><p>3.Node ç¤¾åŒº 5 ä½å›½äººæ ¸å¿ƒè´¡çŒ®è€… 4 äººåœ¨é˜¿é‡Œ, æŠ€æœ¯æœ‰ä¿éšœ</p></li><li><p>4.é˜¿é‡Œå‰ç«¯å®‰å…¨ä¸“å®¶ï¼Œè´Ÿè´£ egg-security ç­‰ç±»åº“, å®‰å…¨æœ‰ä¿éšœ</p></li></ul><h3 id="egg-å¼€å‘éµå¾ª-mvc-è§„èŒƒ-ä»€ä¹ˆæ˜¯-mvc" tabindex="-1">Egg å¼€å‘éµå¾ª MVC è§„èŒƒï¼Œä»€ä¹ˆæ˜¯ MVCï¼Ÿ <a class="header-anchor" href="#egg-å¼€å‘éµå¾ª-mvc-è§„èŒƒ-ä»€ä¹ˆæ˜¯-mvc" aria-label="Permalink to &quot;Egg å¼€å‘éµå¾ª MVC è§„èŒƒï¼Œä»€ä¹ˆæ˜¯ MVCï¼Ÿ&quot;">â€‹</a></h3><p>M(Model)ï¼šå¤„ç†åº”ç”¨ç¨‹åº&#39;æ•°æ®é€»è¾‘&#39;çš„éƒ¨åˆ†(service)</p><p>V(View)ï¼šå¤„ç†æ•°æ®æ˜¾ç¤ºçš„éƒ¨åˆ†(é™æ€/åŠ¨æ€ç½‘é¡µ)</p><p>C(Controller)ï¼šå¤„ç†åº”ç”¨ç¨‹åºä¸šåŠ¡é€»è¾‘, æ•°æ®å’Œé¡µé¢çš„æ¡¥æ¢(controller)</p><p>æ¨èé˜…è¯»: <a href="https://github.com/atian25/blog/issues/18" target="_blank" rel="noreferrer">https://github.com/atian25/blog/issues/18</a></p><h2 id="eggjs-ç›¸å…³ç½‘å€æ–‡æ¡£" tabindex="-1">EggJS ç›¸å…³ç½‘å€æ–‡æ¡£ <a class="header-anchor" href="#eggjs-ç›¸å…³ç½‘å€æ–‡æ¡£" aria-label="Permalink to &quot;EggJS ç›¸å…³ç½‘å€æ–‡æ¡£&quot;">â€‹</a></h2><p>EggJs å®˜ç½‘ï¼š<a href="https://www.eggjs.org/zh-CN" target="_blank" rel="noreferrer">https://www.eggjs.org/zh-CN</a></p><p>EggJs ä¸­æ–‡æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/intro/quickstart" target="_blank" rel="noreferrer">https://www.eggjs.org/zh-CN/intro/quickstart</a></p><p>EggJs å¼€æº GitHub åœ°å€ï¼š<a href="https://github.com/eggjs/egg" target="_blank" rel="noreferrer">https://github.com/eggjs/egg</a></p><h2 id="eggjs-å®æˆ˜-ğŸ˜" tabindex="-1">EggJS å®æˆ˜ ğŸ˜ <a class="header-anchor" href="#eggjs-å®æˆ˜-ğŸ˜" aria-label="Permalink to &quot;EggJS å®æˆ˜ ğŸ˜&quot;">â€‹</a></h2><p>å®æˆ˜å†™å®Œçš„ demoï¼š<a href="https://github.com/muyaCode/egg-demo" target="_blank" rel="noreferrer">muyaCode/egg-demo: egg é¡¹ç›®ç»ƒä¹  (github.com)</a></p><hr><p>çœ‹å¿«é€Ÿå…¥é—¨æ–‡æ¡£ï¼Œè„šæ‰‹æ¶åˆå§‹åŒ–é¡¹ç›®ï¼š<a href="https://www.eggjs.org/zh-CN/intro/quickstart" target="_blank" rel="noreferrer">å¿«é€Ÿå…¥é—¨ - Egg (eggjs.org)</a></p><h3 id="_1-eggjs-çš„é¡¹ç›®ç»“æ„" tabindex="-1">1.eggjs çš„é¡¹ç›®ç»“æ„ <a class="header-anchor" href="#_1-eggjs-çš„é¡¹ç›®ç»“æ„" aria-label="Permalink to &quot;1.eggjs çš„é¡¹ç›®ç»“æ„&quot;">â€‹</a></h3><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/structure" target="_blank" rel="noreferrer">ç›®å½•ç»“æ„ - Egg (eggjs.org)</a></p><p>é¡¹ç›®éœ€è¦æ ¹æ®å®˜æ–¹ç›®å½•ç»“æ„è§„èŒƒå¼€å‘ï¼Œå¦åˆ™ä¸èƒ½æ­£å¸¸è¿è¡Œ</p><hr><h3 id="_2-é¡¹ç›®è¿è¡Œç¯å¢ƒé…ç½®" tabindex="-1">2.é¡¹ç›®è¿è¡Œç¯å¢ƒé…ç½® <a class="header-anchor" href="#_2-é¡¹ç›®è¿è¡Œç¯å¢ƒé…ç½®" aria-label="Permalink to &quot;2.é¡¹ç›®è¿è¡Œç¯å¢ƒé…ç½®&quot;">â€‹</a></h3><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/env" target="_blank" rel="noreferrer">è¿è¡Œç¯å¢ƒ - Egg (eggjs.org)</a></p><hr><h3 id="_3-é¡¹ç›®çš„å®‰å…¨ç­–ç•¥é…ç½®-config-ç›®å½•" tabindex="-1">3.é¡¹ç›®çš„å®‰å…¨ç­–ç•¥é…ç½®-config ç›®å½• <a class="header-anchor" href="#_3-é¡¹ç›®çš„å®‰å…¨ç­–ç•¥é…ç½®-config-ç›®å½•" aria-label="Permalink to &quot;3.é¡¹ç›®çš„å®‰å…¨ç­–ç•¥é…ç½®-config ç›®å½•&quot;">â€‹</a></h3><p>config é…ç½®-æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/config" target="_blank" rel="noreferrer">Config é…ç½® - Egg (eggjs.org)</a></p><p>EggJS ç»™æˆ‘ä»¬æä¾›äº†å¤šç§é…ç½®æ–‡ä»¶, æ–¹ä¾¿æˆ‘ä»¬åœ¨ä¸åŒçš„é˜¶æ®µä¸­ä½¿ç”¨</p><ul><li><p>config.prod.js Â  Â  // åªæœ‰çº¿ä¸Šç¯å¢ƒä¼šåŠ è½½</p></li><li><p>config.test.js Â  Â  // åªæœ‰æµ‹è¯•ç¯å¢ƒä¼šåŠ è½½</p></li><li><p>config.local.js Â  Â  // åªæœ‰å¼€å‘ç¯å¢ƒä¼šåŠ è½½</p></li><li><p>config.default.js Â  // æ‰€æœ‰ç¯å¢ƒéƒ½ä¼šåŠ è½½</p></li></ul><p>å¦‚æœå‡ºç°åŒåçš„é…ç½®,ï¼Œåé¢ä¸‰ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ä¼šè¦†ç›– default ä¸­çš„é…ç½®</p><hr><h4 id="å¦‚ä½•è®¾ç½®å½“å‰ç¯å¢ƒ" tabindex="-1">å¦‚ä½•è®¾ç½®å½“å‰ç¯å¢ƒ? <a class="header-anchor" href="#å¦‚ä½•è®¾ç½®å½“å‰ç¯å¢ƒ" aria-label="Permalink to &quot;å¦‚ä½•è®¾ç½®å½“å‰ç¯å¢ƒ?&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">EGG_SERVER_ENV</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> xxx</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>è¿è¡Œç¯å¢ƒ-é…ç½®æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/env" target="_blank" rel="noreferrer">è¿è¡Œç¯å¢ƒ - Egg (eggjs.org)</a></p><h5 id="éœ€è¦é…åˆcross-envç¯å¢ƒå˜é‡åº“ä½¿ç”¨" tabindex="-1">éœ€è¦é…åˆ<code>cross-env</code>ç¯å¢ƒå˜é‡åº“ä½¿ç”¨ <a class="header-anchor" href="#éœ€è¦é…åˆcross-envç¯å¢ƒå˜é‡åº“ä½¿ç”¨" aria-label="Permalink to &quot;éœ€è¦é…åˆ\`cross-env\`ç¯å¢ƒå˜é‡åº“ä½¿ç”¨&quot;">â€‹</a></h5><p>package.json æ–‡ä»¶å†…é…ç½®ï¼š</p><p><code>egg-scripts start --daemon</code> æ­¤å‘½ä»¤å¯ä»¥æŸ¥çœ‹åº”ç”¨éƒ¨ç½²æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/core/deployment" target="_blank" rel="noreferrer">åº”ç”¨éƒ¨ç½² - Egg (eggjs.org)</a></p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;scripts&quot;</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">    &quot;dev&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;cross-env EGG_SERVER_ENV=dev egg-bin dev&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    &quot;prod&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;cross-env EGG_SERVER_ENV=prod egg-scripts start --daemon&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">    &quot;stop&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;egg-scripts stop&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;">  },</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é…åˆä¸Šé¢çš„ config çš„å„ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¾¾åˆ°ç¯å¢ƒå˜é‡é…ç½®çš„ä½œç”¨</p><hr><p>å®‰å…¨é…ç½®-æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/core/security" target="_blank" rel="noreferrer">å®‰å…¨ - Egg (eggjs.org)</a></p><hr><h3 id="_4-å†…ç½®åŸºç¡€å¯¹è±¡" tabindex="-1">4.å†…ç½®åŸºç¡€å¯¹è±¡ <a class="header-anchor" href="#_4-å†…ç½®åŸºç¡€å¯¹è±¡" aria-label="Permalink to &quot;4.å†…ç½®åŸºç¡€å¯¹è±¡&quot;">â€‹</a></h3><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/objects" target="_blank" rel="noreferrer">æ¡†æ¶å†…ç½®åŸºç¡€å¯¹è±¡ - Egg (eggjs.org)</a></p><h3 id="_5-é™æ€èµ„æºç›®å½•-app-public" tabindex="-1">5.é™æ€èµ„æºç›®å½•-app/public <a class="header-anchor" href="#_5-é™æ€èµ„æºç›®å½•-app-public" aria-label="Permalink to &quot;5.é™æ€èµ„æºç›®å½•-app/public&quot;">â€‹</a></h3><p>æŠŠé™æ€èµ„æºæ”¾åœ¨<code>app/public</code>ç›®å½•ä¸‹ï¼Œä¼šè‡ªåŠ¨è§£æ</p><p>æµè§ˆå™¨è®¿é—®ï¼š<code>localhost:7001/public/login.html</code></p><p>é¡¹ç›®å†…è®¿é—®ï¼š</p><h3 id="_6-åŠ¨æ€èµ„æºå¤„ç†-æ¨¡æ¿æ¸²æŸ“" tabindex="-1">6.åŠ¨æ€èµ„æºå¤„ç†-æ¨¡æ¿æ¸²æŸ“ <a class="header-anchor" href="#_6-åŠ¨æ€èµ„æºå¤„ç†-æ¨¡æ¿æ¸²æŸ“" aria-label="Permalink to &quot;6.åŠ¨æ€èµ„æºå¤„ç†-æ¨¡æ¿æ¸²æŸ“&quot;">â€‹</a></h3><p>æ¨¡æ¿æ¸²æŸ“æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/core/view" target="_blank" rel="noreferrer">View æ¨¡æ¿æ¸²æŸ“ - Egg (eggjs.org)</a></p><p>æˆ‘ä»¬è¿™é‡Œé€‰æ‹©ç”¨ ejs æ¸²æŸ“æ¨¡æ¿æ’ä»¶</p><h4 id="_1-å®‰è£…egg-view-ejsæ’ä»¶" tabindex="-1">1.å®‰è£…<code>egg-view-ejs</code>æ’ä»¶ <a class="header-anchor" href="#_1-å®‰è£…egg-view-ejsæ’ä»¶" aria-label="Permalink to &quot;1.å®‰è£…\`egg-view-ejs\`æ’ä»¶&quot;">â€‹</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">npm</span><span style="color:#98C379;"> i</span><span style="color:#98C379;"> egg-view-ejs</span><span style="color:#D19A66;"> --save</span><span style="color:#D19A66;"> --legacy-peer-deps</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># --legacy-peer-depsï¼šè§£å†³å®‰è£…æŠ¥é”™â†“ï¼Œæ’ä»¶ä¸å…¼å®¹</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># npm ERR! code ERESOLVE</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># npm ERR! ERESOLVE could not resolve</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-åœ¨-config-ç›®å½•ä¸‹æ–°å»º-plugin-js-å†™å…¥é…ç½®" tabindex="-1">2.åœ¨ config ç›®å½•ä¸‹æ–°å»º plugin.js-å†™å…¥é…ç½® <a class="header-anchor" href="#_2-åœ¨-config-ç›®å½•ä¸‹æ–°å»º-plugin-js-å†™å…¥é…ç½®" aria-label="Permalink to &quot;2.åœ¨ config ç›®å½•ä¸‹æ–°å»º plugin.js-å†™å…¥é…ç½®&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">exports</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ejs</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">enable</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">package</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;egg-view-ejs&quot;</span><span style="color:#ABB2BF;"> };</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_3-åœ¨-config-default-js-ä¸­æ–°å¢å¦‚ä¸‹é…ç½®" tabindex="-1">3.åœ¨ config.default.js ä¸­æ–°å¢å¦‚ä¸‹é…ç½® <a class="header-anchor" href="#_3-åœ¨-config-default-js-ä¸­æ–°å¢å¦‚ä¸‹é…ç½®" aria-label="Permalink to &quot;3.åœ¨ config.default.js ä¸­æ–°å¢å¦‚ä¸‹é…ç½®&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E06C75;">view</span><span style="color:#ABB2BF;">: { </span><span style="color:#E06C75;">mapping</span><span style="color:#ABB2BF;">: { </span><span style="color:#98C379;">&#39;.html&#39;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;ejs&#39;</span><span style="color:#ABB2BF;"> } },</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_4-åœ¨-app-ç›®å½•ä¸­æ–°å»º-view-ç›®å½•-å°†åŠ¨æ€ç½‘é¡µæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­" tabindex="-1">4.åœ¨ app ç›®å½•ä¸­æ–°å»º view ç›®å½•, å°†åŠ¨æ€ç½‘é¡µæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­ <a class="header-anchor" href="#_4-åœ¨-app-ç›®å½•ä¸­æ–°å»º-view-ç›®å½•-å°†åŠ¨æ€ç½‘é¡µæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­" aria-label="Permalink to &quot;4.åœ¨ app ç›®å½•ä¸­æ–°å»º view ç›®å½•, å°†åŠ¨æ€ç½‘é¡µæ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­&quot;">â€‹</a></h4><p>æ–‡ä»¶ï¼šapp/view/index.html</p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;">&lt;!</span><span style="color:#E06C75;">DOCTYPE</span><span style="color:#D19A66;"> html</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">html</span><span style="color:#D19A66;"> lang</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;en&quot;</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;</span><span style="color:#E06C75;">head</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		&lt;</span><span style="color:#E06C75;">meta</span><span style="color:#D19A66;"> charset</span><span style="color:#ABB2BF;">=</span><span style="color:#98C379;">&quot;UTF-8&quot;</span><span style="color:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		&lt;</span><span style="color:#E06C75;">title</span><span style="color:#ABB2BF;">&gt;åŠ¨æ€ç½‘é¡µ&lt;/</span><span style="color:#E06C75;">title</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;/</span><span style="color:#E06C75;">head</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;</span><span style="color:#E06C75;">body</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		&lt;</span><span style="color:#E06C75;">h1</span><span style="color:#ABB2BF;">&gt;æˆ‘æ˜¯åŠ¨æ€ç½‘é¡µ&lt;/</span><span style="color:#E06C75;">h1</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">		&lt;</span><span style="color:#E06C75;">h2</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#FFFFFF;">&lt;</span><span style="color:#ABB2BF;">%=msg%&gt;&lt;/</span><span style="color:#E06C75;">h2</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">	&lt;/</span><span style="color:#E06C75;">body</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">html</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_5-åœ¨æ§åˆ¶å™¨ä¸­é€šè¿‡ä¸Šä¸‹æ–‡-render-æ–¹æ³•æ¸²æŸ“" tabindex="-1">5.åœ¨æ§åˆ¶å™¨ä¸­é€šè¿‡ä¸Šä¸‹æ–‡ render æ–¹æ³•æ¸²æŸ“ <a class="header-anchor" href="#_5-åœ¨æ§åˆ¶å™¨ä¸­é€šè¿‡ä¸Šä¸‹æ–‡-render-æ–¹æ³•æ¸²æŸ“" aria-label="Permalink to &quot;5.åœ¨æ§åˆ¶å™¨ä¸­é€šè¿‡ä¸Šä¸‹æ–‡ render æ–¹æ³•æ¸²æŸ“&quot;">â€‹</a></h4><p>æ§åˆ¶å™¨ä¸­æ·»åŠ æ–°æ–¹æ³•ï¼šapp/controller/home.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// æ¨¡æ¿æ¸²æŸ“</span></span>
<span class="line"><span style="color:#E06C75;">async</span><span style="color:#61AFEF;"> getHome</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">  await</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">render</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;index&#39;</span><span style="color:#ABB2BF;">, { </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;ejsæ¨¡æ¿æ¸²æŸ“&#39;</span><span style="color:#ABB2BF;"> });</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>åœ¨è·¯ç”±ä¸­ä½¿ç”¨æ§åˆ¶å™¨æ–¹æ³•æ¸²æŸ“é¡µé¢</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ejsæ¨¡æ¿æ¸²æŸ“å¼•æ“é¡µé¢</span></span>
<span class="line"><span style="color:#E5C07B;">router</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/home&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">controller</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">home</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">getHome</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr><h3 id="_7-æ•°æ®åº“æ“ä½œå’Œç½‘ç»œæ•°æ®å¤„ç†-æœåŠ¡-service" tabindex="-1">7.æ•°æ®åº“æ“ä½œå’Œç½‘ç»œæ•°æ®å¤„ç†-æœåŠ¡ï¼ˆServiceï¼‰ <a class="header-anchor" href="#_7-æ•°æ®åº“æ“ä½œå’Œç½‘ç»œæ•°æ®å¤„ç†-æœåŠ¡-service" aria-label="Permalink to &quot;7.æ•°æ®åº“æ“ä½œå’Œç½‘ç»œæ•°æ®å¤„ç†-æœåŠ¡ï¼ˆServiceï¼‰&quot;">â€‹</a></h3><p>Service æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/service" target="_blank" rel="noreferrer">æœåŠ¡ï¼ˆServiceï¼‰ - Egg (eggjs.org)</a></p><h4 id="_1-é¡¹ç›®æ–°å»º-app-service-ç›®å½•" tabindex="-1">1.é¡¹ç›®æ–°å»º app/service ç›®å½• <a class="header-anchor" href="#_1-é¡¹ç›®æ–°å»º-app-service-ç›®å½•" aria-label="Permalink to &quot;1.é¡¹ç›®æ–°å»º app/service ç›®å½•&quot;">â€‹</a></h4><p>ç›®å½•ä¸‹æ–°å»ºä¸æ§åˆ¶å™¨åŒåçš„æœåŠ¡æ–¹æ³•æ¨¡å— js</p><p><code>app/service/home.js</code></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// app/service/home.js</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> Service</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">Service</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> HomeService</span><span style="color:#C678DD;"> extends</span><span style="color:#E5C07B;"> Service</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">	async</span><span style="color:#61AFEF;"> findNews</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// å‘é€getä¸å¸¦å‚æ•°çš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// let response = await this.ctx.curl(&#39;http://127.0.0.1:3000/getUser&#39;);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// å‘é€getå¸¦å‚æ•°çš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// let response = await this.ctx.curl(&#39;http://127.0.0.1:3000/getUser2?name=it666&amp;age=66&#39;);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// å‘é€postä¸å¸¦å‚æ•°çš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// let response = await this.ctx.curl(&#39;http://127.0.0.1:3000/getNews&#39;, {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		//     method: &#39;post&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// });</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// å‘é€postå¸¦å‚æ•°çš„è¯·æ±‚</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> response</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> await</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">curl</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;http://localhost:3000/getNews2&quot;</span><span style="color:#ABB2BF;">, {</span></span>
<span class="line"><span style="color:#E06C75;">			method</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;post&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">			data</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">				name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;lnj&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">				age</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">33</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">			},</span></span>
<span class="line"><span style="color:#ABB2BF;">		});</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> data</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> JSON</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parse</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;HomeService&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E06C75;"> data</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> HomeService</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="_2-ä½¿ç”¨-service-çš„æ•°æ®è¯·æ±‚å¤„ç†çš„æœåŠ¡æ–¹æ³•" tabindex="-1">2.ä½¿ç”¨ service çš„æ•°æ®è¯·æ±‚å¤„ç†çš„æœåŠ¡æ–¹æ³• <a class="header-anchor" href="#_2-ä½¿ç”¨-service-çš„æ•°æ®è¯·æ±‚å¤„ç†çš„æœåŠ¡æ–¹æ³•" aria-label="Permalink to &quot;2.ä½¿ç”¨ service çš„æ•°æ®è¯·æ±‚å¤„ç†çš„æœåŠ¡æ–¹æ³•&quot;">â€‹</a></h4><p>æ§åˆ¶å™¨ä¸­æ–°æ·»åŠ æ–¹æ³•ï¼šapp/controller/home.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E06C75;">async</span><span style="color:#61AFEF;"> getNews</span><span style="color:#ABB2BF;">(){</span></span>
<span class="line"><span style="color:#C678DD;">  let</span><span style="color:#E06C75;"> data</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> await</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">service</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">home</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">findNews</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">  this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> data</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>åœ¨è·¯ç”±ä¸­ä½¿ç”¨æ–¹æ³•ï¼šapp/router.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// æ•°æ®å¤„ç†</span></span>
<span class="line"><span style="color:#E5C07B;">router</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/news&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">controller</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">home</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">getNews</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="service-æ³¨æ„ç‚¹" tabindex="-1">service æ³¨æ„ç‚¹ <a class="header-anchor" href="#service-æ³¨æ„ç‚¹" aria-label="Permalink to &quot;service æ³¨æ„ç‚¹&quot;">â€‹</a></h4><ol><li><p>service ç›®å½•å¿…é¡»æ”¾åœ¨ app ç›®å½•ä¸­</p></li><li><p>service ç›®å½•æ”¯æŒå¤šçº§ç›®å½•, å¦‚æœæ˜¯å¤šçº§ç›®å½•, é‚£ä¹ˆåœ¨è°ƒç”¨çš„æ—¶å€™å¯ä»¥ä½¿ç”¨é“¾å¼è°ƒç”¨</p><ol><li><code>this.ctx.service.abc.def.text.xxx();</code></li></ol></li><li><p>service ä¸­çš„ js æ–‡ä»¶, å¦‚æœæ˜¯ä»¥_æˆ–è€…é¦–å­—æ¯éƒ½æ˜¯å¤§å†™, é‚£ä¹ˆåœ¨è°ƒç”¨çš„æ—¶å€™å¿…é¡»è½¬æ¢æˆé©¼å³°å‘½å</p><ol><li><p><code>get_user.js --- getUser</code></p></li><li><p><code>GetUser.js --- getUser</code></p></li></ol></li></ol><hr><h3 id="_8-å¤„ç†-cookie-å’Œ-session" tabindex="-1">8.å¤„ç† Cookie å’Œ Session <a class="header-anchor" href="#_8-å¤„ç†-cookie-å’Œ-session" aria-label="Permalink to &quot;8.å¤„ç† Cookie å’Œ Session&quot;">â€‹</a></h3><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/core/cookie-and-session" target="_blank" rel="noreferrer">Cookie ä¸ Session - Egg (eggjs.org)</a></p><hr><h3 id="_9-å¤„ç†æ—¥å¿—" tabindex="-1">9.å¤„ç†æ—¥å¿— <a class="header-anchor" href="#_9-å¤„ç†æ—¥å¿—" aria-label="Permalink to &quot;9.å¤„ç†æ—¥å¿—&quot;">â€‹</a></h3><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/core/logger" target="_blank" rel="noreferrer">æ—¥å¿— - Egg (eggjs.org)</a></p><hr><h3 id="_10-å®šæ—¶ä»»åŠ¡" tabindex="-1">10.å®šæ—¶ä»»åŠ¡ <a class="header-anchor" href="#_10-å®šæ—¶ä»»åŠ¡" aria-label="Permalink to &quot;10.å®šæ—¶ä»»åŠ¡&quot;">â€‹</a></h3><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/schedule" target="_blank" rel="noreferrer">å®šæ—¶ä»»åŠ¡ - Egg (eggjs.org)</a></p><h4 id="eggjs-å®šæ—¶ä»»åŠ¡-è®¡åˆ’ä»»åŠ¡" tabindex="-1">EggJS å®šæ—¶ä»»åŠ¡(è®¡åˆ’ä»»åŠ¡)? <a class="header-anchor" href="#eggjs-å®šæ—¶ä»»åŠ¡-è®¡åˆ’ä»»åŠ¡" aria-label="Permalink to &quot;EggJS å®šæ—¶ä»»åŠ¡(è®¡åˆ’ä»»åŠ¡)?&quot;">â€‹</a></h4><p>è™½ç„¶æˆ‘ä»¬é€šè¿‡æ¡†æ¶å¼€å‘çš„ Web æœåŠ¡å™¨æ˜¯è¯·æ±‚å“åº”æ¨¡å‹çš„ï¼Œä½†æ˜¯ä»ç„¶è¿˜ä¼šæœ‰è®¸å¤šåœºæ™¯éœ€è¦æ‰§è¡Œä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š</p><ul><li><p>å®šæ—¶è¿›è¡Œæ–‡ä»¶åˆ‡å‰²ã€ä¸´æ—¶æ–‡ä»¶åˆ é™¤ã€‚</p></li><li><p>å®šæ—¶ä¸ŠæŠ¥åº”ç”¨çŠ¶æ€ã€‚(ä¾‹å¦‚ç›‘æ§ç³»ç»Ÿ, æ—¶æ—¶ç›‘æ§ç³»ç»Ÿæœ‰æ²¡æœ‰é—®é¢˜, å…¸å‹ä¾‹å­ MongoDB/Redis é›†ç¾¤é€‰ä¸¾)</p></li><li><p>å®šæ—¶ä»è¿œç¨‹æ¥å£æ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚</p></li></ul><p>Egg æ¡†æ¶æä¾›äº†ä¸€å¥—æœºåˆ¶æ¥è®©å®šæ—¶ä»»åŠ¡çš„ç¼–å†™å’Œç»´æŠ¤æ›´åŠ ä¼˜é›…</p><h5 id="_1-å®šä¹‰å®šæ—¶ä»»åŠ¡" tabindex="-1">1.å®šä¹‰å®šæ—¶ä»»åŠ¡ <a class="header-anchor" href="#_1-å®šä¹‰å®šæ—¶ä»»åŠ¡" aria-label="Permalink to &quot;1.å®šä¹‰å®šæ—¶ä»»åŠ¡&quot;">â€‹</a></h5><p>æ–°å»ºæ–‡ä»¶ï¼š<code>app/schedule/updateMessage.js</code></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> Subscription</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">Subscription</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> UpdateCache</span><span style="color:#C678DD;"> extends</span><span style="color:#E5C07B;"> Subscription</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// é€šè¿‡ schedule å±æ€§æ¥è®¾ç½®å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œé—´éš”ç­‰é…ç½®</span></span>
<span class="line"><span style="color:#C678DD;">	static</span><span style="color:#C678DD;"> get</span><span style="color:#61AFEF;"> schedule</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">			interval</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;3s&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// é—´éš”3ç§’æ‰§è¡Œä¸€æ¬¡</span></span>
<span class="line"><span style="color:#E06C75;">			type</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;all&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">//  allè¡¨ç¤ºå½“å‰æœåŠ¡å™¨ä¸Šæ‰€æœ‰ç›¸åŒçš„Nodeè¿›ç¨‹éƒ½æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#ABB2BF;">		};</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// subscribe æ˜¯çœŸæ­£å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶è¢«è¿è¡Œçš„å‡½æ•°</span></span>
<span class="line"><span style="color:#C678DD;">	async</span><span style="color:#61AFEF;"> subscribe</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> response</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> await</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">curl</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;http://127.0.0.1:3000/getMsg&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> data</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Buffer</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> UpdateCache</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>æ¥ä¸‹æ¥<code>npm run dev</code>è¿è¡Œå½“å‰ egg é¡¹ç›®ï¼Œå®šæ—¶ä»»åŠ¡ä¾¿ä¼šå®šæ—¶æ‰§è¡Œå®šæ—¶ä»»åŠ¡<code>subscribe</code>æ–¹æ³•</p><h5 id="_2-å®šæ—¶ä»»åŠ¡æ¸²æŸ“åˆ°å½“å‰é¡¹ç›®çš„æ¨¡æ¿å¼•æ“" tabindex="-1">2.å®šæ—¶ä»»åŠ¡æ¸²æŸ“åˆ°å½“å‰é¡¹ç›®çš„æ¨¡æ¿å¼•æ“ <a class="header-anchor" href="#_2-å®šæ—¶ä»»åŠ¡æ¸²æŸ“åˆ°å½“å‰é¡¹ç›®çš„æ¨¡æ¿å¼•æ“" aria-label="Permalink to &quot;2.å®šæ—¶ä»»åŠ¡æ¸²æŸ“åˆ°å½“å‰é¡¹ç›®çš„æ¨¡æ¿å¼•æ“&quot;">â€‹</a></h5><p>æ§åˆ¶å™¨ä¸­æ·»åŠ æ–¹æ³•ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// å®šæ—¶ä»»åŠ¡æ¸²æŸ“æ–¹æ³•</span></span>
<span class="line"><span style="color:#E06C75;">async</span><span style="color:#61AFEF;"> test</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">  await</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">render</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&#39;index&#39;</span><span style="color:#ABB2BF;">, { </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;"> });</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>æ·»åŠ è·¯ç”±ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// å®šæ—¶ä»»åŠ¡è·¯ç”±</span></span>
<span class="line"><span style="color:#E5C07B;">router</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/test&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">controller</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">home</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">test</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_3-å¯åŠ¨è‡ªå®šä¹‰" tabindex="-1">3.å¯åŠ¨è‡ªå®šä¹‰ <a class="header-anchor" href="#_3-å¯åŠ¨è‡ªå®šä¹‰" aria-label="Permalink to &quot;3.å¯åŠ¨è‡ªå®šä¹‰&quot;">â€‹</a></h5><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/app-start" target="_blank" rel="noreferrer">å¯åŠ¨è‡ªå®šä¹‰ - Egg (eggjs.org)</a></p><h6 id="_1-é¡¹ç›®æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶-app-js" tabindex="-1">1.é¡¹ç›®æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶ï¼šapp.js <a class="header-anchor" href="#_1-é¡¹ç›®æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶-app-js" aria-label="Permalink to &quot;1.é¡¹ç›®æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶ï¼šapp.js&quot;">â€‹</a></h6><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// app.js</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> AppBootHook</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">	constructor</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">app</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">		this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">app</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> app</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// è¿™ä¸ªæ–¹æ³•ä¼šåœ¨EggJSç¨‹åºå¯åŠ¨å®Œæ¯•ä¹‹åæ‰§è¡Œ</span></span>
<span class="line"><span style="color:#C678DD;">	async</span><span style="color:#61AFEF;"> serverDidReady</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æ³¨æ„ç‚¹: è¿™é‡Œä¼ é€’çš„ä¸æ˜¯æ–¹æ³•åç§°, è€Œæ˜¯éœ€è¦è¢«æ‰§è¡Œçš„é‚£ä¸ªå®šæ—¶ä»»åŠ¡æ–‡ä»¶çš„åç§°</span></span>
<span class="line"><span style="color:#C678DD;">		await</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">runSchedule</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;updateMessage&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> AppBootHook</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ç„¶å<code>npm run dev</code>è¿è¡Œå½“å‰ egg é¡¹ç›®</p><hr><h3 id="_11-egg-æ¡†æ¶æ‰©å±•" tabindex="-1">11.Egg æ¡†æ¶æ‰©å±• <a class="header-anchor" href="#_11-egg-æ¡†æ¶æ‰©å±•" aria-label="Permalink to &quot;11.Egg æ¡†æ¶æ‰©å±•&quot;">â€‹</a></h3><p>åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ä½¿ç”¨å·²æœ‰çš„æ‰©å±• API æ¥æ–¹ä¾¿å¼€å‘ï¼Œä¹Ÿå¯ä»¥å¯¹ä»¥ä¸Šå¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰æ‰©å±•ï¼Œè¿›ä¸€æ­¥åŠ å¼ºæ¡†æ¶çš„åŠŸèƒ½</p><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/extend" target="_blank" rel="noreferrer">æ¡†æ¶æ‰©å±• - Egg (eggjs.org)</a></p><hr><h3 id="_12-egg-ä¸­é—´ä»¶" tabindex="-1">12.Egg ä¸­é—´ä»¶ <a class="header-anchor" href="#_12-egg-ä¸­é—´ä»¶" aria-label="Permalink to &quot;12.Egg ä¸­é—´ä»¶&quot;">â€‹</a></h3><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/middleware" target="_blank" rel="noreferrer">ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ - Egg (eggjs.org)</a></p><p>app/middleware ç›®å½•</p><hr><h3 id="_13-egg-æ“ä½œæ•°æ®åº“" tabindex="-1">13.Egg æ“ä½œæ•°æ®åº“ <a class="header-anchor" href="#_13-egg-æ“ä½œæ•°æ®åº“" aria-label="Permalink to &quot;13.Egg æ“ä½œæ•°æ®åº“&quot;">â€‹</a></h3><p>MySQLï¼š<a href="https://www.eggjs.org/zh-CN/tutorials/mysql" target="_blank" rel="noreferrer">MySQL - Egg (eggjs.org)</a></p><p>Sequelizeï¼š<a href="https://www.eggjs.org/zh-CN/tutorials/sequelize" target="_blank" rel="noreferrer">Sequelize - Egg (eggjs.org)</a></p><hr><h3 id="_14-csrf-å®‰å…¨é˜²èŒƒ" tabindex="-1">14.CSRF å®‰å…¨é˜²èŒƒ <a class="header-anchor" href="#_14-csrf-å®‰å…¨é˜²èŒƒ" aria-label="Permalink to &quot;14.CSRF å®‰å…¨é˜²èŒƒ&quot;">â€‹</a></h3><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/core/security#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81-csrf-%E7%9A%84%E9%98%B2%E8%8C%83" target="_blank" rel="noreferrer">å®‰å…¨ - Egg (eggjs.org)</a></p><p>è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»</p><hr><h3 id="_15-æ•°æ®æ ¡éªŒ" tabindex="-1">15.æ•°æ®æ ¡éªŒ <a class="header-anchor" href="#_15-æ•°æ®æ ¡éªŒ" aria-label="Permalink to &quot;15.æ•°æ®æ ¡éªŒ&quot;">â€‹</a></h3><p>ä½¿ç”¨<code>egg-validate</code>åº“ï¼Œnpm æ–‡æ¡£ï¼š<a href="https://www.npmjs.com/package/egg-validate" target="_blank" rel="noreferrer">egg-validate - npm (npmjs.com)</a></p><p>åœ¨<code>controller</code>æ§åˆ¶å™¨å±‚æ ¡éªŒå‰ç«¯ä¼ è¿‡æ¥çš„è¡¨å•æ•°æ®ï¼š<a href="https://www.eggjs.org/zh-CN/basics/controller" target="_blank" rel="noreferrer">æ§åˆ¶å™¨ï¼ˆControllerï¼‰ - Egg (eggjs.org)</a></p><hr><h3 id="_16-ç»Ÿä¸€æ¥å£è¿”å›ç›¸åº”æ ¼å¼é…ç½®" tabindex="-1">16.ç»Ÿä¸€æ¥å£è¿”å›ç›¸åº”æ ¼å¼é…ç½® <a class="header-anchor" href="#_16-ç»Ÿä¸€æ¥å£è¿”å›ç›¸åº”æ ¼å¼é…ç½®" aria-label="Permalink to &quot;16.ç»Ÿä¸€æ¥å£è¿”å›ç›¸åº”æ ¼å¼é…ç½®&quot;">â€‹</a></h3><p>æ¡†æ¶æ‰©å±•æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/basics/extend" target="_blank" rel="noreferrer">æ¡†æ¶æ‰©å±• - Egg (eggjs.org)</a></p><p>å¯¹ context è¿›è¡Œæ‰©å±•ï¼š<a href="https://www.eggjs.org/zh-CN/basics/extend#context" target="_blank" rel="noreferrer">æ¡†æ¶æ‰©å±•#context - Egg (eggjs.org)</a></p><h4 id="_1-æ–°å»ºapp-extendç›®å½•ä¸‹çš„æ–‡ä»¶-app-extend-context-js" tabindex="-1">1.æ–°å»º<code>app/extend</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼šapp/extend/context.js <a class="header-anchor" href="#_1-æ–°å»ºapp-extendç›®å½•ä¸‹çš„æ–‡ä»¶-app-extend-context-js" aria-label="Permalink to &quot;1.æ–°å»º\`app/extend\`ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼šapp/extend/context.js&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// è¯·æ±‚æˆåŠŸè¿”å›</span></span>
<span class="line"><span style="color:#61AFEF;">	success</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">code</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">msg</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;æˆåŠŸ&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// this å°±æ˜¯ ctx å¯¹è±¡ï¼Œåœ¨å…¶ä¸­å¯ä»¥è°ƒç”¨ ctx ä¸Šçš„å…¶ä»–æ–¹æ³•ï¼Œæˆ–è®¿é—®å±æ€§</span></span>
<span class="line"><span style="color:#E5C07B;">		this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">			code</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">code</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">			msg</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">			data</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">		};</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// è¯·æ±‚é”™è¯¯</span></span>
<span class="line"><span style="color:#61AFEF;">	error</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">code</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 500</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">msg</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;é”™è¯¯&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// this å°±æ˜¯ ctx å¯¹è±¡ï¼Œåœ¨å…¶ä¸­å¯ä»¥è°ƒç”¨ ctx ä¸Šçš„å…¶ä»–æ–¹æ³•ï¼Œæˆ–è®¿é—®å±æ€§</span></span>
<span class="line"><span style="color:#E5C07B;">		this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">			code</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">code</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">			msg</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">		};</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_2-å®šä¹‰è¯·æ±‚æˆåŠŸå’Œé”™è¯¯çš„çŠ¶æ€ç -app-extend-helper-js" tabindex="-1">2.å®šä¹‰è¯·æ±‚æˆåŠŸå’Œé”™è¯¯çš„çŠ¶æ€ç ï¼šapp\\extend\\helper.js <a class="header-anchor" href="#_2-å®šä¹‰è¯·æ±‚æˆåŠŸå’Œé”™è¯¯çš„çŠ¶æ€ç -app-extend-helper-js" aria-label="Permalink to &quot;2.å®šä¹‰è¯·æ±‚æˆåŠŸå’Œé”™è¯¯çš„çŠ¶æ€ç ï¼šapp\\extend\\helper.js&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">	errorCode</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æˆåŠŸçŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		200</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æˆåŠŸã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨è¿”å›ç›¸å…³æ•°æ®&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		201</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;èµ„æºåˆ›å»ºæˆåŠŸã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨æä¾›æ•°æ®ï¼ŒæœåŠ¡å™¨åˆ›å»ºèµ„æº&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		202</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚è¢«æ¥æ”¶ã€‚ä½†å¤„ç†å°šæœªå®Œæˆ&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		204</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;å®¢æˆ·ç«¯å‘ŠçŸ¥æœåŠ¡å™¨åˆ é™¤ä¸€ä¸ªèµ„æºï¼ŒæœåŠ¡å™¨ç§»é™¤å®ƒ&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		206</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æˆåŠŸã€‚ä½†æ˜¯åªæœ‰éƒ¨åˆ†å›åº”&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// é”™è¯¯çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		400</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æ— æ•ˆã€‚æ•°æ®ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		401</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æ²¡æœ‰æƒé™ã€‚ç¼ºå°‘API tokenï¼Œæ— æ•ˆæˆ–è€…è¶…æ—¶&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		403</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç”¨æˆ·å¾—åˆ°æˆæƒï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		404</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		406</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚å¤±è´¥ã€‚è¯·æ±‚å¤´éƒ¨ä¸ä¸€è‡´ï¼Œè¯·é‡è¯•&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		410</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		422</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚å¤±è´¥ã€‚è¯·éªŒè¯å‚æ•°&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		500</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		502</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç½‘å…³é”™è¯¯&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		503</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;æœåŠ¡ä¸å¯ç”¨ï¼ŒæœåŠ¡å™¨æš‚æ—¶è¿‡è½½æˆ–ç»´æŠ¤ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		504</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç½‘å…³è¶…æ—¶&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_3-è¿”å›è¯·æ±‚çŠ¶æ€" tabindex="-1">3.è¿”å›è¯·æ±‚çŠ¶æ€ <a class="header-anchor" href="#_3-è¿”å›è¯·æ±‚çŠ¶æ€" aria-label="Permalink to &quot;3.è¿”å›è¯·æ±‚çŠ¶æ€&quot;">â€‹</a></h4><p>æ§åˆ¶å™¨æ–¹æ³•ä¸­è¿”å›é”™è¯¯çŠ¶æ€ç ä¿¡æ¯ç¤ºä¾‹ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">success</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// æŠ›å‡ºçš„é”™è¯¯ä¼šåœ¨cathå†…æ•è·</span></span>
<span class="line"><span style="color:#C678DD;">try</span><span style="color:#ABB2BF;">{}</span><span style="color:#61AFEF;">cath</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">e</span><span style="color:#ABB2BF;">){</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">400</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">helper</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">errorCode</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">400</span><span style="color:#ABB2BF;">]);}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr><h3 id="_17-ç”¨æˆ·å¯†ç åŠ å¯†å·¥å…·æ–¹æ³•" tabindex="-1">17.ç”¨æˆ·å¯†ç åŠ å¯†å·¥å…·æ–¹æ³• <a class="header-anchor" href="#_17-ç”¨æˆ·å¯†ç åŠ å¯†å·¥å…·æ–¹æ³•" aria-label="Permalink to &quot;17.ç”¨æˆ·å¯†ç åŠ å¯†å·¥å…·æ–¹æ³•&quot;">â€‹</a></h3><p>ä½¿ç”¨<code>crypto</code>åº“ï¼Œå†™ md5 åŠ å¯†æ–¹æ³•ï¼šapp\\extend\\helper.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> crypto</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;crypto&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">	errorCode</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æˆåŠŸçŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		200</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æˆåŠŸã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨è¿”å›ç›¸å…³æ•°æ®&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		201</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;èµ„æºåˆ›å»ºæˆåŠŸã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨æä¾›æ•°æ®ï¼ŒæœåŠ¡å™¨åˆ›å»ºèµ„æº&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		202</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚è¢«æ¥æ”¶ã€‚ä½†å¤„ç†å°šæœªå®Œæˆ&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		204</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;å®¢æˆ·ç«¯å‘ŠçŸ¥æœåŠ¡å™¨åˆ é™¤ä¸€ä¸ªèµ„æºï¼ŒæœåŠ¡å™¨ç§»é™¤å®ƒ&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		206</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æˆåŠŸã€‚ä½†æ˜¯åªæœ‰éƒ¨åˆ†å›åº”&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// é”™è¯¯çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		400</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æ— æ•ˆã€‚æ•°æ®ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		401</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æ²¡æœ‰æƒé™ã€‚ç¼ºå°‘API tokenï¼Œæ— æ•ˆæˆ–è€…è¶…æ—¶&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		403</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç”¨æˆ·å¾—åˆ°æˆæƒï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		404</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		406</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚å¤±è´¥ã€‚è¯·æ±‚å¤´éƒ¨ä¸ä¸€è‡´ï¼Œè¯·é‡è¯•&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		410</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		422</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚å¤±è´¥ã€‚è¯·éªŒè¯å‚æ•°&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		500</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		502</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç½‘å…³é”™è¯¯&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		503</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;æœåŠ¡ä¸å¯ç”¨ï¼ŒæœåŠ¡å™¨æš‚æ—¶è¿‡è½½æˆ–ç»´æŠ¤ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		504</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç½‘å…³è¶…æ—¶&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// md5åŠ å¯†æ–¹æ³•</span></span>
<span class="line"><span style="color:#61AFEF;">	_md5</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">password</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// 1.æŒ‡å®šåŠ å¯†æ–¹å¼</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> md5</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> crypto</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createHash</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;md5&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// 2.æŒ‡å®šéœ€è¦åŠ å¯†çš„å†…å®¹å’ŒåŠ å¯†ä¹‹åè¾“å‡ºçš„æ ¼å¼</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> hash</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> md5</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">// æŒ‡å®šéœ€è¦åŠ å¯†çš„å†…å®¹</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">digest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;hex&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// æŒ‡å®šåŠ å¯†ä¹‹åè¾“å‡ºçš„æ ¼å¼</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E06C75;"> hash</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// ç”¨æˆ·å¯†ç åŠ å¯†å·¥å…·æ–¹æ³•</span></span>
<span class="line"><span style="color:#61AFEF;">	generatePwd</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">password</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E06C75;">		password</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> password</span><span style="color:#56B6C2;"> +</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">config</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">keys</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> hash</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_md5</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E06C75;"> hash</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>service ä¸­è°ƒç”¨æ–¹æ³•ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// è°ƒç”¨ç”¨æˆ·å¯†ç åŠ å¯†æ–¹æ³•</span></span>
<span class="line"><span style="color:#E5C07B;">this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">helper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">generatePwd</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr><h3 id="_18-é˜²æ­¢é‡å¤æ³¨å†Œ" tabindex="-1">18.é˜²æ­¢é‡å¤æ³¨å†Œ <a class="header-anchor" href="#_18-é˜²æ­¢é‡å¤æ³¨å†Œ" aria-label="Permalink to &quot;18.é˜²æ­¢é‡å¤æ³¨å†Œ&quot;">â€‹</a></h3><p>æ–¹å¼ 1ï¼šæ•°æ®åº“æ’å…¥è¯­å¥ä½¿ç”¨ï¼šUNIQUE</p><p>æ–¹å¼ 2ï¼šæ’å…¥æ•°æ®å‰å…ˆæŸ¥è¯¢æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªç”¨æˆ·æˆ–è€…ç›¸åŒæ•°æ®</p><p>æŠ›å‡ºå¼‚å¸¸ï¼šthrow new Error(&#39;å½“å‰ç”¨æˆ·å·²å­˜åœ¨&#39;)</p><p>ctx è¿™è¾¹ä¼šæ•è·å¼‚å¸¸ï¼šctx.error(400, e.message);</p><hr><h3 id="_19-å®ç°ç™»å½•" tabindex="-1">19.å®ç°ç™»å½• <a class="header-anchor" href="#_19-å®ç°ç™»å½•" aria-label="Permalink to &quot;19.å®ç°ç™»å½•&quot;">â€‹</a></h3><h4 id="_1-å‰ç«¯ç™»å½•å-åç«¯éœ€è¦è¿”å›æ•°æ®" tabindex="-1">1.å‰ç«¯ç™»å½•åï¼Œåç«¯éœ€è¦è¿”å›æ•°æ® <a class="header-anchor" href="#_1-å‰ç«¯ç™»å½•å-åç«¯éœ€è¦è¿”å›æ•°æ®" aria-label="Permalink to &quot;1.å‰ç«¯ç™»å½•åï¼Œåç«¯éœ€è¦è¿”å›æ•°æ®&quot;">â€‹</a></h4><h4 id="_2-å®ç°ç™»å½•ä¿å­˜çŠ¶æ€-ä½¿ç”¨egg-redisåº“-egg-session-redisåº“-è¿æ¥-redis-ä¿å­˜ç™»å½•çš„-session" tabindex="-1">2.å®ç°ç™»å½•ä¿å­˜çŠ¶æ€ï¼šä½¿ç”¨<code>egg-redis</code>åº“+<code>egg-session-redis</code>åº“ï¼Œè¿æ¥ redisï¼Œä¿å­˜ç™»å½•çš„ session <a class="header-anchor" href="#_2-å®ç°ç™»å½•ä¿å­˜çŠ¶æ€-ä½¿ç”¨egg-redisåº“-egg-session-redisåº“-è¿æ¥-redis-ä¿å­˜ç™»å½•çš„-session" aria-label="Permalink to &quot;2.å®ç°ç™»å½•ä¿å­˜çŠ¶æ€ï¼šä½¿ç”¨\`egg-redis\`åº“+\`egg-session-redis\`åº“ï¼Œè¿æ¥ redisï¼Œä¿å­˜ç™»å½•çš„ session&quot;">â€‹</a></h4><p>egg-redis çš„ npm æ–‡æ¡£ï¼š<a href="https://www.npmjs.com/package/egg-redis" target="_blank" rel="noreferrer">egg-redis - npm (npmjs.com)</a></p><p>egg-session-redis çš„ npm æ–‡æ¡£ï¼š<a href="https://www.npmjs.com/package/egg-session-redis" target="_blank" rel="noreferrer">egg-session-redis - npm (npmjs.com)</a></p><h4 id="_3-é…ç½®æ’ä»¶" tabindex="-1">3.é…ç½®æ’ä»¶ <a class="header-anchor" href="#_3-é…ç½®æ’ä»¶" aria-label="Permalink to &quot;3.é…ç½®æ’ä»¶&quot;">â€‹</a></h4><p><code>config\\plugin.js</code>ä¸­ä½¿ç”¨ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&#39;use strict&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/** </span><span style="color:#C678DD;font-style:italic;">@type</span><span style="color:#7F848E;font-style:italic;"> Egg.EggPlugin */</span></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">    ajv </span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">        enable</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        package</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;egg-ajv&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#E06C75;">    sequelize </span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">        enable</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        package</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;egg-sequelize&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line"><span style="color:#E06C75;">    sessionRedis </span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">        enable</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">        package</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;egg-session-redis&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    },</span></span>
<span class="line highlighted"><span style="color:#E06C75;">    redis </span><span style="color:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="color:#E06C75;">        enable</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="color:#E06C75;">        package</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;egg-redis&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="_4-æ•°æ®åº“çš„è¿æ¥é…ç½®-éƒ½æ˜¯åœ¨config-config-default-jsæ–‡ä»¶å†…" tabindex="-1">4.æ•°æ®åº“çš„è¿æ¥é…ç½®ï¼Œéƒ½æ˜¯åœ¨<code>config\\config.default.js</code>æ–‡ä»¶å†… <a class="header-anchor" href="#_4-æ•°æ®åº“çš„è¿æ¥é…ç½®-éƒ½æ˜¯åœ¨config-config-default-jsæ–‡ä»¶å†…" aria-label="Permalink to &quot;4.æ•°æ®åº“çš„è¿æ¥é…ç½®ï¼Œéƒ½æ˜¯åœ¨\`config\\config.default.js\`æ–‡ä»¶å†…&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&#39;use strict&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * </span><span style="color:#C678DD;font-style:italic;">@param</span><span style="color:#E5C07B;font-style:italic;"> {Egg.EggAppInfo}</span><span style="color:#E06C75;font-style:italic;"> appInfo</span><span style="color:#7F848E;font-style:italic;"> app info</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;font-style:italic;"> appInfo</span><span style="color:#C678DD;"> =&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  /**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">   * built-in config</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">   * </span><span style="color:#C678DD;font-style:italic;">@type</span><span style="color:#E5C07B;font-style:italic;"> {Egg.EggAppConfig}</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">   **/</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> config</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // use for cookie sign key, should change to your own and keep security</span></span>
<span class="line"><span style="color:#E5C07B;">  config</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">keys</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> appInfo</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">name</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &#39;_1592213709118_461&#39;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // add your middleware config here</span></span>
<span class="line"><span style="color:#E5C07B;">  config</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">middleware</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">  config</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ajv</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">    keyword</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;schema&#39;</span><span style="color:#ABB2BF;">,  </span><span style="color:#7F848E;font-style:italic;">// to indicate the namespace and path of schemas, default as &#39;schema&#39;</span></span>
<span class="line"><span style="color:#E06C75;">    allErrors</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,    </span><span style="color:#7F848E;font-style:italic;">// required for custom error message</span></span>
<span class="line"><span style="color:#E06C75;">    jsonPointers</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,  </span><span style="color:#7F848E;font-style:italic;">// required for custom error message</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"><span style="color:#E5C07B;">  config</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">sequelize</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">      dialect</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;mysql&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      host</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      port</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3306</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      user</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;root&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;root&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">      database</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;demo&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line highlighted"><span style="color:#E5C07B;">  config</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">redis</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line highlighted"><span style="color:#E06C75;">      client</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line highlighted"><span style="color:#E06C75;">          port</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">6379</span><span style="color:#ABB2BF;">,          </span><span style="color:#7F848E;font-style:italic;">// Redis port</span></span>
<span class="line highlighted"><span style="color:#E06C75;">          host</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#ABB2BF;">,   </span><span style="color:#7F848E;font-style:italic;">// Redis host</span></span>
<span class="line highlighted"><span style="color:#E06C75;">          password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="color:#E06C75;">          db</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span></span>
<span class="line highlighted"><span style="color:#ABB2BF;">      },</span></span>
<span class="line highlighted"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // add your user config here</span></span>
<span class="line"><span style="color:#C678DD;">  const</span><span style="color:#E5C07B;"> userConfig</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // myAppName: &#39;egg&#39;,</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">    ...</span><span style="color:#E06C75;">config</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    ...</span><span style="color:#E06C75;">userConfig</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">  };</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h4 id="_5-å‰ç«¯ç™»å½•åä¼ é€’è¿‡æ¥å‚æ•°-egg-session-redisåº“ä¼šæ³¨å…¥ä¸Šä¸‹æ–‡å±æ€§-ctx-session-user" tabindex="-1">5.å‰ç«¯ç™»å½•åä¼ é€’è¿‡æ¥å‚æ•°ï¼Œ<code>egg-session-redis</code>åº“ä¼šæ³¨å…¥ä¸Šä¸‹æ–‡å±æ€§ï¼šctx.session.user <a class="header-anchor" href="#_5-å‰ç«¯ç™»å½•åä¼ é€’è¿‡æ¥å‚æ•°-egg-session-redisåº“ä¼šæ³¨å…¥ä¸Šä¸‹æ–‡å±æ€§-ctx-session-user" aria-label="Permalink to &quot;5.å‰ç«¯ç™»å½•åä¼ é€’è¿‡æ¥å‚æ•°ï¼Œ\`egg-session-redis\`åº“ä¼šæ³¨å…¥ä¸Šä¸‹æ–‡å±æ€§ï¼šctx.session.user&quot;">â€‹</a></h4><p>æŠŠ ctx.session.user ä¿å­˜ç™»å½•çš„ç”¨æˆ·</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">session</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">user</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> å‰ç«¯ç™»å½•å</span><span style="color:#ABB2BF;">ï¼Œ</span><span style="color:#E06C75;">åç«¯æŸ¥è¯¢åˆ°çš„ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><hr><h3 id="_20-egg-é¡¹ç›®æµ‹è¯•-å•å…ƒæµ‹è¯•" tabindex="-1">20.Egg é¡¹ç›®æµ‹è¯•ï¼šå•å…ƒæµ‹è¯• <a class="header-anchor" href="#_20-egg-é¡¹ç›®æµ‹è¯•-å•å…ƒæµ‹è¯•" aria-label="Permalink to &quot;20.Egg é¡¹ç›®æµ‹è¯•ï¼šå•å…ƒæµ‹è¯•&quot;">â€‹</a></h3><h4 id="å•å…ƒæµ‹è¯•" tabindex="-1">å•å…ƒæµ‹è¯• <a class="header-anchor" href="#å•å…ƒæµ‹è¯•" aria-label="Permalink to &quot;å•å…ƒæµ‹è¯•&quot;">â€‹</a></h4><p>æ–‡æ¡£ï¼š<a href="https://www.eggjs.org/zh-CN/core/unittest" target="_blank" rel="noreferrer">å•å…ƒæµ‹è¯• - Egg (eggjs.org)</a></p><h5 id="_1-ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•" tabindex="-1">1.ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•? <a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•" aria-label="Permalink to &quot;1.ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•?&quot;">â€‹</a></h5><p>å•å…ƒæµ‹è¯•æ˜¯æŒ‡å¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥å’ŒéªŒè¯</p><h5 id="_2-ä»€ä¹ˆæ˜¯æœ€å°å¯æµ‹è¯•å•å…ƒ" tabindex="-1">2.ä»€ä¹ˆæ˜¯æœ€å°å¯æµ‹è¯•å•å…ƒ? <a class="header-anchor" href="#_2-ä»€ä¹ˆæ˜¯æœ€å°å¯æµ‹è¯•å•å…ƒ" aria-label="Permalink to &quot;2.ä»€ä¹ˆæ˜¯æœ€å°å¯æµ‹è¯•å•å…ƒ?&quot;">â€‹</a></h5><p>ä¸€ä¸ªå‡½æ•°, ä¸€ä¸ªç±», ä¸€ä¸ªæ–‡ä»¶, è¿™äº›éƒ½å¯ä»¥ç§°ä¹‹ä¸ºæœ€å°å¯æµ‹è¯•å•å…ƒ</p><p>å…·ä½“éœ€è¦æ ¹æ®å®é™…æƒ…å†µå»åˆ¤å®šå…¶å…·ä½“å«ä¹‰, ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä»¥å‡½æ•°ä½œä¸ºæœ€å°å•å…ƒå³å¯</p><h5 id="_3-å•å…ƒæµ‹è¯•æœ‰ä»€ä¹ˆç”¨" tabindex="-1">3.å•å…ƒæµ‹è¯•æœ‰ä»€ä¹ˆç”¨? <a class="header-anchor" href="#_3-å•å…ƒæµ‹è¯•æœ‰ä»€ä¹ˆç”¨" aria-label="Permalink to &quot;3.å•å…ƒæµ‹è¯•æœ‰ä»€ä¹ˆç”¨?&quot;">â€‹</a></h5><ul><li><p>ä¿è¯ä»£ç çš„æ­£ç¡®æ€§</p></li><li><p>ä¿å­˜ç¨‹åºçš„ç¨³å®šæ€§</p></li><li><p>å¢å¼ºè‡ªä¿¡å¿ƒ</p></li><li><p>å…¬å¸é¢†å¯¼è¦æ±‚(çº¢ç»¿ç¯)</p></li></ul><h5 id="_4-åœ¨-eggjs-ä¸­å¦‚ä½•è¿›è¡Œå•å…ƒæµ‹è¯•" tabindex="-1">4.åœ¨ EggJS ä¸­å¦‚ä½•è¿›è¡Œå•å…ƒæµ‹è¯• <a class="header-anchor" href="#_4-åœ¨-eggjs-ä¸­å¦‚ä½•è¿›è¡Œå•å…ƒæµ‹è¯•" aria-label="Permalink to &quot;4.åœ¨ EggJS ä¸­å¦‚ä½•è¿›è¡Œå•å…ƒæµ‹è¯•&quot;">â€‹</a></h5><h6 id="_4-1-eggjs-ä½¿ç”¨-mocha-æµ‹è¯•æ¡†æ¶å’Œ-power-assert-æ–­è¨€åº“æ¥è¿›è¡Œå•å…ƒæµ‹è¯•" tabindex="-1">4.1 EggJS ä½¿ç”¨ Mocha æµ‹è¯•æ¡†æ¶å’Œ power-assert æ–­è¨€åº“æ¥è¿›è¡Œå•å…ƒæµ‹è¯• <a class="header-anchor" href="#_4-1-eggjs-ä½¿ç”¨-mocha-æµ‹è¯•æ¡†æ¶å’Œ-power-assert-æ–­è¨€åº“æ¥è¿›è¡Œå•å…ƒæµ‹è¯•" aria-label="Permalink to &quot;4.1 EggJS ä½¿ç”¨ Mocha æµ‹è¯•æ¡†æ¶å’Œ power-assert æ–­è¨€åº“æ¥è¿›è¡Œå•å…ƒæµ‹è¯•&quot;">â€‹</a></h6><ul><li><p>Mochaï¼š<a href="https://mochajs.org/" target="_blank" rel="noreferrer">https://mochajs.org/</a></p></li><li><p>ä½œç”¨ : æä¾›äº†ç¼–å†™æµ‹è¯•ä»£ç çš„æ–¹æ³•</p></li><li><p>power-assert: <a href="https://github.com/power-assert-js/power-assert" target="_blank" rel="noreferrer">https://github.com/power-assert-js/power-assert</a></p></li><li><p>ä½œç”¨ : åˆ¤æ–­æµ‹è¯•ç»“æœæ˜¯å¦æ­£ç¡®</p></li></ul><h6 id="_4-2-eggjs-è¿˜æŠ½å–äº†ä¸€ä¸ªå«åš-egg-mock-çš„è¾…åŠ©æ¨¡å—-é…åˆ-mocha-å’Œ-power-assert-è¿›è¡Œæµ‹è¯•" tabindex="-1">4.2 EggJS è¿˜æŠ½å–äº†ä¸€ä¸ªå«åš egg-mock çš„è¾…åŠ©æ¨¡å—, é…åˆ Mocha å’Œ power-assert è¿›è¡Œæµ‹è¯• <a class="header-anchor" href="#_4-2-eggjs-è¿˜æŠ½å–äº†ä¸€ä¸ªå«åš-egg-mock-çš„è¾…åŠ©æ¨¡å—-é…åˆ-mocha-å’Œ-power-assert-è¿›è¡Œæµ‹è¯•" aria-label="Permalink to &quot;4.2 EggJS è¿˜æŠ½å–äº†ä¸€ä¸ªå«åš egg-mock çš„è¾…åŠ©æ¨¡å—, é…åˆ Mocha å’Œ power-assert è¿›è¡Œæµ‹è¯•&quot;">â€‹</a></h6><ul><li><p>egg-mock: Â  Â  <a href="https://www.npmjs.com/package/egg-mock" target="_blank" rel="noreferrer">https://www.npmjs.com/package/egg-mock</a></p></li><li><p>ä½œç”¨ : å¸®åŠ©æˆ‘ä»¬èƒ½å¤Ÿåœ¨å•å…ƒæµ‹è¯•ä¸­æ¨¡æ‹Ÿ app, context, cookie, session, ç½‘ç»œè¯·æ±‚ç­‰</p></li></ul><h6 id="_4-3-eggjs-è§„å®šäº†æµ‹è¯•æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„å’Œæ–‡ä»¶åç§°" tabindex="-1">4.3 EggJS è§„å®šäº†æµ‹è¯•æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„å’Œæ–‡ä»¶åç§° <a class="header-anchor" href="#_4-3-eggjs-è§„å®šäº†æµ‹è¯•æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„å’Œæ–‡ä»¶åç§°" aria-label="Permalink to &quot;4.3 EggJS è§„å®šäº†æµ‹è¯•æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„å’Œæ–‡ä»¶åç§°&quot;">â€‹</a></h6><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># æµ‹è¯•æ–‡ä»¶çš„ç›®å½•ç»“æ„å’Œæ–‡ä»¶åç§° å’Œ è¢«æµ‹è¯•æ–‡ä»¶çš„ç›®å½•ç»“æ„å’Œåç§°å¿…é¡»ä¸€æ ·</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># æµ‹è¯•æ–‡ä»¶çš„æ–‡ä»¶åç§°å¢åŠ .teståç¼€</span></span>
<span class="line"><span style="color:#56B6C2;">test</span></span>
<span class="line"><span style="color:#61AFEF;">    app</span></span>
<span class="line"><span style="color:#61AFEF;">    â”œâ”€â”€â”€â”€</span></span>
<span class="line"><span style="color:#61AFEF;">       â”œâ”€â”€</span><span style="color:#98C379;"> controller</span></span>
<span class="line"><span style="color:#61AFEF;">       â”‚</span><span style="color:#98C379;">   â””â”€â”€</span><span style="color:#98C379;"> home.test.js</span></span>
<span class="line"><span style="color:#61AFEF;">       â”œâ”€â”€</span><span style="color:#98C379;"> hello.test.js</span></span>
<span class="line"><span style="color:#61AFEF;">       â””â”€â”€</span><span style="color:#98C379;"> service</span></span>
<span class="line"><span style="color:#61AFEF;">           â””â”€â”€</span><span style="color:#98C379;"> user.test.js</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h6 id="_4-4-egg-é¡¹ç›®è¿è¡Œæµ‹è¯•æ–‡ä»¶" tabindex="-1">4.4 egg é¡¹ç›®è¿è¡Œæµ‹è¯•æ–‡ä»¶ <a class="header-anchor" href="#_4-4-egg-é¡¹ç›®è¿è¡Œæµ‹è¯•æ–‡ä»¶" aria-label="Permalink to &quot;4.4 egg é¡¹ç›®è¿è¡Œæµ‹è¯•æ–‡ä»¶&quot;">â€‹</a></h6><p>EggJS è§„å®šæˆ‘ä»¬ä½¿ç”¨ egg-bin test æ¥è¿è¡Œæˆ‘ä»¬ç¼–å†™çš„æµ‹è¯•æ–‡ä»¶</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">egg-bin</span><span style="color:#98C379;"> test</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><hr><h4 id="æµ‹è¯•åº“æ¨¡æ¿å’Œæµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ" tabindex="-1">æµ‹è¯•åº“æ¨¡æ¿å’Œæµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ <a class="header-anchor" href="#æµ‹è¯•åº“æ¨¡æ¿å’Œæµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ" aria-label="Permalink to &quot;æµ‹è¯•åº“æ¨¡æ¿å’Œæµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">app   :æœåŠ¡ç«¯å®ä¾‹å¯¹è±¡</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">mock  :eggæä¾›ç»™æˆ‘ä»¬çš„è¾…åŠ©æ¨¡å—å¯¹è±¡</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">assert:æ–­è¨€åº“å¯¹è±¡</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">* */</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ä¸€ä¸ªdescribeå‡½æ•°å°±æ˜¯ä¸€ç»„ç›¸å…³çš„æµ‹è¯•</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦æŠŠä¸€ç»„ç›¸å…³çš„æµ‹è¯•å†™åˆ°ä¸€ä¸ªdescribeå‡½æ•°ä¸­</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">ç¬¬ä¸€ä¸ªå‚æ•°: è¿™ç»„æµ‹è¯•çš„åç§°</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">ç¬¬äºŒä¸ªå‚æ•°: ç¼–å†™è¿™ç»„æµ‹è¯•å…·ä½“ä»£ç çš„åœ°æ–¹</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">* */</span></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/controller/user.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  åœ¨ä¸€ä¸ªdescribeæ–¹æ³•ä¸­çš„ä¸€ä¸ªitå°±æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  ä¸€ä¸ªitå¯ä»¥ç”¨æ¥æµ‹è¯•ä¸€ä¸ªæ–¹æ³•(å‡½æ•°)</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  ç¬¬ä¸€ä¸ªå‚æ•°: ç»™å½“å‰çš„è¿™ä¸ªæµ‹è¯•å–çš„åç§°</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  ç¬¬äºŒä¸ªå‚æ•°: ç¼–å†™å…·ä½“æµ‹è¯•ä»£ç çš„å‡½æ•°</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  * */</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// it(&#39;should assert&#39;, () =&gt; {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	//</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// });</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  Mochaæµ‹è¯•åº“çš„ç”Ÿå‘½å‘¨æœŸé’©å­</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  å•ä¸ªæµ‹è¯•ç”¨ä¾‹çš„</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  before -&gt; beforeEach -&gt; it -&gt; afterEach -&gt; after</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  å¤šä¸ªæµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  before -&gt; beforeEach -&gt; it -&gt; afterEach -&gt; beforeEach -&gt; it -&gt; afterEach -&gt; after</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  before -&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  beforeEach -&gt; it -&gt; afterEach</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  beforeEach -&gt; it -&gt; afterEach</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  beforeEach -&gt; it -&gt; afterEach</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  -&gt; after</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  ç”Ÿå‘½å‘¨æœŸé’©å­çš„ä½œç”¨:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œä¹‹å‰å»ç”³è¯·ä¸€äº›èµ„æº</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œä¹‹åå»é‡Šæ”¾ç”³è¯·çš„èµ„æº</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  ä¾‹å¦‚: æˆ‘ä»¬éœ€è¦æµ‹è¯•æ•°æ®åº“, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ä¹‹å‰å¾€æ•°æ®åº“ä¸­æ·»åŠ ä¸€äº›æµ‹è¯•æ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        ç„¶ååœ¨æµ‹è¯•å®Œæˆä¹‹ååˆ é™¤è¿™äº›æµ‹è¯•æ•°æ®</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  * */</span></span>
<span class="line"><span style="color:#61AFEF;">	before</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;before&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	beforeEach</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;beforeEach&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;å…·ä½“çš„æµ‹è¯•ç”¨ä¾‹&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;it&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;å…·ä½“çš„æµ‹è¯•ç”¨ä¾‹&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;it&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;å…·ä½“çš„æµ‹è¯•ç”¨ä¾‹&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;it&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	afterEach</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;afterEach&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	after</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;after&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><hr><h4 id="åŒæ­¥æµ‹è¯•å’Œå¼‚æ­¥æµ‹è¯•" tabindex="-1">åŒæ­¥æµ‹è¯•å’Œå¼‚æ­¥æµ‹è¯• <a class="header-anchor" href="#åŒæ­¥æµ‹è¯•å’Œå¼‚æ­¥æµ‹è¯•" aria-label="Permalink to &quot;åŒæ­¥æµ‹è¯•å’Œå¼‚æ­¥æµ‹è¯•&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/controller/user.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  Mocha: åŒæ­¥æµ‹è¯•å’Œå¼‚æ­¥æµ‹è¯•</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  * */</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;åŒæ­¥æµ‹è¯•&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// console.log(&#39;it&#39;);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æ¨¡æ‹Ÿäº†ä¸€ä¸ªä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> ctx</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockContext</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">			session</span><span style="color:#ABB2BF;">: { </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;lnj&quot;</span><span style="color:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;">		});</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// å¸Œæœ›ä¸Šä¸‹æ–‡ä¸­æœ‰session, å¹¶ä¸”ä¿å­˜äº†name, å¹¶ä¸”nameæ˜¯lnj</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// ä»¥ä¸‹ä»£ç çš„å«ä¹‰: æ–­å®šä¸Šä¸‹æ–‡ä¸­æœ‰session, sessionä¸­æœ‰name,nameå–å€¼æ˜¯lnj</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">session</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">name</span><span style="color:#56B6C2;"> ===</span><span style="color:#98C379;"> &quot;lnj&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;å¼‚æ­¥æµ‹è¯•-promise&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">httpRequest</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/public/login.html&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">expect</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;å¼‚æ­¥æµ‹è¯•-callback&quot;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">done</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">httpRequest</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/public/login.html&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">expect</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">done</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;å¼‚æ­¥æµ‹è¯•-async+await&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		await</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">httpRequest</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/public/login.html&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">expect</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">200</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><hr><h4 id="æµ‹è¯•æ§åˆ¶å™¨" tabindex="-1">æµ‹è¯•æ§åˆ¶å™¨ <a class="header-anchor" href="#æµ‹è¯•æ§åˆ¶å™¨" aria-label="Permalink to &quot;æµ‹è¯•æ§åˆ¶å™¨&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/controller/user.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•æ³¨å†Œ-æˆåŠŸ&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockCsrf</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> user</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">username</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;123@qq.com&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;abc123&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">gender</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç”·&quot;</span><span style="color:#ABB2BF;"> };</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> response</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> await</span><span style="color:#E06C75;"> app</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">httpRequest</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/api/user/register&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">send</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">user</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">body</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ===</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•æ³¨å†Œ-ç”¨æˆ·åä¸ç¬¦åˆé¢„æœŸ&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockCsrf</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> user</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">username</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;jonathan&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;abc123&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">gender</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç”·&quot;</span><span style="color:#ABB2BF;"> };</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> response</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> await</span><span style="color:#E06C75;"> app</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">httpRequest</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/api/user/register&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">send</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">user</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">body</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ===</span><span style="color:#D19A66;"> 400</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•æ³¨å†Œ-å¯†ç ä¸ç¬¦åˆé¢„æœŸ&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockCsrf</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> user</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">username</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;234@qq.com&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;123&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">gender</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç”·&quot;</span><span style="color:#ABB2BF;"> };</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> response</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> await</span><span style="color:#E06C75;"> app</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">httpRequest</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">post</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;/api/user/register&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">send</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">user</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">body</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ===</span><span style="color:#D19A66;"> 400</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// æµ‹è¯•å®Œæˆæ‰§è¡Œ</span></span>
<span class="line"><span style="color:#61AFEF;">	after</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		await</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">model</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">destroy</span><span style="color:#ABB2BF;">({ </span><span style="color:#E06C75;">truncate</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">force</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> });</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><hr><h4 id="æµ‹è¯•-service" tabindex="-1">æµ‹è¯• Service <a class="header-anchor" href="#æµ‹è¯•-service" aria-label="Permalink to &quot;æµ‹è¯• Service&quot;">â€‹</a></h4><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/service/user.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•åˆ›å»ºç”¨æˆ·-æˆåŠŸ&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æµ‹è¯•åˆ›å»ºæˆåŠŸ</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> ctx</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockContext</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> user</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> { </span><span style="color:#E06C75;">username</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;123@qq.com&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;abc123&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">gender</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç”·&quot;</span><span style="color:#ABB2BF;"> };</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> res</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> await</span><span style="color:#E5C07B;"> ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">service</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createUser</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">user</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">username</span><span style="color:#56B6C2;"> ===</span><span style="color:#98C379;"> &quot;123@qq.com&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æµ‹è¯•ç”¨æˆ·åé‡å¤æƒ…å†µ</span></span>
<span class="line"><span style="color:#C678DD;">		try</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">			await</span><span style="color:#E5C07B;"> ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">service</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">user</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createUser</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">user</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		} </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">e</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">			assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">e</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#61AFEF;">	after</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		await</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">model</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">User</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">destroy</span><span style="color:#ABB2BF;">({ </span><span style="color:#E06C75;">truncate</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;">force</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> });</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><hr><h4 id="æµ‹è¯•-application" tabindex="-1">æµ‹è¯• Application <a class="header-anchor" href="#æµ‹è¯•-application" aria-label="Permalink to &quot;æµ‹è¯• Application&quot;">â€‹</a></h4><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼šapp/extend/application.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> cache</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {};</span></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	set</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">key</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">value</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E06C75;">		cache</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">key</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#E06C75;"> value</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#61AFEF;">	get</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">key</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E06C75;"> cache</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">key</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>æµ‹è¯•æ–‡ä»¶ï¼štest\\app\\extend\\application.test.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/extend/application.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•application&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">		app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">set</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;name&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;it666.com&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;name&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">===</span><span style="color:#98C379;"> &quot;it666.com&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h4 id="æµ‹è¯•-context" tabindex="-1">æµ‹è¯• Context <a class="header-anchor" href="#æµ‹è¯•-context" aria-label="Permalink to &quot;æµ‹è¯• Context&quot;">â€‹</a></h4><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼šapp\\extend\\context.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	success</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">data</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">code</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">msg</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;æˆåŠŸ&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// this å°±æ˜¯ ctx å¯¹è±¡ï¼Œåœ¨å…¶ä¸­å¯ä»¥è°ƒç”¨ ctx ä¸Šçš„å…¶ä»–æ–¹æ³•ï¼Œæˆ–è®¿é—®å±æ€§</span></span>
<span class="line"><span style="color:#E5C07B;">		this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">			code</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">code</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">			msg</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">			data</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">data</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">		};</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#61AFEF;">	error</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">code</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 500</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">msg</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;é”™è¯¯&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// this å°±æ˜¯ ctx å¯¹è±¡ï¼Œåœ¨å…¶ä¸­å¯ä»¥è°ƒç”¨ ctx ä¸Šçš„å…¶ä»–æ–¹æ³•ï¼Œæˆ–è®¿é—®å±æ€§</span></span>
<span class="line"><span style="color:#E5C07B;">		this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">body</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">			code</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">code</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">			msg</span><span style="color:#ABB2BF;">: </span><span style="color:#E06C75;">msg</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">		};</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>æµ‹è¯•æ–‡ä»¶ï¼štest\\app\\extend\\context.test.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/extend/context.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•context&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> ctx</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockContext</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">		ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">error</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">body</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ===</span><span style="color:#D19A66;"> 500</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">body</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">msg</span><span style="color:#56B6C2;"> ===</span><span style="color:#98C379;"> &quot;é”™è¯¯&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr><h4 id="æµ‹è¯•-request" tabindex="-1">æµ‹è¯• Request <a class="header-anchor" href="#æµ‹è¯•-request" aria-label="Permalink to &quot;æµ‹è¯• Request&quot;">â€‹</a></h4><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼šapp\\extend\\request.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	isChrome</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> userAgent</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">get</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;user-agent&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">toLowerCase</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E5C07B;"> userAgent</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;chrome&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼štest\\app\\extend\\request.test.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/extend/request.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•request&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> ctx</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockContext</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">			headers</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">				// &#39;user-agent&#39;:&#39;Chrome&#39;</span></span>
<span class="line"><span style="color:#98C379;">				&quot;user-agent&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;Mozilla&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">			},</span></span>
<span class="line"><span style="color:#ABB2BF;">		});</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// assert(ctx.request.isChrome() === true);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">request</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isChrome</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">===</span><span style="color:#D19A66;"> false</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><hr><h4 id="æµ‹è¯•-response" tabindex="-1">æµ‹è¯• Response <a class="header-anchor" href="#æµ‹è¯•-response" aria-label="Permalink to &quot;æµ‹è¯• Response&quot;">â€‹</a></h4><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼šapp\\extend\\response.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	isSuccess</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">status</span><span style="color:#56B6C2;"> ===</span><span style="color:#D19A66;"> 200</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼štest\\app\\extend\\response.test.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/extend/request.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•response&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> ctx</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockContext</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">response</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">isSuccess</span><span style="color:#ABB2BF;">() </span><span style="color:#56B6C2;">===</span><span style="color:#D19A66;"> true</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h4 id="æµ‹è¯•-helper" tabindex="-1">æµ‹è¯• Helper <a class="header-anchor" href="#æµ‹è¯•-helper" aria-label="Permalink to &quot;æµ‹è¯• Helper&quot;">â€‹</a></h4><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼šapp\\extend\\helper.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> crypto</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;crypto&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">	errorCode</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æˆåŠŸçŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		200</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æˆåŠŸã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨è¿”å›ç›¸å…³æ•°æ®&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		201</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;èµ„æºåˆ›å»ºæˆåŠŸã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨æä¾›æ•°æ®ï¼ŒæœåŠ¡å™¨åˆ›å»ºèµ„æº&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		202</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚è¢«æ¥æ”¶ã€‚ä½†å¤„ç†å°šæœªå®Œæˆ&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		204</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;å®¢æˆ·ç«¯å‘ŠçŸ¥æœåŠ¡å™¨åˆ é™¤ä¸€ä¸ªèµ„æºï¼ŒæœåŠ¡å™¨ç§»é™¤å®ƒ&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		206</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æˆåŠŸã€‚ä½†æ˜¯åªæœ‰éƒ¨åˆ†å›åº”&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// é”™è¯¯çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		400</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æ— æ•ˆã€‚æ•°æ®ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		401</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚æ²¡æœ‰æƒé™ã€‚ç¼ºå°‘API tokenï¼Œæ— æ•ˆæˆ–è€…è¶…æ—¶&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		403</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç”¨æˆ·å¾—åˆ°æˆæƒï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		404</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		406</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚å¤±è´¥ã€‚è¯·æ±‚å¤´éƒ¨ä¸ä¸€è‡´ï¼Œè¯·é‡è¯•&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		410</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		422</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;è¯·æ±‚å¤±è´¥ã€‚è¯·éªŒè¯å‚æ•°&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç </span></span>
<span class="line"><span style="color:#D19A66;">		500</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		502</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç½‘å…³é”™è¯¯&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		503</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;æœåŠ¡ä¸å¯ç”¨ï¼ŒæœåŠ¡å™¨æš‚æ—¶è¿‡è½½æˆ–ç»´æŠ¤ã€‚&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#D19A66;">		504</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ç½‘å…³è¶…æ—¶&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#61AFEF;">	_md5</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">password</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// 1.æŒ‡å®šåŠ å¯†æ–¹å¼</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> md5</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> crypto</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createHash</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;md5&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">		// 2.æŒ‡å®šéœ€è¦åŠ å¯†çš„å†…å®¹å’ŒåŠ å¯†ä¹‹åè¾“å‡ºçš„æ ¼å¼</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> hash</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> md5</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">update</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">) </span><span style="color:#7F848E;font-style:italic;">// æŒ‡å®šéœ€è¦åŠ å¯†çš„å†…å®¹</span></span>
<span class="line"><span style="color:#ABB2BF;">			.</span><span style="color:#61AFEF;">digest</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;hex&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// æŒ‡å®šåŠ å¯†ä¹‹åè¾“å‡ºçš„æ ¼å¼</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E06C75;"> hash</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#61AFEF;">	generatePwd</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">password</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E06C75;">		password</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> password</span><span style="color:#56B6C2;"> +</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">config</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">keys</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> hash</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> this</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">_md5</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">password</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#E06C75;"> hash</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼štest\\app\\extend\\helper.test.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/extend/helper.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•helper&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> ctx</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">mockContext</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">helper</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">generatePwd</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;123&quot;</span><span style="color:#ABB2BF;">) </span><span style="color:#56B6C2;">!==</span><span style="color:#98C379;"> &quot;123&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h4 id="æµ‹è¯•-schedule" tabindex="-1">æµ‹è¯• schedule <a class="header-anchor" href="#æµ‹è¯•-schedule" aria-label="Permalink to &quot;æµ‹è¯• schedule&quot;">â€‹</a></h4><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼Œå®šæ—¶ä»»åŠ¡ï¼šapp\\schedule\\updateMessage.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// å®šæ—¶ä»»åŠ¡</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> Subscription</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">Subscription</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">let</span><span style="color:#E06C75;"> count</span><span style="color:#56B6C2;"> =</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> UpdateCache</span><span style="color:#C678DD;"> extends</span><span style="color:#E5C07B;"> Subscription</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// é€šè¿‡ schedule å±æ€§æ¥è®¾ç½®å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œé—´éš”ç­‰é…ç½®</span></span>
<span class="line"><span style="color:#C678DD;">	static</span><span style="color:#C678DD;"> get</span><span style="color:#61AFEF;"> schedule</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#C678DD;">		return</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">			interval</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;10s&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">// é—´éš”3ç§’æ‰§è¡Œä¸€æ¬¡</span></span>
<span class="line"><span style="color:#E06C75;">			type</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;all&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#7F848E;font-style:italic;">//  allè¡¨ç¤ºå½“å‰æœåŠ¡å™¨ä¸Šæ‰€æœ‰ç›¸åŒçš„Nodeè¿›ç¨‹éƒ½æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#ABB2BF;">		};</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// subscribe æ˜¯çœŸæ­£å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶è¢«è¿è¡Œçš„å‡½æ•°</span></span>
<span class="line"><span style="color:#C678DD;">	async</span><span style="color:#61AFEF;"> subscribe</span><span style="color:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#E5C07B;">		this</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">ctx</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">msg</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> \`lnj+</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">count</span><span style="color:#56B6C2;">++</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">; </span><span style="color:#7F848E;font-style:italic;">// lnj+1 lnj+2</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> UpdateCache</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>è¢«æµ‹è¯•æ–‡ä»¶ï¼štest\\app\\schedule\\updateMessage.test.js</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#98C379;">&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> { </span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">mock</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">assert</span><span style="color:#ABB2BF;"> } </span><span style="color:#56B6C2;">=</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;egg-mock/bootstrap&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">describe</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;test/app/schedule/updateMessage.test.js&quot;</span><span style="color:#ABB2BF;">, () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	it</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;æµ‹è¯•updateMessage&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">async</span><span style="color:#ABB2BF;"> () </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		await</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">runSchedule</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;updateMessage&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">msg</span><span style="color:#56B6C2;"> ===</span><span style="color:#98C379;"> &quot;lnj+1&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">		await</span><span style="color:#E5C07B;"> app</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">runSchedule</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;updateMessage&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">		assert</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">app</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">msg</span><span style="color:#56B6C2;"> ===</span><span style="color:#98C379;"> &quot;lnj+2&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr><h4 id="æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ" tabindex="-1">æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ <a class="header-anchor" href="#æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ" aria-label="Permalink to &quot;æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ&quot;">â€‹</a></h4><p>1.æµ‹è¯•æŠ¥å‘Šç”Ÿæˆå‘½ä»¤ï¼špackage.json çš„&quot;script&quot;å†…çš„å‘½ä»¤ï¼š&quot;cov&quot;: &quot;egg-bin cov&quot;,</p><p>2.è¿è¡Œå‘½ä»¤ï¼š<code>npm run cov</code></p><p>3.ç­‰å¾…ç”Ÿæˆï¼Œä¼šåœ¨é¡¹ç›®ç”Ÿæˆ<code>coverage</code>ç›®å½•ï¼ŒæŠŠ<code>coverage</code>ç›®å½•ä¸‹çš„<code>lcov-report</code>ç›®å½•å†…çš„ index.html æ‰“å¼€</p><p>4.æ‰“å¼€åå°±æ˜¯çœ‹è§å„ç§æµ‹è¯•æŠ¥å‘Š</p><h2 id="egg-bag-framework" tabindex="-1">egg-bag-framework <a class="header-anchor" href="#egg-bag-framework" aria-label="Permalink to &quot;egg-bag-framework&quot;">â€‹</a></h2><p><a href="https://juejin.cn/post/7321943946308976680" target="_blank" rel="noreferrer">éƒ½åšå‰ç«¯å¼€å‘äº†ï¼Œæ¥å£è‡ªå·±è¿˜ä¸ä¼šå†™å˜›ï¼ŸğŸ’˜ - æ˜é‡‘ (juejin.cn)</a></p>`,248)]))}const A=n(t,[["render",r]]);export{F as __pageData,A as default};
