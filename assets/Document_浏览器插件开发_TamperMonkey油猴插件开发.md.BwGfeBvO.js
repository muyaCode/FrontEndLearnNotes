import{_ as n,c as a,o as l,ah as p}from"./chunks/framework.DqD713j2.js";const e="/FrontEndLearnNotes/assets/197623e925af452ea8d050e4425030d3tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.DjdwTYNm.webp",o="/FrontEndLearnNotes/assets/e262e2c29882467dacf6d579b201741btplv-k3u1fbpfcp-zoom-in-crop-mark1512000.wurGFosT.webp",t="/FrontEndLearnNotes/assets/7059031b3d2e48c89de37d7573628b13tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.CF55l2sv.webp",r="/FrontEndLearnNotes/assets/c545654833bf40178d3ab748f9e2473ctplv-k3u1fbpfcp-zoom-in-crop-mark1512000.BU9K4Eua.webp",c="/FrontEndLearnNotes/assets/27eac042636448e587f241bf6e9ec46dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000.9xikEFYp.webp",i="/FrontEndLearnNotes/assets/65181fe045894837bafc49208b55d163tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.DV-eyau3.webp",B="/FrontEndLearnNotes/assets/48ef992430ee42f8adbc2a84fc437c39tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.BfPuA6A2.webp",y="/FrontEndLearnNotes/assets/6a8ff7489acf4ac0893c259ea325470btplv-k3u1fbpfcp-zoom-in-crop-mark1512000.D9N1wGTa.webp",b="/FrontEndLearnNotes/assets/d569a78c7dd04bf7921a8eda387fb0f1tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.ts-BiciE.webp",u="/FrontEndLearnNotes/assets/5e911ff8f14942b98d7395a60fafcd4dtplv-k3u1fbpfcp-zoom-in-crop-mark1512000.CLyuGDC0.webp",d="/FrontEndLearnNotes/assets/7fcfcbb2447e4491aa7135926fdcd938tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.BbFGUWjw.webp",m="/FrontEndLearnNotes/assets/7b893892c3ca4252adcd85e392407170tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.BmlYkJjJ.webp",F="/FrontEndLearnNotes/assets/f9e90c261cff49fbb1294fd884ebfa10tplv-k3u1fbpfcp-zoom-in-crop-mark1512000.BDEIKyJH.webp",_=JSON.parse('{"title":"TamperMonkey 油猴插件开发","description":"","frontmatter":{},"headers":[],"relativePath":"Document/浏览器插件开发/TamperMonkey油猴插件开发.md","filePath":"Document/浏览器插件开发/TamperMonkey油猴插件开发.md","lastUpdated":1750954157000}'),A={name:"Document/浏览器插件开发/TamperMonkey油猴插件开发.md"};function C(h,s,E,f,g,q){return l(),a("div",null,s[0]||(s[0]=[p(`<h1 id="tampermonkey-油猴插件开发" tabindex="-1">TamperMonkey 油猴插件开发 <a class="header-anchor" href="#tampermonkey-油猴插件开发" aria-label="Permalink to &quot;TamperMonkey 油猴插件开发&quot;">​</a></h1><p><a href="https://mp.weixin.qq.com/s/Wqjfd-lo-T3vCfY6lRoc4A" target="_blank" rel="noreferrer">js 逆向-你要学会偷懒「自用油猴脚本」 (qq.com)</a></p><h2 id="相关网站" tabindex="-1">相关网站 <a class="header-anchor" href="#相关网站" aria-label="Permalink to &quot;相关网站&quot;">​</a></h2><p>官网首页：<a href="https://www.tampermonkey.net/index.php" target="_blank" rel="noreferrer">首页 | Tampermonkey</a></p><p>搜索脚本：<a href="https://www.tampermonkey.net/scripts.php" target="_blank" rel="noreferrer">用户脚本 | Tampermonkey</a></p><p>开发文档：<a href="https://www.tampermonkey.net/documentation.php" target="_blank" rel="noreferrer">文档 | Tampermonkey</a></p><p>开发问题：<a href="https://www.tampermonkey.net/faq.php" target="_blank" rel="noreferrer">常问问题 | Tampermonkey</a></p><p>油猴中文网：<a href="https://bbs.tampermonkey.net.cn/" target="_blank" rel="noreferrer">油猴中文网 - 油猴脚本分享交流 (tampermonkey.net.cn)</a></p><p>油猴脚本列表：<a href="https://scriptcat.org/zh-CN/search" target="_blank" rel="noreferrer">用户脚本列表 - ScriptCat</a></p><h2 id="一、前言" tabindex="-1">一、前言 <a class="header-anchor" href="#一、前言" aria-label="Permalink to &quot;一、前言&quot;">​</a></h2><p><strong>浏览器插件</strong> 泛指 Tampermonkey, Violentmonkey, Greasemonkey 这类给页面注入 js 的浏览器扩展。</p><p><strong>支持浏览器</strong>：Chrome、Microsoft、Edge、Firefox、Safari、Opera Next</p><p>「油猴脚本」是一段脚本代码，通过它可以让浏览器实现各种各样的扩展功能，和浏览器扩展的作用类似。 比如获去链接重定向、微博页面精简、去广告等，相当于给浏览器开了个挂，可以说是浏览器的辅助神器了！但浏览器扩展若要发布到 chrome 扩展市场，需要支付 5 美元，但「油猴脚本」可以随时随地发布，不需要支付任何费用费用。</p><p>通过在浏览器扩展在网页加载时注入特定的 js 达到更改页面布局效果等等一切 js 能做的事情。这些扩展也提供了一些网页没有的 api，使注入的 js 能突破网页默认的限制，实现其他的功能。</p><h2 id="二、了解-tampermonkey" tabindex="-1">二、了解 Tampermonkey <a class="header-anchor" href="#二、了解-tampermonkey" aria-label="Permalink to &quot;二、了解 Tampermonkey&quot;">​</a></h2><p>早期浏览器脚本的执行机制：动态创建一个 script 元素插入到 document ，当脚本执行完毕后删除 script 元素。但是这种方式有几个缺陷：</p><ol><li>插入 script 标签时会触发 DOMNodeInserted 事件，如下：</li></ol><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E5C07B;">document</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">addEventListener</span><span style="color:#ABB2BF;">（</span><span style="color:#98C379;">&quot;DOMNodeInserted&quot;</span><span style="color:#ABB2BF;">，()</span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;">{</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  // ...</span></span>
<span class="line"><span style="color:#ABB2BF;">}，</span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol><li>脚本封装的 GM_API 有泄露风险。可能会被恶意网页调用 GM_API 实现跨网页窃取数据。</li><li>脚本可以可以通过 file:// 路径来发起请求，读取用户磁盘数据，但这也给恶意网页开了后门，一旦被反向注入会导致用户本地隐私数据泄密。</li></ol><p>后面脚本新增了沙盒模式（iframe 方案/with+proxy 方案）进行重构，不再通过注入 script 元素的方式，也不会在宿主环境全局定义 GM_API。并引入了 <strong>XPCNativeWrappers</strong> 机制（返回了一个包装过的数据，这个数据是可以信任的，确保不会被网页进行恶意篡改）。</p><p>但是这个方案也不是完美的，也有一些问题：如在设置 onclick 回调函数的时候不可以直接进行赋值；在设置自定义属性的时候没有作用。这些都是因为可信任进程通信管道返回的是一个包装后的数据，而不是原来的数据本身，这时候我们只能使用 addEventListener 来进行添加 onclick 回调函数，使用 setAttribute 来设置自定义属性等等，这很繁琐。</p><p>为了妥协，Tampermonkey 提出了 <strong>unsafewindows</strong> ,它是原网页数据的一个映射，我们操纵它就相当于操纵原网页。注意：一旦使用了 unsafewindows，代表破坏了安全模型！并且 unsafewindows 的内容并不完全可信，需要谨慎处理！</p><p>默认情况下，脚本运行在沙盒环境下，此环境无法访问到前端 dom 。若声明 @grant none，那脚本就会被直接放在浏览器环境上下文中执行,这时脚本上下文（this）就是浏览器上下文（this）。这更加方便获取 dom 节点，但会导致 GM_API 无法使用。</p><p><strong>grant</strong> 属性可用来申请 <code>GM_*</code> 函数和 <strong>unsafeWindow</strong> 权限。</p><ul><li><strong>none</strong> 就是直接运行在前端页面中，此时脚本中的 this 指向宿主网页的 window 对象。</li><li><strong>unsafeWindow</strong> 和 <code>GM_*</code> 就是运行在沙盒环境，需要使用 <strong>unsafeWindow</strong> 去操作前端的元素。</li></ul><p>常用头部信息</p><table tabindex="0"><thead><tr><th>名称</th><th>描述</th><th>说明</th></tr></thead><tbody><tr><td>@name</td><td>脚本名称</td><td></td></tr><tr><td>@namespace</td><td>脚本命名空间</td><td></td></tr><tr><td>@version</td><td>脚本版本</td><td>语义化版本规则</td></tr><tr><td>@author</td><td>脚本作者</td><td>-</td></tr><tr><td>@description</td><td>脚本描述</td><td>-</td></tr><tr><td>@include</td><td>脚本匹配地址</td><td>可以使用正则表达式/通配符 *</td></tr><tr><td>@match</td><td>脚本匹配地址</td><td>允许使用通配符，更加严格</td></tr><tr><td>@exclude</td><td>排除脚本匹配地址</td><td>-</td></tr><tr><td>@require</td><td>引入外部 JS 文件</td><td>加载并执行的 js 文件，如 UNPKG、<a href="https://www.jsdelivr.com/" target="_blank" rel="noreferrer">jsDelivr</a> 等 cdn 或本地资源</td></tr><tr><td>@resource</td><td>预加载资源</td><td>将外部库保存成资源，可以在代码中通过 GM_getResourceURL 访问</td></tr><tr><td>@connect</td><td>获取网站访问权限</td><td>允许由 GM_xmlhttpRequest 检索的子域</td></tr><tr><td>@run-at</td><td>脚本运行时机</td><td>可选项：document-start、body、end、idle、menu</td></tr><tr><td>@grant</td><td>申请脚本环境/GM_API</td><td>none 表示直接注入宿主环境，unsafeWindow 表示沙盒环境，其他权限由 API 名称指定</td></tr><tr><td>@noframes</td><td>脚本标记</td><td>标记使脚本在主页上运行，但不在 iframe 上运行</td></tr></tbody></table><p>下面列举部分常用 GM_API，其它可见：<a href="https://www.tampermonkey.net/documentation.php#meta:grant" target="_blank" rel="noreferrer">文档 | Tampermonkey</a></p><table tabindex="0"><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>GM_addStyle</td><td>将给定样式添加到文档中并返回注入的样式元素</td></tr><tr><td>GM_addElement</td><td>创建指定的 HTML 元素，应用所有给定的属性并返回注入的 HTML 元素，此功能是实验性的</td></tr><tr><td>GM_setValue</td><td>存储一个给定名称的值</td></tr><tr><td>GM_getValue</td><td>从 GM_setValue 存储的名称中获取值</td></tr><tr><td>GM_deleteValue</td><td>将 GM_setValue 存储的名称删除</td></tr><tr><td>GM_listValues</td><td>列出存储的所有名称</td></tr><tr><td>GM_addValueChangeListener</td><td>侦听 GM_setValue 储存名称的值的更改并返回更改前和后的值</td></tr><tr><td>GM_removeValueChangeListener</td><td>删除由 GM_addValueChangeListener 添加的侦听器</td></tr><tr><td>GM_log</td><td>向控制台记录消息</td></tr><tr><td>GM_getResourceText</td><td>获取由 @resource 预加载的资源</td></tr><tr><td>GM_getResourceURL</td><td>获取由 @resource 预加载的 Base64 编码 URI</td></tr><tr><td>GM_registerMenuCommand</td><td>注册一个菜单，在运行此脚本的页面的中显示</td></tr><tr><td>GM_unregisterMenuCommand</td><td>取消由 GM_registerMenuCommand 注册的菜单</td></tr><tr><td>GM_openInTab</td><td>通过给定的 URL 打开一个新标签页</td></tr><tr><td>GM_xmlhttpRequest</td><td>通过脚本发送的 XHR 请求</td></tr><tr><td>GM_download</td><td>通过给定的 URL 下载文件到本地</td></tr><tr><td>GM_saveTab</td><td>保存选项卡对象，生命周期为选项卡的打开-&gt;关闭</td></tr><tr><td>GM_getTab</td><td>获取选项卡对象，生命周期为选项卡的打开-&gt;关闭</td></tr><tr><td>GM_getTabs</td><td>获取所有选项卡对象，生命周期为选项卡的打开-&gt;关闭</td></tr><tr><td>GM_notification</td><td>显示桌面通知</td></tr><tr><td>GM_setClipboard</td><td>将数据复制到剪贴板</td></tr></tbody></table><h2 id="三、工程化" tabindex="-1">三、工程化 <a class="header-anchor" href="#三、工程化" aria-label="Permalink to &quot;三、工程化&quot;">​</a></h2><p>最基础的开发方式是通过插件自带的在线编辑器开发，但有着诸多问题：只能写原生 js、没有代码提示、没有 js model ，只能通过 @require API 引入第三方库、没有工程化概念，复杂工程管理困难、没有模块热更新等。</p><p>第二种方式：通过脚本 <code>@require file:\\C:\\Users\\userName\\Desktop\\tm_demo\\xxx.user.js</code> 引用本地资源这种方式，配合 IDE ，如 vscode 开发，但这种只解决了部分问题，复杂项目依然难以维护。</p><p>第三种：是通过 <a href="https://puppeteer.bootcss.com/" target="_blank" rel="noreferrer">puppeteer</a>，加载 Tampermonkey 魔改插件，对插件进行了非侵入式 hook，并且起了个服务器跟浏览器的插件用 socket 通信，实现了文件的自动监控，授权修改，动态更新。原理可参考：<a href="https://bbs.tampermonkey.net.cn/thread-6744-1-1.html" target="_blank" rel="noreferrer">李恒道—尝试抹平 Tampermonkey 的 VSCode 开发体验</a>。</p><p>第四种：最常见的是通过 webpack/rollup/uglify-js/esbuild/vite 等构建工具，我选择了 <a href="https://github.com/lisonge/vite-plugin-monkey" target="_blank" rel="noreferrer">vite-plugin-monkey</a>，vite 相比 webpack 的优势在于：</p><ul><li>明确区分了 开发/构建 模式</li><li>暴露了本地开发服务器的 api 供外部使用</li><li>更加轻量快速的热重载</li><li>支持中间件，用来生成中间桥接代码，无需每次生成文件或手动填写代码</li></ul><p>具体可参考：<a href="https://github.com/lisonge/vite-plugin-monkey" target="_blank" rel="noreferrer">lisonge/vite-plugin-monkey：一个 vite 插件服务器和构建 your.user.js，用于 Tampermonkey、Violentmonkey、Greasemonkey、ScriptCat 等用户脚本引擎 (github.com)</a></p><h2 id="四、常见问题" tabindex="-1">四、常见问题 <a class="header-anchor" href="#四、常见问题" aria-label="Permalink to &quot;四、常见问题&quot;">​</a></h2><h3 id="_1-异步获取元素" tabindex="-1">1. 异步获取元素 <a class="header-anchor" href="#_1-异步获取元素" aria-label="Permalink to &quot;1. 异步获取元素&quot;">​</a></h3><p>获取 dom 节点时可能会出现元素延迟加载的问题，常见解决方案如下：</p><p>使用 settimeout 获取，缺点：实时性不足（需要等当前 tick），有性能损失</p><p>DOMNodeInserted 事件的性能也 不好</p><p>MutationObserver ，缺点：语法复杂</p><p>使用第三方库：如 <a href="https://bbs.tampermonkey.net.cn/thread-2726-1-1.html" target="_blank" rel="noreferrer">异步获取元素的脚本库 ElementGetter-油猴中文网 (tampermonkey.net.cn)</a> 等，</p><h3 id="_2-存在-iframe-框架" tabindex="-1">2. 存在 iframe 框架 <a class="header-anchor" href="#_2-存在-iframe-框架" aria-label="Permalink to &quot;2. 存在 iframe 框架&quot;">​</a></h3><p>存在某个网页通过 iframe 内嵌了其它网页需要注入，解决方案如下：</p><p>@match 匹配到脚本内部</p><p>在同域的情况下可以获取到 iframe 元素后通过 conetentWindow 属性访问 iframe 的作用域</p><h3 id="_3-需要掌握的-js-api" tabindex="-1">3. 需要掌握的 JS API <a class="header-anchor" href="#_3-需要掌握的-js-api" aria-label="Permalink to &quot;3. 需要掌握的 JS API&quot;">​</a></h3><p>MutationObserver 参考：<a href="https://zh.javascript.info/mutation-observer" target="_blank" rel="noreferrer">DOM 变动观察器（Mutation observer） (javascript.info)</a></p><p>Proxy 参考：<a href="https://zh.javascript.info/proxy" target="_blank" rel="noreferrer">Proxy 和 Reflect (javascript.info)</a></p><h3 id="_4-需要知道的-css-知识点" tabindex="-1">4. 需要知道的 CSS 知识点 <a class="header-anchor" href="#_4-需要知道的-css-知识点" aria-label="Permalink to &quot;4. 需要知道的 CSS 知识点&quot;">​</a></h3><p>需要知道：<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors" target="_blank" rel="noreferrer">CSS 选择器 - CSS：层叠样式表 | MDN (mozilla.org)</a></p><h1 id="油猴脚本开发实战" tabindex="-1">油猴脚本开发实战 <a class="header-anchor" href="#油猴脚本开发实战" aria-label="Permalink to &quot;油猴脚本开发实战&quot;">​</a></h1><p>参考文章合集：<a href="https://juejin.cn/column/7139154267742896165" target="_blank" rel="noreferrer">油猴脚本 - 狂奔滴小马的专栏 - 掘金 (juejin.cn)</a></p><h2 id="新建脚本" tabindex="-1">新建脚本 <a class="header-anchor" href="#新建脚本" aria-label="Permalink to &quot;新建脚本&quot;">​</a></h2><p>在脚本管理控制台，右上角的<code>+</code>添加按钮，新建一个脚本，默认会包含以下代码：</p><p><img src="`+e+`" alt="新建脚本"></p><p>最上面的注释不能删除，Tampermonkey 就通过注释代码来配置脚本字段的</p><ul><li><p><code>@match</code> 用来匹配注入脚本网址的 url 其中 * 代表一个或者多个任意字符</p><p>若要匹配 baidu 域名下的任意网页可以使用 <code>*://*.baidu.com/*</code>;</p><p>若要匹配任意网址，可以使用<code>*://*/*</code></p></li><li><p><code> @require</code> 代表要注入的公用 JS 库</p><p>比如要使用 jquery，可以使用以下代码</p></li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// @require https://code.jquery.com/jquery-2.1.4.min.js</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @require tampermonkey://vendor/jquery.js</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @require tampermonkey://vendor/jszip/jszip.js</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="csdn-免登录复制" tabindex="-1">CSDN 免登录复制 <a class="header-anchor" href="#csdn-免登录复制" aria-label="Permalink to &quot;CSDN 免登录复制&quot;">​</a></h2><p>比如 CSDN 中代码块复制必须要登录后才可以复制， 那么我们就可以写一个脚本，输入以下代码</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @name         CSDN 免登录复制</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @version      0.1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @description  try to take over the world!</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @match        *://*.csdn.net/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @require      tampermonkey://vendor/jquery.js</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        none</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#98C379;">	&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">	$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;pre,code&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">css</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;user-select&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;auto&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>保存后，重新刷新浏览器，在右上角的扩展标志中会向上一个<code>1</code>, 说明有一个扩展作用于这个网页，脚本注入成功。</p><p><img src="`+o+`" alt="CSDN 免登录复制"></p><p>其实就是一行代码，CSDN 的默认代码块的样式是 <code>user-select: none;</code>，不能复制，改成 <code>auto</code> 后就可以复制了。</p><h2 id="添加样式" tabindex="-1">添加样式 <a class="header-anchor" href="#添加样式" aria-label="Permalink to &quot;添加样式&quot;">​</a></h2><p>首先需要在最上面的注释中开启权限 <code>@grant</code> <code>GM_addStyle</code>，然后就可以使用内置的 <code>GM_addStyle</code> 方法了。</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        GM_addStyle</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"><span style="color:#61AFEF;">GM_addStyle</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#98C379;">	\`pre,code{user-select:auto !important}.signin{display: none !important;}\`</span></span>
<span class="line"><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这样也可以解决 CSDN 代码块不能复制的问题，顺便将代码块后面的<code>登录后复制</code>按钮隐藏；</p><p>当然我们也可以使用 JS 自己实现</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> heads</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">querySelector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;head&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> style</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createElement</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;style&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">style</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">setAttribute</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;type&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;text/css&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">style</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">innerHTML</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> \`pre,code{user-select:auto !important}.signin{display: none !important;}\`</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;">heads</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">append</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">style</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="网络请求" tabindex="-1">网络请求 <a class="header-anchor" href="#网络请求" aria-label="Permalink to &quot;网络请求&quot;">​</a></h2><p>一般前端脚本都是修改前端网页内容，若复杂一点的脚本，可能会涉及到动态数据，比如我们在脚本中直接写<code>fetch</code> 请求，这时浏览器肯定会阻止请求，因为跨域了。</p><p>我们需要使用脚本的内置方法</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        GM_xmlhttpRequest</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"><span style="color:#61AFEF;">GM_xmlhttpRequest</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">	headers</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#98C379;">		&quot;content-type&quot;</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;application/json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	responseType</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;json&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">	url</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;https://api.juejin.cn/recommend_api/v1/article/recommend_cate_feed&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">	data</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;{&quot;id_type&quot;:2,&quot;sort_type&quot;:200,&quot;cate_id&quot;:&quot;6809637767543259144&quot;,&quot;cursor&quot;:&quot;0&quot;,&quot;limit&quot;:20}&#39;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">	method</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;POST&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#61AFEF;">	onreadystatechange</span><span style="color:#ABB2BF;">: (</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">		if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">readyState</span><span style="color:#56B6C2;"> ===</span><span style="color:#D19A66;"> 4</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">			console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">response</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>在最上面的注释中开启权限 <code>@grant</code> <code>GM_xmlhttpRequest</code>，然后就可以使用内置的 <code>GM_xmlhttpRequest</code> 方法了。</p><p>比如把接口换成有道翻译的 api。通过 <code> document.getSelection().toString();</code> 获取网页中的选中文本，便可以实现一个划词翻译油猴插件了。 <img src="`+t+`" alt="划词翻译"></p><h2 id="右键搜索" tabindex="-1">右键搜索 <a class="header-anchor" href="#右键搜索" aria-label="Permalink to &quot;右键搜索&quot;">​</a></h2><p>接下来我们将结合右键菜单和打开新窗口的内置函数，实现一个快捷搜索的功能， 同样内置函数需要在最上面的注释中加入权限，代码如下：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        GM_registerMenuCommand</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        GM_openInTab</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">GM_registerMenuCommand</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;GitHub 搜索&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#C678DD;">	const</span><span style="color:#E5C07B;"> str</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSelection</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">str</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">		GM_openInTab</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`https://github.com/search?q=</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">str</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">, { </span><span style="color:#E06C75;">active</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> });</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;">GM_registerMenuCommand</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;NPM 搜索&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#C678DD;">	const</span><span style="color:#E5C07B;"> str</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">getSelection</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">toString</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">str</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#61AFEF;">		GM_openInTab</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">\`https://www.npmjs.com/search?q=</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">str</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">\`</span><span style="color:#ABB2BF;">, { </span><span style="color:#E06C75;">active</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;"> });</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><img src="`+r+'" alt="右键搜索"></p><p>这样就有了快捷菜单搜索的功能，只是操作挂着 3 级目录下，操作有些不方便。</p><p>以上简单介绍了脚本的开发以及一些简单实现，但这个脚本我们只能在自己电脑使用，若想让其他小伙伴也能够使用，我们需要将脚本发布到脚本脚本市场，供其他小伙伴下载。</p><h2 id="脚本发布" tabindex="-1">脚本发布 <a class="header-anchor" href="#脚本发布" aria-label="Permalink to &quot;脚本发布&quot;">​</a></h2><p>一个非常流行的脚本共享网站便是 <a href="https://greasyfork.org/zh-CN" target="_blank" rel="noreferrer">greasyfork.org</a>，有着非常丰富的脚本，并且支持多语言。</p><p><img src="'+c+`" alt="greasyfork 脚本发布"></p><p>注册账号后，点击右上角的<code>用户名</code>，然后点击控制台中的<code>发布你编写的脚本</code>，贴入你写的脚本代码，便可以发布成功！将发布后的链接发送个小伙伴，就可以让他们安装你写的脚本了，你也可以在上面根据匹配域名搜索相关脚本，看大神们是如何来写脚本的。</p><h2 id="前端工程化" tabindex="-1">前端工程化 <a class="header-anchor" href="#前端工程化" aria-label="Permalink to &quot;前端工程化&quot;">​</a></h2><p>现代前端开发已经离不开前端框架，若直接使用原生 JS 让我们写复杂的功能，难免会让我们崩溃，比如需要在 JS 中写 CSS，一不小心写错就会让整个脚本无法执行。所以我们可以使用 webpack 来构建一个工程化的项目。 并且使用 Typescript 和 eslint ，让我们的前端工程健全。</p><p>下面是 <code>webpack.config.js</code></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> webpack</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;webpack&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> fs</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fs&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> path</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;path&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> config</span><span style="color:#56B6C2;"> =</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E06C75;">	entry</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;./src/index.tsx&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">	output</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		clean</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		iife</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		path</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">resolve</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__dirname</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;dist&quot;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#E06C75;">		filename</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;bundle.js&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	devServer</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		static</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">			directory</span><span style="color:#ABB2BF;">: </span><span style="color:#E5C07B;">path</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">join</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">__dirname</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;public&quot;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#ABB2BF;">		},</span></span>
<span class="line"><span style="color:#E06C75;">		compress</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		port</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">9000</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// 脚本发布后，会被举报，不允许压缩</span></span>
<span class="line"><span style="color:#E06C75;">	optimization</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		minimize</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	module</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		rules</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#ABB2BF;">			{</span></span>
<span class="line"><span style="color:#E06C75;">				test</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">(js</span><span style="color:#ABB2BF;">|</span><span style="color:#E06C75;">jsx)</span><span style="color:#C678DD;">$</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">				use</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;babel-loader&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">				exclude</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /node_modules/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">			},</span></span>
<span class="line"><span style="color:#ABB2BF;">			{</span></span>
<span class="line"><span style="color:#E06C75;">				test</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">css</span><span style="color:#C678DD;">$</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">				use</span><span style="color:#ABB2BF;">: [</span></span>
<span class="line"><span style="color:#ABB2BF;">					{</span></span>
<span class="line"><span style="color:#E06C75;">						loader</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;style-loader&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">						options</span><span style="color:#ABB2BF;">: {},</span></span>
<span class="line"><span style="color:#ABB2BF;">					},</span></span>
<span class="line"><span style="color:#ABB2BF;">					{ </span><span style="color:#E06C75;">loader</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;css-loader&quot;</span><span style="color:#ABB2BF;"> },</span></span>
<span class="line"><span style="color:#ABB2BF;">				],</span></span>
<span class="line"><span style="color:#ABB2BF;">			},</span></span>
<span class="line"><span style="color:#ABB2BF;">			{</span></span>
<span class="line"><span style="color:#E06C75;">				test</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /</span><span style="color:#56B6C2;">\\.</span><span style="color:#E06C75;">ts(x)</span><span style="color:#D19A66;">?</span><span style="color:#C678DD;">$</span><span style="color:#E06C75;">/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">				loader</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;ts-loader&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">				exclude</span><span style="color:#ABB2BF;">:</span><span style="color:#E06C75;"> /node_modules/</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">			},</span></span>
<span class="line"><span style="color:#ABB2BF;">		],</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#E06C75;">	plugins</span><span style="color:#ABB2BF;">: [</span><span style="color:#C678DD;">new</span><span style="color:#61AFEF;"> BannerPlugin</span><span style="color:#ABB2BF;">()],</span></span>
<span class="line"><span style="color:#E06C75;">	resolve</span><span style="color:#ABB2BF;">: {</span></span>
<span class="line"><span style="color:#E06C75;">		extensions</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&quot;.tsx&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;.ts&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;.js&quot;</span><span style="color:#ABB2BF;">],</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">module</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">exports</span><span style="color:#56B6C2;"> =</span><span style="color:#E06C75;"> config</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>使用 <code>style-loader</code>，在 webpack 打包后，会自动将 css 样式通过 style 标签插入到 head 中，这样就做到了 css 和 js 分离。 这里有个问题，就是油猴脚本特有的代码前置注释 <code>==UserScript==</code>，在 webpack 打包后会被删除，所以我们得自己实现一个插件，将这段注释加回来。</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#C678DD;">const</span><span style="color:#E5C07B;"> ConcatSource</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> require</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;webpack-sources&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#E06C75;">ConcatSource</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> * 添加前缀注释</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C678DD;">class</span><span style="color:#E5C07B;"> BannerPlugin</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;">	apply</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">compiler</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">		let</span><span style="color:#E06C75;"> banner</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> &quot;&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> entryFile</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> compiler</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">options</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">entry</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">main</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">import</span><span style="color:#ABB2BF;">[</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> res</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> fs</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">readFileSync</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">entryFile</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;utf-8&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">		const</span><span style="color:#E5C07B;"> matched</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> res</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">match</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;">			/(</span><span style="color:#56B6C2;">\\/\\/</span><span style="color:#E06C75;">\\s==UserScript==)(?&lt;content&gt;(\\n.</span><span style="color:#D19A66;">+</span><span style="color:#E06C75;">)</span><span style="color:#D19A66;">+</span><span style="color:#E06C75;">)(\\n</span><span style="color:#56B6C2;">\\/\\/</span><span style="color:#E06C75;">\\s==</span><span style="color:#56B6C2;">\\/</span><span style="color:#E06C75;">UserScript==)/</span></span>
<span class="line"><span style="color:#ABB2BF;">		);</span></span>
<span class="line"><span style="color:#C678DD;">		if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">matched</span><span style="color:#56B6C2;"> &amp;&amp;</span><span style="color:#E5C07B;"> matched</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">groups</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">content</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E06C75;">			banner</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#98C379;">				&quot;// ==UserScript==&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#E5C07B;"> matched</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">groups</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">content</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &quot;</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">// ==/UserScript==</span><span style="color:#56B6C2;">\\n</span><span style="color:#98C379;">&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#E5C07B;">		compiler</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">hooks</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">emit</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">tap</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;BannerPlugin&quot;</span><span style="color:#ABB2BF;">, (</span><span style="color:#E06C75;font-style:italic;">compilation</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">			compilation</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">chunks</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">chunk</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">				// 最终生成的文件的集合</span></span>
<span class="line"><span style="color:#E5C07B;">				chunk</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">files</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forEach</span><span style="color:#ABB2BF;">((</span><span style="color:#E06C75;font-style:italic;">fileName</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">					compilation</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">assets</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">fileName</span><span style="color:#ABB2BF;">] </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> ConcatSource</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#E06C75;">						banner</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E5C07B;">						compilation</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">assets</span><span style="color:#ABB2BF;">[</span><span style="color:#E06C75;">fileName</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">					);</span></span>
<span class="line"><span style="color:#ABB2BF;">				});</span></span>
<span class="line"><span style="color:#ABB2BF;">			});</span></span>
<span class="line"><span style="color:#ABB2BF;">		});</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>上述代码通过正则匹配 <code>==UserScript==</code> 之间的代码，并且将匹配的内容合并到了最后的代码 <code>chunk</code> 中。</p><h2 id="cicd" tabindex="-1">CICD <a class="header-anchor" href="#cicd" aria-label="Permalink to &quot;CICD&quot;">​</a></h2><p>若我们每次打包后的 JS 都需要手动拷贝到 <code>greasyfork.org</code> 未免有些麻烦，得益于 <code>greasyfork.org</code> 有个自动发布的功能，我们可以配合 GitHub actions 来实现自动发布。</p><p>在项目文件夹下建立 <code>.github/workflows/build.yml</code>， 输入以下代码</p><div class="language-yml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">GitHub Pages</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D19A66;">on</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  push</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    branches</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#98C379;">main</span></span>
<span class="line"><span style="color:#E06C75;">  pull_request</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">jobs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  deploy</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    runs-on</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">ubuntu-20.04</span></span>
<span class="line"><span style="color:#E06C75;">    permissions</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      contents</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">write</span></span>
<span class="line"><span style="color:#E06C75;">    concurrency</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      group</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${{ github.workflow }}-\${{ github.ref }}</span></span>
<span class="line"><span style="color:#E06C75;">    steps</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">actions/checkout@v3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Setup Node</span></span>
<span class="line"><span style="color:#E06C75;">        uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">actions/setup-node@v3</span></span>
<span class="line"><span style="color:#E06C75;">        with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">          node-version</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;14&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Get yarn cache</span></span>
<span class="line"><span style="color:#E06C75;">        id</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">yarn-cache</span></span>
<span class="line"><span style="color:#E06C75;">        run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">echo &quot;::set-output name=dir::$(yarn cache dir)&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Cache dependencies</span></span>
<span class="line"><span style="color:#E06C75;">        uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">actions/cache@v2</span></span>
<span class="line"><span style="color:#E06C75;">        with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">          path</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${{ steps.yarn-cache.outputs.dir }}</span></span>
<span class="line"><span style="color:#E06C75;">          key</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${{ runner.os }}-yarn-\${{ hashFiles(&#39;**/yarn.lock&#39;) }}</span></span>
<span class="line"><span style="color:#E06C75;">          restore-keys</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">|</span></span>
<span class="line"><span style="color:#98C379;">            \${{ runner.os }}-yarn-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">yarn install</span></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">run</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">yarn build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">      - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Deploy</span></span>
<span class="line"><span style="color:#E06C75;">        uses</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color:#E06C75;">        if</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${{ github.ref == &#39;refs/heads/main&#39; }}</span></span>
<span class="line"><span style="color:#E06C75;">        with</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">          github_token</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">\${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color:#E06C75;">          publish_dir</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">./dist</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>当我们把代码提交到 Github ，就会自动触发 workflow ，依次执行 <code>yarn install</code> 、<code>yarn build</code> 并且自动将 <code>dist</code> 目录下的代码自动部署到 GitHub pages。</p><p>接下来我们复制 pages 中的 raw 源文件地址</p><p><img src="`+i+'" alt="github 源文件地址"></p><p>贴入复制的源文件地址</p><p><img src="'+B+'" alt="img"></p><ul><li>设置脚本同步为自动</li><li>并且设置 webhook</li></ul><p><img src="'+y+'" alt=" webhook 配置"></p><p>复制这里对应的 webhook 地址和秘钥</p><p><img src="'+b+'" alt="github 设置 webhook"></p><p>在 GitHub 项目地址中添加 webhook</p><p>这样只要我们一旦提交代码， greasyfork.org 中的脚本便会自动更新最新版本。</p><p>以上所有配置整理在<a href="https://maqi1520/tampermonkey-starter" target="_blank" rel="noreferrer">tampermonkey-starter</a>中， 若你也想创建一个自己的脚本，可以直接 fork 项目，修改相关配置即可。</p><h2 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h2><p>本文简单介绍了油猴脚本开发步骤以及实现，结合 webpack 让脚本实现工程化，并且配合 Github action，让脚本实现自动化构建和部署。</p><p>但是若想要实现一些有用的脚本，还需要具备更多的知识，比如<code>JS逆向分析</code>等，若你有好的想法，赶快行动起来吧！</p><h1 id="编写一个自动点击的油猴脚本" tabindex="-1">编写一个自动点击的油猴脚本 <a class="header-anchor" href="#编写一个自动点击的油猴脚本" aria-label="Permalink to &quot;编写一个自动点击的油猴脚本&quot;">​</a></h1><h3 id="_1-缘起" tabindex="-1">1. 缘起 <a class="header-anchor" href="#_1-缘起" aria-label="Permalink to &quot;1. 缘起&quot;">​</a></h3><p>最近逛学习网站的时候总是会弹出来各种莫名其妙的框框，十分苦恼之下，偶然间注意到了我浏览器右上角的一个神奇的插件，想起来过往种种用油猴刷英文视频的经历，突然想要自己编写一个油猴插件试一试，所以就有了这篇文章。</p><p>因为我是边学边做作品，所以肯定会有些地方写得不成熟，这是正常现象，不要大惊小怪，现在进入正题。</p><p>这里如何在浏览器里面安装油猴插件，因为太简单，就不多做介绍了。网上相关经验很多。</p><h3 id="_2-油猴插件实现原理" tabindex="-1">2. 油猴插件实现原理 <a class="header-anchor" href="#_2-油猴插件实现原理" aria-label="Permalink to &quot;2. 油猴插件实现原理&quot;">​</a></h3><p>油猴的原理，以我目前浅显的了解，就是在特定的玩野，执行特定的、编辑好的 js 脚本，从而实现包括但不限于去广告、实现自动签到、改变网站的布局等等，各种客户端的功能。由于这种脚本只是在客户端做手脚，所以对于网站运营商来说，几乎不会造成任何影响，所以目前应该也不用担心做这个会被送银手镯的问题。</p><h3 id="_3-实现功能分析" tabindex="-1">3. 实现功能分析 <a class="header-anchor" href="#_3-实现功能分析" aria-label="Permalink to &quot;3. 实现功能分析&quot;">​</a></h3><p>目前的目标(要实现的功能)如下</p><p>Alpha 版:</p><ul><li>去掉看雪论坛上面的升级正式会员的弹框(给发不了好文章的兄弟们带来福音)</li></ul><p>Beta 版:</p><ul><li>实现看雪论坛的自动签到</li></ul><p>Release 1.0.0 版:</p><p>实现以上两种功能即可 Release。</p><h3 id="_4-代码设计" tabindex="-1">4. 代码设计 <a class="header-anchor" href="#_4-代码设计" aria-label="Permalink to &quot;4. 代码设计&quot;">​</a></h3><p>然后就是整篇文章的主题部分了，那就是该怎么写这个脚本。</p><p>首先，这个油猴要写的是 js 的脚本，这就要求开发者要会一点前端的技术。起码得会一点 js，对前端有简单了解。</p><h4 id="_4-1-创建脚本" tabindex="-1">4.1 创建脚本 <a class="header-anchor" href="#_4-1-创建脚本" aria-label="Permalink to &quot;4.1 创建脚本&quot;">​</a></h4><p>打开控制面板，点击顶部导航栏最左侧的+号创建自己的脚本。</p><p><img src="'+u+`" alt="image-20230317222015569.png"></p><p>编辑器里面就是我们要写脚本的地方了，可以看到这里已经给出了一部分内容，下面是要实现功能得代码部分，上面是脚本的注释部分，油猴的注释会被解析出来，不同的注释代表着不同的含义。</p><p>关于这里各个注释的含义，这里借鉴一下，<a href="https://blog.csdn.net/mukes/article/details/109727662" target="_blank" rel="noreferrer">别人的总结</a>。</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @name         这里是你的编写的油猴脚本的名字</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @namespace    这个是命名空间；用来区分名称相同但是作者不同的用户脚本，一般都是写作者的个人网址，没有也可以写你的博客地址</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @version      0.1  这个是版本号</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @description  这个是功能描述，描述你的这个脚本是用来干嘛的</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @author       这个是作者的名字，比如我：mukes</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @match        这个是该脚本匹配的网址，支持通配符匹配</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @include		 这个也是该脚本匹配的网址，支持通配符匹配</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @exclude		 这个和 iclude 配合使用，排除匹配到的网址，优先于 include</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        none</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>借由此，我们可以很容易地写出来自己的文件头</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @name         看雪一键签到</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @namespace    http://lyricpoem.cn/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @version      Alpha</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @description  实现看雪论坛一键签到，以及去掉看雪的新手顶部弹框。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @author       Lyr1cP03m</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @match        https://bbs.kanxue.com/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        none</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#98C379;">	&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// Your code here...</span></span>
<span class="line"><span style="color:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_4-2-关闭弹框功能实现" tabindex="-1">4.2 关闭弹框功能实现 <a class="header-anchor" href="#_4-2-关闭弹框功能实现" aria-label="Permalink to &quot;4.2 关闭弹框功能实现&quot;">​</a></h4><p>接下来就是重中之重了，那就是代码的具体实现。这里我首先要实现的功能是关闭看雪论坛的新人弹框。</p><p>这个其实他既然设置了能点击右上角关闭弹框，我们直接抄下来他的关闭的代码就行了，事实证明，这个关闭弹框的功能并不难</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 关闭弹框</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.temporary_member_box&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">css</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;height&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>设置该盒子的 css height 为 0px 即可。</p><h4 id="_4-3-实现自动签到" tabindex="-1">4.3 实现自动签到 <a class="header-anchor" href="#_4-3-实现自动签到" aria-label="Permalink to &quot;4.3 实现自动签到&quot;">​</a></h4><p>这个本来也挺简单的，我开始写的内容如下。</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// 自动签到  (使用改脚本会多访问一次\`user-is_signin.htm\`这个接口)</span></span>
<span class="line"><span style="color:#E5C07B;">$</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">ajax</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">	url</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;user-is_signin.htm&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#61AFEF;">	function</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;font-style:italic;">code</span><span style="color:#ABB2BF;">, </span><span style="color:#E06C75;font-style:italic;">message</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">		if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">			//查询到未签到的处理方式</span></span>
<span class="line"><span style="color:#61AFEF;">			$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">			console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;已一键签到*_*&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">			// 查询到签过到了的处理方式</span></span>
<span class="line"><span style="color:#C678DD;">			var</span><span style="color:#E06C75;"> sign_html</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> \`&lt;p&gt;</span><span style="color:#C678DD;">\${</span><span style="color:#E06C75;">message</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">&lt;/p&gt;\`</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">			$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">html</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">sign_html</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">			$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">addClass</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;signin_over&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">removeClass</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sign&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>我尝试刷新了一下，但是并不起作用，简单看下控制台出现了新的 warnings，如下。</p><p><img src="`+d+`" alt="image-20230317233611807.png"></p><p>warning 内容为</p><p>Cross-Origin Read Blocking (CORB) 已屏蔽 MIME 类型为 text/html 的跨域响应 <a href="https://www.kanxue.com/%E3%80%82" target="_blank" rel="noreferrer">https://www.kanxue.com/。</a></p><p>如需了解详情，请参阅：<a href="https://www.chromestatus.com/feature/5629709824032768%E3%80%82" target="_blank" rel="noreferrer">https://www.chromestatus.com/feature/5629709824032768。</a></p><p>这个跨域请求问题油猴有内置的解决方案，解决后的脚本内容如下</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#61AFEF;">GM_xmlhttpRequest</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">	method</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;GET&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">	url</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;https://bbs.kanxue.com/user-is_signin.htm&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#61AFEF;">	onload</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;">		if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 1</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">			//查询到未签到的处理方式</span></span>
<span class="line"><span style="color:#61AFEF;">			$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">			console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;[+]TemperMonkeyMessage 已一键签到*_*&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ==</span><span style="color:#D19A66;"> 0</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">			// 查询到签过到了的处理方式</span></span>
<span class="line"><span style="color:#E5C07B;">			console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;[+]TemperMonkeyMessage 已签过到*_*&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">			var</span><span style="color:#E06C75;"> sign_html</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> \`&lt;p&gt;</span><span style="color:#C678DD;">\${</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">message</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">&lt;/p&gt;\`</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">			$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">html</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">sign_html</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">			$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">addClass</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;signin_over&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">removeClass</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sign&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#ABB2BF;">	},</span></span>
<span class="line"><span style="color:#ABB2BF;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>但是问题显然还是没被解决，因为点击效果一直没成。</p><p>后来输出一下<code>console.log($(&quot;.signin&quot;))</code>明白了。</p><p><img src="`+m+`" alt="image-20230318002411257.png"></p><p>原来是这个 class 对应了两个不同的按钮，油猴脚本这里需要指定要点击的按钮是第几个才行。</p><p>还是没解决，应该是油猴脚本的执行时机不对的问题，前端 js 的各种玄学问题。这里不具体研究了，发现其实直接加一个 setTimeout 就挺管用的。有可能是各种资源没加载完，不太懂，有懂得师傅可以解释一下。</p><h4 id="_4-4-alpha-版本的代码" tabindex="-1">4.4 Alpha 版本的代码 <a class="header-anchor" href="#_4-4-alpha-版本的代码" aria-label="Permalink to &quot;4.4 Alpha 版本的代码&quot;">​</a></h4><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @name         看雪一键签到</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @namespace    http://lyricpoem.cn/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @version      Alpha</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @description  实现看雪论坛一键签到，以及去掉看雪的新手顶部弹框。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @author       Lyr1cP03m</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @match        https://bbs.kanxue.com/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        GM_xmlhttpRequest</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#98C379;">	&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// 关闭弹框</span></span>
<span class="line"><span style="color:#61AFEF;">	$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.temporary_member_box&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">css</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;height&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;0&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// 自动签到  (使用改脚本会多访问一次\`user-is_signin.htm\`这个接口)</span></span>
<span class="line"><span style="color:#61AFEF;">	GM_xmlhttpRequest</span><span style="color:#ABB2BF;">({</span></span>
<span class="line"><span style="color:#E06C75;">		method</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;GET&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#E06C75;">		url</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;https://bbs.kanxue.com/user-is_signin.htm&quot;</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#61AFEF;">		onload</span><span style="color:#ABB2BF;">: </span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;font-style:italic;">res</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E06C75;">			res</span><span style="color:#56B6C2;"> =</span><span style="color:#61AFEF;"> eval</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;(&quot;</span><span style="color:#56B6C2;"> +</span><span style="color:#E5C07B;"> res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">response</span><span style="color:#56B6C2;"> +</span><span style="color:#98C379;"> &quot;)&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">			console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">res</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">			if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;1&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">				//查询到未签到的处理方式</span></span>
<span class="line"><span style="color:#61AFEF;">				setTimeout</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#61AFEF;">					$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">				}, </span><span style="color:#D19A66;">1000</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">				console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;[+]TemperMonkeyMessage 已一键签到*_*&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">			} </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">code</span><span style="color:#56B6C2;"> ==</span><span style="color:#98C379;"> &quot;0&quot;</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">				// 查询到签过到了的处理方式</span></span>
<span class="line"><span style="color:#E5C07B;">				console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;[+]TemperMonkeyMessage 已签过到*_*&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">				var</span><span style="color:#E06C75;"> sign_html</span><span style="color:#56B6C2;"> =</span><span style="color:#98C379;"> \`&lt;span&gt;</span><span style="color:#C678DD;">\${</span><span style="color:#E5C07B;">res</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">message</span><span style="color:#C678DD;">}</span><span style="color:#98C379;">&lt;/span&gt;\`</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;">				$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">html</span><span style="color:#ABB2BF;">(</span><span style="color:#E06C75;">sign_html</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;">				$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">attr</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;disabled&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;true&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">//签过到后禁用按钮。</span></span>
<span class="line"><span style="color:#61AFEF;">				$</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;.signin&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">addClass</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;signin_over&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">removeClass</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sign&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">			}</span></span>
<span class="line"><span style="color:#ABB2BF;">		},</span></span>
<span class="line"><span style="color:#ABB2BF;">	});</span></span>
<span class="line"><span style="color:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="_5-发布自己的脚本" tabindex="-1">5. 发布自己的脚本 <a class="header-anchor" href="#_5-发布自己的脚本" aria-label="Permalink to &quot;5. 发布自己的脚本&quot;">​</a></h3><p>接下来就是最后一步了，那就是发布自己的脚本到<code>GreasyFork (油叉)</code>了。首先在<a href="https://greasyfork.org/zh-CN" target="_blank" rel="noreferrer">油叉</a>上登录。</p><p><img src="`+F+`" alt="image-20230318011609752.png"></p><p>在个人中心里面发布自己的脚本，但是这里新用户是不能发布脚本的，可以先上传到 GitHub 上面，等几天再发布。</p><p>GitHub：<a href="https://github.com/m4xlmum/GreasyFork-Scripts" target="_blank" rel="noreferrer">GreasyFork-Scripts</a></p><h1 id="手机上用油猴实现自动抢购某台" tabindex="-1">手机上用油猴实现自动抢购某台 <a class="header-anchor" href="#手机上用油猴实现自动抢购某台" aria-label="Permalink to &quot;手机上用油猴实现自动抢购某台&quot;">​</a></h1><p>要在移动端使用油猴脚本实现自动化操作（比如抢购茅台）是有一定限制的，因为主流的移动浏览器（如 Chrome 和 Safari）通常不支持油猴脚本。</p><p>不过，有一个方法可以绕过这一限制，那就是使用支持用户脚本的移动浏览器。</p><p>对于 Android 用户，可以考虑使用如 <strong>Kiwi Browser</strong> 或 <strong>Yandex Browser</strong>，这些浏览器基于 Chromium，支持 Chrome 扩展，包括油猴（Tampermonkey）。</p><h3 id="步骤-1-在-android-设备上安装支持扩展的浏览器" tabindex="-1">步骤 1: 在 Android 设备上安装支持扩展的浏览器 <a class="header-anchor" href="#步骤-1-在-android-设备上安装支持扩展的浏览器" aria-label="Permalink to &quot;步骤 1: 在 Android 设备上安装支持扩展的浏览器&quot;">​</a></h3><ol><li>下载并安装 Kiwi Browser 或 Yandex Browser:</li></ol><ul><li><p>打开 Google Play Store。</p></li><li><p>搜索 “Kiwi Browser” 或 “Yandex Browser”。</p></li><li><p>选择浏览器并安装。</p></li></ul><h3 id="步骤-2-安装-tampermonkey-扩展" tabindex="-1">步骤 2: 安装 Tampermonkey 扩展 <a class="header-anchor" href="#步骤-2-安装-tampermonkey-扩展" aria-label="Permalink to &quot;步骤 2: 安装 Tampermonkey 扩展&quot;">​</a></h3><ol><li>在安装好的浏览器中，打开扩展页面（通常在菜单中有“扩展”选项）。</li><li>搜索 Tampermonkey 官网或在 Google 上搜索 Tampermonkey 的 Chrome Web Store 页面，下载并安装 Tampermonkey 扩展。</li></ol><h3 id="步骤-3-创建并编辑油猴脚本" tabindex="-1">步骤 3: 创建并编辑油猴脚本 <a class="header-anchor" href="#步骤-3-创建并编辑油猴脚本" aria-label="Permalink to &quot;步骤 3: 创建并编辑油猴脚本&quot;">​</a></h3><ol><li>点击浏览器中 Tampermonkey 图标，选择“添加新脚本”。</li><li>在脚本编辑器中，删除默认模板，粘贴以下示例脚本：</li></ol><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic;">// ==UserScript==</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @name         自动购买茅台移动版</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @namespace    http://tampermonkey.net/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @version      0.1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @description  自动化在移动端天猫购买茅台酒</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @author       You</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @match        *://*/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @grant        none</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// @run-at       document-end</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">// ==/UserScript==</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">function</span><span style="color:#ABB2BF;"> () {</span></span>
<span class="line"><span style="color:#98C379;">	&quot;use strict&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">	// 每次页面加载后检查是否为茅台的购买页面</span></span>
<span class="line"><span style="color:#C678DD;">	if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">window</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">location</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">href</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">includes</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;chaoshi.detail.tmall.com&quot;</span><span style="color:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#61AFEF;">		setTimeout</span><span style="color:#ABB2BF;">(() </span><span style="color:#C678DD;">=&gt;</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">			// 尝试找到购买按钮并点击</span></span>
<span class="line"><span style="color:#C678DD;">			const</span><span style="color:#E5C07B;"> buyButton</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> document</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">querySelector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;button.buy&quot;</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// 根据实际页面调整选择器</span></span>
<span class="line"><span style="color:#C678DD;">			if</span><span style="color:#ABB2BF;"> (</span><span style="color:#E06C75;">buyButton</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">				buyButton</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">click</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">			} </span><span style="color:#C678DD;">else</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">				console</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">log</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;购买按钮未找到&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">			}</span></span>
<span class="line"><span style="color:#ABB2BF;">		}, </span><span style="color:#D19A66;">3000</span><span style="color:#ABB2BF;">); </span><span style="color:#7F848E;font-style:italic;">// 延迟3秒钟执行，等待页面加载完成</span></span>
<span class="line"><span style="color:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ol start="3"><li>修改脚本中的 <code>@match</code> 以适应实际的 URL，修改选择器以适应实际的按钮。</li></ol><h3 id="步骤-4-测试和调整脚本" tabindex="-1">步骤 4: 测试和调整脚本 <a class="header-anchor" href="#步骤-4-测试和调整脚本" aria-label="Permalink to &quot;步骤 4: 测试和调整脚本&quot;">​</a></h3><ul><li><p>打开目标购买页面，观察脚本是否能正确执行。</p></li><li><p>根据需要调整延迟时间或按钮选择器。</p></li></ul><h3 id="注意事项" tabindex="-1"><strong>注意事项</strong> <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;**注意事项**&quot;">​</a></h3><ul><li><p>自动化购买脚本可能违反天猫或其他平台的服务条款，使用时需谨慎。</p></li><li><p>确保脚本不会无意中触发不需要的购买。</p></li><li><p>该方法可能不适用于 iOS 设备，因为 iOS 的浏览器架构限制了此类扩展。</p></li></ul><p>通过这种方法，您可以在支持扩展的移动浏览器上实现类似 PC 浏览器油猴脚本的功能，从而在移动设备上自动化一些操作。这为移动端网页自动化提供了一种可行的解决方案。</p><h3 id="做些优化" tabindex="-1">做些优化 <a class="header-anchor" href="#做些优化" aria-label="Permalink to &quot;做些优化&quot;">​</a></h3><p>对于在移动端使用油猴脚本进行自动化的场景，以下优化帮助您更安全、更有效地实施自动化策略：</p><h4 id="_1-监测和调试" tabindex="-1">1.监测和调试 <a class="header-anchor" href="#_1-监测和调试" aria-label="Permalink to &quot;1.监测和调试&quot;">​</a></h4><ul><li><p>调试脚本：使用浏览器的开发者工具进行调试，检查是否有 JavaScript 错误或者查看网络请求等。虽然在移动设备上进行调试比较复杂，但使用基于 Chromium 的浏览器如 Kiwi 或 Yandex 可以让这个过程更接近桌面体验。</p></li><li><p>日志记录：在你的脚本中增加适当的日志记录，这可以帮助你理解脚本在实际环境中的行为，尤其是在处理异步事件和响应时。</p></li></ul><h4 id="_2-用户界面友好性" tabindex="-1">2.用户界面友好性 <a class="header-anchor" href="#_2-用户界面友好性" aria-label="Permalink to &quot;2.用户界面友好性&quot;">​</a></h4><ul><li><p>反馈机制：确保脚本在执行操作时有清晰的用户反馈。例如，当点击按钮或完成购买时，可以显示一些提示信息，让用户知道脚本已经执行。</p></li><li><p>错误处理：增强脚本的错误处理能力，确保在遇到意外情况（如元素未找到、网络请求失败等）时，脚本能给出错误提示并优雅地终止或重试。</p></li></ul><h4 id="_3-性能考虑" tabindex="-1">3.性能考虑 <a class="header-anchor" href="#_3-性能考虑" aria-label="Permalink to &quot;3.性能考虑&quot;">​</a></h4><ul><li><p>避免过度轮询：使用<code>setTimeout</code>或<code>setInterval</code>进行元素检查或操作时，设置合理的间隔时间，避免对设备性能造成影响或增加不必要的服务器请求。</p></li><li><p>资源清理：确保脚本在完成任务后能正确清理已占用的资源，如关闭不再需要的定时器，删除不必要的全局变量等。</p></li></ul><h1 id="开源插件" tabindex="-1">开源插件 <a class="header-anchor" href="#开源插件" aria-label="Permalink to &quot;开源插件&quot;">​</a></h1><p><a href="https://github.com/xxxily/h5player" target="_blank" rel="noreferrer">xxxily/h5player：本软件支持所有音视频网站，如 TikTok、YouTube、哔哩哔哩、TED、Instagram、Twitter 等。功能包括：可变播放速度、截屏、视频下载、自定义设置、扩展等，为您提供愉悦的在线音视频播放体验。 (github.com)</a></p><p><a href="https://github.com/CodFrm/cxmooc-tools" target="_blank" rel="noreferrer">CodFrm/cxmooc-tools: 一个 超星(学习通)/智慧树(知到)/中国大学mooc 学习工具,火狐,谷歌,油猴支持.全自动任务,视频倍速秒过,作业考试题库,验证码自动打码(੧ᐛ੭挂科模式,启动) (github.com)</a></p><p>脚本增强视频播放功能，兼容所有H5视频网站，如：Bilibili、TikTok、腾讯视频、优酷、爱奇艺、西瓜视频、YouTube、微博视频、知乎视频、搜狐视频、网易公开课、百度网盘、阿里云Disk、TED、Instagram、Twitter 等等。</p><p>脚本支持键盘快捷键全程控制，支持播放速度控制、视频截图、画中画、网页全屏、调节亮度、饱和度、对比度、增强的自定义配置可用性等功能，为您提供愉悦的在线视频播放体验经验：<a href="https://github.com/xxxily/h5player" target="_blank" rel="noreferrer">https://github.com/xxxily/h5player</a></p>`,198)]))}const D=n(A,[["render",C]]);export{_ as __pageData,D as default};
